const {
    useState: useState,
    useEffect: useEffect
} = React, API_URL = "https://tutts-backend-production.up.railway.app/api";
// ==================== LOGGER CONTROLADO (PRODU√á√ÉO) ====================
(function() {
    if (window.__loggerConfigured) return;
    const isProduction = !['localhost', '127.0.0.1'].includes(window.location.hostname);
    if (isProduction) {
        const noop = () => {};
        window.console.log = noop;
        window.console.debug = noop;
        window.console.info = noop;
    }
    window.__loggerConfigured = true;
})();
// ==================== FIM LOGGER CONTROLADO ====================

// ==================== LOGO URL ====================
const TUTTS_LOGO_URL = "https://github.com/Leonardodevcloud/tutts-frontend/blob/main/logotuttsoriginal.png?raw=true";

// ==================== SPLASH SCREEN COMPONENT ====================
const SplashScreen = ({ onComplete }) => {
    const [phase, setPhase] = useState(0);
    useEffect(() => {
        const t1 = setTimeout(() => setPhase(1), 800);
        const t2 = setTimeout(() => setPhase(2), 2500);
        const t3 = setTimeout(() => onComplete(), 3000);
        return () => { clearTimeout(t1); clearTimeout(t2); clearTimeout(t3); };
    }, [onComplete]);
    return React.createElement("div", {
        className: `fixed inset-0 z-[9999] flex flex-col items-center justify-center bg-gradient-to-br from-purple-100 to-purple-200 ${phase === 2 ? 'splash-fade-out' : ''}`
    },
        React.createElement("div", { className: "absolute inset-0 flex items-center justify-center pointer-events-none" },
            React.createElement("div", { className: "w-36 h-36 rounded-full border-4 border-purple-400/30 splash-ring-expand", style: { animationDelay: '0s' } }),
            React.createElement("div", { className: "w-36 h-36 rounded-full border-4 border-purple-300/20 splash-ring-expand absolute", style: { animationDelay: '0.7s' } }),
            React.createElement("div", { className: "w-36 h-36 rounded-full border-4 border-purple-200/10 splash-ring-expand absolute", style: { animationDelay: '1.4s' } })
        ),
        React.createElement("div", { className: "relative" },
            React.createElement("div", { className: `relative ${phase >= 0 ? 'splash-logo-reveal' : 'opacity-0'}` },
                React.createElement("div", { className: "absolute inset-0 bg-purple-500/30 rounded-xl blur-2xl scale-125" }),
                React.createElement("img", { src: TUTTS_LOGO_URL, alt: "Tutts Logo", className: `relative w-28 h-28 rounded-xl shadow-2xl object-cover ${phase >= 1 ? 'splash-logo-pulse' : ''}` })
            )
        ),
        React.createElement("div", { className: `mt-8 text-center ${phase >= 1 ? 'splash-text-reveal' : 'opacity-0'}` },
            React.createElement("h1", { className: "text-2xl font-bold text-gray-800 mb-1" }, "Central do Entregador Tutts"),
            React.createElement("p", { className: "text-gray-500 text-sm" }, "Solicita√ß√µes e Saque Emergencial")
        ),
        React.createElement("div", { className: `mt-10 w-48 h-1 bg-purple-200 rounded-full overflow-hidden ${phase >= 1 ? 'opacity-100' : 'opacity-0'}`, style: { transition: 'opacity 0.3s' } },
            React.createElement("div", { className: "h-full splash-shimmer-bar rounded-full" })
        ),
        React.createElement("p", { className: `mt-4 text-purple-600 text-sm font-medium ${phase >= 1 ? 'opacity-100' : 'opacity-0'}`, style: { transition: 'opacity 0.3s ease 0.2s' } }, "Carregando...")
    );
};
// ==================== FIM SPLASH SCREEN ====================

// ==================== API KEY REMOVIDA - AGORA USA PROXY NO BACKEND ====================
// SEGURAN√áA: A API key foi movida para o backend (vari√°vel de ambiente ORS_API_KEY)

// ==================== FUN√á√ïES DE SEGURAN√áA ====================

// Sanitizar HTML para prevenir XSS em popups e elementos din√¢micos
const escapeHtml = (text) => {
    if (!text) return '';
    const div = document.createElement('div');
    div.textContent = String(text);
    return div.innerHTML;
};

// Sanitizar para uso em atributos HTML
const escapeAttr = (text) => {
    if (!text) return '';
    return String(text)
        .replace(/&/g, '&amp;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;');
};

// ==================== FIM FUN√á√ïES DE SEGURAN√áA ====================

// ==================== SISTEMA DE VERS√ÉO E CACHE ====================
const APP_VERSION = "2.2.3"; // Security Patch V3 - Refresh Token + Account Lock
const VERSION_KEY = "tutts_app_version";

// Verificar se precisa limpar cache (vers√£o diferente)
(function checkVersion() {
    const savedVersion = localStorage.getItem(VERSION_KEY);
    if (savedVersion !== APP_VERSION) {
        console.log(`üîÑ Atualizando de ${savedVersion || 'inicial'} para ${APP_VERSION}`);
        
        // Limpar caches
        if ('caches' in window) {
            caches.keys().then(names => {
                names.forEach(name => {
                    caches.delete(name);
                    console.log(`üóëÔ∏è Cache ${name} limpo`);
                });
            });
        }
        
        // Limpar localStorage antigo (exceto dados importantes)
        const keysToKeep = ['tutts_user', 'tutts_token', VERSION_KEY];
        Object.keys(localStorage).forEach(key => {
            if (!keysToKeep.includes(key) && !key.startsWith('tutts_tutorial')) {
                localStorage.removeItem(key);
            }
        });
        
        // Salvar nova vers√£o
        localStorage.setItem(VERSION_KEY, APP_VERSION);
        
        // For√ßar reload se tinha vers√£o anterior (n√£o no primeiro acesso)
        if (savedVersion) {
            console.log('üîÑ Recarregando para aplicar atualiza√ß√µes...');
            window.location.reload(true);
        }
    }
})();

// For√ßar atualiza√ß√£o do Service Worker se existir
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.getRegistrations().then(registrations => {
        registrations.forEach(registration => {
            registration.update();
        });
    });
}

// ==================== FIM SISTEMA DE VERS√ÉO ====================

// ==================== FUN√á√ïES DE AUTENTICA√á√ÉO ====================

// Obter token JWT armazenado
const getToken = () => {
    return sessionStorage.getItem("tutts_token");
};

// Obter refresh token armazenado
const getRefreshToken = () => {
    return localStorage.getItem("tutts_refresh_token"); // localStorage para persistir entre sess√µes
};

// Salvar token JWT
const setToken = (token) => {
    if (token) {
        sessionStorage.setItem("tutts_token", token);
    } else {
        sessionStorage.removeItem("tutts_token");
    }
};

// Salvar refresh token
const setRefreshToken = (refreshToken) => {
    if (refreshToken) {
        localStorage.setItem("tutts_refresh_token", refreshToken);
    } else {
        localStorage.removeItem("tutts_refresh_token");
    }
};

// Vari√°vel para controlar se est√° renovando token (evitar m√∫ltiplas chamadas)
let isRefreshingToken = false;
let refreshPromise = null;

// Fun√ß√£o para renovar token usando refresh token
const renovarToken = async () => {
    // Se j√° est√° renovando, esperar a promise existente
    if (isRefreshingToken && refreshPromise) {
        return refreshPromise;
    }
    
    const refreshToken = getRefreshToken();
    if (!refreshToken) {
        return null;
    }
    
    isRefreshingToken = true;
    
    refreshPromise = (async () => {
        try {
            const response = await fetch(API_URL + '/users/refresh-token', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ refreshToken })
            });
            
            if (response.ok) {
                const data = await response.json();
                setToken(data.token);
                if (data.refreshToken) {
                    setRefreshToken(data.refreshToken);
                }
                if (data.user) {
                    sessionStorage.setItem("tutts_user", JSON.stringify(data.user));
                }
                console.log('üîÑ Token renovado automaticamente');
                return data.token;
            } else {
                // Refresh token inv√°lido ou expirado - fazer logout
                console.log('‚ùå Refresh token inv√°lido - fazendo logout');
                fazerLogoutCompleto();
                return null;
            }
        } catch (error) {
            console.error('‚ùå Erro ao renovar token:', error);
            return null;
        } finally {
            isRefreshingToken = false;
            refreshPromise = null;
        }
    })();
    
    return refreshPromise;
};

// Fun√ß√£o para fazer logout completo
const fazerLogoutCompleto = () => {
    sessionStorage.removeItem("tutts_user");
    sessionStorage.removeItem("tutts_token");
    localStorage.removeItem("tutts_refresh_token");
    window.location.reload();
};

// Fun√ß√£o para fazer requisi√ß√µes autenticadas com auto-refresh
const fetchAuth = async (url, options = {}, retryCount = 0) => {
    let token = getToken();
    const headers = {
        'Content-Type': 'application/json',
        ...options.headers
    };
    
    if (token) {
        headers['Authorization'] = `Bearer ${token}`;
    }
    
    try {
        const response = await fetch(url, {
            ...options,
            headers
        });
        
        // Se token expirou, tentar renovar automaticamente
        if (response.status === 401 && token && retryCount === 0) {
            const data = await response.clone().json().catch(() => ({}));
            
            if (data.expired) {
                console.log('üîÑ Token expirado, tentando renovar...');
                const novoToken = await renovarToken();
                
                if (novoToken) {
                    // Retry com novo token
                    return fetchAuth(url, options, retryCount + 1);
                } else {
                    fazerLogoutCompleto();
                }
            }
        }
        
        return response;
    } catch (error) {
        console.error('Erro na requisi√ß√£o:', error);
        throw error;
    }
};

// ==================== FIM FUN√á√ïES DE AUTENTICA√á√ÉO ====================

// Fun√ß√£o helper para verificar permiss√µes de m√≥dulo
// Retorna true se o usu√°rio tem acesso ao m√≥dulo
function hasModuleAccess(user, moduleId) {
    if (!user) return false;
    
    // Admin master tem acesso a tudo
    if (user.role === "admin_master") return true;
    
    // Admin financeiro tem acesso apenas ao financeiro e solicita√ß√µes
    if (user.role === "admin_financeiro") {
        return ["financeiro", "solicitacoes", "disponibilidade"].includes(moduleId);
    }
    
    // User comum tem acesso ao m√≥dulo de filas (para check-in na fila)
    if (user.role === "user") {
        return ["filas"].includes(moduleId);
    }
    
    // Admin normal - verificar permiss√µes
    if (user.role === "admin") {
        // Se n√£o tem permiss√µes configuradas, dar acesso a tudo
        if (!user.permissions || !user.permissions.modulos) return true;
        
        // Se hasConfig √© false, significa que nunca foi configurado
        if (user.permissions.hasConfig === false) return true;
        
        // Verificar permiss√£o espec√≠fica do m√≥dulo
        const perm = user.permissions.modulos[moduleId];
        // Se a permiss√£o √© undefined ou true, tem acesso
        // Se √© false, n√£o tem acesso
        return perm !== false;
    }
    
    return false;
}

// Fun√ß√£o helper para encontrar a primeira aba permitida de um m√≥dulo
function getFirstAllowedTab(user, moduleId, defaultTab) {
    if (!user) return defaultTab;
    
    // Admin master tem acesso a tudo
    if (user.role === "admin_master") return defaultTab;
    
    // Encontrar configura√ß√£o do m√≥dulo
    const moduloConfig = SISTEMA_MODULOS_CONFIG.find(m => m.id === moduleId);
    if (!moduloConfig || !moduloConfig.abas) return defaultTab;
    
    // Se n√£o tem permiss√µes de abas configuradas, retorna o default
    const abas = user.permissions && user.permissions.abas ? user.permissions.abas : {};
    if (Object.keys(abas).length === 0) return defaultTab;
    
    // Procurar primeira aba permitida
    for (let i = 0; i < moduloConfig.abas.length; i++) {
        const aba = moduloConfig.abas[i];
        const abaKey = moduleId + "_" + aba.id.replace("-", "");
        if (abas[abaKey] !== false) {
            return aba.id;
        }
    }
    
    // Se nenhuma aba permitida, retorna o default
    return defaultTab;
}

// CONFIGURA√á√ÉO GLOBAL DE M√ìDULOS E ABAS - Edite aqui para adicionar novos m√≥dulos/abas
const SISTEMA_MODULOS_CONFIG = [
    { id: "solicitacoes", label: "Solicita√ß√µes", icon: "üìã",
      abas: [{id: "dashboard", label: "Dashboard"}, {id: "search", label: "Busca"}, {id: "ranking", label: "Ranking"}, {id: "relatorios", label: "Relat√≥rios"}]
    },
    { id: "financeiro", label: "Financeiro", icon: "üí∞",
      abas: [{id: "home-fin", label: "üè† Home"}, {id: "solicitacoes", label: "Solicita√ß√µes"}, {id: "validacao", label: "Valida√ß√£o"}, {id: "conciliacao", label: "Concilia√ß√£o"}, {id: "resumo", label: "Resumo"}, {id: "gratuidades", label: "Gratuidades"}, {id: "restritos", label: "Restritos"}, {id: "indicacoes", label: "Indica√ß√µes"}, {id: "promo-novatos", label: "Promo Novatos"}, {id: "loja", label: "Loja"}, {id: "relatorios", label: "Relat√≥rios"}, {id: "horarios", label: "Hor√°rios"}, {id: "avisos", label: "Avisos"}, {id: "backup", label: "Backup"}, {id: "saldo-plific", label: "Saldo Plific"}]
    },
    { id: "operacional", label: "Operacional", icon: "‚öôÔ∏è",
      abas: [{id: "indicacoes", label: "Indica√ß√µes"}, {id: "promo-novatos", label: "Promo Novatos"}, {id: "avisos", label: "Avisos"}, {id: "novas-operacoes", label: "Novas Opera√ß√µes"}, {id: "recrutamento", label: "Recrutamento"}, {id: "localizacao-clientes", label: "Localiza√ß√£o Clientes"}, {id: "relatorio-diario", label: "Relat√≥rio Di√°rio"}, {id: "score-prof", label: "Score Prof"}, {id: "incentivos", label: "Acompanhamento"}]
    },
    { id: "disponibilidade", label: "Disponibilidade", icon: "üìÖ",
      abas: [{id: "panorama", label: "Panorama"}, {id: "principal", label: "Principal"}, {id: "faltosos", label: "Faltosos"}, {id: "espelho", label: "Espelho"}, {id: "relatorios", label: "Relat√≥rios"}, {id: "motoboys", label: "Motoboys"}, {id: "restricoes", label: "Restri√ß√µes"}, {id: "config", label: "Configura√ß√µes"}]
    },
    { id: "bi", label: "BI", icon: "üìä",
      abas: [{id: "home-bi", label: "üè† Home"}, {id: "dashboard", label: "Dashboard"}, {id: "acompanhamento", label: "Acompanhamento"}, {id: "profissionais", label: "Por Profissional"}, {id: "garantido", label: "Garantido"}, {id: "os", label: "An√°lise por OS"}, {id: "upload", label: "Upload"}, {id: "config", label: "Configura√ß√µes"}]
    },
    { id: "todo", label: "TO-DO", icon: "üìù",
      abas: [{id: "tarefas", label: "Tarefas"}, {id: "metricas", label: "M√©tricas"}]
    },
    { id: "filas", label: "Filas", icon: "üë•",
      abas: [{id: "monitoramento", label: "Monitoramento"}, {id: "vinculos", label: "V√≠nculos"}, {id: "relatorios", label: "Relat√≥rios"}, {id: "config", label: "Configura√ß√µes"}]
    },
    { id: "social", label: "Social", icon: "üíú",
      abas: [{id: "perfil", label: "Meu Perfil"}, {id: "comunidade", label: "Comunidade"}, {id: "mensagens", label: "Mensagens"}]
    },
    { id: "config", label: "Configura√ß√µes", icon: "üîß",
      abas: [{id: "usuarios", label: "Usu√°rios"}, {id: "permissoes", label: "Permiss√µes ADM"}, {id: "clientes-api", label: "Clientes API"}, {id: "auditoria", label: "Auditoria"}, {id: "sistema", label: "Sistema"}]
    }
];

// ==================== COMPONENTE NAVEGA√á√ÉO HORIZONTAL ====================
const NavegacaoHorizontal = ({ usuario, moduloAtivo, abaAtiva, onNavigate, hasModuleAccess, socialProfile, onLogout, isLoading, lastUpdate, onRefresh }) => {
    const moduloConfig = SISTEMA_MODULOS_CONFIG.find(m => m.id === moduloAtivo);
    const abas = moduloConfig?.abas || [];
    
    return React.createElement("div", { className: "sticky top-0 z-40" },
        // Header principal
        React.createElement("header", { className: "bg-gradient-to-r from-indigo-900 to-purple-900 shadow-lg" },
            React.createElement("div", { className: "max-w-full mx-auto px-4 py-2" },
                // Linha 1: Logo + M√≥dulos + Usu√°rio
                React.createElement("div", { className: "flex items-center justify-between gap-4" },
                    // Logo
                    React.createElement("button", {
                        onClick: () => onNavigate("home", null),
                        className: "flex items-center gap-2 hover:opacity-80 transition-opacity flex-shrink-0",
                        title: "Ir para In√≠cio"
                    },
                        React.createElement("img", {
                            src: "https://github.com/Leonardodevcloud/tutts-frontend/blob/main/logotuttsoriginal.png?raw=true",
                            alt: "Tutts",
                            className: "w-10 h-10 rounded-lg"
                        }),
                        React.createElement("span", { className: "text-white font-bold text-lg hidden lg:block" }, "Tutts")
                    ),
                    
                    // Navega√ß√£o de M√≥dulos
                    React.createElement("nav", { className: "flex-1 flex items-center justify-center gap-1 overflow-x-auto px-2 scrollbar-hide" },
                        // Bot√£o Home
                        React.createElement("button", {
                            onClick: () => onNavigate("home", null),
                            className: "flex items-center gap-1.5 px-3 py-2 rounded-lg text-sm font-medium transition-all whitespace-nowrap " +
                                (moduloAtivo === "home" ? "bg-white text-purple-900 shadow-lg" : "text-white/80 hover:bg-white/10 hover:text-white")
                        },
                            React.createElement("span", { className: "text-lg" }, "üè†"),
                            React.createElement("span", { className: "hidden sm:inline" }, "In√≠cio")
                        ),
                        
                        // M√≥dulos
                        SISTEMA_MODULOS_CONFIG.filter(m => hasModuleAccess(usuario, m.id)).map(modulo =>
                            React.createElement("button", {
                                key: modulo.id,
                                onClick: () => onNavigate(modulo.id, modulo.abas?.[0]?.id || null),
                                className: "flex items-center gap-1.5 px-3 py-2 rounded-lg text-sm font-medium transition-all whitespace-nowrap " +
                                    (moduloAtivo === modulo.id ? "bg-white text-purple-900 shadow-lg" : "text-white/80 hover:bg-white/10 hover:text-white")
                            },
                                React.createElement("span", { className: "text-lg" }, modulo.icon),
                                React.createElement("span", { className: "hidden md:inline" }, modulo.label)
                            )
                        )
                    ),
                    
                    // Lado direito: Status + Usu√°rio
                    React.createElement("div", { className: "flex items-center gap-2 flex-shrink-0" },
                        // Status de conex√£o
                        React.createElement("div", { className: "flex items-center gap-1.5 bg-white/10 px-2 py-1 rounded-full" },
                            React.createElement("span", { className: "w-2 h-2 rounded-full " + (isLoading ? "bg-yellow-400 animate-pulse" : "bg-green-400") }),
                            React.createElement("span", { className: "text-xs text-white/70 hidden sm:block" },
                                isLoading ? "..." : lastUpdate ? lastUpdate.toLocaleTimeString("pt-BR", { hour: "2-digit", minute: "2-digit" }) : "‚ö°"
                            )
                        ),
                        // Bot√£o refresh
                        React.createElement("button", {
                            onClick: onRefresh,
                            className: "p-1.5 bg-white/10 text-white rounded-lg hover:bg-white/20 transition-colors",
                            title: "Atualizar"
                        }, "üîÑ"),
                        // Avatar e nome
                        React.createElement("div", { className: "flex items-center gap-2" },
                            socialProfile?.profile_photo ? 
                                React.createElement("img", {
                                    src: socialProfile.profile_photo,
                                    className: "w-8 h-8 rounded-full object-cover border-2 border-white/30"
                                }) : 
                                React.createElement("div", {
                                    className: "w-8 h-8 rounded-full bg-purple-600 flex items-center justify-center text-white font-bold text-sm"
                                }, usuario?.fullName?.charAt(0)?.toUpperCase() || "?"),
                            React.createElement("div", { className: "hidden lg:block" },
                                React.createElement("p", { className: "text-white text-sm font-medium leading-tight" }, usuario?.fullName?.split(" ")[0] || "Usu√°rio"),
                                React.createElement("p", { className: "text-indigo-300 text-xs leading-tight" },
                                    usuario?.role === "admin_master" ? "üëë Master" :
                                    usuario?.role === "admin" ? "üëë Admin" :
                                    usuario?.role === "admin_financeiro" ? "üí∞ Financeiro" : "üë§ Usu√°rio"
                                )
                            )
                        ),
                        // Logout
                        React.createElement("button", {
                            onClick: onLogout,
                            className: "p-1.5 text-white/70 hover:text-white hover:bg-white/10 rounded-lg transition-colors",
                            title: "Sair"
                        }, "üö™")
                    )
                )
            )
        ),
        
        // Barra de abas do m√≥dulo (se houver abas)
        abas.length > 0 && React.createElement("div", { className: "bg-white shadow border-b" },
            React.createElement("div", { className: "max-w-full mx-auto px-4" },
                React.createElement("nav", { className: "flex items-center gap-1 overflow-x-auto py-1 scrollbar-hide" },
                    abas.map(aba =>
                        React.createElement("button", {
                            key: aba.id,
                            onClick: () => onNavigate(moduloAtivo, aba.id),
                            className: "px-4 py-2 text-sm font-medium rounded-lg transition-all whitespace-nowrap " +
                                (abaAtiva === aba.id ? 
                                    "bg-purple-100 text-purple-800 shadow-sm" : 
                                    "text-gray-600 hover:bg-gray-100 hover:text-gray-900")
                        }, aba.label)
                    )
                )
            )
        )
    );
};

// ==================== COMPONENTE SIDEBAR AUTO-HIDE (MANTIDO PARA COMPATIBILIDADE) ====================
const Sidebar = ({ usuario, moduloAtivo, setModulo, menuAberto, setMenuAberto, sidebarAberto, setSidebarAberto, sidebarFixo, setSidebarFixo, hasModuleAccess, onNavigate, socialProfile }) => {
    const sidebarVisivel = sidebarAberto || sidebarFixo;
    
    const handleModuloClick = (modulo) => {
        if (modulo.abas && modulo.abas.length > 0) {
            setMenuAberto(menuAberto === modulo.id ? null : modulo.id);
        } else {
            onNavigate(modulo.id, null);
            if (!sidebarFixo) setSidebarAberto(false);
        }
    };
    
    const handleAbaClick = (moduloId, abaId) => {
        onNavigate(moduloId, abaId);
        if (!sidebarFixo) setSidebarAberto(false);
    };
    
    // Adiciona "home" no in√≠cio para o sidebar
    const modulosComHome = [{ id: "home", label: "In√≠cio", icon: "üè†", abas: [] }, ...SISTEMA_MODULOS_CONFIG];
    
    return React.createElement("div", {
        className: "fixed left-0 top-0 h-full z-40 flex",
        onMouseLeave: () => !sidebarFixo && setSidebarAberto(false)
    },
        // Barra de trigger (sempre vis√≠vel)
        React.createElement("div", {
            className: "w-2 h-full bg-gradient-to-b from-purple-900 to-indigo-900 hover:w-3 transition-all cursor-pointer flex items-center justify-center",
            onMouseEnter: () => setSidebarAberto(true),
            onClick: () => setSidebarFixo(!sidebarFixo)
        },
            React.createElement("div", { className: "w-1 h-20 bg-white/30 rounded-full" })
        ),
        // Sidebar expandido
        React.createElement("div", {
            className: "h-full bg-gradient-to-b from-purple-900 via-indigo-900 to-purple-950 shadow-2xl transition-all duration-300 overflow-hidden flex flex-col " + 
                (sidebarVisivel ? "w-64 opacity-100" : "w-0 opacity-0"),
            style: { transitionProperty: 'width, opacity' }
        },
            // Header do sidebar
            React.createElement("div", { className: "p-4 border-b border-white/10 flex items-center justify-between" },
                React.createElement("div", {className: "flex items-center gap-3"},
                    socialProfile?.profile_photo ? React.createElement("img", {
                        src: socialProfile.profile_photo,
                        className: "w-10 h-10 rounded-full object-cover border-2 border-white/30"
                    }) : React.createElement("div", {
                        className: "w-10 h-10 rounded-full bg-purple-600 flex items-center justify-center text-white font-bold text-lg"
                    }, usuario?.fullName?.charAt(0)?.toUpperCase() || "?"),
                    React.createElement("div", {className: "overflow-hidden"},
                        React.createElement("p", {className: "text-white font-semibold text-sm truncate"}, usuario?.fullName || "Usu√°rio"),
                        React.createElement("p", {className: "text-purple-300 text-xs truncate"}, 
                            usuario?.role === "admin_master" ? "üëë Master" :
                            usuario?.role === "admin" ? "üëë Admin" :
                            usuario?.role === "admin_financeiro" ? "üí∞ Financeiro" : "üë§ Usu√°rio"
                        )
                    )
                ),
                React.createElement("button", {
                    onClick: () => setSidebarFixo(!sidebarFixo),
                    className: "p-2 rounded-lg hover:bg-white/10 transition-colors " + (sidebarFixo ? "text-yellow-400" : "text-white/50"),
                    title: sidebarFixo ? "Desafixar menu" : "Fixar menu"
                }, sidebarFixo ? "üìå" : "üìç")
            ),
            // Menu items
            React.createElement("div", {className: "flex-1 overflow-y-auto py-2"},
                modulosComHome.filter(m => m.id === "home" || hasModuleAccess(usuario, m.id)).map(modulo => 
                    React.createElement("div", {key: modulo.id},
                        React.createElement("button", {
                            onClick: () => handleModuloClick(modulo),
                            className: "w-full px-4 py-3 flex items-center justify-between text-left transition-all " + 
                                (moduloAtivo === modulo.id ? "bg-white/20 text-white border-l-4 border-yellow-400" : "text-white/80 hover:bg-white/10 hover:text-white border-l-4 border-transparent")
                        },
                            React.createElement("div", {className: "flex items-center gap-3"},
                                React.createElement("span", {className: "text-xl"}, modulo.icon),
                                React.createElement("span", {className: "font-medium"}, modulo.label)
                            ),
                            modulo.abas && modulo.abas.length > 0 && React.createElement("span", {
                                className: "text-white/50 transition-transform " + (menuAberto === modulo.id ? "rotate-180" : "")
                            }, "‚ñº")
                        ),
                        menuAberto === modulo.id && modulo.abas && modulo.abas.length > 0 && React.createElement("div", { className: "bg-black/20 py-1" },
                            modulo.abas.map(aba => 
                                React.createElement("button", {
                                    key: aba.id,
                                    onClick: () => handleAbaClick(modulo.id, aba.id),
                                    className: "w-full px-4 py-2 pl-12 text-left text-sm text-white/70 hover:bg-white/10 hover:text-white transition-colors"
                                }, aba.label)
                            )
                        )
                    )
                )
            ),
            React.createElement("div", {className: "p-3 border-t border-white/10"},
                React.createElement("p", {className: "text-center text-white/30 text-xs"}, "üèçÔ∏è Tutts v2.1")
            )
        )
    );
};

// ==================== HEADER COMPACTO GLOBAL ====================
const HeaderCompacto = ({ usuario, moduloAtivo, abaAtiva, socialProfile, isLoading, lastUpdate, onRefresh, onLogout, onGoHome, onNavigate, onChangeTab }) => {
    const moduloConfig = SISTEMA_MODULOS_CONFIG.find(m => m.id === moduloAtivo);
    const abas = moduloConfig?.abas || [];
    
    return React.createElement("div", { className: "sticky top-0 z-30" },
        // Header principal
        React.createElement("header", {
            className: "bg-gradient-to-r from-indigo-900 to-purple-900 shadow-lg"
        },
            React.createElement("div", { className: "max-w-full mx-auto px-3 py-2" },
                React.createElement("div", { className: "flex items-center justify-between gap-2" },
                    // Logo
                    React.createElement("button", {
                        onClick: onGoHome,
                        className: "flex items-center gap-2 hover:opacity-80 transition-opacity flex-shrink-0",
                        title: "Ir para In√≠cio"
                    },
                        React.createElement("img", {
                            src: "https://github.com/Leonardodevcloud/tutts-frontend/blob/main/logotuttsoriginal.png?raw=true",
                            alt: "Tutts",
                            className: "w-9 h-9 rounded-lg",
                            onError: (e) => { e.target.style.display = "none"; }
                        }),
                        React.createElement("span", { className: "text-white font-bold text-lg hidden lg:block" }, "Tutts")
                    ),
                    
                    // Navega√ß√£o de M√≥dulos - Centro
                    React.createElement("nav", { className: "flex-1 flex items-center justify-center gap-1 overflow-x-auto px-2" },
                        // Bot√£o Home
                        React.createElement("button", {
                            onClick: onGoHome,
                            className: "flex items-center gap-1 px-2.5 py-1.5 rounded-lg text-xs font-medium transition-all whitespace-nowrap " +
                                (moduloAtivo === "home" ? "bg-white text-purple-900 shadow" : "text-white/80 hover:bg-white/10")
                        },
                            React.createElement("span", null, "üè†"),
                            React.createElement("span", { className: "hidden sm:inline" }, "In√≠cio")
                        ),
                        
                        // Todos os m√≥dulos
                        SISTEMA_MODULOS_CONFIG.filter(m => hasModuleAccess(usuario, m.id)).map(modulo =>
                            React.createElement("button", {
                                key: modulo.id,
                                onClick: () => onNavigate ? onNavigate(modulo.id, modulo.abas?.[0]?.id) : null,
                                className: "flex items-center gap-1 px-2.5 py-1.5 rounded-lg text-xs font-medium transition-all whitespace-nowrap " +
                                    (moduloAtivo === modulo.id ? "bg-white text-purple-900 shadow" : "text-white/80 hover:bg-white/10")
                            },
                                React.createElement("span", null, modulo.icon),
                                React.createElement("span", { className: "hidden md:inline" }, modulo.label)
                            )
                        )
                    ),
                    
                    // Lado direito: Status + Usu√°rio
                    React.createElement("div", { className: "flex items-center gap-2 flex-shrink-0" },
                        // Status
                        React.createElement("div", { className: "flex items-center gap-1 bg-white/10 px-2 py-1 rounded-full" },
                            React.createElement("span", { className: "w-2 h-2 rounded-full " + (isLoading ? "bg-yellow-400 animate-pulse" : "bg-green-400") }),
                            React.createElement("span", { className: "text-xs text-white/70 hidden sm:block" },
                                isLoading ? "..." : lastUpdate ? lastUpdate.toLocaleTimeString("pt-BR", { hour: "2-digit", minute: "2-digit" }) : ""
                            )
                        ),
                        // Refresh
                        React.createElement("button", {
                            onClick: onRefresh,
                            className: "p-1.5 bg-white/10 text-white rounded-lg hover:bg-white/20"
                        }, "üîÑ"),
                        // Avatar
                        React.createElement("div", { className: "flex items-center gap-2" },
                            socialProfile?.profile_photo ?
                                React.createElement("img", {
                                    src: socialProfile.profile_photo,
                                    className: "w-8 h-8 rounded-full object-cover border-2 border-white/30"
                                }) :
                                React.createElement("div", {
                                    className: "w-8 h-8 rounded-full bg-purple-600 flex items-center justify-center text-white font-bold text-sm"
                                }, usuario?.fullName?.charAt(0)?.toUpperCase() || "?"),
                            React.createElement("div", { className: "hidden lg:block" },
                                React.createElement("p", { className: "text-white text-sm font-medium leading-tight" }, usuario?.fullName?.split(" ")[0] || "Usu√°rio"),
                                React.createElement("p", { className: "text-indigo-300 text-xs leading-tight" },
                                    usuario?.role === "admin_master" ? "üëë Master" :
                                    usuario?.role === "admin" ? "üëë Admin" :
                                    usuario?.role === "admin_financeiro" ? "üí∞ Financeiro" : "üë§ Usu√°rio"
                                )
                            )
                        ),
                        // Logout
                        React.createElement("button", {
                            onClick: onLogout,
                            className: "p-1.5 text-white/70 hover:text-white hover:bg-white/10 rounded-lg"
                        }, "üö™")
                    )
                )
            )
        ),
        
        // Barra de abas do m√≥dulo (se houver abas, n√£o for home, e n√£o for disponibilidade que tem suas pr√≥prias abas internas)
        moduloAtivo !== "home" && moduloAtivo !== "disponibilidade" && abas.length > 0 && onChangeTab && React.createElement("div", { 
            className: "bg-white shadow-sm border-b"
        },
            React.createElement("div", { className: "max-w-full mx-auto px-4" },
                React.createElement("nav", { className: "flex items-center gap-1 overflow-x-auto py-2" },
                    abas.map(aba =>
                        React.createElement("button", {
                            key: aba.id,
                            onClick: () => onChangeTab ? onChangeTab(aba.id) : null,
                            className: "px-4 py-2 text-sm font-medium rounded-lg transition-all whitespace-nowrap " +
                                (abaAtiva === aba.id ? 
                                    "bg-purple-100 text-purple-800 shadow-sm" : 
                                    "text-gray-600 hover:bg-gray-100 hover:text-gray-900")
                        }, aba.label)
                    )
                )
            )
        )
    );
};

// MENSAGENS DE GENTILEZA - Uma ser√° exibida aleatoriamente a cada acesso
const MENSAGENS_GENTILEZA = [
    "Pequenos gestos de gentileza fazem grandes diferen√ßas.",
    "Gentileza √© a linguagem que o cora√ß√£o entende.",
    "Ser gentil √© um ato de coragem e de amor.",
    "Espalhe amor onde quer que v√°. O mundo precisa disso.",
    "A gentileza √© o que torna o mundo um lugar melhor.",
    "Uma palavra amiga pode mudar o dia de algu√©m.",
    "Seja a gentileza que voc√™ deseja ver no mundo.",
    "Atitudes gentis n√£o custam nada, mas valem muito.",
    "A bondade em palavras cria confian√ßa.",
    "Sorria! √Äs vezes, √© o que o outro precisa.",
    "A verdadeira gentileza √© ajudar sem esperar nada em troca.",
    "Palavras gentis s√£o como abra√ßos silenciosos.",
    "Ser gentil √© uma escolha di√°ria.",
    "A gentileza √© a chave para abrir cora√ß√µes.",
    "A verdadeira for√ßa est√° em ser gentil.",
    "Seja luz na vida de algu√©m hoje.",
    "Pequenos gestos, grandes mudan√ßas.",
    "Gentileza √© amor em a√ß√£o.",
    "A gratid√£o √© o primeiro passo para a gentileza.",
    "Ser gentil √© um ato de esperan√ßa.",
    "Gentileza gera gentileza, sempre.",
    "A generosidade √© o reflexo de um cora√ß√£o gentil.",
    "Cada sorriso conta uma hist√≥ria de bondade.",
    "Compartilhar gentileza √© como plantar sementes de paz.",
    "As melhores pessoas s√£o aquelas que espalham amor.",
    "Gentileza √© o perfume que deixamos pelo caminho.",
    "Deixe a gentileza ser sua marca registrada.",
    "A simplicidade dos atos gentis √© poderosa.",
    "Trate os outros com a mesma bondade que voc√™ deseja receber.",
    "A bondade √© o tesouro mais precioso de todos."
];

// Fun√ß√£o para obter sauda√ß√£o baseada no hor√°rio
const getSaudacao = () => {
    const hora = new Date().getHours();
    if (hora >= 5 && hora < 12) return "Bom dia";
    if (hora >= 12 && hora < 18) return "Boa tarde";
    return "Boa noite";
};

// Fun√ß√£o para obter mensagem aleat√≥ria
const getMensagemGentileza = () => {
    const index = Math.floor(Math.random() * MENSAGENS_GENTILEZA.length);
    return MENSAGENS_GENTILEZA[index];
};

fetch(`${API_URL.replace("/api","")}/health`).catch(() => {});
const hideLoadingScreen = () => {
        const e = document.getElementById("loading-screen");
        e && (e.classList.add("fade-out"), setTimeout(() => e.remove(), 500))
    },
    Toast = ({
        message: e,
        type: t
    }) => React.createElement("div", {
        className: `fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-2xl toast ${"success"===t?"bg-green-600":"bg-red-600"} text-white font-semibold flex items-center gap-3`
    }, React.createElement("span", {
        className: "text-2xl"
    }, "success" === t ? "‚úì" : "‚úó"), React.createElement("span", null, e)),
    LoadingOverlay = ({
        message: e = "Carregando..."
    }) => React.createElement("div", {
        className: "fixed inset-0 bg-black bg-opacity-30 z-50 flex items-center justify-center"
    }, React.createElement("div", {
        className: "bg-white rounded-xl p-6 shadow-2xl flex flex-col items-center gap-3"
    }, React.createElement("div", {
        className: "w-10 h-10 border-4 border-purple-600 border-t-transparent rounded-full animate-spin"
    }), React.createElement("p", {
        className: "text-gray-700 font-semibold"
    }, e))),
    ImageModal = ({
        imageUrl: e,
        onClose: t
    }) => React.createElement("div", {
        className: "fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4",
        onClick: t
    }, React.createElement("div", {
        className: "relative max-w-4xl max-h-screen"
    }, React.createElement("button", {
        onClick: t,
        className: "absolute -top-10 right-0 text-white text-3xl hover:text-gray-300"
    }, "‚úï"), React.createElement("img", {
        src: e,
        alt: "Expandido",
        className: "max-w-full max-h-screen rounded-lg shadow-2xl",
        onClick: e => e.stopPropagation()
    }))),
    calcularCRC16 = e => {
        let t = 65535;
        for (let a = 0; a < e.length; a++) {
            t ^= e.charCodeAt(a) << 8;
            for (let e = 0; e < 8; e++) t = 32768 & t ? 65535 & (t << 1 ^ 4129) : t << 1 & 65535
        }
        return t.toString(16).toUpperCase().padStart(4, "0")
    },
    montarCampo = (e, t) => `${e}${t.length.toString().padStart(2,"0")}${t}`,
    formatarChavePix = e => {
        let t = e.trim();
        if (t.includes("@")) return t.toLowerCase().trim();
        if (/[a-zA-Z]/.test(t)) return t;
        const a = t.replace(/\D/g, "");
        return t.includes("(") || t.includes(")") ? "+55" + a : 14 === a.length ? a : 13 === a.length && a.startsWith("55") ? "+" + a : 10 === a.length ? "+55" + a : 11 === a.length ? t.includes(".") && t.includes("-") ? a : "9" === a.charAt(2) ? "+55" + a : a : t.startsWith("+") ? "+" + a : a || t
    },
    generatePixCode = (e, t, a, l = "BRASILIA") => {
        const r = formatarChavePix(e),
            o = a.normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[^a-zA-Z0-9 ]/g, "").toUpperCase().substring(0, 25).trim(),
            c = l.normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[^a-zA-Z0-9 ]/g, "").toUpperCase().substring(0, 15).trim(),
            s = parseFloat(t).toFixed(2),
            n = montarCampo("00", "br.gov.bcb.pix") + montarCampo("01", r),
            m = montarCampo("05", "***");
        let i = "";
        i += montarCampo("00", "01"), i += montarCampo("26", n), i += montarCampo("52", "0000"), i += montarCampo("53", "986"), i += montarCampo("54", s), i += montarCampo("58", "BR"), i += montarCampo("59", o), i += montarCampo("60", c), i += montarCampo("62", m), i += "6304";
        return i += calcularCRC16(i), i
    },
    PixQRCodeModal = ({
        withdrawal: e,
        onClose: t,
        showToast: a
    }) => {
        const [o, c] = React.useState(""), [s, n] = React.useState(!1), [m, i] = React.useState(!0), [qrDataUrl, setQrDataUrl] = React.useState("");
        
        React.useEffect(() => {
            if (e) {
                try {
                    const pixCode = generatePixCode(e.pix_key, e.final_amount, e.user_name);
                    c(pixCode);
                    
                    // Gerar QR Code em elemento tempor√°rio fora do React
                    if (typeof QRCode !== 'undefined') {
                        const tempDiv = document.createElement('div');
                        tempDiv.style.position = 'absolute';
                        tempDiv.style.left = '-9999px';
                        document.body.appendChild(tempDiv);
                        
                        new QRCode(tempDiv, {
                            text: pixCode,
                            width: 160,
                            height: 160,
                            colorDark: "#000000",
                            colorLight: "#ffffff",
                            correctLevel: QRCode.CorrectLevel.M
                        });
                        
                        // Aguardar o canvas ser gerado e extrair como data URL
                        setTimeout(() => {
                            const canvas = tempDiv.querySelector('canvas');
                            const img = tempDiv.querySelector('img');
                            if (canvas) {
                                setQrDataUrl(canvas.toDataURL('image/png'));
                            } else if (img) {
                                setQrDataUrl(img.src);
                            }
                            document.body.removeChild(tempDiv);
                            i(false);
                        }, 50);
                    } else {
                        // Fallback para API externa
                        setQrDataUrl(`https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=${encodeURIComponent(pixCode)}`);
                        i(false);
                    }
                } catch (err) {
                    console.error("Erro ao gerar PIX:", err);
                    i(false);
                }
            }
        }, [e]);
        
        return e ? React.createElement("div", {
            className: "fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4",
            onClick: t
        }, React.createElement("div", {
            className: "bg-white rounded-2xl shadow-2xl w-full max-w-md",
            onClick: ev => ev.stopPropagation()
        }, 
        // Header
        React.createElement("div", {
            className: "bg-gradient-to-r from-green-600 to-green-700 text-white px-4 py-3 rounded-t-2xl flex items-center justify-between"
        }, 
            React.createElement("div", { className: "flex items-center gap-3" },
                React.createElement("span", { className: "text-2xl" }, "üí∞"),
                React.createElement("div", null,
                    React.createElement("h2", { className: "font-bold" }, "PIX Copia e Cola"),
                    React.createElement("p", { className: "text-green-200 text-xs" }, "Escaneie ou copie o c√≥digo")
                )
            ),
            React.createElement("button", {
                onClick: t,
                className: "text-white/80 hover:text-white text-2xl font-bold"
            }, "‚úï")
        ),
        // Conte√∫do
        React.createElement("div", { className: "p-4" },
            // Dados do benefici√°rio em grid
            React.createElement("div", { className: "bg-gray-50 rounded-xl p-3 mb-4" },
                React.createElement("div", { className: "grid grid-cols-2 gap-x-4 gap-y-2 text-sm" },
                    React.createElement("div", null,
                        React.createElement("p", { className: "text-gray-500 text-xs" }, "Benefici√°rio"),
                        React.createElement("p", { className: "font-semibold text-gray-800" }, e.user_name)
                    ),
                    React.createElement("div", null,
                        React.createElement("p", { className: "text-gray-500 text-xs" }, "C√≥digo"),
                        React.createElement("p", { className: "font-semibold text-gray-800" }, e.user_cod)
                    ),
                    React.createElement("div", { className: "col-span-2" },
                        React.createElement("p", { className: "text-gray-500 text-xs" }, "Chave PIX"),
                        React.createElement("p", { className: "font-semibold text-blue-600 font-mono text-sm break-all" }, formatarChavePix(e.pix_key))
                    ),
                    React.createElement("div", { className: "col-span-2 pt-2 border-t border-gray-200" },
                        React.createElement("p", { className: "text-gray-500 text-xs" }, "Valor a Transferir"),
                        React.createElement("p", { className: "font-bold text-green-600 text-2xl" }, "R$ ", parseFloat(e.final_amount).toFixed(2).replace(".", ","))
                    )
                )
            ),
            // QR Code centralizado
            React.createElement("div", { className: "flex justify-center mb-4" },
                m ? React.createElement("div", {
                    className: "w-40 h-40 bg-gray-100 rounded-xl flex items-center justify-center border-4 border-green-200"
                }, React.createElement("div", {
                    className: "w-8 h-8 border-4 border-green-600 border-t-transparent rounded-full animate-spin"
                })) : qrDataUrl ? React.createElement("img", {
                    src: qrDataUrl,
                    alt: "QR Code PIX",
                    className: "w-40 h-40 border-4 border-green-200 rounded-xl shadow-lg"
                }) : null
            ),
            // C√≥digo copia e cola
            React.createElement("div", { className: "mb-4" },
                React.createElement("p", { className: "text-xs text-gray-500 mb-1 font-semibold" }, "C√≥digo Copia e Cola:"),
                React.createElement("div", { className: "bg-gray-100 rounded-lg p-2 text-[10px] font-mono text-gray-600 break-all border" }, o)
            ),
            // Bot√£o copiar
            React.createElement("button", {
                onClick: async () => {
                    try {
                        await navigator.clipboard.writeText(o), n(!0), a("‚úÖ C√≥digo PIX copiado!", "success"), setTimeout(() => n(!1), 3e3)
                    } catch (err) {
                        const textarea = document.createElement("textarea");
                        textarea.value = o, textarea.style.position = "fixed", textarea.style.left = "-9999px", document.body.appendChild(textarea), textarea.select();
                        try {
                            document.execCommand("copy"), n(!0), a("‚úÖ C√≥digo PIX copiado!", "success"), setTimeout(() => n(!1), 3e3)
                        } catch (err2) {
                            a("‚ùå Erro ao copiar", "error")
                        }
                        document.body.removeChild(textarea)
                    }
                },
                className: "w-full py-3 rounded-xl font-bold text-white text-base transition-all flex items-center justify-center gap-2 " + (s ? "bg-green-500" : "bg-green-600 hover:bg-green-700 active:scale-95")
            }, s ? "‚úÖ C√≥digo Copiado!" : "üìã Copiar C√≥digo PIX")
        ))) : null
    },
    PieChart = ({
        data: e,
        title: t
    }) => {
        const a = e.reduce((e, t) => e + t.value, 0);
        if (0 === a) return React.createElement("div", {
            className: "bg-white rounded-xl shadow p-6"
        }, React.createElement("h3", {
            className: "text-lg font-semibold mb-4"
        }, t), React.createElement("p", {
            className: "text-gray-500 text-center py-8"
        }, "Sem dados dispon√≠veis"));
        let l = 0;
        const r = e.map((e, t) => {
            const r = e.value / a * 100,
                o = r / 100 * 360,
                c = l;
            l += o;
            const s = 100 + 90 * Math.cos((c - 90) * Math.PI / 180),
                n = 100 + 90 * Math.sin((c - 90) * Math.PI / 180),
                m = 100 + 90 * Math.cos((l - 90) * Math.PI / 180),
                i = 100 + 90 * Math.sin((l - 90) * Math.PI / 180),
                d = o > 180 ? 1 : 0;
            return {
                ...e,
                path: `M 100 100 L ${s} ${n} A 90 90 0 ${d} 1 ${m} ${i} Z`,
                percentage: r.toFixed(1)
            }
        });
        return React.createElement("div", {
            className: "bg-white rounded-xl shadow p-6"
        }, React.createElement("h3", {
            className: "text-lg font-semibold mb-4"
        }, t), React.createElement("div", {
            className: "flex flex-col md:flex-row items-center gap-6"
        }, React.createElement("svg", {
            viewBox: "0 0 200 200",
            className: "w-48 h-48"
        }, r.map((e, t) => React.createElement("path", {
            key: t,
            d: e.path,
            fill: e.color,
            className: "hover:opacity-80 transition-opacity cursor-pointer"
        }))), React.createElement("div", {
            className: "flex-1 space-y-2"
        }, r.map((e, t) => React.createElement("div", {
            key: t,
            className: "flex items-center gap-2"
        }, React.createElement("div", {
            className: "w-4 h-4 rounded",
            style: {
                backgroundColor: e.color
            }
        }), React.createElement("span", {
            className: "text-sm flex-1"
        }, e.label), React.createElement("span", {
            className: "font-semibold"
        }, e.value), React.createElement("span", {
            className: "text-gray-500 text-sm"
        }, "(", e.percentage, "%)"))))))
    },
    StatusPieChart = ({
        submissions: e
    }) => {
        const t = {
                pendente: e.filter(e => "pendente" === e.status).length,
                aprovado: e.filter(e => "aprovado" === e.status).length,
                rejeitado: e.filter(e => "rejeitado" === e.status).length
            },
            a = e.length,
            l = [{
                label: "Pendentes",
                value: t.pendente,
                color: "#eab308"
            }, {
                label: "Aprovados",
                value: t.aprovado,
                color: "#22c55e"
            }, {
                label: "Rejeitados",
                value: t.rejeitado,
                color: "#ef4444"
            }].filter(e => e.value > 0);
        let r = 0;
        return React.createElement("div", {
            className: "bg-white rounded-xl shadow p-6"
        }, React.createElement("h2", {
            className: "text-lg font-semibold mb-4"
        }, "üìà Distribui√ß√£o por Status"), 0 === a ? React.createElement("p", {
            className: "text-gray-500"
        }, "Nenhuma solicita√ß√£o") : React.createElement("div", {
            className: "flex flex-col md:flex-row items-center gap-6"
        }, React.createElement("svg", {
            viewBox: "0 0 200 200",
            className: "w-48 h-48"
        }, l.map((e, t) => {
            const l = e.value / a * 360,
                o = r;
            r += l;
            const c = 100 + 90 * Math.cos((o - 90) * Math.PI / 180),
                s = 100 + 90 * Math.sin((o - 90) * Math.PI / 180),
                n = 100 + 90 * Math.cos((o + l - 90) * Math.PI / 180),
                m = 100 + 90 * Math.sin((o + l - 90) * Math.PI / 180),
                i = l > 180 ? 1 : 0;
            return React.createElement("path", {
                key: t,
                d: `M 100 100 L ${c} ${s} A 90 90 0 ${i} 1 ${n} ${m} Z`,
                fill: e.color,
                stroke: "white",
                strokeWidth: "2"
            })
        }), React.createElement("circle", {
            cx: "100",
            cy: "100",
            r: "50",
            fill: "white"
        }), React.createElement("text", {
            x: "100",
            y: "95",
            textAnchor: "middle",
            className: "text-2xl font-bold",
            fill: "#1f2937"
        }, a), React.createElement("text", {
            x: "100",
            y: "110",
            textAnchor: "middle",
            className: "text-xs",
            fill: "#6b7280"
        }, "Total")), React.createElement("div", {
            className: "flex-1 space-y-2"
        }, l.map((e, t) => React.createElement("div", {
            key: t,
            className: "flex items-center gap-2"
        }, React.createElement("div", {
            className: "w-4 h-4 rounded",
            style: {
                backgroundColor: e.color
            }
        }), React.createElement("span", {
            className: "text-sm flex-1"
        }, e.label), React.createElement("span", {
            className: "font-semibold"
        }, e.value), React.createElement("span", {
            className: "text-gray-500 text-sm"
        }, "(", (e.value / a * 100).toFixed(1), "%)"))))))
    },
    MotivosPieChart = ({
        submissions: e
    }) => {
        const t = {};
        e.forEach(e => {
            t[e.motivo] = (t[e.motivo] || 0) + 1
        });
        const a = ["#7c3aed", "#2563eb", "#059669", "#dc2626", "#ea580c", "#8b5cf6"],
            l = e.length,
            r = Object.entries(t).map(([e, t], r) => ({
                motivo: e,
                count: t,
                percentage: (t / l * 100).toFixed(1),
                color: a[r % a.length]
            }));
        let o = 0;
        return React.createElement("div", {
            className: "bg-white rounded-xl shadow p-6"
        }, React.createElement("h2", {
            className: "text-lg font-semibold mb-4"
        }, "üìä Distribui√ß√£o por Motivo"), 0 === l ? React.createElement("p", {
            className: "text-gray-500"
        }, "Nenhuma solicita√ß√£o") : React.createElement("div", {
            className: "flex flex-col md:flex-row items-center gap-6"
        }, React.createElement("svg", {
            viewBox: "0 0 200 200",
            className: "w-48 h-48"
        }, r.map((e, t) => {
            const a = e.count / l * 360,
                r = o;
            o += a;
            const c = 100 + 90 * Math.cos((r - 90) * Math.PI / 180),
                s = 100 + 90 * Math.sin((r - 90) * Math.PI / 180),
                n = 100 + 90 * Math.cos((r + a - 90) * Math.PI / 180),
                m = 100 + 90 * Math.sin((r + a - 90) * Math.PI / 180),
                i = a > 180 ? 1 : 0;
            return React.createElement("path", {
                key: t,
                d: `M 100 100 L ${c} ${s} A 90 90 0 ${i} 1 ${n} ${m} Z`,
                fill: e.color,
                stroke: "white",
                strokeWidth: "2"
            })
        }), React.createElement("circle", {
            cx: "100",
            cy: "100",
            r: "50",
            fill: "white"
        }), React.createElement("text", {
            x: "100",
            y: "95",
            textAnchor: "middle",
            className: "text-2xl font-bold",
            fill: "#1f2937"
        }, l), React.createElement("text", {
            x: "100",
            y: "110",
            textAnchor: "middle",
            className: "text-xs",
            fill: "#6b7280"
        }, "Total")), React.createElement("div", {
            className: "flex-1 space-y-2"
        }, r.map((e, t) => React.createElement("div", {
            key: t,
            className: "flex items-center gap-3"
        }, React.createElement("div", {
            className: "w-4 h-4 rounded",
            style: {
                backgroundColor: e.color
            }
        }), React.createElement("div", {
            className: "flex-1"
        }, React.createElement("p", {
            className: "text-sm font-medium text-gray-800 truncate"
        }, e.motivo), React.createElement("p", {
            className: "text-xs text-gray-500"
        }, e.count, " (", e.percentage, "%)")))))))
    },
    TechRanking = ({
        submissions: e
    }) => {
        const t = {};
        e.forEach(e => {
            const a = e.fullName || "Desconhecido";
            t[a] || (t[a] = {
                total: 0,
                aprovadas: 0,
                rejeitadas: 0,
                pendentes: 0
            }), t[a].total++, "aprovado" === e.status ? t[a].aprovadas++ : "rejeitado" === e.status ? t[a].rejeitadas++ : t[a].pendentes++
        });
        const a = Object.entries(t).map(([e, t]) => ({
            name: e,
            ...t,
            aprovacao: t.total > 0 ? (t.aprovadas / t.total * 100).toFixed(1) : 0
        })).sort((e, t) => t.total - e.total);
        return React.createElement("div", {
            className: "bg-white rounded-xl shadow p-6"
        }, React.createElement("h3", {
            className: "text-lg font-semibold mb-4"
        }, "üèÜ Ranking de Profissionais"), 0 === a.length ? React.createElement("p", {
            className: "text-gray-500 text-center py-8"
        }, "Sem dados") : React.createElement("div", {
            className: "space-y-3"
        }, a.map((e, t) => React.createElement("div", {
            key: t,
            className: "flex items-center gap-4 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition"
        }, React.createElement("div", {
            className: "text-2xl font-bold w-8 " + (0 === t ? "text-yellow-500" : 1 === t ? "text-gray-400" : 2 === t ? "text-orange-600" : "text-gray-400")
        }, t + 1, "¬∫"), React.createElement("div", {
            className: "flex-1"
        }, React.createElement("p", {
            className: "font-semibold text-gray-800"
        }, e.name), React.createElement("div", {
            className: "flex gap-4 text-sm text-gray-600 mt-1"
        }, React.createElement("span", null, "Total: ", React.createElement("b", null, e.total)), React.createElement("span", {
            className: "text-green-600"
        }, "‚úì ", e.aprovadas), React.createElement("span", {
            className: "text-red-600"
        }, "‚úó ", e.rejeitadas), React.createElement("span", {
            className: "text-yellow-600"
        }, "‚è≥ ", e.pendentes))), React.createElement("div", {
            className: "text-right"
        }, React.createElement("div", {
            className: "text-2xl font-bold text-purple-600"
        }, e.aprovacao, "%"), React.createElement("div", {
            className: "text-xs text-gray-500"
        }, "aprova√ß√£o"))))))
    },
    PaginaIndicacao = ({
        token: e
    }) => {
        const [t, a] = useState(!0), [l, r] = useState(null), [o, c] = useState(null), [s, n] = useState(!1), [m, i] = useState(!1), [d, p] = useState({
            nome: "",
            telefone: ""
        }), x = e => {
            const t = e.replace(/\D/g, "");
            return t.length <= 2 ? `(${t}` : t.length <= 7 ? `(${t.slice(0,2)}) ${t.slice(2)}` : t.length <= 11 ? `(${t.slice(0,2)}) ${t.slice(2,7)}-${t.slice(7)}` : `(${t.slice(0,2)}) ${t.slice(2,7)}-${t.slice(7,11)}`
        };
        React.useEffect(() => {
            if (!e || "undefined" === e || "null" === e) return c("Link inv√°lido"), void a(!1);
            (async () => {
                try {
                    const t = await fetchAuth(`${API_URL}/indicacao-link/validar/${e}`);
                    if (!t.ok) return c("Link inv√°lido ou expirado"), void a(!1);
                    const l = await t.json();
                    r(l.indicador)
                } catch (e) {
                    c("Erro ao validar link")
                }
                a(!1)
            })()
        }, [e]);
        return t ? React.createElement("div", {
            className: "min-h-screen bg-gradient-to-br from-blue-600 to-purple-700 flex items-center justify-center"
        }, React.createElement("div", {
            className: "text-white text-center"
        }, React.createElement("div", {
            className: "animate-spin text-6xl mb-4"
        }, "‚è≥"), React.createElement("p", {
            className: "text-xl"
        }, "Validando link..."))) : o ? React.createElement("div", {
            className: "min-h-screen bg-gradient-to-br from-red-500 to-red-700 flex items-center justify-center p-4"
        }, React.createElement("div", {
            className: "bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-center"
        }, React.createElement("div", {
            className: "text-6xl mb-4"
        }, "‚ùå"), React.createElement("h1", {
            className: "text-2xl font-bold text-red-600 mb-2"
        }, "Link Inv√°lido"), React.createElement("p", {
            className: "text-gray-600 mb-6"
        }, o), React.createElement("p", {
            className: "text-sm text-gray-500"
        }, "Pe√ßa um novo link para quem te indicou."))) : s ? React.createElement("div", {
            className: "min-h-screen bg-gradient-to-br from-green-500 to-green-700 flex items-center justify-center p-4"
        }, React.createElement("div", {
            className: "bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-center"
        }, React.createElement("div", {
            className: "text-6xl mb-4"
        }, "üéâ"), React.createElement("h1", {
            className: "text-2xl font-bold text-green-600 mb-2"
        }, "Cadastro Realizado!"), React.createElement("p", {
            className: "text-gray-600 mb-4"
        }, "Seu cadastro foi enviado com sucesso."), React.createElement("div", {
            className: "bg-green-50 border border-green-200 rounded-lg p-4"
        }, React.createElement("p", {
            className: "text-green-800 text-sm"
        }, "Em breve entraremos em contato pelo n√∫mero informado.")))) : React.createElement("div", {
            className: "min-h-screen bg-gradient-to-br from-blue-600 to-purple-700 flex items-center justify-center p-4"
        }, React.createElement("div", {
            className: "bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full"
        }, React.createElement("div", {
            className: "text-center mb-6"
        }, React.createElement("div", {
            className: "text-5xl mb-3"
        }, "üöÄ"), React.createElement("h1", {
            className: "text-2xl font-bold text-gray-800"
        }, "Seja um Entregador!"), React.createElement("p", {
            className: "text-gray-600 mt-2"
        }, "Voc√™ foi indicado por ", React.createElement("span", {
            className: "font-bold text-purple-600"
        }, l?.user_name))), React.createElement("form", {
            onSubmit: async t => {
                if (t.preventDefault(), !d.nome.trim() || !d.telefone.trim()) return void alert("Preencha todos os campos");
                const a = d.telefone.replace(/\D/g, "");
                if (a.length < 10 || a.length > 11) alert("Telefone inv√°lido. Use o formato (DD) 99999-9999");
                else {
                    i(!0);
                    try {
                        const t = await fetchAuth(`${API_URL}/indicacao-link/cadastrar`, {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify({
                                token: e,
                                nome: d.nome.trim(),
                                telefone: d.telefone
                            })
                        });
                        if (!t.ok) {
                            const e = await t.json();
                            throw new Error(e.error || "Erro ao cadastrar")
                        }
                        n(!0)
                    } catch (e) {
                        alert(e.message)
                    }
                    i(!1)
                }
            },
            className: "space-y-4"
        }, React.createElement("div", null, React.createElement("label", {
            className: "block text-sm font-semibold text-gray-700 mb-1"
        }, "Nome Completo *"), React.createElement("input", {
            type: "text",
            value: d.nome,
            onChange: e => p({
                ...d,
                nome: e.target.value
            }),
            className: "w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none transition-colors",
            placeholder: "Seu nome completo",
            required: !0
        })), React.createElement("div", null, React.createElement("label", {
            className: "block text-sm font-semibold text-gray-700 mb-1"
        }, "WhatsApp *"), React.createElement("input", {
            type: "tel",
            value: d.telefone,
            onChange: e => p({
                ...d,
                telefone: x(e.target.value)
            }),
            className: "w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none transition-colors",
            placeholder: "(62) 99999-9999",
            maxLength: 15,
            required: !0
        }), React.createElement("p", {
            className: "text-xs text-gray-500 mt-1"
        }, "Entraremos em contato por este n√∫mero")), React.createElement("button", {
            type: "submit",
            disabled: m,
            className: "w-full py-4 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl font-bold text-lg hover:from-purple-700 hover:to-blue-700 transition-all disabled:opacity-50"
        }, m ? "‚è≥ Enviando..." : "üì§ Enviar Cadastro")), React.createElement("div", {
            className: "mt-6 text-center"
        }, React.createElement("p", {
            className: "text-xs text-gray-400"
        }, "Ao enviar, voc√™ concorda em ser contatado sobre oportunidades de trabalho."))))
    },

    // ==================== COMPONENTE ROTEIRIZADOR ====================
    RoteirizadorModule = ({ enderecosBi, onClose, showToast }) => {
        const [enderecosSelecionados, setEnderecosSelecionados] = useState([]);
        const [termoBusca, setTermoBusca] = useState('');
        const [sugestoes, setSugestoes] = useState([]);
        const [buscando, setBuscando] = useState(false);
        const [loading, setLoading] = useState(false);
        const [resultado, setResultado] = useState(null);
        const [retornarInicio, setRetornarInicio] = useState(false);
        const [mapaRoteirizador, setMapaRoteirizador] = useState(null);
        const [markersLayer, setMarkersLayer] = useState(null);
        const [routeLayer, setRouteLayer] = useState(null);
        const [enderecosBI, setEnderecosBI] = useState([]);
        const [carregandoBI, setCarregandoBI] = useState(true);
        const [pontoPartidaPadrao, setPontoPartidaPadrao] = useState(null);
        const [mostrarConfigPartida, setMostrarConfigPartida] = useState(false);

        const limparPonto = function(end) {
            if (!end) return '';
            return end.replace(/^Ponto\s*\d+\s*[-‚Äì]\s*/i, '').trim();
        };

        useEffect(() => {
            try {
                var salvo = localStorage.getItem('roteirizador_partida_padrao');
                if (salvo) {
                    var partida = JSON.parse(salvo);
                    setPontoPartidaPadrao(partida);
                    setEnderecosSelecionados([Object.assign({}, partida, { id: Date.now() })]);
                }
            } catch(e) {}
        }, []);

        // Carregar TODOS os endere√ßos do BI - sem agrupamento agressivo
        useEffect(() => {
            const carregarEnderecosBI = async () => {
                try {
                    setCarregandoBI(true);
                    const response = await fetchAuth(`${API_URL}/bi/entregas-lista?`);
                    const data = await response.json();
                    if (Array.isArray(data)) {
                        // Agrupar apenas endere√ßos ID√äNTICOS (mesmo endere√ßo + cidade)
                        const map = new Map();
                        data.forEach(e => {
                            if (!e.endereco) return;
                            var endLimpo = limparPonto(e.endereco);
                            // Chave: endere√ßo limpo + cidade (para n√£o misturar cidades)
                            const chave = (endLimpo + '|' + (e.cidade || '')).toLowerCase();
                            
                            if (!map.has(chave)) {
                                map.set(chave, { 
                                    endereco: endLimpo, 
                                    bairro: e.bairro, 
                                    cidade: e.cidade, 
                                    estado: e.estado, 
                                    latitude: e.latitude, 
                                    longitude: e.longitude, 
                                    contagem: 1 
                                });
                            } else {
                                const x = map.get(chave); 
                                x.contagem++;
                                if (!x.latitude && e.latitude) { 
                                    x.latitude = e.latitude; 
                                    x.longitude = e.longitude; 
                                }
                                if (!x.bairro && e.bairro) x.bairro = e.bairro;
                                if (!x.estado && e.estado) x.estado = e.estado;
                            }
                        });
                        var enderecosUnicos = Array.from(map.values());
                        console.log('üó∫Ô∏è Endere√ßos carregados:', data.length, '-> √∫nicos:', enderecosUnicos.length);
                        setEnderecosBI(enderecosUnicos);
                    }
                } catch (err) { console.error(err); }
                setCarregandoBI(false);
            };
            carregarEnderecosBI();
        }, []);

        useEffect(() => {
            let mapInstance = null;
            const initMap = () => {
                if (typeof L !== 'undefined') {
                    const container = document.getElementById('mapa-roteirizador');
                    if (container && !mapInstance) {
                        container.innerHTML = ''; container._leaflet_id = null;
                        mapInstance = L.map('mapa-roteirizador').setView([-16.6869, -49.2648], 4);
                        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '¬© OSM' }).addTo(mapInstance);
                        setMapaRoteirizador(mapInstance);
                        setMarkersLayer(L.layerGroup().addTo(mapInstance));
                        navigator.geolocation && navigator.geolocation.getCurrentPosition(function(pos) { mapInstance && mapInstance.setView([pos.coords.latitude, pos.coords.longitude], 12); }, function() {});
                    }
                }
            };
            setTimeout(initMap, 200);
            return function() { if (mapInstance) try { mapInstance.remove(); } catch(e) {} };
        }, []);

        useEffect(() => {
            if (!mapaRoteirizador || !markersLayer) return;
            markersLayer.clearLayers();
            if (routeLayer) { mapaRoteirizador.removeLayer(routeLayer); setRouteLayer(null); }
            
            var pontosValidos = enderecosSelecionados.filter(function(e) { return e.latitude && e.longitude; });
            pontosValidos.forEach(function(p, i) {
                var icon = L.divIcon({ className: '', html: '<div style="background:' + (i === 0 ? '#10b981' : '#7c3aed') + ';color:#fff;width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:12px;border:2px solid #fff;box-shadow:0 2px 4px rgba(0,0,0,0.3)">' + (i === 0 ? 'üö©' : i) + '</div>', iconSize: [28, 28], iconAnchor: [14, 14] });
                L.marker([p.latitude, p.longitude], { icon: icon }).addTo(markersLayer).bindPopup('<b>' + (i === 0 ? 'PARTIDA' : 'Parada ' + i) + '</b><br>' + escapeHtml((p.endereco || '').substring(0, 50)));
            });
            
            if (pontosValidos.length > 0) {
                var bounds = L.latLngBounds(pontosValidos.map(function(p) { return [p.latitude, p.longitude]; }));
                mapaRoteirizador.fitBounds(bounds, { padding: [50, 50], maxZoom: 14 });
            }
        }, [enderecosSelecionados, mapaRoteirizador, markersLayer]);

        // Buscar sugest√µes - busca mais abrangente
        useEffect(() => {
            const buscar = async () => {
                if (!termoBusca || termoBusca.length < 2) { setSugestoes([]); return; }
                setBuscando(true);
                var termo = termoBusca.toLowerCase().trim();
                var termos = termo.split(/\s+/); // Dividir em palavras
                
                var resultadosBI = enderecosBI.filter(function(e) {
                    var endLower = (e.endereco || '').toLowerCase();
                    var bairroLower = (e.bairro || '').toLowerCase();
                    var cidadeLower = (e.cidade || '').toLowerCase();
                    var textoCompleto = endLower + ' ' + bairroLower + ' ' + cidadeLower;
                    
                    // Todas as palavras devem estar presentes
                    return termos.every(function(t) { return textoCompleto.includes(t); });
                }).sort(function(a, b) { 
                    // Priorizar os que t√™m coordenadas
                    if (a.latitude && !b.latitude) return -1;
                    if (!a.latitude && b.latitude) return 1;
                    // Depois por contagem (mais usados primeiro)
                    return (b.contagem || 0) - (a.contagem || 0);
                }).slice(0, 15).map(function(e) { 
                    return { 
                        endereco: e.endereco, 
                        bairro: e.bairro, 
                        cidade: e.cidade, 
                        estado: e.estado, 
                        latitude: e.latitude, 
                        longitude: e.longitude,
                        contagem: e.contagem,
                        fonte: 'bi'
                    }; 
                });
                
                // CEP
                var resultadosCEP = [];
                var cepMatch = termoBusca.match(/(\d{5})-?(\d{3})/);
                if (cepMatch) {
                    try {
                        var resp = await fetch('https://viacep.com.br/ws/' + cepMatch[1] + cepMatch[2] + '/json/');
                        var data = await resp.json();
                        if (!data.erro) resultadosCEP.push({ 
                            endereco: data.logradouro + ', ' + data.bairro + ', ' + data.localidade + ' - ' + data.uf, 
                            bairro: data.bairro, 
                            cidade: data.localidade, 
                            estado: data.uf, 
                            cep: data.cep,
                            fonte: 'cep',
                            precisaGeo: true 
                        });
                    } catch(e) {}
                }
                setSugestoes([].concat(resultadosBI, resultadosCEP));
                setBuscando(false);
            };
            var timer = setTimeout(buscar, 200);
            return function() { clearTimeout(timer); };
        }, [termoBusca, enderecosBI]);

        const geocodificarPreciso = async function(sug) {
            if (sug.latitude && sug.longitude) return sug;
            
            var cidade = sug.cidade || '';
            var estado = sug.estado || '';
            var bairro = sug.bairro || '';
            var endereco = sug.endereco || '';
            
            var queries = [];
            if (endereco && cidade) queries.push(endereco + ', ' + cidade + (estado ? ' - ' + estado : '') + ', Brasil');
            if (bairro && cidade) queries.push(bairro + ', ' + cidade + (estado ? ' - ' + estado : '') + ', Brasil');
            if (cidade && estado) queries.push(cidade + ', ' + estado + ', Brasil');
            
            for (var i = 0; i < queries.length; i++) {
                try {
                    var resp = await fetch('https://nominatim.openstreetmap.org/search?format=json&q=' + encodeURIComponent(queries[i]) + '&limit=1&countrycodes=br', { headers: { 'User-Agent': 'TuttsRoteirizador/1.0' } });
                    var data = await resp.json();
                    if (data[0]) {
                        var resultado = data[0].display_name.toLowerCase();
                        if (!cidade || resultado.includes(cidade.toLowerCase())) {
                            return Object.assign({}, sug, { latitude: parseFloat(data[0].lat), longitude: parseFloat(data[0].lon) });
                        }
                    }
                } catch(e) {}
            }
            
            // Fallback: usar proxy seguro do backend (API key protegida)
            for (var i = 0; i < queries.length; i++) {
                try {
                    var resp = await fetchAuth(API_URL + '/routing/geocode?text=' + encodeURIComponent(queries[i]));
                    if (!resp.ok) continue;
                    var data = await resp.json();
                    if (data.features && data.features[0]) {
                        return Object.assign({}, sug, { latitude: data.features[0].geometry.coordinates[1], longitude: data.features[0].geometry.coordinates[0] });
                    }
                } catch(e) { console.log('Erro geocode:', e.message); }
            }
            return null;
        };

        const adicionar = function(sug) {
            if (enderecosSelecionados.length >= 15) { showToast && showToast('M√°ximo 15', 'error'); return; }
            
            var endLimpo = limparPonto(sug.endereco);
            var chaveNova = (endLimpo + '|' + (sug.cidade || '')).toLowerCase();
            if (enderecosSelecionados.some(function(e) { return (e.endereco + '|' + (e.cidade || '')).toLowerCase() === chaveNova; })) { 
                showToast && showToast('J√° adicionado', 'error'); 
                return; 
            }
            
            if (sug.latitude && sug.longitude) {
                setEnderecosSelecionados(function(prev) { 
                    return prev.concat([{ id: Date.now(), endereco: endLimpo, bairro: sug.bairro, cidade: sug.cidade, estado: sug.estado, latitude: sug.latitude, longitude: sug.longitude, fonte: sug.fonte }]); 
                });
                setTermoBusca(''); setSugestoes([]);
                return;
            }
            
            showToast && showToast('Localizando...', 'info');
            geocodificarPreciso(sug).then(function(end) {
                if (!end) { showToast && showToast('N√£o localizado', 'error'); return; }
                setEnderecosSelecionados(function(prev) { 
                    return prev.concat([{ id: Date.now(), endereco: limparPonto(end.endereco), bairro: end.bairro, cidade: end.cidade, estado: end.estado, latitude: end.latitude, longitude: end.longitude, fonte: end.fonte }]); 
                });
            });
            setTermoBusca(''); setSugestoes([]);
        };

        const remover = function(id) { setEnderecosSelecionados(function(prev) { return prev.filter(function(e) { return e.id !== id; }); }); };
        const mover = function(idx, dir) { var l = enderecosSelecionados.slice(), n = idx + dir; if (n < 0 || n >= l.length) return; var t = l[idx]; l[idx] = l[n]; l[n] = t; setEnderecosSelecionados(l); };

        const definirPartidaPadrao = function(end) {
            var partida = { endereco: end.endereco, bairro: end.bairro, cidade: end.cidade, estado: end.estado, latitude: end.latitude, longitude: end.longitude };
            localStorage.setItem('roteirizador_partida_padrao', JSON.stringify(partida));
            setPontoPartidaPadrao(partida);
            showToast && showToast('Partida salva!', 'success');
            setMostrarConfigPartida(false);
        };

        const removerPartidaPadrao = function() {
            localStorage.removeItem('roteirizador_partida_padrao');
            setPontoPartidaPadrao(null);
            showToast && showToast('Removida', 'info');
            setMostrarConfigPartida(false);
        };

        const otimizarRota = async function(pontos) {
            var vehicle = { id: 1, profile: 'driving-car', start: [pontos[0].longitude, pontos[0].latitude] };
            if (retornarInicio) vehicle.end = [pontos[0].longitude, pontos[0].latitude];
            var resp = await fetchAuth(API_URL + '/routing/optimize', { method: 'POST', body: JSON.stringify({ jobs: pontos.slice(1).map(function(p, i) { return { id: i + 1, location: [p.longitude, p.latitude] }; }), vehicles: [vehicle] }) });
            if (!resp.ok) { var err = await resp.json().catch(function() { return {}; }); throw new Error(err.error || 'Erro na otimiza√ß√£o'); }
            return resp.json();
        };

        const obterGeometria = async function(pontos) {
            var resp = await fetchAuth(API_URL + '/routing/directions', { method: 'POST', body: JSON.stringify({ coordinates: pontos.map(function(p) { return [p.longitude, p.latitude]; }) }) });
            return resp.ok ? resp.json() : null;
        };

        const atualizarMapaComRota = function(pontos, geo) {
            if (!mapaRoteirizador || !markersLayer) return;
            markersLayer.clearLayers();
            if (routeLayer) { mapaRoteirizador.removeLayer(routeLayer); setRouteLayer(null); }
            pontos.filter(function(p) { return !p.isRetorno; }).forEach(function(p, i) {
                var icon = L.divIcon({ className: '', html: '<div style="background:' + (i === 0 ? '#10b981' : '#7c3aed') + ';color:#fff;width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:12px;border:2px solid #fff;box-shadow:0 2px 4px rgba(0,0,0,0.3)">' + (i === 0 ? 'üö©' : i) + '</div>', iconSize: [28, 28], iconAnchor: [14, 14] });
                L.marker([p.latitude, p.longitude], { icon: icon }).addTo(markersLayer).bindPopup('<b>' + (i === 0 ? 'PARTIDA' : 'Parada ' + i) + '</b><br>' + escapeHtml((p.endereco || '').substring(0, 50)));
            });
            if (geo && geo.features) { var layer = L.geoJSON(geo, { style: { color: '#7c3aed', weight: 5, opacity: 0.8 } }).addTo(mapaRoteirizador); setRouteLayer(layer); }
            if (pontos.length > 0) mapaRoteirizador.fitBounds(L.latLngBounds(pontos.filter(function(p) { return !p.isRetorno; }).map(function(p) { return [p.latitude, p.longitude]; })), { padding: [50, 50] });
        };

        const roteirizar = async function() {
            if (enderecosSelecionados.length < 2) { showToast && showToast('M√≠nimo 2 endere√ßos', 'error'); return; }
            setLoading(true); setResultado(null);
            try {
                var pontos = enderecosSelecionados.map(function(e) { return { latitude: e.latitude, longitude: e.longitude, endereco: e.endereco, bairro: e.bairro, cidade: e.cidade }; });
                if (pontos.some(function(p) { return !p.latitude || !p.longitude; })) throw new Error('Endere√ßo sem coordenadas');
                var otimizacao = await otimizarRota(pontos);
                var ordem = [pontos[0]];
                if (otimizacao.routes && otimizacao.routes[0]) otimizacao.routes[0].steps.filter(function(s) { return s.type === 'job'; }).forEach(function(s) { ordem.push(pontos[s.job]); });
                if (retornarInicio) ordem.push(Object.assign({}, pontos[0], { isRetorno: true }));
                var geo = await obterGeometria(ordem);
                var km = 0, min = 0;
                if (geo && geo.features && geo.features[0] && geo.features[0].properties.segments) geo.features[0].properties.segments.forEach(function(s) { km += s.distance || 0; min += s.duration || 0; });
                setResultado({ ordemOtimizada: ordem, distanciaKm: (km / 1000).toFixed(1), tempoMin: Math.round(min / 60), geometria: geo });
                atualizarMapaComRota(ordem, geo);
                showToast && showToast('Rota calculada!', 'success');
            } catch (err) { showToast && showToast(err.message, 'error'); }
            setLoading(false);
        };

        const abrirWaze = function() { if (resultado) { var p = resultado.ordemOtimizada.filter(function(x) { return !x.isRetorno; }); if (p.length) window.open('https://waze.com/ul?ll=' + p[p.length-1].latitude + ',' + p[p.length-1].longitude + '&navigate=yes', '_blank'); } };
        const abrirMaps = function() { if (resultado) { var p = resultado.ordemOtimizada.filter(function(x) { return !x.isRetorno; }); if (p.length) window.open('https://www.google.com/maps/dir/' + p.map(function(x) { return x.latitude + ',' + x.longitude; }).join('/'), '_blank'); } };
        const limpar = function() { 
            if (pontoPartidaPadrao) {
                setEnderecosSelecionados([Object.assign({}, pontoPartidaPadrao, { id: Date.now() })]);
            } else {
                setEnderecosSelecionados([]);
            }
            setResultado(null); setTermoBusca(''); setSugestoes([]);
            if (routeLayer && mapaRoteirizador) { mapaRoteirizador.removeLayer(routeLayer); setRouteLayer(null); }
        };

        return React.createElement('div', { className: 'fixed inset-0 z-[9999] flex flex-col', style: { background: '#1e1b4b' } },
            React.createElement('div', { className: 'bg-purple-900 text-white px-4 py-2 flex items-center justify-between' },
                React.createElement('div', { className: 'flex items-center gap-3' },
                    React.createElement('button', { onClick: onClose, className: 'px-3 py-1 bg-white/10 hover:bg-white/20 rounded text-sm' }, '‚Üê Voltar'),
                    React.createElement('span', { className: 'font-bold' }, 'üó∫Ô∏è Roteirizador')
                ),
                React.createElement('div', { className: 'flex items-center gap-3' },
                    resultado && React.createElement('div', { className: 'flex items-center gap-3 bg-white/10 rounded px-3 py-1 text-sm' },
                        React.createElement('span', { className: 'text-green-400 font-bold' }, resultado.distanciaKm + ' km'),
                        React.createElement('span', { className: 'text-cyan-400 font-bold' }, resultado.tempoMin + ' min')
                    ),
                    resultado && React.createElement('button', { onClick: abrirWaze, className: 'px-3 py-1 bg-cyan-500 rounded text-sm font-medium' }, 'Waze'),
                    resultado && React.createElement('button', { onClick: abrirMaps, className: 'px-3 py-1 bg-blue-500 rounded text-sm font-medium' }, 'Maps')
                )
            ),
            React.createElement('div', { className: 'flex-1 flex overflow-hidden' },
                React.createElement('div', { className: 'w-[360px] bg-white flex flex-col' },
                    React.createElement('div', { className: 'p-3 border-b bg-purple-50' },
                        React.createElement('div', { className: 'relative' },
                            React.createElement('input', { type: 'text', value: termoBusca, onChange: function(e) { setTermoBusca(e.target.value); }, placeholder: 'üîç Buscar endere√ßo, bairro, cidade...', className: 'w-full px-3 py-2 border border-purple-200 rounded-lg text-sm focus:border-purple-500 focus:outline-none', autoComplete: 'off' }),
                            buscando && React.createElement('div', { className: 'absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 border-2 border-purple-500 border-t-transparent rounded-full animate-spin' })
                        ),
                        React.createElement('div', { className: 'flex items-center justify-between mt-1' },
                            React.createElement('p', { className: 'text-xs text-purple-600' }, carregandoBI ? '‚è≥ Carregando...' : '‚úÖ ' + enderecosBI.length + ' endere√ßos √∫nicos'),
                            pontoPartidaPadrao && React.createElement('span', { className: 'text-xs text-green-600' }, 'üö© Partida salva')
                        ),
                        sugestoes.length > 0 && React.createElement('div', { className: 'mt-2 bg-white border border-purple-200 rounded-lg shadow-lg max-h-[250px] overflow-y-auto' },
                            sugestoes.map(function(sug, idx) {
                                var temCoord = sug.latitude && sug.longitude;
                                return React.createElement('div', { key: idx, onClick: function() { adicionar(sug); }, className: 'px-3 py-2 hover:bg-purple-50 cursor-pointer border-b last:border-b-0' },
                                    React.createElement('div', { className: 'flex items-center gap-2' },
                                        React.createElement('span', { className: 'text-sm' }, sug.fonte === 'bi' ? (temCoord ? 'üì¶' : 'üì¶‚ùì') : 'üìÆ'),
                                        React.createElement('div', { className: 'flex-1 min-w-0' },
                                            React.createElement('div', { className: 'font-medium text-gray-800 truncate text-xs' }, sug.endereco),
                                            React.createElement('div', { className: 'text-xs text-gray-500 truncate' }, [sug.bairro, sug.cidade, sug.estado].filter(Boolean).join(' - '))
                                        ),
                                        temCoord && React.createElement('span', { className: 'text-green-500 text-xs' }, '‚úì')
                                    )
                                );
                            })
                        )
                    ),
                    React.createElement('div', { className: 'flex-1 overflow-y-auto p-2' },
                        React.createElement('div', { className: 'flex items-center justify-between mb-2' },
                            React.createElement('span', { className: 'text-xs font-bold text-gray-600' }, 'Rota (' + enderecosSelecionados.length + '/15)'),
                            enderecosSelecionados.length > 0 && React.createElement('button', { onClick: limpar, className: 'text-xs text-red-500' }, 'Limpar')
                        ),
                        enderecosSelecionados.length === 0
                            ? React.createElement('div', { className: 'text-center py-8 text-gray-400 text-sm' }, 'üìç Adicione endere√ßos')
                            : React.createElement('div', { className: 'space-y-1' },
                                enderecosSelecionados.map(function(end, idx) {
                                    return React.createElement('div', { key: end.id, className: 'p-2 rounded border text-xs ' + (idx === 0 ? 'bg-green-50 border-green-200' : 'bg-white border-gray-200') },
                                        React.createElement('div', { className: 'flex items-center gap-2' },
                                            React.createElement('span', { className: 'w-6 h-6 rounded-full flex items-center justify-center font-bold text-white text-xs ' + (idx === 0 ? 'bg-green-500' : 'bg-purple-600') }, idx === 0 ? 'üö©' : idx),
                                            React.createElement('div', { className: 'flex-1 min-w-0' },
                                                React.createElement('div', { className: 'font-medium text-gray-800 truncate' }, end.endereco),
                                                React.createElement('div', { className: 'text-gray-500 truncate' }, [end.bairro, end.cidade].filter(Boolean).join(' - '))
                                            ),
                                            React.createElement('div', { className: 'flex gap-1' },
                                                idx === 0 && React.createElement('button', { onClick: function() { setMostrarConfigPartida(!mostrarConfigPartida); }, className: 'text-gray-400 hover:text-green-600' }, '‚öôÔ∏è'),
                                                idx > 0 && React.createElement('button', { onClick: function() { mover(idx, -1); }, className: 'text-gray-400 hover:text-purple-600' }, '‚ñ≤'),
                                                idx < enderecosSelecionados.length - 1 && React.createElement('button', { onClick: function() { mover(idx, 1); }, className: 'text-gray-400 hover:text-purple-600' }, '‚ñº'),
                                                React.createElement('button', { onClick: function() { remover(end.id); }, className: 'text-gray-400 hover:text-red-600' }, '‚úï')
                                            )
                                        ),
                                        idx === 0 && mostrarConfigPartida && React.createElement('div', { className: 'mt-2 pt-2 border-t border-green-200 flex gap-2' },
                                            React.createElement('button', { onClick: function() { definirPartidaPadrao(end); }, className: 'flex-1 px-2 py-1 bg-green-500 text-white rounded text-xs font-medium' }, '‚úì Salvar padr√£o'),
                                            pontoPartidaPadrao && React.createElement('button', { onClick: removerPartidaPadrao, className: 'px-2 py-1 bg-red-100 text-red-600 rounded text-xs' }, 'Remover')
                                        )
                                    );
                                })
                            )
                    ),
                    React.createElement('div', { className: 'p-3 border-t bg-gray-50' },
                        React.createElement('label', { className: 'flex items-center gap-2 mb-2 cursor-pointer text-sm' },
                            React.createElement('input', { type: 'checkbox', checked: retornarInicio, onChange: function(e) { setRetornarInicio(e.target.checked); }, className: 'w-4 h-4' }),
                            React.createElement('span', null, '‚Ü©Ô∏è Retornar ao in√≠cio')
                        ),
                        React.createElement('button', { onClick: roteirizar, disabled: loading || enderecosSelecionados.length < 2, className: 'w-full py-2 bg-purple-600 text-white rounded-lg font-bold text-sm hover:bg-purple-700 disabled:opacity-50' }, loading ? '‚è≥ Calculando...' : 'üöÄ Otimizar Rota')
                    )
                ),
                React.createElement('div', { className: 'flex-1 flex flex-col' },
                    React.createElement('div', { id: 'mapa-roteirizador', className: 'flex-1' }),
                    resultado && React.createElement('div', { className: 'bg-white border-t p-3' },
                        React.createElement('div', { className: 'text-xs font-bold text-gray-600 mb-2' }, '‚úÖ Ordem otimizada:'),
                        React.createElement('div', { className: 'flex flex-wrap gap-1' },
                            resultado.ordemOtimizada.map(function(p, idx) {
                                return React.createElement('span', { key: idx, className: 'px-2 py-1 rounded text-xs font-medium ' + (idx === 0 || p.isRetorno ? 'bg-green-100 text-green-700' : 'bg-purple-100 text-purple-700') },
                                    (idx === 0 ? 'üö©' : p.isRetorno ? '‚Ü©Ô∏è' : idx) + ' ' + (p.endereco || '').substring(0, 20)
                                );
                            })
                        )
                    )
                )
            )
        );
    },
    // ==================== FIM COMPONENTE ROTEIRIZADOR ====================

    App = () => {
        const [e, t] = useState(window.location.hash || "");
        React.useEffect(() => {
            const e = () => {
                t(window.location.hash || "")
            };
            return window.addEventListener("hashchange", e), () => window.removeEventListener("hashchange", e)
        }, []);
        const a = e.match(/#\/indicar\/([A-Za-z0-9]+)/);
        if (a && a[1]) return React.createElement(PaginaIndicacao, {
            token: a[1]
        });
        const [l, r] = useState(() => {
            try {
                const e = sessionStorage.getItem("tutts_user");
                return e ? JSON.parse(e) : null
            } catch {
                return null
            }
        }), o = e => {
            if (e) {
                sessionStorage.setItem("tutts_user", JSON.stringify(e));
            } else {
                // Notificar servidor sobre logout (revogar refresh token)
                const refreshToken = getRefreshToken();
                if (refreshToken) {
                    fetchAuth(`${API_URL}/users/logout`, {
                        method: 'POST',
                        body: JSON.stringify({ refreshToken })
                    }).catch(() => {}); // Ignorar erros no logout
                }
                sessionStorage.removeItem("tutts_user");
                sessionStorage.removeItem("tutts_token"); // Limpar token JWT no logout
                localStorage.removeItem("tutts_refresh_token"); // Limpar refresh token
            }
            r(e);
        }, [c, s] = useState(!1), [n, m] = useState(!1), [i, d] = useState(null), [p, x] = useState({}), [u, g] = useState(null), [b, R] = useState(Date.now()), [E, h] = useState(null), [f, N] = useState(!1), [y, v] = useState({
            solicitacoes: 0,
            validacao: 0,
            loja: 0,
            gratuidades: 0
        }), [w, _] = useState({
            solicitacoes: [],
            validacao: [],
            loja: [],
            gratuidades: []
        }), [j, C] = useState([]), [A, S] = useState([]), [k, P] = useState(!1), [T, D] = useState(null), [L, I] = useState([]), [F, $] = useState(!1), [M, O] = useState([]), [q, U] = useState([]), [z, B] = useState([]), [V, J] = useState(null), [Q, H] = useState([]), [G, W] = useState([]), [Z, Y] = useState([]), [K, X] = useState({}), [ee, te] = useState([]), [ae, le] = useState([]), [re, oe] = useState([]), [ce, se] = useState([]), [ne, me] = useState([]), [ie, de] = useState([]), [progressoNovatos, setProgressoNovatos] = useState([]), [modalEntregasNovatos, setModalEntregasNovatos] = useState(null), [pe, xe] = useState([]), [cidadesIndicacao, setCidadesIndicacao] = useState([]), [ue, ge] = useState(!1), [be, Re] = useState(null), [Ee, he] = useState("home"), [mensagemGentileza, setMensagemGentileza] = useState(() => getMensagemGentileza()), [elegibilidadeNovatos, setElegibilidadeNovatos] = useState({ elegivel: false, motivo: '', promocoes: [], carregando: true }), [regioesNovatos, setRegioesNovatos] = useState([]), [clientesBINovatos, setClientesBINovatos] = useState([]), [clientesSelecionados, setClientesSelecionados] = useState([]), [carregandoClientes, setCarregandoClientes] = useState(false), [solicitacoesPagina, setSolicitacoesPagina] = useState(1), [acertoRealizado, setAcertoRealizado] = useState(() => { try { const saved = localStorage.getItem("tutts_acerto_realizado"); return saved !== null ? JSON.parse(saved) : true; } catch(e) { return true; } }), [solicitacoesPorPagina] = useState(120), [conciliacaoPagina, setConciliacaoPagina] = useState(1), [conciliacaoPorPagina] = useState(120), 
        
        // Helper para parse de saldo (aceita n√∫mero ou string brasileira)
        parseSaldoBR = (valor) => {
            if (typeof valor === "number") return valor;
            if (!valor) return 0;
            const str = String(valor);
            if (str.includes(",")) {
                return parseFloat(str.replace(/\./g, "").replace(",", ".")) || 0;
            }
            return parseFloat(str) || 0;
        },
        
        [fe, Ne] = useState({
            titulo: "Acerte os procedimentos e ganhe saque gratuito de R$ 500,00",
            imagens: [null, null, null, null],
            perguntas: [{
                texto: "",
                resposta: !0
            }, {
                texto: "",
                resposta: !0
            }, {
                texto: "",
                resposta: !0
            }, {
                texto: "",
                resposta: !0
            }, {
                texto: "",
                resposta: !0
            }],
            valor_gratuidade: 500,
            ativo: !1
        }), [ye, ve] = useState([]), [we, _e] = useState(!1), [je, Ce] = useState(null), [Ae, Se] = useState(0), [ke, Pe] = useState(0), [Te, De] = useState([null, null, null, null, null]), [Le, Ie] = useState(null), [Fe, $e] = useState(!1), [Me, Oe] = useState({
            horarios: [],
            especiais: [],
            loading: !0
        }), [qe, Ue] = useState({
            avisos: [],
            loading: !0
        }), [ze, Be] = useState(null), [Ve, Je] = useState(0), [Qe, He] = useState([]), [Ge, We] = useState(!1), [Ze, Ye] = useState([]), [Ke, Xe] = useState([]), [et, tt] = useState([]), [at, lt] = useState([]), [rt, ot] = useState(!0), [ct, st] = useState(0), [nt, mt] = useState("produtos"), [it, dt] = useState([]), [pt, xt] = useState("lista"), [ut, gt] = useState([]), [bt, Rt] = useState([]), [Et, ht] = useState("home-bi"), [ft, Nt] = useState(null), [yt, vt] = useState([]), [wt, _t] = useState([{
            km_min: 0,
            km_max: 15,
            prazo_minutos: 45
        }, {
            km_min: 15,
            km_max: 20,
            prazo_minutos: 50
        }, {
            km_min: 20,
            km_max: 30,
            prazo_minutos: 60
        }, {
            km_min: 30,
            km_max: null,
            prazo_minutos: 90
        }]), [jt, Ct] = useState([]), [At, St] = useState([]), [kt, Pt] = useState([]), [Tt, Dt] = useState({}), [Lt, It] = useState([]), [Ft, $t] = useState([]), [Mt, Ot] = useState([]), [qt, Ut] = useState([]), [zt, Bt] = useState([]), [Vt, Jt] = useState([]), [Qt, Ht] = useState({
            porTempo: [],
            porKm: []
        }), [Gt, Wt] = useState([]), [Zt, Yt] = useState([]), [Kt, Xt] = useState({}), [ea, ta] = useState([]), [aa, la] = useState([]), [ra, oa] = useState([]), [ca, sa] = useState({
            key: null,
            direction: "desc"
        }), [na, ma] = useState([]), [ia, da] = useState([]), [pa, xa] = useState([]), [ua, ga] = useState({
            data_inicio: "",
            data_fim: "",
            cod_cliente: [],
            centro_custo: [],
            categoria: "",
            status_prazo: "",
            status_prazo_prof: "",
            status_retorno: "",
            regiao: ""
        }), [ba, Ra] = useState(!1), [loadingMessage, setLoadingMessage] = useState("Carregando dados..."), [loadingProgress, setLoadingProgress] = useState(0), [Ea, ha] = useState(null), [driveImportando, setDriveImportando] = useState(null), [fa, Na] = useState([{
            km_min: 0,
            km_max: 15,
            prazo_minutos: 45
        }]), [ya, va] = useState([{
            km_min: 0,
            km_max: 15,
            prazo_minutos: 45
        }]), 
        // Estados para Prazo Profissional
        [prazoProfPadrao, setPrazoProfPadrao] = useState([{
            km_min: 0,
            km_max: 15,
            prazo_minutos: 60
        }]),
        [prazoProfNovo, setPrazoProfNovo] = useState([{
            km_min: 0,
            km_max: 15,
            prazo_minutos: 60
        }]),
        [prazosProfissionais, setPrazosProfissionais] = useState([]),
        [prazoProfConfigOS, setPrazoProfConfigOS] = useState([]), // Configura√ß√µes de prazo prof para aba OS
        [wa, _a] = useState(!1), [todoGrupos, setTodoGrupos] = useState([]), [todoTarefas, setTodoTarefas] = useState([]), [todoGrupoAtivo, setTodoGrupoAtivo] = useState(null), [todoMetricas, setTodoMetricas] = useState(null), [todoTab, setTodoTab] = useState("tarefas"), [todoFiltroStatus, setTodoFiltroStatus] = useState("todas"), [todoModal, setTodoModal] = useState(null), [todoLoading, setTodoLoading] = useState(false), [todoAdmins, setTodoAdmins] = useState([]),
        // Estado do m√≥dulo de Filas
        [filasTab, setFilasTab] = useState("monitoramento"),
        // Novos estados para TODO melhorado
        [todoMeuDia, setTodoMeuDia] = useState([]),
        [todoViewMode, setTodoViewMode] = useState("meudia"), // "meudia" ou "grupo"
        [todoFiltroCard, setTodoFiltroCard] = useState(null), // "pendentes", "atrasadas", "concluidas"
        [todoNotifModal, setTodoNotifModal] = useState(false),
        [todoPendentesNotif, setTodoPendentesNotif] = useState([]),
        [todoTarefasJaNotificadas, setTodoTarefasJaNotificadas] = useState([]), // IDs de tarefas j√° notificadas
        // NOVOS ESTADOS - Kanban, Subtarefas, Timer
        [todoViewType, setTodoViewType] = useState("lista"), // "lista" | "kanban"
        [todoSubtarefas, setTodoSubtarefas] = useState({}), // {tarefa_id: [subtarefas]}
        [todoTimerTarefa, setTodoTimerTarefa] = useState(null), // Tarefa com timer ativo
        [todoTimerSegundos, setTodoTimerSegundos] = useState(0),
        [todoTemplates, setTodoTemplates] = useState([]),
        [todoTarefaDetalhe, setTodoTarefaDetalhe] = useState(null),
        [acompDados, setAcompDados] = useState(null),
        [acompLoading, setAcompLoading] = useState(false),
        [acompFiltros, setAcompFiltros] = useState({os: false, entregas: false, noPrazo: false, foraPrazo: false, retornos: false, valorTotal: false, valorProf: false, faturamentoTotal: false, ticketMedio: false, tempoMedioEntrega: false, tempoMedioAlocacao: false, tempoMedioColeta: false, totalEntregadores: false, mediaEntProfissional: false, evolucaoSemanal: false}),
        [acompFiltrosOrdem, setAcompFiltrosOrdem] = useState([]),
        [acompClientes, setAcompClientes] = useState(null),
        [comparativoSemanal, setComparativoSemanal] = useState(null),
        [comparativoSemanalClientes, setComparativoSemanalClientes] = useState(null),
        // Estados do Cliente 767
        [cliente767Dados, setCliente767Dados] = useState(null),
        [cliente767Loading, setCliente767Loading] = useState(false),
        [cliente767ModalFiltro, setCliente767ModalFiltro] = useState(false),
        [cliente767Filtros, setCliente767Filtros] = useState({ data_inicio: '', data_fim: '', centros_custo: [] }),
        // Estados do Relat√≥rio IA (Gemini)
        [relatorioIATipos, setRelatorioIATipos] = useState([]), // Array de tipos selecionados
        [relatorioIALoading, setRelatorioIALoading] = useState(false),
        [relatorioIAResultado, setRelatorioIAResultado] = useState(null),
        [relatorioIAErro, setRelatorioIAErro] = useState(null),
        [relatorioIAHistorico, setRelatorioIAHistorico] = useState([]),
        [relatorioIAHistoricoDB, setRelatorioIAHistoricoDB] = useState([]),
        [relatorioIAPromptCustom, setRelatorioIAPromptCustom] = useState(''),
        [relatorioIAFiltros, setRelatorioIAFiltros] = useState({
            data_inicio: '',
            data_fim: '',
            cod_cliente: '',
            centro_custo: ''
        }),
        [relatorioIACentrosCusto, setRelatorioIACentrosCusto] = useState([]),
        // Estados de busca de cliente
        [buscaClienteModal, setBuscaClienteModal] = useState(''),
        [buscaClienteRelatorioIA, setBuscaClienteRelatorioIA] = useState(''),
        // Estados de pagina√ß√£o e OS dos profissionais
        [profPaginaAtual, setProfPaginaAtual] = useState(1),
        [profOsExpandido, setProfOsExpandido] = useState({}), // {cod_prof: [lista de OS]}
        [profOsLoading, setProfOsLoading] = useState(null), // cod_prof que est√° carregando
        // Estados do m√≥dulo Garantido (BI)
        [garantidoData, setGarantidoData] = useState([]),
        [garantidoLoading, setGarantidoLoading] = useState(false),
        [garantidoFiltros, setGarantidoFiltros] = useState({
            data_inicio: '',
            data_fim: '',
            cod_cliente: '',
            cod_prof: '',
            filtro_status: 'todos' // todos, abaixo, acima, nao_rodou, rodou
        }),
        [garantidoStats, setGarantidoStats] = useState(null),
        [garantidoSubTab, setGarantidoSubTab] = useState('analise'), // analise, semanal, cliente
        [garantidoSemanal, setGarantidoSemanal] = useState([]),
        [garantidoPorCliente, setGarantidoPorCliente] = useState([]),
        [garantidoStatusMap, setGarantidoStatusMap] = useState({}), // Mapa de status salvos
        [garantidoModalStatus, setGarantidoModalStatus] = useState(null), // Modal para alterar status
        [garantidoMotivoReprovado, setGarantidoMotivoReprovado] = useState(''), // Motivo quando reprovado
        // Estados do Mapa de Calor
        [mapaCalorDados, setMapaCalorDados] = useState(null),
        [mapaCalorLoading, setMapaCalorLoading] = useState(false),
        [mapaCalorVisivel, setMapaCalorVisivel] = useState(true),
        // Estado para datas com dados no BI
        [biDatasComDados, setBiDatasComDados] = useState(new Set()),
        // Estados para calend√°rio customizado
        [calDataInicioAberto, setCalDataInicioAberto] = useState(false),
        [calDataFimAberto, setCalDataFimAberto] = useState(false),
        [calMesAtual, setCalMesAtual] = useState(new Date()),
        // Estados do m√≥dulo Social
        [socialProfile, setSocialProfile] = useState(null),
        [socialUsers, setSocialUsers] = useState([]),
        [socialMessages, setSocialMessages] = useState([]),
        [socialUnread, setSocialUnread] = useState(0),
        [socialTab, setSocialTab] = useState("perfil"),
        [socialLoading, setSocialLoading] = useState(false),
        [socialModalUser, setSocialModalUser] = useState(null),
        // Estados para Mensagens da Lideran√ßa
        [liderancaMensagens, setLiderancaMensagens] = useState([]),
        [liderancaPendentes, setLiderancaPendentes] = useState([]),
        [liderancaHistorico, setLiderancaHistorico] = useState([]),
        [liderancaModal, setLiderancaModal] = useState(null), // {tipo: 'criar'|'visualizar'|'notificacao', dados: {...}}
        [liderancaVisualizacoes, setLiderancaVisualizacoes] = useState([]),
        [liderancaMensagensJaNotificadas, setLiderancaMensagensJaNotificadas] = useState([]),
        [liderancaVizPorMsg, setLiderancaVizPorMsg] = useState({}), // {msg_id: [{user_cod, user_foto, user_nome}]}
        [liderancaReacoes, setLiderancaReacoes] = useState({}), // {msg_id: [{user_cod, emoji}]}
        [liderancaImagemExpandida, setLiderancaImagemExpandida] = useState(null), // URL da imagem expandida
        // Estados para grava√ß√£o de √°udio
        [liderancaGravando, setLiderancaGravando] = useState(false),
        [liderancaMediaRecorder, setLiderancaMediaRecorder] = useState(null),
        [liderancaAudioChunks, setLiderancaAudioChunks] = useState([]),
        [liderancaAudioPreview, setLiderancaAudioPreview] = useState(null),
        // Estado para preview de imagem
        [liderancaImagemPreview, setLiderancaImagemPreview] = useState(null),
        // Estados do Editor de Foto de Perfil
        [photoEditorOpen, setPhotoEditorOpen] = useState(false),
        [photoEditorSrc, setPhotoEditorSrc] = useState(null),
        [photoEditorZoom, setPhotoEditorZoom] = useState(1),
        [photoEditorPosition, setPhotoEditorPosition] = useState({x: 0, y: 0}),
        [photoEditorDragging, setPhotoEditorDragging] = useState(false),
        [photoEditorDragStart, setPhotoEditorDragStart] = useState({x: 0, y: 0}),
        // Estados do m√≥dulo Avisos (usu√°rio)
        [avisoAtual, setAvisoAtual] = useState(null),
        [avisoCarregado, setAvisoCarregado] = useState(false),
        // Estados do m√≥dulo Avisos (admin)
        [avisosData, setAvisosData] = useState([]),
        [avisosRegioes, setAvisosRegioes] = useState([]),
        [avisoModal, setAvisoModal] = useState(false),
        [avisoEdit, setAvisoEdit] = useState(null),
        [avisoForm, setAvisoForm] = useState({
            titulo: '',
            regioes: [],
            todas_regioes: false,
            data_inicio: '',
            data_fim: '',
            recorrencia_tipo: 'uma_vez',
            recorrencia_intervalo: 24,
            imagem_url: ''
        }),
        // Estados do m√≥dulo Incentivos Operacionais
        [incentivosData, setIncentivosData] = useState([]),
        [incentivosStats, setIncentivosStats] = useState({ ativos: 0, vencendo_em_breve: 0, pausados: 0, encerrados: 0, total: 0 }),
        [incentivoModal, setIncentivoModal] = useState(false),
        [incentivoEdit, setIncentivoEdit] = useState(null),
        [incentivoForm, setIncentivoForm] = useState({
            titulo: '',
            tipo: 'promocao',
            data_inicio: '',
            data_fim: '',
            hora_inicio: '',
            hora_fim: '',
            valor: '',
            valor_incentivo: '',
            clientes_vinculados: [],
            cor: '#0d9488'
        }),
        [incentivosCalendarioMes, setIncentivosCalendarioMes] = useState(new Date()),
        [incentivoClientesBi, setIncentivoClientesBi] = useState([]),
        [incentivoClientesLoading, setIncentivoClientesLoading] = useState(false),
        // Estados do m√≥dulo Opera√ß√µes
        [operacoesData, setOperacoesData] = useState([]),
        [operacoesRefreshKey, setOperacoesRefreshKey] = useState(0), // Trigger para atualizar calend√°rio
        [operacaoModal, setOperacaoModal] = useState(false),
        [operacaoEdit, setOperacaoEdit] = useState(null),
        [operacaoForm, setOperacaoForm] = useState({
            regiao: '',
            nome_cliente: '',
            endereco: '',
            modelo: 'nuvem',
            quantidade_motos: 1,
            obrigatoriedade_bau: false,
            possui_garantido: false,
            valor_garantido: '',
            data_inicio: '',
            observacoes: '',
            faixas_km: [
                { km_inicio: 1, km_fim: 10, valor_motoboy: '' },
                { km_inicio: 11, km_fim: 15, valor_motoboy: '' },
                { km_inicio: 16, km_fim: 20, valor_motoboy: '' },
                { km_inicio: 21, km_fim: 25, valor_motoboy: '' },
                { km_inicio: 26, km_fim: 30, valor_motoboy: '' },
                { km_inicio: 31, km_fim: 35, valor_motoboy: '' },
                { km_inicio: 36, km_fim: 40, valor_motoboy: '' },
                { km_inicio: 41, km_fim: 45, valor_motoboy: '' },
                { km_inicio: 46, km_fim: 50, valor_motoboy: '' },
                { km_inicio: 51, km_fim: 60, valor_motoboy: '' }
            ]
        }),
        // Estados para checklist de motos e expans√£o de cards
        [operacaoExpandida, setOperacaoExpandida] = useState(null),
        [checklistMotos, setChecklistMotos] = useState({}),
        [operacaoSubTab, setOperacaoSubTab] = useState('execucao'),
        // Estados para Recrutamento
        [recrutamentoData, setRecrutamentoData] = useState([]),
        [recrutamentoLoading, setRecrutamentoLoading] = useState(false),
        [recrutamentoModal, setRecrutamentoModal] = useState(false),
        [recrutamentoEdit, setRecrutamentoEdit] = useState(null),
        [recrutamentoForm, setRecrutamentoForm] = useState({
            nome_cliente: '',
            data_conclusao: '',
            quantidade_motos: 1,
            quantidade_backup: 0,
            observacao: ''
        }),
        [recrutamentoStats, setRecrutamentoStats] = useState(null),
        [recrutamentoCodBusca, setRecrutamentoCodBusca] = useState({}), // {necessidade_id_tipo: {codigo: '', nome: '', loading: false}}
        [recrutamentoSubTab, setRecrutamentoSubTab] = useState('em_andamento'),
        // Estados para Localiza√ß√£o de Clientes
        [localizacaoClientes, setLocalizacaoClientes] = useState([]),
        [localizacaoFiltro, setLocalizacaoFiltro] = useState(''),
        [localizacaoLoading, setLocalizacaoLoading] = useState(false),
        [localizacaoSubTab, setLocalizacaoSubTab] = useState('lista'), // 'lista' ou 'mapa'
        // Estados para Roteirizador
        [mostrarRoteirizador, setMostrarRoteirizador] = useState(false),
        // Estados para Relat√≥rio Di√°rio
        [relatoriosDiarios, setRelatoriosDiarios] = useState([]),
        [relatoriosLoading, setRelatoriosLoading] = useState(false),
        [showRelatorioModal, setShowRelatorioModal] = useState(false),
        [relatorioEdit, setRelatorioEdit] = useState(null),
        [relatorioImagemAmpliada, setRelatorioImagemAmpliada] = useState(null),
        [relatorioNaoLido, setRelatorioNaoLido] = useState(null), // Relat√≥rio para exibir no modal de ci√™ncia
        [relatoriosNaoLidos, setRelatoriosNaoLidos] = useState([]), // Lista de relat√≥rios n√£o lidos
        [relatorioForm, setRelatorioForm] = useState({
            titulo: '',
            conteudo: '',
            imagem: null,
            para_todos: true,
            setores_destino: []
        }),
        // Sistema de Setores
        [setores, setSetores] = useState([]),
        [setoresLoading, setSetoresLoading] = useState(false),
        [showSetorModal, setShowSetorModal] = useState(false),
        [setorEdit, setSetorEdit] = useState(null),
        [setorForm, setSetorForm] = useState({ nome: '', descricao: '', cor: '#6366f1' }),
        [setorExpandido, setSetorExpandido] = useState(null), // ID do setor expandido para ver usu√°rios
        // Tutorial do usu√°rio
        [tutorialAtivo, setTutorialAtivo] = useState(false),
        [tutorialPasso, setTutorialPasso] = useState(0),
        // Se√ß√£o Sobre a Tutts (landing page)
        [sobreTuttsAberto, setSobreTuttsAberto] = useState(false),
        [sobreTuttsSecao, setSobreTuttsSecao] = useState(0),
        // Estados para configura√ß√£o de regi√µes melhorada
        [regiaoNome, setRegiaoNome] = useState(""),
        [regiaoClienteSelecionado, setRegiaoClienteSelecionado] = useState([]), // array de cod_cliente selecionados
        [regiaoCentrosCusto, setRegiaoCentrosCusto] = useState({}), // {cod_cliente: [centros]}
        [regiaoItensAdicionados, setRegiaoItensAdicionados] = useState([]), // [{cod_cliente, nome_cliente, centro_custo}]
        [regiaoEditando, setRegiaoEditando] = useState(null), [plificState, setPlificState] = useState({ loading: false, loadingLote: false, consultaIndividual: null, consultaLote: [], idBusca: "", loadingDebito: false, pagina: 1, totalPaginas: 0, total: 0, somaTotal: 0 }), [modalDebitoPlific, setModalDebitoPlific] = useState(null), [debitoFormPlific, setDebitoFormPlific] = useState({ valor: "", descricao: "" }), [saldoPlificUser, setSaldoPlificUser] = useState({ saldo: null, loading: false, erro: null }),
        // Estados para dropdowns da aba Config
        [configSecaoAberta, setConfigSecaoAberta] = useState(""), // "" = todas fechadas
        // ==================== SIDEBAR STATES ====================
        [sidebarAberto, setSidebarAberto] = useState(false),
        [sidebarFixo, setSidebarFixo] = useState(false),
        [sidebarMenuAberto, setSidebarMenuAberto] = useState(null),
        ja = (e, t = "success") => {
            d({
                message: e,
                type: t
            }), setTimeout(() => d(null), 3e3)
        };
        
        // Expor fun√ß√£o de navega√ß√£o globalmente para o card de Filas do usu√°rio
        window._tuttsSetModulo = he;
        
        // ==================== FUN√á√ÉO DE NAVEGA√á√ÉO DO SIDEBAR ====================
        const navegarSidebar = (moduloId, abaId) => {
            he(moduloId);
            if (moduloId === "financeiro") {
                x(prev => ({...prev, finTab: abaId || "home-fin"}));
            } else if (moduloId === "solicitacoes") {
                x(prev => ({...prev, adminTab: abaId || "dashboard"}));
            } else if (moduloId === "disponibilidade") {
                // Disponibilidade √© um m√≥dulo separado - n√£o misturar com solicitacoes
                x(prev => ({...prev, dispTab: abaId || "panorama"}));
            } else if (moduloId === "bi") {
                ll(); tl(); al(); pl(); carregarPrazosProf();
                if (abaId) ht(abaId);
            } else if (moduloId === "config") {
                x(prev => ({...prev, configTab: abaId || "usuarios"}));
            } else if (moduloId === "operacional") {
                x(prev => ({...prev, opTab: abaId || "indicacoes"}));
            } else if (moduloId === "todo") {
                if (abaId) setTodoTab(abaId);
            } else if (moduloId === "filas") {
                if (abaId) setFilasTab(abaId);
            }
        };
        
        // ==================== PORTAL DO ROTEIRIZADOR ====================
        useEffect(() => {
            if (mostrarRoteirizador) {
                console.log("üó∫Ô∏è useEffect - Criando modal portal");
                let portalDiv = document.getElementById('roteirizador-portal');
                if (!portalDiv) {
                    portalDiv = document.createElement('div');
                    portalDiv.id = 'roteirizador-portal';
                    document.body.appendChild(portalDiv);
                }
                ReactDOM.render(
                    React.createElement(RoteirizadorModule, {
                        enderecosBi: localizacaoClientes,
                        onClose: () => { 
                            console.log("üó∫Ô∏è Fechando modal via portal"); 
                            setMostrarRoteirizador(false); 
                        },
                        showToast: ja
                    }),
                    portalDiv
                );
            } else {
                const portalDiv = document.getElementById('roteirizador-portal');
                if (portalDiv) {
                    ReactDOM.unmountComponentAtNode(portalDiv);
                }
            }
        }, [mostrarRoteirizador, localizacaoClientes]);
        
        // ==================== TUTORIAL DO USU√ÅRIO ====================
        const TUTORIAL_PASSOS = [
            {
                titulo: "üëã Bem-vindo ao Sistema Tutts!",
                descricao: "Ol√°! Vamos te mostrar como usar o sistema de forma r√°pida e f√°cil. Em poucos passos voc√™ vai conhecer todas as funcionalidades dispon√≠veis para voc√™.",
                icone: "üéâ",
                destaque: null
            },
            {
                titulo: "üìã Solicitar Ajuste",
                descricao: "Precisa solicitar reembolso de retornos ou ped√°gios? √â aqui! Basta enviar o n√∫mero da OS e os valores ser√£o analisados pela equipe.",
                icone: "üìã",
                destaque: "solicitacoes"
            },
            {
                titulo: "üí∞ Saque Emergencial",
                descricao: "Precisa de dinheiro antes do pagamento regular? Solicite um saque emergencial! Uma taxa de 4,5% ser√° aplicada e o valor cai na sua conta em at√© 1 hora.",
                icone: "üíµ",
                destaque: "saque"
            },
            {
                titulo: "üë• Promo√ß√£o de Indica√ß√£o",
                descricao: "Indique amigos para trabalhar conosco e ganhe b√¥nus! Quanto mais indica√ß√µes aprovadas, mais voc√™ ganha. Compartilhe seu link de indica√ß√£o!",
                icone: "ü§ù",
                destaque: "indicacoes"
            },
            {
                titulo: "üõ°Ô∏è Seguro de Vida IZA",
                descricao: "Voc√™ tem um seguro de vida! Aqui voc√™ encontra informa√ß√µes sobre coberturas, valores e como acionar em caso de necessidade.",
                icone: "üõ°Ô∏è",
                destaque: "seguro"
            },
            {
                titulo: "üõí Lojinha Tutts",
                descricao: "Ofertas exclusivas para voc√™! Compre produtos com desconto e o valor √© abatido diretamente do seu saldo. Fique de olho nas promo√ß√µes!",
                icone: "üõçÔ∏è",
                destaque: "loja"
            },
            {
                titulo: "üìä Seus N√∫meros",
                descricao: "Na tela inicial voc√™ v√™ um resumo: ajustes pendentes, saques em an√°lise e indica√ß√µes. Tudo num s√≥ lugar para voc√™ acompanhar!",
                icone: "üìà",
                destaque: "numeros"
            },
            {
                titulo: "üîÑ Bot√µes do Menu",
                descricao: "Use o bot√£o üè† para voltar ao menu principal, o üîÑ para atualizar as informa√ß√µes e o ‚ùì para ver este tutorial novamente quando quiser!",
                icone: "‚öôÔ∏è",
                destaque: "botoes"
            },
            {
                titulo: "‚úÖ Tudo Pronto!",
                descricao: "Agora voc√™ j√° conhece o sistema! Se tiver d√∫vidas, clique no ‚ùì no menu para rever este tutorial. Bom trabalho e boas corridas! üèçÔ∏è",
                icone: "üéä",
                destaque: null
            }
        ];
        
        const iniciarTutorial = () => {
            setTutorialPasso(0);
            setTutorialAtivo(true);
        };
        
        const proximoPasso = () => {
            setTutorialPasso(atual => {
                if (atual < TUTORIAL_PASSOS.length - 1) {
                    return atual + 1;
                } else {
                    finalizarTutorial();
                    return atual;
                }
            });
        };
        
        const passoAnterior = () => {
            setTutorialPasso(atual => {
                if (atual > 0) {
                    return atual - 1;
                }
                return atual;
            });
        };
        
        const finalizarTutorial = () => {
            setTutorialAtivo(false);
            setTutorialPasso(0);
            // Salvar no localStorage que o tutorial foi visto
            localStorage.setItem('tutts_tutorial_visto_' + l?.codProfissional, 'true');
        };
        
        const pularTutorial = () => {
            finalizarTutorial();
        };
        
        // Verificar se deve mostrar tutorial ao logar
        React.useEffect(() => {
            if (l && l.role === "user" && l.codProfissional) {
                const tutorialVisto = localStorage.getItem('tutts_tutorial_visto_' + l.codProfissional);
                if (!tutorialVisto) {
                    // Aguardar um pouco para o sistema carregar
                    setTimeout(() => {
                        setTutorialAtivo(true);
                    }, 1500);
                }
            }
        }, [l?.codProfissional]);
        
        // Componente do Tutorial
        const TutorialOverlay = () => {
            if (!tutorialAtivo) return null;
            
            const passo = TUTORIAL_PASSOS[tutorialPasso];
            const progresso = ((tutorialPasso + 1) / TUTORIAL_PASSOS.length) * 100;
            
            const handleProximo = () => {
                if (tutorialPasso < TUTORIAL_PASSOS.length - 1) {
                    setTutorialPasso(tutorialPasso + 1);
                } else {
                    setTutorialAtivo(false);
                    setTutorialPasso(0);
                    localStorage.setItem('tutts_tutorial_visto_' + l?.codProfissional, 'true');
                }
            };
            
            const handleAnterior = () => {
                if (tutorialPasso > 0) {
                    setTutorialPasso(tutorialPasso - 1);
                }
            };
            
            const handlePular = () => {
                setTutorialAtivo(false);
                setTutorialPasso(0);
                localStorage.setItem('tutts_tutorial_visto_' + l?.codProfissional, 'true');
            };
            
            return React.createElement("div", {
                className: "fixed inset-0 z-[100] flex items-center justify-center p-4",
                style: { backgroundColor: "rgba(0,0,0,0.85)" },
                onClick: (e) => { if (e.target === e.currentTarget) handlePular(); }
            },
                // Card do Tutorial
                React.createElement("div", {
                    className: "bg-white rounded-3xl shadow-2xl w-full max-w-lg overflow-hidden transform transition-all",
                    onClick: (e) => e.stopPropagation()
                },
                    // Header com gradiente
                    React.createElement("div", {
                        className: "bg-gradient-to-r from-purple-600 via-purple-700 to-indigo-700 p-6 text-white relative overflow-hidden"
                    },
                        // Decora√ß√£o de fundo
                        React.createElement("div", {
                            className: "absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2"
                        }),
                        React.createElement("div", {
                            className: "absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full translate-y-1/2 -translate-x-1/2"
                        }),
                        // Conte√∫do do header
                        React.createElement("div", {className: "relative"},
                            React.createElement("div", {className: "flex items-center justify-between mb-2"},
                                React.createElement("span", {className: "text-sm bg-white/20 px-3 py-1 rounded-full"}, 
                                    "Passo ", tutorialPasso + 1, " de ", TUTORIAL_PASSOS.length
                                ),
                                React.createElement("button", {
                                    type: "button",
                                    onClick: handlePular,
                                    className: "text-white/70 hover:text-white text-sm hover:bg-white/10 px-2 py-1 rounded transition-all cursor-pointer"
                                }, "Pular ‚úï")
                            ),
                            React.createElement("div", {className: "text-5xl mb-3"}, passo.icone),
                            React.createElement("h2", {className: "text-2xl font-bold"}, passo.titulo)
                        )
                    ),
                    
                    // Barra de progresso
                    React.createElement("div", {className: "h-1 bg-gray-200"},
                        React.createElement("div", {
                            className: "h-full bg-gradient-to-r from-purple-500 to-indigo-500 transition-all duration-500",
                            style: { width: progresso + "%" }
                        })
                    ),
                    
                    // Conte√∫do
                    React.createElement("div", {className: "p-6"},
                        React.createElement("p", {className: "text-gray-600 text-lg leading-relaxed"}, passo.descricao),
                        
                        // Indicadores de passos
                        React.createElement("div", {className: "flex justify-center gap-2 mt-6"},
                            TUTORIAL_PASSOS.map((_, idx) => 
                                React.createElement("div", {
                                    key: idx,
                                    className: "w-2 h-2 rounded-full transition-all " + (idx === tutorialPasso ? "bg-purple-600 w-6" : idx < tutorialPasso ? "bg-purple-300" : "bg-gray-300")
                                })
                            )
                        )
                    ),
                    
                    // Bot√µes de navega√ß√£o
                    React.createElement("div", {className: "flex gap-3 p-6 pt-0"},
                        tutorialPasso > 0 && React.createElement("button", {
                            type: "button",
                            onClick: handleAnterior,
                            className: "flex-1 px-6 py-3 border-2 border-purple-200 text-purple-700 rounded-xl font-semibold hover:bg-purple-50 transition-all cursor-pointer"
                        }, "‚Üê Anterior"),
                        React.createElement("button", {
                            type: "button",
                            onClick: handleProximo,
                            className: "flex-1 px-6 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-xl font-semibold hover:from-purple-700 hover:to-indigo-700 transition-all shadow-lg hover:shadow-xl cursor-pointer"
                        }, tutorialPasso === TUTORIAL_PASSOS.length - 1 ? "Come√ßar! üöÄ" : "Pr√≥ximo ‚Üí")
                    )
                )
            );
        };
        
        // ==================== FUN√á√ïES DO M√ìDULO SOCIAL ====================
        const loadSocialProfile = async (userCod) => {
            try {
                const res = await fetchAuth(`${API_URL}/social/profile/${userCod}`);
                if (res.ok) {
                    const profile = await res.json();
                    setSocialProfile(profile);
                }
            } catch (err) {
                console.error("Erro ao carregar perfil social:", err);
            }
        };
        
        const saveSocialProfile = async (displayName, photoBase64) => {
            try {
                setSocialLoading(true);
                console.log("üì∏ Salvando perfil:", { displayName, temFoto: !!photoBase64, tamanhoFoto: photoBase64?.length });
                const res = await fetchAuth(`${API_URL}/social/profile/${l.codProfissional}`, {
                    method: "PUT",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({ 
                        display_name: displayName, 
                        profile_photo: photoBase64 
                    })
                });
                if (res.ok) {
                    const profile = await res.json();
                    console.log("üì∏ Perfil salvo:", profile);
                    setSocialProfile(profile);
                    ja("‚úÖ Perfil atualizado!", "success");
                } else {
                    const err = await res.text();
                    console.error("üì∏ Erro ao salvar:", err);
                    ja("Erro ao salvar perfil", "error");
                }
            } catch (err) {
                console.error("üì∏ Erro:", err);
                ja("Erro ao salvar perfil", "error");
            } finally {
                setSocialLoading(false);
            }
        };
        
        const updateOnlineStatus = async (isOnline) => {
            if (!l?.codProfissional) return;
            try {
                await fetchAuth(`${API_URL}/social/status`, {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({ user_cod: l.codProfissional, is_online: isOnline })
                });
            } catch (err) {
                console.error("Erro ao atualizar status:", err);
            }
        };
        
        const loadSocialUsers = async () => {
            try {
                const res = await fetchAuth(`${API_URL}/social/users`);
                if (res.ok) {
                    const users = await res.json();
                    setSocialUsers(users);
                }
            } catch (err) {
                console.error("Erro ao carregar usu√°rios:", err);
            }
        };
        
        const loadSocialMessages = async () => {
            if (!l?.codProfissional) return;
            try {
                const res = await fetchAuth(`${API_URL}/social/messages/${l.codProfissional}`);
                if (res.ok) {
                    const msgs = await res.json();
                    setSocialMessages(msgs);
                }
                // Carregar contagem de n√£o lidas
                const unreadRes = await fetchAuth(`${API_URL}/social/messages/unread/${l.codProfissional}`);
                if (unreadRes.ok) {
                    const data = await unreadRes.json();
                    setSocialUnread(data.count);
                }
            } catch (err) {
                console.error("Erro ao carregar mensagens:", err);
            }
        };
        
        const sendSocialMessage = async (toUserCod, type, content) => {
            try {
                const res = await fetchAuth(`${API_URL}/social/messages`, {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({
                        from_user_cod: l.codProfissional,
                        from_user_name: socialProfile?.display_name || l.fullName,
                        to_user_cod: toUserCod,
                        message_type: type,
                        content: content
                    })
                });
                if (res.ok) {
                    ja("‚úÖ Enviado!", "success");
                    setSocialModalUser(null);
                }
            } catch (err) {
                ja("Erro ao enviar", "error");
            }
        };
        
        const markMessagesAsRead = async () => {
            if (!l?.codProfissional) return;
            try {
                await fetchAuth(`${API_URL}/social/messages/read`, {
                    method: "PATCH",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({ user_cod: l.codProfissional })
                });
                setSocialUnread(0);
            } catch (err) {
                console.error("Erro ao marcar como lido:", err);
            }
        };
        // ==================== FIM FUN√á√ïES M√ìDULO SOCIAL ====================
        
        // ==================== FUN√á√ïES MENSAGENS DA LIDERAN√áA ====================
        
        // Carregar todas as mensagens (para admin_master gerenciar)
        const loadLiderancaMensagens = async () => {
            try {
                const res = await fetchAuth(`${API_URL}/lideranca/mensagens`);
                if (res.ok) {
                    const msgs = await res.json();
                    setLiderancaMensagens(msgs);
                }
            } catch (err) {
                console.error("Erro ao carregar mensagens da lideran√ßa:", err);
            }
        };
        
        // Carregar mensagens pendentes (n√£o visualizadas)
        const loadLiderancaPendentes = async () => {
            if (!l?.codProfissional) return [];
            try {
                const res = await fetchAuth(`${API_URL}/lideranca/mensagens/pendentes/${l.codProfissional}`);
                if (res.ok) {
                    const msgs = await res.json();
                    setLiderancaPendentes(msgs);
                    return msgs;
                }
            } catch (err) {
                console.error("Erro ao carregar mensagens pendentes:", err);
            }
            return [];
        };
        
        // Carregar hist√≥rico de mensagens visualizadas
        const loadLiderancaHistorico = async () => {
            if (!l?.codProfissional) return;
            try {
                const res = await fetchAuth(`${API_URL}/lideranca/mensagens/historico/${l.codProfissional}`);
                if (res.ok) {
                    const msgs = await res.json();
                    setLiderancaHistorico(msgs);
                    // Carregar visualiza√ß√µes e rea√ß√µes de cada mensagem
                    for (const msg of msgs) {
                        loadVizPorMensagem(msg.id);
                        loadReacoesPorMensagem(msg.id);
                    }
                }
            } catch (err) {
                console.error("Erro ao carregar hist√≥rico:", err);
            }
        };
        
        // Carregar visualiza√ß√µes de uma mensagem espec√≠fica (para exibir fotos no rodap√©)
        const loadVizPorMensagem = async (msgId) => {
            try {
                const res = await fetchAuth(`${API_URL}/lideranca/mensagens/${msgId}/visualizacoes`);
                if (res.ok) {
                    const viz = await res.json();
                    setLiderancaVizPorMsg(prev => ({...prev, [msgId]: viz}));
                }
            } catch (err) {
                console.error("Erro ao carregar visualiza√ß√µes:", err);
            }
        };
        
        // Carregar rea√ß√µes de uma mensagem
        const loadReacoesPorMensagem = async (msgId) => {
            try {
                const res = await fetchAuth(`${API_URL}/lideranca/mensagens/${msgId}/reacoes`);
                if (res.ok) {
                    const reacoes = await res.json();
                    setLiderancaReacoes(prev => ({...prev, [msgId]: reacoes}));
                }
            } catch (err) {
                // Ignora se endpoint n√£o existir ainda
            }
        };
        
        // Enviar rea√ß√£o a uma mensagem
        const enviarReacaoLideranca = async (msgId, emoji) => {
            try {
                const res = await fetchAuth(`${API_URL}/lideranca/mensagens/${msgId}/reagir`, {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({
                        user_cod: l.codProfissional,
                        user_nome: socialProfile?.display_name || l.fullName,
                        user_foto: socialProfile?.profile_photo || null,
                        emoji: emoji
                    })
                });
                if (res.ok) {
                    await loadReacoesPorMensagem(msgId);
                }
            } catch (err) {
                console.error("Erro ao enviar rea√ß√£o:", err);
            }
        };
        
        // Criar nova mensagem da lideran√ßa
        const criarLiderancaMensagem = async (dados) => {
            try {
                const res = await fetchAuth(`${API_URL}/lideranca/mensagens`, {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({
                        ...dados,
                        criado_por_cod: l.codProfissional,
                        criado_por_nome: socialProfile?.display_name || l.fullName,
                        criado_por_foto: socialProfile?.profile_photo || null
                    })
                });
                if (res.ok) {
                    ja("‚úÖ Mensagem criada com sucesso!", "success");
                    setLiderancaModal(null);
                    setLiderancaImagemPreview(null);
                    setLiderancaAudioPreview(null);
                    await loadLiderancaMensagens();
                    return true;
                }
            } catch (err) {
                ja("Erro ao criar mensagem", "error");
            }
            return false;
        };
        
        // Marcar mensagem como visualizada
        const marcarLiderancaVisualizada = async (mensagemId) => {
            try {
                await fetchAuth(`${API_URL}/lideranca/mensagens/${mensagemId}/visualizar`, {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({
                        user_cod: l.codProfissional,
                        user_nome: socialProfile?.display_name || l.fullName,
                        user_foto: socialProfile?.profile_photo || null
                    })
                });
            } catch (err) {
                console.error("Erro ao marcar como visualizado:", err);
            }
        };
        
        // Carregar visualiza√ß√µes de uma mensagem
        const loadVisualizacoes = async (mensagemId) => {
            try {
                const res = await fetchAuth(`${API_URL}/lideranca/mensagens/${mensagemId}/visualizacoes`);
                if (res.ok) {
                    const viz = await res.json();
                    setLiderancaVisualizacoes(viz);
                }
            } catch (err) {
                console.error("Erro ao carregar visualiza√ß√µes:", err);
            }
        };
        
        // Deletar mensagem
        const deletarLiderancaMensagem = async (id) => {
            if (!confirm("Tem certeza que deseja excluir esta mensagem?")) return;
            try {
                const res = await fetchAuth(`${API_URL}/lideranca/mensagens/${id}`, { method: "DELETE" });
                if (res.ok) {
                    ja("‚úÖ Mensagem exclu√≠da!", "success");
                    await loadLiderancaMensagens();
                }
            } catch (err) {
                ja("Erro ao excluir", "error");
            }
        };
        
        // Verificar mensagens pendentes (para notifica√ß√£o)
        const checkLiderancaPendentes = async (isInitialCheck = false) => {
            if (!l?.codProfissional) return;
            // S√≥ admins recebem mensagens da lideran√ßa
            if (!["admin", "admin_master", "admin_financeiro"].includes(l.role)) return;
            
            try {
                const pendentes = await loadLiderancaPendentes();
                
                if (isInitialCheck) {
                    // No login, mostra todas as pendentes
                    if (pendentes.length > 0) {
                        console.log(`üì¢ Login: ${pendentes.length} mensagem(ns) da lideran√ßa pendente(s)`);
                        setLiderancaModal({ tipo: 'notificacao', dados: pendentes[0], fila: pendentes });
                        setLiderancaMensagensJaNotificadas(pendentes.map(m => m.id));
                    }
                } else {
                    // No polling, s√≥ mostra novas
                    const novas = pendentes.filter(m => !liderancaMensagensJaNotificadas.includes(m.id));
                    if (novas.length > 0) {
                        console.log(`üì¢ Polling: ${novas.length} NOVA(S) mensagem(ns) da lideran√ßa!`);
                        setLiderancaModal({ tipo: 'notificacao', dados: novas[0], fila: novas });
                        setLiderancaMensagensJaNotificadas(prev => [...prev, ...novas.map(m => m.id)]);
                    }
                }
            } catch (err) {
                console.error("Erro ao verificar mensagens da lideran√ßa:", err);
            }
        };
        
        // Fun√ß√£o para iniciar grava√ß√£o de √°udio
        const iniciarGravacaoAudio = async () => {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                const mediaRecorder = new MediaRecorder(stream);
                const chunks = [];
                
                mediaRecorder.ondataavailable = (e) => {
                    if (e.data.size > 0) {
                        chunks.push(e.data);
                    }
                };
                
                mediaRecorder.onstop = () => {
                    const blob = new Blob(chunks, { type: 'audio/webm' });
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setLiderancaAudioPreview(reader.result);
                        setLiderancaModal(prev => ({
                            ...prev,
                            dados: { ...prev.dados, midia_url: reader.result, midia_tipo: 'audio' }
                        }));
                    };
                    reader.readAsDataURL(blob);
                    stream.getTracks().forEach(track => track.stop());
                };
                
                setLiderancaMediaRecorder(mediaRecorder);
                setLiderancaAudioChunks(chunks);
                mediaRecorder.start();
                setLiderancaGravando(true);
                ja("üéôÔ∏è Gravando...", "success");
            } catch (err) {
                console.error("Erro ao acessar microfone:", err);
                ja("‚ùå N√£o foi poss√≠vel acessar o microfone", "error");
            }
        };
        
        // Fun√ß√£o para parar grava√ß√£o de √°udio
        const pararGravacaoAudio = () => {
            if (liderancaMediaRecorder && liderancaGravando) {
                liderancaMediaRecorder.stop();
                setLiderancaGravando(false);
                ja("‚úÖ √Åudio gravado!", "success");
            }
        };
        
        // Fun√ß√£o para upload de imagem
        const handleLiderancaImagemUpload = (file) => {
            if (!file) return;
            if (file.size > 5 * 1024 * 1024) {
                ja("Imagem muito grande! M√°ximo 5MB", "error");
                return;
            }
            const reader = new FileReader();
            reader.onloadend = () => {
                setLiderancaImagemPreview(reader.result);
                setLiderancaModal(prev => ({
                    ...prev,
                    dados: { ...prev.dados, midia_url: reader.result, midia_tipo: 'imagem' }
                }));
            };
            reader.readAsDataURL(file);
        };
        
        // Limpar m√≠dia
        const limparLiderancaMidia = () => {
            setLiderancaImagemPreview(null);
            setLiderancaAudioPreview(null);
            setLiderancaModal(prev => ({
                ...prev,
                dados: { ...prev.dados, midia_url: null, midia_tipo: null }
            }));
        };
        
        // ==================== FIM FUN√á√ïES MENSAGENS DA LIDERAN√áA ====================
        
        // ==================== FUN√á√ïES DO EDITOR DE FOTO DE PERFIL ====================
        const handlePhotoEditorOpen = (file) => {
            if (!file) return;
            // Aumentado de 500KB para 10MB
            if (file.size > 10 * 1024 * 1024) {
                ja("Imagem muito grande! M√°ximo 10MB", "error");
                return;
            }
            const reader = new FileReader();
            reader.onload = ev => {
                setPhotoEditorSrc(ev.target.result);
                setPhotoEditorZoom(1);
                setPhotoEditorPosition({x: 0, y: 0});
                setPhotoEditorOpen(true);
            };
            reader.readAsDataURL(file);
        };
        
        const handlePhotoEditorSave = () => {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            img.onload = () => {
                // Canvas de 400x400 para qualidade final
                const outputSize = 400;
                canvas.width = outputSize;
                canvas.height = outputSize;
                
                // Tamanho da √°rea de visualiza√ß√£o (256px)
                const viewSize = 256;
                
                // Calcular escala para cobrir todo o c√≠rculo (como object-fit: cover)
                const imgAspect = img.width / img.height;
                let baseWidth, baseHeight;
                
                if (imgAspect > 1) {
                    // Imagem mais larga que alta - altura preenche
                    baseHeight = viewSize;
                    baseWidth = viewSize * imgAspect;
                } else {
                    // Imagem mais alta que larga - largura preenche
                    baseWidth = viewSize;
                    baseHeight = viewSize / imgAspect;
                }
                
                // Aplicar zoom
                const zoomedWidth = baseWidth * photoEditorZoom;
                const zoomedHeight = baseHeight * photoEditorZoom;
                
                // Escala do viewSize para outputSize
                const scaleFactor = outputSize / viewSize;
                
                // Dimens√µes finais no canvas
                const finalWidth = zoomedWidth * scaleFactor;
                const finalHeight = zoomedHeight * scaleFactor;
                
                // Posi√ß√£o centralizada com offset do arraste
                const finalX = (outputSize - finalWidth) / 2 + (photoEditorPosition.x * scaleFactor);
                const finalY = (outputSize - finalHeight) / 2 + (photoEditorPosition.y * scaleFactor);
                
                // Criar clip circular
                ctx.beginPath();
                ctx.arc(outputSize / 2, outputSize / 2, outputSize / 2, 0, Math.PI * 2);
                ctx.closePath();
                ctx.clip();
                
                // Fundo
                ctx.fillStyle = '#7c3aed';
                ctx.fillRect(0, 0, outputSize, outputSize);
                
                // Desenhar imagem
                ctx.drawImage(img, finalX, finalY, finalWidth, finalHeight);
                
                // Converter para base64 com compress√£o
                const quality = 0.9;
                const base64 = canvas.toDataURL('image/png');
                
                // Atualizar preview
                x({...p, socialPhotoPreview: base64});
                setPhotoEditorOpen(false);
                ja("‚úÖ Foto ajustada! Clique em Salvar Perfil", "success");
            };
            img.src = photoEditorSrc;
        };
        
        const handlePhotoEditorMouseDown = (e) => {
            e.preventDefault();
            setPhotoEditorDragging(true);
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            setPhotoEditorDragStart({
                x: clientX - photoEditorPosition.x,
                y: clientY - photoEditorPosition.y
            });
        };
        
        const handlePhotoEditorMouseMove = (e) => {
            if (!photoEditorDragging) return;
            e.preventDefault();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            
            // Limitar movimento baseado no zoom
            const maxMove = 128 * (photoEditorZoom - 1);
            const newX = Math.max(-maxMove, Math.min(maxMove, clientX - photoEditorDragStart.x));
            const newY = Math.max(-maxMove, Math.min(maxMove, clientY - photoEditorDragStart.y));
            
            setPhotoEditorPosition({x: newX, y: newY});
        };
        
        const handlePhotoEditorMouseUp = () => {
            setPhotoEditorDragging(false);
        };
        // ==================== FIM FUN√á√ïES EDITOR DE FOTO ====================
        
        // Carregar perfil social e atualizar status online quando logar
        useEffect(() => {
            if (l?.codProfissional) {
                loadSocialProfile(l.codProfissional);
                updateOnlineStatus(true);
                loadSocialMessages();
                
                // Verificar tarefas pendentes (para usu√°rios com acesso ao To Do)
                const canAccessTodoEff = hasModuleAccess(l, "todo");
                if (canAccessTodoEff) {
                    setTimeout(() => checkTodoPendentes(true), 2000); // Aguarda 2s ap√≥s login - inicial
                }
                
                // Verificar mensagens da lideran√ßa (para admins)
                const isAdmin = ["admin", "admin_master", "admin_financeiro"].includes(l.role);
                if (isAdmin) {
                    setTimeout(() => checkLiderancaPendentes(true), 1000); // Aguarda 1s ap√≥s login
                }
                
                // Atualizar status online periodicamente
                const statusInterval = setInterval(() => {
                    updateOnlineStatus(true);
                    loadSocialMessages();
                }, 60000); // A cada 1 minuto
                
                // Polling: Verificar novas tarefas pendentes a cada 90 segundos
                let todoPollingInterval = null;
                if (canAccessTodoEff) {
                    todoPollingInterval = setInterval(() => {
                        console.log("üîî Polling: Verificando novas tarefas...");
                        checkTodoPendentes(false); // false = apenas novas tarefas
                    }, 90000); // A cada 1.5 minutos
                }
                
                // Polling: Verificar novas mensagens da lideran√ßa a cada 60 segundos
                let liderancaPollingInterval = null;
                if (isAdmin) {
                    liderancaPollingInterval = setInterval(() => {
                        console.log("üì¢ Polling: Verificando mensagens da lideran√ßa...");
                        checkLiderancaPendentes(false);
                    }, 60000); // A cada 1 minuto
                }
                
                // Marcar como offline ao fechar
                const handleBeforeUnload = () => updateOnlineStatus(false);
                window.addEventListener('beforeunload', handleBeforeUnload);
                
                return () => {
                    clearInterval(statusInterval);
                    if (todoPollingInterval) clearInterval(todoPollingInterval);
                    if (liderancaPollingInterval) clearInterval(liderancaPollingInterval);
                    window.removeEventListener('beforeunload', handleBeforeUnload);
                    updateOnlineStatus(false);
                };
            }
        }, [l?.codProfissional]);
        
        useEffect(() => {
            if (!l) return;
            const e = () => R(Date.now()),
                t = ["mousedown", "mousemove", "keydown", "scroll", "touchstart", "click"];
            t.forEach(t => window.addEventListener(t, e));
            const a = setInterval(() => {
                Date.now() - b > 9e5 && (ja("‚è∞ Sess√£o expirada", "error"), setTimeout(() => {
                    o(null), x({})
                }, 1500))
            }, 3e4);
            return () => {
                t.forEach(t => window.removeEventListener(t, e)), clearInterval(a)
            }
        }, [l, b]), useEffect(() => {
            l || "register" !== p.view || 0 !== pe.length || Ta()
        }, [p.view]), useEffect(() => (document.body.style.overflow = wa ? "hidden" : "auto", () => {
            document.body.style.overflow = "auto"
        }), [wa]), useEffect(() => {
            if ("register" === p.view && p.cod && pe.length > 0) {
                const e = Da(p.cod);
                x(e ? t => ({
                    ...t,
                    name: e,
                    codValido: !0
                }) : e => ({
                    ...e,
                    name: "",
                    codValido: !1
                }))
            }
        }, [p.cod, p.view, pe]), useEffect(() => {
            if (!l) return;
            const e = async e => {
                try {
                    await e()
                } catch (e) {
                    console.log("Background load error:", e)
                }
            }, t = () => {
                "user" === l.role && (e($a), e(qa), e(vl), e(_l), e(kl), e(carregarProgressoNovatos), e(Dl), e(Il), e(Za), e(Ka), e(Ta)), "admin_financeiro" !== l.role && "admin_master" !== l.role || (e(za), e(Ba), e(gl), e(wl), e(Cl), e(Sl), e(Dl), e(Ll), e(Ia), e(Ja), e(Ha), e(Wa), e(Ya)), "admin" !== l.role && "admin_master" !== l.role || e(Ia), "admin" === l.role && hasModuleAccess(l, "financeiro") && (e(wl), e(gl), e(Cl), e(Sl), e(Ll)), e(La)
            };
            (async () => {
                "user" === l.role && await Promise.all([Oa(), Ga()]), "admin_financeiro" !== l.role && "admin_master" !== l.role || await Promise.all([Ua(), Va()])
            })().then(() => {
                setTimeout(t, 100)
            })
        }, [l]);
        const Ca = () => {
                try {
                    const e = new(window.AudioContext || window.webkitAudioContext),
                        t = e.createOscillator(),
                        a = e.createGain();
                    t.connect(a), a.connect(e.destination), t.frequency.value = 800, t.type = "sine", a.gain.value = .3, t.start(), setTimeout(() => {
                        t.frequency.value = 600
                    }, 150), setTimeout(() => {
                        t.frequency.value = 800
                    }, 300), setTimeout(() => {
                        t.stop()
                    }, 450)
                } catch (e) {
                    console.log("Audio n√£o suportado")
                }
            },
            
            // ==================== WEBSOCKET PARA TEMPO REAL ====================
            wsRef = React.useRef(null),
            wsReconnectTimer = React.useRef(null),
            [wsConnected, setWsConnected] = React.useState(false),
            
            connectWebSocket = React.useCallback(() => {
                if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) return;
                const wsUrl = API_URL.replace('https://', 'wss://').replace('http://', 'ws://').replace('/api', '') + '/ws/financeiro';
                console.log('üîå [WS] Conectando:', wsUrl);
                try {
                    wsRef.current = new WebSocket(wsUrl);
                    wsRef.current.onopen = () => {
                        console.log('‚úÖ [WS] Conectado!');
                        setWsConnected(true);
                        if (l) {
                            // Enviar token JWT para autentica√ß√£o segura
                            const token = sessionStorage.getItem('tutts_token');
                            wsRef.current.send(JSON.stringify({ type: 'AUTH', token: token, role: l.role, cod_profissional: l.codProfissional }));
                        }
                        if (wsReconnectTimer.current) { clearTimeout(wsReconnectTimer.current); wsReconnectTimer.current = null; }
                    };
                    wsRef.current.onmessage = (event) => {
                        try {
                            const data = JSON.parse(event.data);
                            console.log('üì© [WS]:', data.event);
                            if (data.event === 'NEW_WITHDRAWAL') {
                                U(prev => { if (prev.some(w => w.id === data.data.id)) return prev; return [data.data, ...prev]; });
                                v(prev => ({ ...prev, solicitacoes: (prev.solicitacoes || 0) + 1, validacao: (prev.validacao || 0) + 1 }));
                                Ca(); ja(`üîî Novo saque de ${data.data.user_name || data.data.user_cod}!`, "info");
                            } else if (data.event === 'WITHDRAWAL_UPDATE') {
                                U(prev => prev.map(w => w.id === data.data.id ? { ...w, status: data.data.status } : w));
                                if (['aprovado', 'aprovado_gratuidade', 'rejeitado'].includes(data.data.status)) {
                                    v(prev => ({ ...prev, solicitacoes: Math.max(0, (prev.solicitacoes || 0) - 1), validacao: Math.max(0, (prev.validacao || 0) - 1) }));
                                }
                            } else if (data.event === 'MY_WITHDRAWAL_UPDATE') {
                                if (data.data.status === 'aprovado' || data.data.status === 'aprovado_gratuidade') { Ca(); ja('‚úÖ Seu saque foi aprovado!', 'success'); }
                                else if (data.data.status === 'rejeitado') { ja(`‚ùå Saque rejeitado: ${data.data.reject_reason || 'Sem motivo'}`, 'error'); }
                            } else if (data.event === 'AUTH_SUCCESS') { console.log('‚úÖ [WS] Autenticado:', data.role); }
                            else if (data.event === 'AUTH_ERROR') { console.error('‚ùå [WS] Erro de autentica√ß√£o:', data.error); setWsConnected(false); }
                        } catch (err) { console.error('‚ùå [WS] Erro:', err); }
                    };
                    wsRef.current.onclose = () => { console.log('üîå [WS] Desconectado'); setWsConnected(false); if (!wsReconnectTimer.current) { wsReconnectTimer.current = setTimeout(connectWebSocket, 5000); } };
                    wsRef.current.onerror = () => { setWsConnected(false); };
                } catch (err) { console.error('‚ùå [WS] Falha:', err); }
            }, [l]),
            // ==================== FIM WEBSOCKET ====================
            
            Aa = React.useRef(0),
            Sa = React.useRef(0),
            ka = React.useRef({
                solicitacoes: new Set,
                loja: new Set,
                gratuidades: new Set
            }),
            Pa = e => {
                if ("solicitacoes" === e || "validacao" === e) {
                    const e = q.filter(e => "pending" === e.status).map(e => e.id);
                    ka.current.solicitacoes = new Set([...ka.current.solicitacoes, ...e]), v(e => ({
                        ...e,
                        solicitacoes: 0,
                        validacao: 0
                    }))
                } else if ("loja" === e) {
                    const e = et.filter(e => "pendente" === e.status).map(e => e.id);
                    ka.current.loja = new Set([...ka.current.loja, ...e]), v(e => ({
                        ...e,
                        loja: 0
                    }))
                } else if ("gratuidades" === e) {
                    const e = Q.filter(e => "pending" === e.status).map(e => e.id);
                    ka.current.gratuidades = new Set([...ka.current.gratuidades, ...e]), v(e => ({
                        ...e,
                        gratuidades: 0
                    }))
                }
            };
        
        // ==================== CONECTAR WEBSOCKET ====================
        useEffect(() => {
            if (l && ['admin', 'admin_master', 'admin_financeiro'].includes(l.role)) {
                // CORRE√á√ÉO: Verificar se o token existe antes de conectar
                const token = sessionStorage.getItem('tutts_token');
                if (token) {
                    connectWebSocket();
                } else {
                    // Aguardar um pouco para o token ser salvo
                    const timeout = setTimeout(() => {
                        if (sessionStorage.getItem('tutts_token')) {
                            connectWebSocket();
                        }
                    }, 500);
                    return () => clearTimeout(timeout);
                }
            }
            return () => {
                if (wsRef.current) wsRef.current.close();
                if (wsReconnectTimer.current) clearTimeout(wsReconnectTimer.current);
            };
        }, [l, connectWebSocket]);
        
        // Ping para manter conex√£o viva
        useEffect(() => {
            if (!wsConnected) return;
            const pingInterval = setInterval(() => {
                if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) {
                    wsRef.current.send(JSON.stringify({ type: 'PING' }));
                }
            }, 30000);
            return () => clearInterval(pingInterval);
        }, [wsConnected]);
        // ==================== FIM WEBSOCKET CONNECT ====================
        
        useEffect(() => {
            const canAccessFinEff = hasModuleAccess(l, "financeiro");
            if (!l || (!canAccessFinEff || ("admin_master" === l.role && "financeiro" !== Ee))) return;
            
            // Carregar planilha de profissionais se ainda n√£o carregada (para cidades das indica√ß√µes)
            if (pe.length === 0) {
                Ta();
            }
            
            // ==================== CARREGAMENTO OTIMIZADO ====================
            const carregarDados = async () => {
                N(!0);
                try {
                    // Carregar TODOS os saques para vis√£o geral + pedidos + gratuidades
                    // Usar fetchAuth para enviar token JWT
                    const [saquesRes, pedidosRes, gratuidadesRes] = await Promise.all([
                        fetchAuth(`${API_URL}/withdrawals`),
                        fetchAuth(`${API_URL}/loja/pedidos`),
                        fetchAuth(`${API_URL}/gratuities`)
                    ]);
                    
                    // Verificar se as respostas s√£o v√°lidas
                    if (!saquesRes.ok || !gratuidadesRes.ok) {
                        console.error('Erro nas requisi√ß√µes:', saquesRes.status, gratuidadesRes.status);
                        N(!1);
                        return;
                    }
                    
                    const saques = await saquesRes.json();
                    const pedidos = await pedidosRes.json();
                    const gratuidades = await gratuidadesRes.json();
                    
                    // Verificar se s√£o arrays v√°lidos
                    if (!Array.isArray(saques) || !Array.isArray(gratuidades)) {
                        console.error('Resposta inv√°lida:', saques, gratuidades);
                        N(!1);
                        return;
                    }
                    
                    // Filtrar pendentes para contadores
                    const pendentes = saques.filter(e => e.status === "pending" || e.status === "aguardando_aprovacao");
                    const novosSaques = pendentes.filter(e => !ka.current.solicitacoes.has(e.id));
                    const novosPedidos = pedidos.filter(e => "pendente" === e.status && !ka.current.loja.has(e.id));
                    const novasGratuidades = gratuidades.filter(e => "pending" === e.status && !ka.current.gratuidades.has(e.id));
                    
                    v({ solicitacoes: novosSaques.length, validacao: novosSaques.length, loja: novosPedidos.length, gratuidades: novasGratuidades.length });
                    
                    // Detectar novos apenas se WebSocket offline
                    if (!wsConnected) {
                        const countAtual = pendentes.length;
                        if (countAtual > Aa.current && Aa.current > 0) { Ca(); ja("üîî Novo saque solicitado!", "info"); }
                        Aa.current = countAtual;
                        const countPedidos = pedidos.filter(e => "pendente" === e.status).length;
                        if (countPedidos > Sa.current && Sa.current > 0) { Ca(); ja("üõí Novo pedido na loja!", "info"); }
                        Sa.current = countPedidos;
                    }
                    
                    // IMPORTANTE: Carregar TODOS os saques para a tabela
                    U(saques); tt(pedidos); H(gratuidades);
                    
                    const abaAtiva = p.finTab || "home-fin";
                    "solicitacoes" === abaAtiva || "validacao" === abaAtiva ? Pa("solicitacoes") : "loja" === abaAtiva ? Pa("loja") : "gratuidades" === abaAtiva && Pa("gratuidades");
                    h(new Date);
                    console.log('‚úÖ Dados carregados:', saques.length, 'total,', pendentes.length, 'pendentes');
                } catch (e) { console.error("Erro:", e); }
                N(!1);
            };
            
            carregarDados();
            
            // Fallback: polling APENAS se WebSocket offline (60s ao inv√©s de 10s)
            const fallbackInterval = setInterval(() => {
                if (!wsConnected) { console.log('‚ö†Ô∏è [Fallback] WebSocket offline'); carregarDados(); }
            }, 60000);
            
            return () => clearInterval(fallbackInterval);
        }, [l, p.finTab, Ee, wsConnected]), 
        
        // useEffect separado para carregar dados espec√≠ficos da aba (s√≥ quando muda de aba)
        useEffect(() => {
            if (!l) return;
            const canAccessFinEff = hasModuleAccess(l, "financeiro");
            if (!canAccessFinEff) return;
            
            const e = p.finTab || "home-fin";
            const loadTabData = async () => {
                try {
                    switch (e) {
                        case "restritos":
                            await Ba();
                            break;
                        case "indicacoes":
                            // Carregar planilha se necess√°rio (para lista de cidades)
                            if (pe.length === 0) await Ta();
                            await wl(), await vl(), await jl(), await _l();
                            break;
                        case "promo-novatos":
                            await verificarElegibilidadeNovatos(), await Cl(), await Sl(), await Ll(), await carregarRegioesNovatos();
                            break;
                        case "resumo":
                            await Va();
                            break;
                        case "loja":
                            await Ja(), await Ha();
                            break;
                    }
                } catch (err) {
                    console.error("Erro ao carregar aba:", err);
                }
            };
            loadTabData();
        }, [p.finTab]),
        
        useEffect(() => {
            if (!l || "admin" !== l.role) return;
            const e = setInterval(async () => {
                N(!0);
                try {
                    await La(), h(new Date)
                } catch (e) {
                    console.error("Erro no polling:", e)
                }
                N(!1)
            }, 6e4);
            return () => clearInterval(e)
        }, [l]), useEffect(() => {
            // Verificar elegibilidade para promo√ß√µes novatos quando usu√°rio logar
            // Aplica para qualquer usu√°rio que n√£o seja admin
            if (l && l.codProfissional && !['admin', 'admin_master', 'admin_financeiro'].includes(l.role)) {
                verificarElegibilidadeNovatos();
            }
        }, [l]), useEffect(() => {
            if (!l || !["admin", "admin_master"].includes(l.role)) return;
            if ("disponibilidade" !== p.adminTab) return;
            const e = setInterval(async () => {
                try {
                    const e = await fetchAuth(`${API_URL}/disponibilidade`);
                    if (!e.ok) return;
                    const t = await e.json();
                    x(e => ({
                        ...e,
                        dispData: t
                    })), console.log("üîÑ Disponibilidade atualizada em tempo real")
                } catch (e) {
                    console.error("Erro no polling disponibilidade:", e)
                }
            }, 1e4);
            return () => clearInterval(e)
        }, [l, p.adminTab]), useEffect(() => {
            if (!l || !["admin", "admin_master", "admin_financeiro"].includes(l.role)) return;
            if ("horarios" !== p.finTab) return;
            (async () => {
                try {
                    const [e, t] = await Promise.all([fetchAuth(`${API_URL}/horarios`).then(e => e.json()), fetchAuth(`${API_URL}/horarios/especiais`).then(e => e.json())]);
                    console.log("Hor√°rios especiais recebidos:", t), Oe({
                        horarios: e,
                        especiais: t,
                        loading: !1
                    })
                } catch (e) {
                    console.error("Erro ao carregar hor√°rios:", e), Oe(e => ({
                        ...e,
                        loading: !1
                    }))
                }
            })()
        }, [l, p.finTab]), useEffect(() => {
            if (!l || !["admin", "admin_master", "admin_financeiro"].includes(l.role)) return;
            if ("avisos" !== p.finTab) return;
            (async () => {
                try {
                    const e = await fetchAuth(`${API_URL}/avisos`),
                        t = await e.json();
                    Ue({
                        avisos: t,
                        loading: !1
                    })
                } catch (e) {
                    console.error("Erro ao carregar avisos:", e), Ue(e => ({
                        ...e,
                        loading: !1
                    }))
                }
            })()
        }, [l, p.finTab]), useEffect(() => {
            if (!l || "user" !== l.role) return;
            if ("saque" !== p.userTab) return;
            We(!1), Je(0), Be(null); buscarSaldoPlificUsuario();
            (async () => {
                try {
                    const [e, t] = await Promise.all([fetchAuth(`${API_URL}/horarios/verificar`).then(e => e.json()), fetchAuth(`${API_URL}/avisos?ativos=true`).then(e => e.json())]);
                    Be(e);
                    const a = t.filter(t => !t.exibir_fora_horario || t.exibir_fora_horario && !e.dentroHorario);
                    He(a)
                } catch (e) {
                    console.error("Erro ao verificar hor√°rio:", e), Be({
                        dentroHorario: !0
                    })
                }
            })()
        }, [l, p.userTab]), 
        
        // Polling para atualizar hist√≥rico de saques do usu√°rio a cada 15 segundos
        useEffect(() => {
            if (!l || "user" !== l.role) return;
            if ("saque" !== p.userTab) return;
            
            // Atualiza imediatamente ao entrar
            Oa();
            
            // Polling a cada 15 segundos
            const pollingInterval = setInterval(() => {
                Oa();
                buscarSaldoPlificUsuario();
            }, 15000);
            
            return () => clearInterval(pollingInterval);
        }, [l, p.userTab]),
        
        useEffect(() => {
            T && T.pix_tipo && x(e => ({
                ...e,
                pixTipo: T.pix_tipo,
                finPix: T.pix_key || "",
                finName: T.full_name || "",
                finCpf: T.cpf || ""
            }))
        }, [T]);
        
        // Carregar aviso pendente para o usu√°rio
        useEffect(() => {
            if (l && l.role === "user" && l.codProfissional && !avisoCarregado) {
                setAvisoCarregado(true);
                fetchAuth(`${API_URL}/avisos-op/usuario/${l.codProfissional}`)
                    .then(res => res.json())
                    .then(data => { if (data) setAvisoAtual(data); })
                    .catch(err => console.error(err));
            }
        }, [l, avisoCarregado]);
        
        // Fun√ß√£o para fechar aviso
        const fecharAviso = async () => {
            if (avisoAtual && l) {
                await fetchAuth(`${API_URL}/avisos-op/${avisoAtual.id}/visualizar`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_cod: l.codProfissional })
                });
            }
            setAvisoAtual(null);
        };
        
        // Fun√ß√µes do m√≥dulo Avisos (admin)
        const carregarAvisos = async () => {
            try {
                const res = await fetchAuth(`${API_URL}/avisos-op`);
                const data = await res.json();
                setAvisosData(Array.isArray(data) ? data : []);
            } catch (err) { 
                console.error(err); 
                setAvisosData([]);
            }
        };
        
        const carregarRegioes = async () => {
            try {
                const res = await fetchAuth(`${API_URL}/avisos-op/regioes`);
                const data = await res.json();
                setAvisosRegioes(Array.isArray(data) ? data : []);
            } catch (err) { 
                console.error(err); 
                setAvisosRegioes([]);
            }
        };

        // ==================== FUN√á√ïES INCENTIVOS OPERACIONAIS ====================
        const carregarIncentivos = async () => {
            try {
                const [dataRes, statsRes] = await Promise.all([
                    fetchAuth(`${API_URL}/incentivos-op`),
                    fetchAuth(`${API_URL}/incentivos-op/stats`)
                ]);
                
                const data = await dataRes.json();
                const stats = await statsRes.json();
                
                setIncentivosData(data || []);
                setIncentivosStats(stats || { ativos: 0, vencendo_em_breve: 0, pausados: 0, encerrados: 0, total: 0 });
            } catch (err) {
                console.error('‚ùå Erro ao carregar incentivos:', err);
            }
        };

        const carregarClientesBiIncentivos = async () => {
            setIncentivoClientesLoading(true);
            try {
                const res = await fetchAuth(`${API_URL}/bi/clientes-por-regiao`);
                const data = await res.json();
                setIncentivoClientesBi(Array.isArray(data) ? data : []);
            } catch (err) {
                console.error('‚ùå Erro ao carregar clientes BI:', err);
                setIncentivoClientesBi([]);
            }
            setIncentivoClientesLoading(false);
        };

        const salvarIncentivo = async () => {
            try {
                const url = incentivoEdit 
                    ? `${API_URL}/incentivos-op/${incentivoEdit.id}`
                    : `${API_URL}/incentivos-op`;
                
                const method = incentivoEdit ? 'PUT' : 'POST';
                
                const payload = {
                    ...incentivoForm,
                    valor_incentivo: incentivoForm.valor_incentivo ? parseFloat(incentivoForm.valor_incentivo) : null,
                    status: incentivoForm.status || incentivoEdit?.status || 'ativo',
                    created_by: l?.name || l?.email
                };
                
                const res = await fetchAuth(url, {
                    method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (res.ok) {
                    ja(incentivoEdit ? '‚úÖ Incentivo atualizado!' : '‚úÖ Incentivo criado!', 'success');
                    setIncentivoModal(false);
                    setIncentivoEdit(null);
                    setIncentivoForm({
                        titulo: '',
                        tipo: 'promocao',
                        data_inicio: '',
                        data_fim: '',
                        hora_inicio: '',
                        hora_fim: '',
                        valor: '',
                        valor_incentivo: '',
                        clientes_vinculados: [],
                        cor: '#0d9488'
                    });
                    carregarIncentivos();
                } else {
                    const err = await res.json();
                    ja('Erro: ' + (err.error || 'Falha ao salvar'), 'error');
                }
            } catch (err) {
                console.error('‚ùå Erro ao salvar incentivo:', err);
                ja('Erro ao salvar incentivo', 'error');
            }
        };

        const deletarIncentivo = async (id) => {
            if (!confirm('Tem certeza que deseja excluir este incentivo?')) return;
            
            try {
                const res = await fetchAuth(`${API_URL}/incentivos-op/${id}`, { method: 'DELETE' });
                
                if (res.ok) {
                    ja('‚úÖ Incentivo exclu√≠do!', 'success');
                    carregarIncentivos();
                } else {
                    ja('Erro ao excluir incentivo', 'error');
                }
            } catch (err) {
                console.error('‚ùå Erro ao deletar incentivo:', err);
                ja('Erro ao excluir incentivo', 'error');
            }
        };
        // ==================== FIM FUN√á√ïES INCENTIVOS ====================

        const consultarSaldoPlific = async (idProf) => {
            if (!idProf) { ja("Informe o ID", "error"); return; }
            setPlificState(prev => ({ ...prev, loading: true }));
            try {
                const response = await fetchAuth(`${API_URL}/plific/saldo/${idProf}?refresh=true`);
                const data = await response.json();
                if (!response.ok) throw new Error(data.error || "Erro");
                setPlificState(prev => ({ ...prev, consultaIndividual: data, loading: false }));
                ja("Saldo consultado!", "success");
            } catch (error) {
                setPlificState(prev => ({ ...prev, loading: false }));
                ja(error.message, "error");
            }
        };


        // Consulta em Lote - busca saldos de m√∫ltiplos profissionais
        const consultarSaldosLotePlific = async (pagina = 1) => {
            setPlificState(prev => ({ ...prev, loadingLote: true }));
            try {
                const response = await fetchAuth(`${API_URL}/plific/saldos-todos?pagina=${pagina}&porPagina=15`);
                const data = await response.json();
                
                if (!response.ok) throw new Error(data.error || "Erro ao consultar saldos");
                
                setPlificState(prev => ({ 
                    ...prev, 
                    consultaLote: data.profissionais || [], 
                    pagina: data.pagina || 1,
                    totalPaginas: data.totalPaginas || 0,
                    total: data.total || 0,
                    somaTotal: data.somaTotal || 0,
                    loadingLote: false 
                }));
                
                if (pagina === 1) {
                    ja(`${data.total || 0} profissionais encontrados!`, "success");
                }
            } catch (error) {
                setPlificState(prev => ({ ...prev, loadingLote: false }));
                ja(error.message, "error");
            }
        };

        // Lan√ßar D√©bito
        const lancarDebitoPlific = async (idProf, valor, descricao) => {
            if (!idProf || !valor || !descricao) {
                ja("Preencha todos os campos", "error");
                return false;
            }
            
            const valorNum = parseFloat(String(valor).replace(",", "."));
            if (isNaN(valorNum) || valorNum <= 0) {
                ja("Valor inv√°lido", "error");
                return false;
            }

            setPlificState(prev => ({ ...prev, loadingDebito: true }));
            try {
                const response = await fetchAuth(`${API_URL}/plific/lancar-debito`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ idProf: parseInt(idProf), valor: valorNum, descricao })
                });
                
                const data = await response.json();
                
                if (!response.ok) throw new Error(data.error || "Erro ao lan√ßar d√©bito");
                
                setPlificState(prev => ({ ...prev, loadingDebito: false }));
                ja(`D√©bito de R$ ${valorNum.toFixed(2)} lan√ßado com sucesso!`, "success");
                
                // Atualiza o saldo ap√≥s d√©bito
                consultarSaldoPlific(idProf);
                
                return true;
            } catch (error) {
                setPlificState(prev => ({ ...prev, loadingDebito: false }));
                ja(error.message, "error");
                return false;
            }
        };

        // Exportar CSV
        const exportarSaldosCSVPlific = () => {
            if (!plificState.consultaLote || plificState.consultaLote.length === 0) {
                ja("Nenhum dado para exportar", "warning");
                return;
            }
            
            const dados = plificState.consultaLote.filter(r => !r.erro);
            const csv = [
                "ID;Nome;CPF;Celular;Saldo",
                ...dados.map(p => `${p.idProf || p.id || ""};${p.nome || ""};${p.cpf || ""};${p.celular || ""};${parseSaldoBR(p.saldo).toFixed(2).replace(".", ",")}`)
            ].join("\n");
            
            const blob = new Blob(["\ufeff" + csv], { type: "text/csv;charset=utf-8" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `saldos_plific_${new Date().toISOString().split("T")[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            ja("CSV exportado!", "success");
        };


        // Buscar saldo Plific do usu√°rio logado (para tela de saque)
        const buscarSaldoPlificUsuario = async (forceRefresh = false) => {
            if (!l || !l.cod_profissional) return;
            
            setSaldoPlificUser(prev => ({ ...prev, loading: true, erro: null }));
            try {
                const url = forceRefresh 
                    ? `${API_URL}/plific/saldo/${l.cod_profissional}?refresh=true`
                    : `${API_URL}/plific/saldo/${l.cod_profissional}`;
                const response = await fetchAuth(url);
                const data = await response.json();
                
                if (!response.ok) {
                    setSaldoPlificUser({ saldo: null, loading: false, erro: data.error || "Erro ao consultar saldo" });
                    return;
                }
                
                const saldoReal = data.profissional ? parseSaldoBR(data.profissional.saldo) : 0;
                
                // Guarda o saldo real - o c√°lculo com pendentes √© feito no render
                setSaldoPlificUser({ saldo: saldoReal, loading: false, erro: null });
            } catch (error) {
                setSaldoPlificUser({ saldo: null, loading: false, erro: error.message });
            }
        };
        
        // Calcular saldo dispon√≠vel (saldo real - saques pendentes)
        
        const calcularSaldoDisponivel = () => {
            if (saldoPlificUser.saldo === null) return null;
            const saquesPendentes = M.filter(s => s.status === "pending" || s.status === "aguardando_aprovacao");
            const totalPendente = saquesPendentes.reduce((acc, s) => acc + parseFloat(s.requested_amount || 0), 0);
            return Math.max(0, saldoPlificUser.saldo - totalPendente);
        };

        
        // Fun√ß√£o para carregar opera√ß√µes
        const carregarOperacoes = async () => {
            try {
                const res = await fetchAuth(`${API_URL}/operacoes`);
                const data = await res.json();
                setOperacoesData(Array.isArray(data) ? data : []);
            } catch (err) { 
                console.error('Erro ao carregar opera√ß√µes:', err); 
                setOperacoesData([]);
            }
        };
        
        // Fun√ß√£o para notificar que opera√ß√£o foi salva (atualiza calend√°rio de incentivos)
        const notificarOperacaoSalva = () => {
            setOperacoesRefreshKey(k => k + 1);
        };
        
        // ==================== FUN√á√ïES RECRUTAMENTO ====================
        // Fun√ß√£o para carregar necessidades de recrutamento
        const carregarRecrutamento = async () => {
            setRecrutamentoLoading(true);
            try {
                const res = await fetchAuth(`${API_URL}/recrutamento`);
                const data = await res.json();
                setRecrutamentoData(Array.isArray(data) ? data : []);
                
                // Carregar estat√≠sticas
                const statsRes = await fetchAuth(`${API_URL}/recrutamento/estatisticas`);
                const stats = await statsRes.json();
                setRecrutamentoStats(stats);
            } catch (err) { 
                console.error('Erro ao carregar recrutamento:', err); 
                setRecrutamentoData([]);
            }
            setRecrutamentoLoading(false);
        };
        
        // Fun√ß√£o para salvar necessidade de recrutamento
        const salvarRecrutamento = async () => {
            try {
                const url = recrutamentoEdit 
                    ? `${API_URL}/recrutamento/${recrutamentoEdit.id}`
                    : `${API_URL}/recrutamento`;
                const method = recrutamentoEdit ? 'PUT' : 'POST';
                
                const res = await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        ...recrutamentoForm,
                        criado_por: l?.fullName || 'Admin'
                    })
                });
                
                if (!res.ok) {
                    const err = await res.json();
                    throw new Error(err.error);
                }
                
                ja(recrutamentoEdit ? '‚úÖ Necessidade atualizada!' : '‚úÖ Necessidade criada!', 'success');
                setRecrutamentoModal(false);
                setRecrutamentoEdit(null);
                setRecrutamentoForm({
                    nome_cliente: '',
                    data_conclusao: '',
                    quantidade_motos: 1,
                    quantidade_backup: 0,
                    observacao: ''
                });
                carregarRecrutamento();
            } catch (err) {
                ja('‚ùå Erro: ' + err.message, 'error');
            }
        };
        
        // Fun√ß√£o para buscar profissional pelo c√≥digo
        const buscarProfissionalRecrutamento = async (necessidadeId, tipo, codigo) => {
            const key = `${necessidadeId}_${tipo}`;
            setRecrutamentoCodBusca(prev => ({
                ...prev,
                [key]: { ...prev[key], codigo, loading: true, nome: '', erro: '' }
            }));
            
            try {
                const res = await fetchAuth(`${API_URL}/recrutamento/buscar-profissional/${codigo}`);
                if (!res.ok) {
                    const err = await res.json();
                    throw new Error(err.error || 'N√£o encontrado');
                }
                const data = await res.json();
                setRecrutamentoCodBusca(prev => ({
                    ...prev,
                    [key]: { ...prev[key], codigo, nome: data.nome_profissional || data.full_name, loading: false }
                }));
            } catch (err) {
                setRecrutamentoCodBusca(prev => ({
                    ...prev,
                    [key]: { ...prev[key], codigo, nome: '', loading: false, erro: err.message }
                }));
            }
        };
        
        // Fun√ß√£o para atribuir profissional
        const atribuirProfissionalRecrutamento = async (necessidadeId, tipo) => {
            const key = `${necessidadeId}_${tipo}`;
            const info = recrutamentoCodBusca[key];
            if (!info || !info.codigo) {
                ja('‚ùå Digite o c√≥digo do profissional', 'error');
                return;
            }
            
            try {
                const res = await fetchAuth(`${API_URL}/recrutamento/${necessidadeId}/atribuir`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        cod_profissional: info.codigo,
                        tipo,
                        atribuido_por: l?.fullName || 'Admin'
                    })
                });
                
                if (!res.ok) {
                    const err = await res.json();
                    throw new Error(err.error);
                }
                
                ja('‚úÖ Profissional atribu√≠do!', 'success');
                setRecrutamentoCodBusca(prev => ({
                    ...prev,
                    [key]: { codigo: '', nome: '', loading: false }
                }));
                carregarRecrutamento();
            } catch (err) {
                ja('‚ùå Erro: ' + err.message, 'error');
            }
        };
        
        // Fun√ß√£o para remover atribui√ß√£o
        const removerAtribuicaoRecrutamento = async (atribuicaoId) => {
            if (!confirm('Remover esta atribui√ß√£o?')) return;
            
            try {
                const res = await fetchAuth(`${API_URL}/recrutamento/atribuicao/${atribuicaoId}`, {
                    method: 'DELETE'
                });
                
                if (!res.ok) {
                    const err = await res.json();
                    throw new Error(err.error);
                }
                
                ja('‚úÖ Atribui√ß√£o removida!', 'success');
                carregarRecrutamento();
            } catch (err) {
                ja('‚ùå Erro: ' + err.message, 'error');
            }
        };
        
        // Fun√ß√£o para deletar necessidade
        const deletarRecrutamento = async (id) => {
            if (!confirm('Excluir esta necessidade de recrutamento? Todas as atribui√ß√µes ser√£o removidas.')) return;
            
            try {
                const res = await fetchAuth(`${API_URL}/recrutamento/${id}`, {
                    method: 'DELETE'
                });
                
                if (!res.ok) {
                    const err = await res.json();
                    throw new Error(err.error);
                }
                
                ja('‚úÖ Necessidade exclu√≠da!', 'success');
                carregarRecrutamento();
            } catch (err) {
                ja('‚ùå Erro: ' + err.message, 'error');
            }
        };
        
        // ==================== FUN√á√ïES LOCALIZA√á√ÉO CLIENTES ====================
        // Fun√ß√£o para gerar link do Google Maps
        const gerarLinkGoogleMaps = (endereco, latitude, longitude) => {
            if (latitude && longitude && latitude !== 0 && longitude !== 0) {
                return `https://www.google.com/maps?q=${latitude},${longitude}`;
            }
            if (endereco) {
                return `https://www.google.com/maps?q=${encodeURIComponent(endereco)}`;
            }
            return 'https://www.google.com/maps';
        };
        
        // Fun√ß√£o para gerar link do Waze
        const gerarLinkWaze = (endereco, latitude, longitude) => {
            if (latitude && longitude && latitude !== 0 && longitude !== 0) {
                return `https://waze.com/ul?ll=${latitude},${longitude}&navigate=yes`;
            }
            if (endereco) {
                return `https://waze.com/ul?q=${encodeURIComponent(endereco)}&navigate=yes`;
            }
            return 'https://waze.com/ul';
        };
        
        // Fun√ß√£o para copiar para clipboard
        const copiarParaClipboard = async (texto, tipo) => {
            try {
                await navigator.clipboard.writeText(texto);
                ja(`‚úÖ Link ${tipo} copiado!`, "success");
            } catch (err) {
                // Fallback para browsers antigos
                const textarea = document.createElement('textarea');
                textarea.value = texto;
                textarea.style.position = 'fixed';
                textarea.style.left = '-9999px';
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    ja(`‚úÖ Link ${tipo} copiado!`, "success");
                } catch (e) {
                    ja(`‚ùå Erro ao copiar`, "error");
                }
                document.body.removeChild(textarea);
            }
        };
        
        // Fun√ß√£o para carregar dados de localiza√ß√£o dos clientes
        const carregarLocalizacaoClientes = async () => {
            setLocalizacaoLoading(true);
            try {
                const res = await fetchAuth(`${API_URL}/bi/localizacao-clientes`);
                const data = await res.json();
                setLocalizacaoClientes(Array.isArray(data) ? data : []);
            } catch (err) { 
                console.error('Erro ao carregar localiza√ß√£o clientes:', err); 
                setLocalizacaoClientes([]);
            }
            setLocalizacaoLoading(false);
        };
        
        // Fun√ß√µes para Relat√≥rio Di√°rio
        const carregarRelatoriosDiarios = async () => {
            setRelatoriosLoading(true);
            try {
                // Passar setor_id e usuario_id para filtrar relat√≥rios que o usu√°rio pode ver
                // Admins (sem setor) veem todos, usu√°rios comuns s√≥ veem os do seu setor ou para todos
                const params = new URLSearchParams();
                if (l?.setor_id) params.append('setor_id', l.setor_id);
                if (l?.codProfissional) params.append('usuario_id', l.codProfissional);
                
                const queryString = params.toString() ? `?${params.toString()}` : '';
                const res = await fetchAuth(`${API_URL}/relatorios-diarios${queryString}`);
                const data = await res.json();
                setRelatoriosDiarios(Array.isArray(data) ? data : []);
            } catch (err) { 
                console.error('Erro ao carregar relat√≥rios:', err); 
                setRelatoriosDiarios([]);
            }
            setRelatoriosLoading(false);
        };
        
        // ===== FUN√á√ïES DE SETORES =====
        const carregarSetores = async () => {
            try {
                const res = await fetchAuth(`${API_URL}/setores`);
                const data = await res.json();
                setSetores(Array.isArray(data) ? data : []);
            } catch (err) {
                console.error('Erro ao carregar setores:', err);
                setSetores([]);
            }
        };
        
        const salvarSetor = async () => {
            if (!setorForm.nome.trim()) {
                ja('Nome do setor √© obrigat√≥rio', 'error');
                return;
            }
            
            setSetoresLoading(true);
            try {
                const url = setorEdit 
                    ? `${API_URL}/setores/${setorEdit.id}`
                    : `${API_URL}/setores`;
                const method = setorEdit ? 'PUT' : 'POST';
                
                const res = await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(setorForm)
                });
                
                const data = await res.json();
                
                if (!res.ok) {
                    throw new Error(data.error || 'Erro ao salvar');
                }
                
                ja(setorEdit ? 'Setor atualizado!' : 'Setor criado!', 'success');
                setShowSetorModal(false);
                setSetorEdit(null);
                setSetorForm({ nome: '', descricao: '', cor: '#6366f1' });
                carregarSetores();
            } catch (err) {
                ja(err.message || 'Erro ao salvar setor', 'error');
            }
            setSetoresLoading(false);
        };
        
        const excluirSetor = async (setor) => {
            if (!confirm(`Excluir o setor "${setor.nome}"?`)) return;
            
            try {
                const res = await fetchAuth(`${API_URL}/setores/${setor.id}`, { method: 'DELETE' });
                const data = await res.json();
                
                if (!res.ok) {
                    throw new Error(data.error || 'Erro ao excluir');
                }
                
                ja('Setor exclu√≠do!', 'success');
                carregarSetores();
            } catch (err) {
                ja(err.message || 'Erro ao excluir setor', 'error');
            }
        };
        
        const atualizarSetorUsuario = async (codProfissional, setorId) => {
            try {
                const res = await fetchAuth(`${API_URL}/users/${codProfissional}/setor`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ setor_id: setorId || null })
                });
                
                if (!res.ok) {
                    throw new Error('Erro ao atualizar');
                }
                
                ja('Setor do usu√°rio atualizado!', 'success');
                Ia(); // Recarregar usu√°rios
            } catch (err) {
                ja('Erro ao atualizar setor', 'error');
            }
        };
        
        // Carregar setores quando logar
        React.useEffect(() => {
            if (l?.codProfissional) {
                carregarSetores();
            }
        }, [l?.codProfissional]);
        
        // Carregar relat√≥rios n√£o lidos pelo usu√°rio
        const carregarRelatoriosNaoLidos = async () => {
            console.log('üì¢ Verificando relat√≥rios n√£o lidos para:', l?.codProfissional, 'setor:', l?.setor_id);
            if (!l?.codProfissional) {
                console.log('‚ùå Sem codProfissional');
                return;
            }
            try {
                // Passar setor_id como query param para filtrar por setor
                const setorParam = l?.setor_id ? `?setor_id=${l.setor_id}` : '';
                const res = await fetchAuth(`${API_URL}/relatorios-diarios/nao-lidos/${l.codProfissional}${setorParam}`);
                const data = await res.json();
                console.log('üì¢ Resposta do servidor:', data);
                const naoLidos = Array.isArray(data) ? data : [];
                setRelatoriosNaoLidos(naoLidos);
                // Se houver relat√≥rios n√£o lidos, mostrar o primeiro
                if (naoLidos.length > 0) {
                    console.log('üì¢ Mostrando modal para:', naoLidos[0]);
                    setRelatorioNaoLido(naoLidos[0]);
                } else {
                    console.log('üì¢ Nenhum relat√≥rio n√£o lido');
                }
            } catch (err) { 
                console.error('Erro ao carregar relat√≥rios n√£o lidos:', err); 
            }
        };
        
        // Marcar relat√≥rio como lido
        const marcarRelatorioComoLido = async (relatorioId) => {
            if (!l?.codProfissional) return;
            try {
                await fetchAuth(`${API_URL}/relatorios-diarios/${relatorioId}/visualizar`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        usuario_id: l.codProfissional,
                        usuario_nome: l.fullName || l.username,
                        usuario_foto: socialProfile?.profile_photo || ''
                    })
                });
                
                // Remover da lista de n√£o lidos
                const novosNaoLidos = relatoriosNaoLidos.filter(r => r.id !== relatorioId);
                setRelatoriosNaoLidos(novosNaoLidos);
                
                // Mostrar pr√≥ximo relat√≥rio n√£o lido ou fechar modal
                if (novosNaoLidos.length > 0) {
                    setRelatorioNaoLido(novosNaoLidos[0]);
                } else {
                    setRelatorioNaoLido(null);
                }
                
                // Atualizar lista de relat√≥rios para mostrar nova visualiza√ß√£o
                carregarRelatoriosDiarios();
            } catch (err) { 
                console.error('Erro ao marcar como lido:', err); 
            }
        };
        
        // Verificar relat√≥rios n√£o lidos ao carregar e periodicamente
        React.useEffect(() => {
            if (l?.codProfissional) {
                carregarRelatoriosNaoLidos();
                // Verificar a cada 30 segundos
                const interval = setInterval(carregarRelatoriosNaoLidos, 30000);
                return () => clearInterval(interval);
            }
        }, [l?.codProfissional]);
        
        // Renderizar modal de relat√≥rio globalmente via Portal
        React.useEffect(() => {
            if (!relatorioNaoLido) return;
            
            // Criar container do portal se n√£o existir
            let portalRoot = document.getElementById('relatorio-modal-portal');
            if (!portalRoot) {
                portalRoot = document.createElement('div');
                portalRoot.id = 'relatorio-modal-portal';
                document.body.appendChild(portalRoot);
            }
            
            // Renderizar modal no portal
            const modalContent = React.createElement("div", {
                style: {
                    position: 'fixed',
                    top: 0,
                    left: 0,
                    right: 0,
                    bottom: 0,
                    backgroundColor: 'rgba(0,0,0,0.7)',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    zIndex: 99999,
                    padding: '16px'
                }
            },
                React.createElement("div", {
                    style: {
                        backgroundColor: 'white',
                        borderRadius: '16px',
                        boxShadow: '0 25px 50px -12px rgba(0,0,0,0.25)',
                        width: '100%',
                        maxWidth: '640px',
                        maxHeight: '90vh',
                        overflow: 'hidden',
                        display: 'flex',
                        flexDirection: 'column'
                    }
                },
                    // Header
                    React.createElement("div", {
                        style: {
                            background: 'linear-gradient(to right, #0d9488, #0f766e)',
                            color: 'white',
                            padding: '16px',
                            display: 'flex',
                            alignItems: 'center',
                            gap: '12px'
                        }
                    },
                        React.createElement("span", {style: {fontSize: '30px'}}, "üì¢"),
                        React.createElement("div", null,
                            React.createElement("h3", {style: {fontSize: '18px', fontWeight: 'bold', margin: 0}}, "Novo Relat√≥rio Di√°rio"),
                            React.createElement("p", {style: {fontSize: '14px', color: '#99f6e4', margin: 0}}, 
                                relatoriosNaoLidos.length > 1 
                                    ? relatoriosNaoLidos.length + " relat√≥rios pendentes"
                                    : "1 relat√≥rio pendente"
                            )
                        )
                    ),
                    // Info do autor
                    React.createElement("div", {
                        style: {
                            padding: '16px',
                            backgroundColor: '#f9fafb',
                            borderBottom: '1px solid #e5e7eb',
                            display: 'flex',
                            alignItems: 'center',
                            gap: '12px'
                        }
                    },
                        relatorioNaoLido.usuario_foto 
                            ? React.createElement("img", {
                                src: relatorioNaoLido.usuario_foto,
                                style: {width: '48px', height: '48px', borderRadius: '50%', objectFit: 'cover', border: '2px solid #99f6e4'}
                            })
                            : React.createElement("div", {
                                style: {
                                    width: '48px',
                                    height: '48px',
                                    borderRadius: '50%',
                                    backgroundColor: '#ccfbf1',
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    color: '#0d9488',
                                    fontWeight: 'bold',
                                    fontSize: '18px'
                                }
                            }, (relatorioNaoLido.usuario_nome || "?").charAt(0).toUpperCase()),
                        React.createElement("div", null,
                            React.createElement("p", {style: {fontWeight: 'bold', color: '#1f2937', margin: 0}}, relatorioNaoLido.titulo),
                            React.createElement("p", {style: {fontSize: '14px', color: '#6b7280', margin: 0}}, 
                                relatorioNaoLido.usuario_nome + " ‚Ä¢ " + 
                                new Date(relatorioNaoLido.created_at).toLocaleDateString('pt-BR', {
                                    day: '2-digit', month: '2-digit', year: 'numeric',
                                    hour: '2-digit', minute: '2-digit'
                                })
                            )
                        )
                    ),
                    // Conte√∫do
                    React.createElement("div", {
                        style: {
                            padding: '16px',
                            overflowY: 'auto',
                            flex: 1,
                            maxHeight: '50vh'
                        }
                    },
                        React.createElement("div", {
                            style: {color: '#374151', whiteSpace: 'pre-wrap'}
                        }, relatorioNaoLido.conteudo || ''),
                        relatorioNaoLido.imagem_url && React.createElement("div", {style: {marginTop: '16px'}},
                            React.createElement("img", {
                                src: relatorioNaoLido.imagem_url,
                                style: {maxWidth: '100%', borderRadius: '8px', boxShadow: '0 4px 6px -1px rgba(0,0,0,0.1)'}
                            })
                        )
                    ),
                    // Footer
                    React.createElement("div", {
                        style: {
                            padding: '16px',
                            backgroundColor: '#f9fafb',
                            borderTop: '1px solid #e5e7eb'
                        }
                    },
                        React.createElement("button", {
                            onClick: () => marcarRelatorioComoLido(relatorioNaoLido.id),
                            style: {
                                width: '100%',
                                padding: '16px 24px',
                                backgroundColor: '#0d9488',
                                color: 'white',
                                borderRadius: '12px',
                                fontWeight: 'bold',
                                fontSize: '18px',
                                border: 'none',
                                cursor: 'pointer',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                gap: '8px',
                                boxShadow: '0 10px 15px -3px rgba(0,0,0,0.1)'
                            }
                        }, "‚úÖ Estou Ciente")
                    )
                )
            );
            
            ReactDOM.render(modalContent, portalRoot);
            
            return () => {
                ReactDOM.unmountComponentAtNode(portalRoot);
            };
        }, [relatorioNaoLido, relatoriosNaoLidos]);
        
        const abrirNovoRelatorio = () => {
            setRelatorioEdit(null);
            // Por padr√£o, abre com "Setores espec√≠ficos" selecionado e "Monitoramento" marcado
            const setorMonitoramento = setores.find(s => s.nome.toLowerCase() === 'monitoramento');
            const setoresDefault = setorMonitoramento ? [setorMonitoramento.id] : [];
            setRelatorioForm({
                titulo: '',
                conteudo: '',
                imagem: null,
                para_todos: false, // Setores espec√≠ficos por padr√£o
                setores_destino: setoresDefault // Monitoramento selecionado por padr√£o
            });
            setShowRelatorioModal(true);
        };
        
        const abrirEditarRelatorio = (relatorio) => {
            setRelatorioEdit(relatorio);
            setRelatorioForm({
                titulo: relatorio.titulo || '',
                conteudo: relatorio.conteudo || '',
                imagem: null,
                para_todos: relatorio.para_todos !== false,
                setores_destino: relatorio.setores_destino || []
            });
            setShowRelatorioModal(true);
        };
        
        const salvarRelatorio = async (event) => {
            // Prevenir qualquer comportamento padr√£o
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            if (!relatorioForm.titulo.trim()) {
                ja('Preencha o t√≠tulo do relat√≥rio', 'error');
                return false;
            }
            
            // Validar setores se n√£o for para todos
            if (!relatorioForm.para_todos && (!relatorioForm.setores_destino || relatorioForm.setores_destino.length === 0)) {
                ja('Selecione pelo menos um setor de destino', 'error');
                return false;
            }
            
            s(true);
            try {
                let imagem_base64 = null;
                
                // Converter imagem para base64 se existir
                if (relatorioForm.imagem) {
                    imagem_base64 = await new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onload = () => resolve(reader.result);
                        reader.readAsDataURL(relatorioForm.imagem);
                    });
                }
                
                const payload = {
                    titulo: relatorioForm.titulo,
                    conteudo: relatorioForm.conteudo,
                    usuario_id: l.codProfissional,
                    usuario_nome: l.fullName || l.username,
                    usuario_foto: socialProfile?.profile_photo || '',
                    imagem_base64: imagem_base64,
                    para_todos: relatorioForm.para_todos,
                    setores_destino: relatorioForm.para_todos ? [] : relatorioForm.setores_destino
                };
                
                const urlApi = relatorioEdit 
                    ? `${API_URL}/relatorios-diarios/${relatorioEdit.id}`
                    : `${API_URL}/relatorios-diarios`;
                    
                const response = await fetch(urlApi, {
                    method: relatorioEdit ? 'PUT' : 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) throw new Error('Erro ao salvar');
                
                ja(relatorioEdit ? '‚úÖ Relat√≥rio atualizado!' : '‚úÖ Relat√≥rio criado!', 'success');
                setShowRelatorioModal(false);
                setRelatorioEdit(null);
                setRelatorioForm({ titulo: '', conteudo: '', imagem: null, para_todos: true, setores_destino: [] });
                await carregarRelatoriosDiarios();
            } catch (err) {
                console.error('Erro ao salvar relat√≥rio:', err);
                ja('‚ùå Erro ao salvar relat√≥rio', 'error');
            }
            s(false);
            return false;
        };
        
        const excluirRelatorio = async (id) => {
            if (!confirm('Tem certeza que deseja excluir este relat√≥rio?')) return;
            s(true);
            try {
                const res = await fetchAuth(`${API_URL}/relatorios-diarios/${id}`, { method: 'DELETE' });
                if (!res.ok) throw new Error('Erro ao excluir');
                ja('‚úÖ Relat√≥rio exclu√≠do!', 'success');
                carregarRelatoriosDiarios();
            } catch (err) {
                ja('‚ùå Erro ao excluir relat√≥rio', 'error');
            }
            s(false);
        };
        
        const inserirEmoji = (emoji) => {
            setRelatorioForm(prev => ({
                ...prev,
                conteudo: prev.conteudo + emoji
            }));
        };
        
        const aplicarFormatacao = (tipo) => {
            const textarea = document.getElementById('relatorio-conteudo');
            if (!textarea) return;
            
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const texto = relatorioForm.conteudo;
            const selecionado = texto.substring(start, end);
            
            let novoTexto = '';
            switch(tipo) {
                case 'bold':
                    novoTexto = texto.substring(0, start) + '**' + selecionado + '**' + texto.substring(end);
                    break;
                case 'italic':
                    novoTexto = texto.substring(0, start) + '_' + selecionado + '_' + texto.substring(end);
                    break;
                default:
                    return;
            }
            
            setRelatorioForm(prev => ({ ...prev, conteudo: novoTexto }));
        };
        
        // Fun√ß√£o para calcular contador regressivo
        const calcularContadorRegressivo = (dataInicio) => {
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);
            const inicio = new Date(dataInicio?.split('T')[0] + "T12:00:00");
            inicio.setHours(0, 0, 0, 0);
            const diffTime = inicio - hoje;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays < 0) {
                return { texto: `Iniciou h√° ${Math.abs(diffDays)} dia(s)`, status: 'iniciado', dias: diffDays };
            } else if (diffDays === 0) {
                return { texto: 'INICIA HOJE! üéâ', status: 'hoje', dias: 0 };
            } else if (diffDays === 1) {
                return { texto: 'Inicia AMANH√É!', status: 'amanha', dias: 1 };
            } else if (diffDays <= 7) {
                return { texto: `Faltam ${diffDays} dias`, status: 'proximo', dias: diffDays };
            } else {
                return { texto: `Faltam ${diffDays} dias`, status: 'distante', dias: diffDays };
            }
        };
        
        // Fun√ß√£o para gerar relat√≥rio PDF da opera√ß√£o
        const gerarRelatorioOperacao = async (op) => {
            const contador = calcularContadorRegressivo(op.data_inicio);
            
            // Carregar jsPDF dinamicamente se n√£o existir
            if (!window.jspdf) {
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
                document.head.appendChild(script);
                await new Promise(resolve => script.onload = resolve);
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Cores oficiais da Tutts
            const roxoTutts = [85, 7, 118]; // #550776
            const laranjaTutts = [243, 118, 1]; // #f37601
            const branco = [255, 255, 255];
            const cinzaEscuro = [51, 51, 51];
            const cinzaMedio = [102, 102, 102];
            const cinzaClaro = [245, 245, 245];
            const cinzaBorda = [220, 220, 220];
            
            // ===== HEADER =====
            doc.setFillColor(...roxoTutts);
            doc.rect(0, 0, 210, 50, 'F');
            
            // Linha decorativa laranja
            doc.setFillColor(...laranjaTutts);
            doc.rect(0, 50, 210, 3, 'F');
            
            // Logo Tutts (texto estilizado)
            doc.setTextColor(...branco);
            doc.setFontSize(28);
            doc.setFont('helvetica', 'bold');
            doc.text('tutts', 12, 32);
            
            // Seta laranja simulando a logo
            doc.setFillColor(...laranjaTutts);
            doc.triangle(12, 18, 48, 18, 52, 12, 'F');
            
            // T√≠tulo do relat√≥rio - alinhado √† direita
            doc.setTextColor(...branco);
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            doc.text('RELAT√ìRIO DE OPERA√á√ÉO', 200, 15, { align: 'right' });
            
            // Nome do cliente - alinhado √† direita
            doc.setFontSize(18);
            doc.setFont('helvetica', 'bold');
            const nomeCliente = op.nome_cliente.length > 35 ? op.nome_cliente.substring(0, 35) + '...' : op.nome_cliente;
            doc.text(nomeCliente, 200, 28, { align: 'right' });
            
            // Data de emiss√£o
            doc.setFontSize(9);
            doc.setFont('helvetica', 'normal');
            doc.text('Emitido em ' + new Date().toLocaleDateString('pt-BR') + ' √†s ' + new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'}), 200, 40, { align: 'right' });
            
            let y = 65;
            
            // ===== DATA DE IN√çCIO - DESTAQUE =====
            doc.setFillColor(...cinzaClaro);
            doc.roundedRect(15, y, 180, 22, 3, 3, 'F');
            doc.setDrawColor(...laranjaTutts);
            doc.setLineWidth(1);
            doc.line(15, y, 15, y + 22);
            
            doc.setFontSize(9);
            doc.setTextColor(...cinzaMedio);
            doc.setFont('helvetica', 'normal');
            doc.text('DATA DE IN√çCIO DA OPERA√á√ÉO', 22, y + 7);
            
            doc.setFontSize(14);
            doc.setTextColor(...cinzaEscuro);
            doc.setFont('helvetica', 'bold');
            doc.text(new Date(op.data_inicio).toLocaleDateString('pt-BR', { weekday: 'long', day: '2-digit', month: 'long', year: 'numeric' }), 22, y + 16);
            
            // Badge do contador
            const contadorWidth = doc.getTextWidth(contador.texto) + 16;
            doc.setFillColor(...laranjaTutts);
            doc.roundedRect(195 - contadorWidth, y + 5, contadorWidth, 12, 2, 2, 'F');
            doc.setFontSize(9);
            doc.setTextColor(...branco);
            doc.setFont('helvetica', 'bold');
            doc.text(contador.texto, 195 - contadorWidth/2, y + 13, { align: 'center' });
            
            y += 32;
            
            // ===== INFORMA√á√ïES DA OPERA√á√ÉO =====
            doc.setFontSize(11);
            doc.setTextColor(...roxoTutts);
            doc.setFont('helvetica', 'bold');
            doc.text('INFORMA√á√ïES DA OPERA√á√ÉO', 105, y, { align: 'center' });
            doc.setDrawColor(...roxoTutts);
            doc.setLineWidth(0.5);
            doc.line(15, y + 2, 195, y + 2);
            
            y += 12;
            
            // Tabela de informa√ß√µes
            const tableData = [
                ['Regi√£o', op.regiao || '-'],
                ['Modelo', op.modelo === 'nuvem' ? 'Nuvem' : op.modelo === 'dedicado' ? 'Dedicado' : 'Flash'],
                ['Quantidade de Motos', op.quantidade_motos + ' moto(s)'],
                ['Obrigatoriedade de Ba√∫', op.obrigatoriedade_bau ? 'Sim' : 'N√£o'],
                ['Garantido pela Loja', op.possui_garantido ? 'Sim - R$ ' + parseFloat(op.valor_garantido || 0).toFixed(2) : 'N√£o']
            ];
            
            tableData.forEach((row, idx) => {
                if (idx % 2 === 0) {
                    doc.setFillColor(...cinzaClaro);
                    doc.rect(15, y - 4, 180, 10, 'F');
                }
                doc.setFontSize(10);
                doc.setTextColor(...cinzaMedio);
                doc.setFont('helvetica', 'normal');
                doc.text(row[0], 20, y + 2);
                doc.setTextColor(...cinzaEscuro);
                doc.setFont('helvetica', 'bold');
                doc.text(row[1], 100, y + 2);
                y += 10;
            });
            
            y += 5;
            
            // Endere√ßo
            doc.setFillColor(...cinzaClaro);
            doc.roundedRect(15, y, 180, 18, 2, 2, 'F');
            doc.setFontSize(9);
            doc.setTextColor(...cinzaMedio);
            doc.setFont('helvetica', 'normal');
            doc.text('ENDERE√áO COMPLETO', 20, y + 6);
            doc.setFontSize(10);
            doc.setTextColor(...cinzaEscuro);
            doc.setFont('helvetica', 'normal');
            const enderecoText = op.endereco || '-';
            const enderecoLines = doc.splitTextToSize(enderecoText, 165);
            doc.text(enderecoLines[0], 20, y + 14);
            
            y += 28;
            
            // ===== VALORES POR FAIXA DE KM =====
            if (op.faixas_km && op.faixas_km.filter(f => f.valor_motoboy > 0).length > 0) {
                doc.setFontSize(11);
                doc.setTextColor(...roxoTutts);
                doc.setFont('helvetica', 'bold');
                doc.text('TABELA DE VALORES POR QUILOMETRAGEM', 105, y, { align: 'center' });
                doc.setDrawColor(...roxoTutts);
                doc.setLineWidth(0.5);
                doc.line(15, y + 2, 195, y + 2);
                
                y += 10;
                
                const faixas = op.faixas_km.filter(f => f.valor_motoboy > 0);
                
                // Cabe√ßalho da tabela
                doc.setFillColor(...roxoTutts);
                doc.rect(15, y, 90, 8, 'F');
                doc.rect(105, y, 90, 8, 'F');
                doc.setFontSize(9);
                doc.setTextColor(...branco);
                doc.setFont('helvetica', 'bold');
                doc.text('FAIXA DE KM', 60, y + 5.5, { align: 'center' });
                doc.text('VALOR MOTOBOY', 150, y + 5.5, { align: 'center' });
                
                y += 8;
                
                faixas.forEach((faixa, idx) => {
                    if (idx % 2 === 0) {
                        doc.setFillColor(...cinzaClaro);
                        doc.rect(15, y, 180, 8, 'F');
                    }
                    doc.setDrawColor(...cinzaBorda);
                    doc.setLineWidth(0.2);
                    doc.line(15, y + 8, 195, y + 8);
                    
                    doc.setFontSize(10);
                    doc.setTextColor(...cinzaEscuro);
                    doc.setFont('helvetica', 'normal');
                    doc.text(faixa.km_inicio + ' km - ' + faixa.km_fim + ' km', 60, y + 5.5, { align: 'center' });
                    doc.setFont('helvetica', 'bold');
                    doc.text('R$ ' + parseFloat(faixa.valor_motoboy).toFixed(2), 150, y + 5.5, { align: 'center' });
                    y += 8;
                });
                
                y += 10;
            }
            
            // ===== OBSERVA√á√ïES =====
            if (op.observacoes) {
                if (y > 230) { doc.addPage(); y = 20; }
                
                doc.setFontSize(11);
                doc.setTextColor(...roxoTutts);
                doc.setFont('helvetica', 'bold');
                doc.text('OBSERVA√á√ïES', 105, y, { align: 'center' });
                doc.setDrawColor(...roxoTutts);
                doc.setLineWidth(0.5);
                doc.line(15, y + 2, 195, y + 2);
                
                y += 10;
                
                doc.setFillColor(...cinzaClaro);
                const obsLines = doc.splitTextToSize(op.observacoes, 170);
                const obsHeight = Math.max(obsLines.length * 5 + 8, 15);
                doc.roundedRect(15, y, 180, obsHeight, 2, 2, 'F');
                
                doc.setFontSize(10);
                doc.setTextColor(...cinzaEscuro);
                doc.setFont('helvetica', 'normal');
                doc.text(obsLines, 20, y + 7);
                
                y += obsHeight + 10;
            }
            
            // ===== FOOTER =====
            const footerY = 275;
            
            // Linha separadora
            doc.setDrawColor(...cinzaBorda);
            doc.setLineWidth(0.3);
            doc.line(15, footerY, 195, footerY);
            
            // Informa√ß√µes do footer
            doc.setFontSize(8);
            doc.setTextColor(...cinzaMedio);
            doc.setFont('helvetica', 'normal');
            doc.text('Documento gerado automaticamente pelo Sistema Tutts', 15, footerY + 6);
            doc.text('Respons√°vel: ' + (op.criado_por || '-'), 15, footerY + 11);
            
            // Logo texto no footer
            doc.setFontSize(12);
            doc.setTextColor(...roxoTutts);
            doc.setFont('helvetica', 'bold');
            doc.text('tutts', 190, footerY + 10, { align: 'right' });
            
            // Download do PDF
            doc.save('Tutts_Operacao_' + op.nome_cliente.replace(/[^a-zA-Z0-9]/g, '_') + '.pdf');
            ja('üìÑ Relat√≥rio PDF baixado!', 'success');
        };
        
        const salvarAviso = async () => {
            try {
                const url = avisoEdit ? `${API_URL}/avisos-op/${avisoEdit.id}` : `${API_URL}/avisos-op`;
                const method = avisoEdit ? 'PUT' : 'POST';
                
                await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        ...avisoForm,
                        created_by: l?.fullName
                    })
                });
                
                ja(avisoEdit ? '‚úÖ Aviso atualizado!' : '‚úÖ Aviso criado!', 'success');
                setAvisoModal(false);
                setAvisoEdit(null);
                setAvisoForm({ titulo: '', regioes: [], todas_regioes: false, data_inicio: '', data_fim: '', recorrencia_tipo: 'uma_vez', recorrencia_intervalo: 24, imagem_url: '' });
                carregarAvisos();
            } catch (err) {
                ja('‚ùå Erro ao salvar aviso', 'error');
            }
        };
        
        const deletarAviso = async (id) => {
            if (!confirm('Tem certeza que deseja excluir este aviso?')) return;
            try {
                await fetchAuth(`${API_URL}/avisos-op/${id}`, { method: 'DELETE' });
                ja('‚úÖ Aviso exclu√≠do!', 'success');
                carregarAvisos();
            } catch (err) {
                ja('‚ùå Erro ao excluir', 'error');
            }
        };
        
        const handleAvisoImageUpload = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (ev) => {
                setAvisoForm(f => ({ ...f, imagem_url: ev.target.result }));
            };
            reader.readAsDataURL(file);
        };
        
        // useEffect para carregar avisos quando entrar na aba
        useEffect(() => {
            if (p.opTab === 'avisos' && l && (l.role === 'admin_master' || l.role === 'admin')) {
                carregarAvisos();
                carregarRegioes();
            }
        }, [p.opTab, l]);
        
        // useEffect para carregar incentivos quando entrar na aba
        useEffect(() => {
            if (p.opTab === 'incentivos' && l && (l.role === 'admin_master' || l.role === 'admin')) {
                carregarIncentivos();
                carregarClientesBiIncentivos();
                carregarOperacoes(); // Carregar opera√ß√µes para exibir no calend√°rio
            }
        }, [p.opTab, l, operacoesRefreshKey]); // Adicionar refreshKey para reagir a novas opera√ß√µes
        
        const loadTodoGrupos = async () => {
            try {
                const res = await fetchAuth(`${API_URL}/todo/grupos?user_cod=${l.codProfissional}&role=${l.role}`);
                return await res.json()
            } catch (err) {
                console.error("Erro:", err);
                return []
            }
        };
        const loadTodoTarefas = async (grupoId, status = "todas") => {
            try {
                let url = `${API_URL}/todo/tarefas?user_cod=${l.codProfissional}&role=${l.role}`;
                if (grupoId) url += `&grupo_id=${grupoId}`;
                if (status !== "todas") url += `&status=${status}`;
                const res = await fetch(url);
                return await res.json()
            } catch (err) {
                console.error("Erro:", err);
                return []
            }
        };
        const loadTodoMetricas = async (periodo = "30") => {
            try {
                const res = await fetchAuth(`${API_URL}/todo/metricas?periodo=${periodo}`);
                return await res.json()
            } catch (err) {
                console.error("Erro:", err);
                return null
            }
        };
        const loadTodoAdmins = async () => {
            try {
                const res = await fetchAuth(`${API_URL}/todo/admins`);
                return await res.json()
            } catch (err) {
                return []
            }
        };
        
        // Fun√ß√£o para carregar "Meu Dia" - tarefas do dia ou vencidas atribu√≠das ao usu√°rio
        const loadTodoMeuDia = async () => {
            try {
                const res = await fetchAuth(`${API_URL}/todo/tarefas?user_cod=${l.codProfissional}&role=${l.role}`);
                const todas = await res.json();
                const hoje = new Date();
                hoje.setHours(0, 0, 0, 0);
                
                // Normalizar c√≥digo do usu√°rio para string
                const meuCod = String(l.codProfissional);
                const meuNome = l.fullName;
                
                // Filtrar APENAS tarefas ATRIBU√çDAS ao usu√°rio (n√£o as que ele criou)
                // que s√£o do dia ou vencidas
                const meuDia = todas.filter(t => {
                    // Parsear respons√°veis de forma segura
                    let responsaveis = [];
                    try {
                        if (Array.isArray(t.responsaveis)) {
                            responsaveis = t.responsaveis;
                        } else if (typeof t.responsaveis === 'string' && t.responsaveis) {
                            responsaveis = JSON.parse(t.responsaveis);
                        }
                    } catch (e) {
                        responsaveis = [];
                    }
                    
                    // Verificar se o usu√°rio est√° na lista de respons√°veis
                    // Normalizar todos os valores para string e verificar diferentes formatos
                    const isAtribuidoParaMim = responsaveis.some(resp => {
                        if (typeof resp === 'string') {
                            return String(resp) === meuCod || resp === meuNome;
                        } else if (typeof resp === 'object' && resp !== null) {
                            // Caso seja objeto {cod: "...", nome: "..."} ou {user_cod: "..."}
                            const respCod = String(resp.cod || resp.user_cod || '');
                            const respNome = resp.nome || resp.user_name || '';
                            return respCod === meuCod || respNome === meuNome;
                        } else if (typeof resp === 'number') {
                            return String(resp) === meuCod;
                        }
                        return false;
                    });
                    
                    if (!isAtribuidoParaMim) return false; // S√≥ mostra se est√° atribu√≠da a mim
                    if (t.status === "concluida") return false; // N√£o mostrar conclu√≠das no meu dia
                    
                    if (t.data_prazo) {
                        const dataVenc = new Date(t.data_prazo);
                        dataVenc.setHours(0, 0, 0, 0);
                        return dataVenc <= hoje; // Hoje ou vencida
                    }
                    return true; // Sem data = aparece no meu dia
                });
                
                setTodoMeuDia(meuDia);
                return meuDia;
            } catch (err) {
                console.error("Erro ao carregar Meu Dia:", err);
                return [];
            }
        };
        
        // ============================================
        // NOVAS FUN√á√ïES TO-DO - KANBAN, SUBTAREFAS, TIMER
        // ============================================
        
        // Fun√ß√£o auxiliar para formatar tempo em HH:MM:SS
        const formatarTempo = (segundos) => {
            if (!segundos || segundos < 0) return "00:00:00";
            const h = Math.floor(segundos / 3600);
            const m = Math.floor((segundos % 3600) / 60);
            const s = Math.floor(segundos % 60);
            return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        };
        
        // Fun√ß√£o auxiliar para formatar tempo curto (ex: 2h 30min)
        const formatarTempoCurto = (segundos) => {
            if (!segundos || segundos < 0) return "0min";
            const h = Math.floor(segundos / 3600);
            const m = Math.floor((segundos % 3600) / 60);
            if (h > 0) return `${h}h ${m}min`;
            return `${m}min`;
        };
        
        // Carregar subtarefas de uma tarefa
        const loadTodoSubtarefas = async (tarefaId) => {
            try {
                const res = await fetchAuth(`${API_URL}/todo/tarefas/${tarefaId}/subtarefas`);
                const subs = await res.json();
                setTodoSubtarefas(prev => ({ ...prev, [tarefaId]: subs }));
                return subs;
            } catch (err) {
                console.error("Erro ao carregar subtarefas:", err);
                return [];
            }
        };
        
        // Adicionar subtarefa
        const addTodoSubtarefa = async (tarefaId, titulo) => {
            try {
                const subs = todoSubtarefas[tarefaId] || [];
                await fetchAuth(`${API_URL}/todo/tarefas/${tarefaId}/subtarefas`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ titulo, ordem: subs.length })
                });
                await loadTodoSubtarefas(tarefaId);
                // Atualizar lista de tarefas
                if (todoViewMode === "meudia") await loadTodoMeuDia();
                else if (todoGrupoAtivo) await loadTodoTarefas(todoGrupoAtivo.id);
            } catch (err) {
                console.error("Erro ao adicionar subtarefa:", err);
            }
        };
        
        // Toggle subtarefa conclu√≠da
        const toggleTodoSubtarefa = async (subId, concluida, tarefaId) => {
            try {
                await fetchAuth(`${API_URL}/todo/subtarefas/${subId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        concluida: !concluida,
                        user_cod: l.codProfissional,
                        user_name: l.fullName
                    })
                });
                await loadTodoSubtarefas(tarefaId);
                // Atualizar lista de tarefas
                if (todoViewMode === "meudia") await loadTodoMeuDia();
                else if (todoGrupoAtivo) await loadTodoTarefas(todoGrupoAtivo.id);
            } catch (err) {
                console.error("Erro ao atualizar subtarefa:", err);
            }
        };
        
        // Excluir subtarefa
        const deleteTodoSubtarefa = async (subId, tarefaId) => {
            try {
                await fetchAuth(`${API_URL}/todo/subtarefas/${subId}`, { method: 'DELETE' });
                await loadTodoSubtarefas(tarefaId);
                if (todoViewMode === "meudia") await loadTodoMeuDia();
                else if (todoGrupoAtivo) await loadTodoTarefas(todoGrupoAtivo.id);
            } catch (err) {
                console.error("Erro ao excluir subtarefa:", err);
            }
        };
        
        // Iniciar timer
        const iniciarTodoTimer = async (tarefaId) => {
            try {
                await fetchAuth(`${API_URL}/todo/tarefas/${tarefaId}/timer/iniciar`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_cod: l.codProfissional,
                        user_name: l.fullName
                    })
                });
                setTodoTimerTarefa(tarefaId);
                setTodoTimerSegundos(0);
                ja("‚è±Ô∏è Timer iniciado!", "success");
                // Atualizar lista
                if (todoViewMode === "meudia") await loadTodoMeuDia();
                else if (todoGrupoAtivo) await loadTodoTarefas(todoGrupoAtivo.id);
            } catch (err) {
                console.error("Erro ao iniciar timer:", err);
                ja("Erro ao iniciar timer", "error");
            }
        };
        
        // Parar timer
        const pararTodoTimer = async (tarefaId) => {
            try {
                await fetchAuth(`${API_URL}/todo/tarefas/${tarefaId}/timer/parar`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_cod: l.codProfissional,
                        user_name: l.fullName
                    })
                });
                setTodoTimerTarefa(null);
                setTodoTimerSegundos(0);
                ja("‚èπÔ∏è Timer parado e tempo registrado!", "success");
                // Atualizar lista
                if (todoViewMode === "meudia") await loadTodoMeuDia();
                else if (todoGrupoAtivo) await loadTodoTarefas(todoGrupoAtivo.id);
            } catch (err) {
                console.error("Erro ao parar timer:", err);
                ja("Erro ao parar timer", "error");
            }
        };
        
        // Mover tarefa no Kanban
        const moverTodoKanban = async (tarefaId, colunaDestino) => {
            try {
                await fetchAuth(`${API_URL}/todo/tarefas/${tarefaId}/kanban`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        coluna_kanban: colunaDestino,
                        user_cod: l.codProfissional,
                        user_name: l.fullName
                    })
                });
                ja(`‚úÖ Tarefa movida para ${colunaDestino === 'todo' ? 'A Fazer' : colunaDestino === 'doing' ? 'Fazendo' : 'Conclu√≠do'}!`, "success");
                // Atualizar lista
                if (todoViewMode === "meudia") await loadTodoMeuDia();
                else if (todoGrupoAtivo) await loadTodoTarefas(todoGrupoAtivo.id);
            } catch (err) {
                console.error("Erro ao mover tarefa:", err);
                ja("Erro ao mover tarefa", "error");
            }
        };
        
        // Abrir detalhe da tarefa
        const abrirTodoDetalhe = async (tarefa) => {
            setTodoTarefaDetalhe(tarefa);
            await loadTodoSubtarefas(tarefa.id);
        };
        
        // Fun√ß√£o para abrir modal de editar tarefa com respons√°veis pr√©-carregados
        const abrirEditarTarefa = (tarefa) => {
            let responsaveisSelecionados = [];
            try {
                let resp = tarefa.responsaveis;
                if (typeof resp === 'string') resp = JSON.parse(resp);
                if (Array.isArray(resp)) {
                    responsaveisSelecionados = resp.map(r => typeof r === 'string' ? r : (r.cod || r.user_cod || r.nome));
                }
            } catch (e) {}
            
            setTodoModal({
                tipo: "editarTarefa", 
                tarefa: tarefa,
                responsaveisSelecionados: responsaveisSelecionados
            });
        };
        
        // Fun√ß√£o para verificar tarefas pendentes e mostrar notifica√ß√£o
        // S√≥ notifica se o usu√°rio tem tarefas ATRIBU√çDAS a ele (n√£o as que ele criou)
        // S√≥ notifica NOVAS tarefas (que ainda n√£o foram notificadas nesta sess√£o)
        const checkTodoPendentes = async (isInitialCheck = false) => {
            try {
                const res = await fetchAuth(`${API_URL}/todo/tarefas?user_cod=${l.codProfissional}&role=${l.role}`);
                const todas = await res.json();
                const hoje = new Date();
                hoje.setHours(0, 0, 0, 0);
                
                // Normalizar c√≥digo do usu√°rio para string
                const meuCod = String(l.codProfissional);
                const meuNome = l.fullName;
                
                const pendentes = todas.filter(t => {
                    // Parsear respons√°veis de forma segura
                    let responsaveis = [];
                    try {
                        if (Array.isArray(t.responsaveis)) {
                            responsaveis = t.responsaveis;
                        } else if (typeof t.responsaveis === 'string' && t.responsaveis) {
                            responsaveis = JSON.parse(t.responsaveis);
                        }
                    } catch (e) {
                        responsaveis = [];
                    }
                    
                    // Verificar se o usu√°rio est√° na lista de respons√°veis
                    const isAtribuidoParaMim = responsaveis.some(resp => {
                        if (typeof resp === 'string') {
                            return String(resp) === meuCod || resp === meuNome;
                        } else if (typeof resp === 'object' && resp !== null) {
                            const respCod = String(resp.cod || resp.user_cod || '');
                            const respNome = resp.nome || resp.user_name || '';
                            return respCod === meuCod || respNome === meuNome;
                        } else if (typeof resp === 'number') {
                            return String(resp) === meuCod;
                        }
                        return false;
                    });
                    
                    if (!isAtribuidoParaMim) return false;
                    if (t.status === "concluida") return false;
                    
                    if (t.data_prazo) {
                        const dataVenc = new Date(t.data_prazo);
                        dataVenc.setHours(0, 0, 0, 0);
                        return dataVenc <= hoje; // Hoje ou vencida
                    }
                    return true; // Sem data = considera pendente
                });
                
                // Na verifica√ß√£o inicial (login), mostra TODAS as pendentes
                if (isInitialCheck) {
                    if (pendentes.length > 0) {
                        console.log(`üîî Login: ${pendentes.length} tarefa(s) pendente(s)`);
                        setTodoPendentesNotif(pendentes);
                        setTodoNotifModal(true);
                        // Marca todas como j√° notificadas
                        setTodoTarefasJaNotificadas(pendentes.map(t => t.id));
                    }
                } else {
                    // No polling, mostra apenas NOVAS tarefas (n√£o notificadas ainda)
                    const novasTarefas = pendentes.filter(t => !todoTarefasJaNotificadas.includes(t.id));
                    
                    if (novasTarefas.length > 0) {
                        console.log(`üîî Polling: ${novasTarefas.length} NOVA(S) tarefa(s) pendente(s)!`);
                        setTodoPendentesNotif(novasTarefas);
                        setTodoNotifModal(true);
                        // Adiciona √†s j√° notificadas
                        setTodoTarefasJaNotificadas(prev => [...prev, ...novasTarefas.map(t => t.id)]);
                    }
                }
            } catch (err) {
                console.error("Erro ao verificar pendentes:", err);
            }
        };
        
        useEffect(() => {
            const canAccessTodoEff = hasModuleAccess(l, "todo");
            if (!(l && canAccessTodoEff && "todo" === Ee)) return;
            const init = async () => {
                setTodoLoading(true);
                const [grupos, admins, meuDia] = await Promise.all([loadTodoGrupos(), loadTodoAdmins(), loadTodoMeuDia()]);
                setTodoGrupos(grupos);
                setTodoAdmins(admins);
                setTodoMeuDia(meuDia);
                // Iniciar com "Meu Dia" como padr√£o
                setTodoViewMode("meudia");
                setTodoGrupoAtivo(null);
                if ("admin_master" === l.role) {
                    const metricas = await loadTodoMetricas();
                    setTodoMetricas(metricas)
                }
                setTodoLoading(false)
            };
            init()
        }, [Ee, l]);
        const Ta = async () => {
            ge(!0), Re(null);
            try {
                const e = await fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vQTbc5J8j85MlYGrjWajG33cTDd6TEpYur5hgNcYUwmtra8jh3Nfsrzm-0GNJO6wCYEZAGEHxw807o7/pub?gid=0&single=true&output=tsv"),
                    t = (await e.text()).split("\n").filter(e => e.trim()),
                    a = [];
                const cidadesSet = new Set();
                for (let e = 1; e < t.length; e++) {
                    const l = t[e].split("\t"),
                        r = l[0]?.trim(),
                        o = l[1]?.trim(),
                        cidadeProf = l[3]?.trim() || "";
                    r && o && a.push({
                        codigo: r,
                        nome: o,
                        cidade: cidadeProf
                    });
                    if (cidadeProf) cidadesSet.add(cidadeProf);
                }
                xe(a);
                const cidadesArray = Array.from(cidadesSet).sort((a, b) => a.localeCompare(b, 'pt-BR'));
                setCidadesIndicacao(cidadesArray);
                console.log(`üìä Planilha carregada: ${a.length} profissionais, ${cidadesArray.length} cidades`);
            } catch (e) {
                console.error("Erro ao carregar planilha:", e), Re("Erro ao carregar lista de profissionais")
            }
            ge(!1)
        }, Da = e => {
            if (!e || 0 === pe.length) return null;
            const t = pe.find(t => t.codigo === e.toString());
            return t ? t.nome : null
        },
        // Helper para obter cidade do profissional pela planilha
        getCidadeProfissionalApp = (codProfissional) => {
            if (!pe || pe.length === 0 || !codProfissional) return null;
            const prof = pe.find(p => p.codigo === String(codProfissional));
            return prof ? prof.cidade : null;
        },
        // Normalizar texto para compara√ß√£o (remove acentos, lowercase, trim)
        normalizarTextoApp = (texto) => {
            if (!texto) return "";
            return texto.toString().toLowerCase().trim()
                .normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        },
        // Obter promo√ß√µes filtradas por regi√£o do usu√°rio
        getPromocoesFiltradas = () => {
            if (!l || l.role !== "user") return ee;
            const cidadeUsuario = getCidadeProfissionalApp(l.cod_profissional || l.codProfissional);
            if (!cidadeUsuario) return ee;
            return ee.filter(promo => {
                if (!promo.regiao) return false;
                const regiaoNorm = normalizarTextoApp(promo.regiao);
                const cidadeNorm = normalizarTextoApp(cidadeUsuario);
                return regiaoNorm === cidadeNorm || 
                       regiaoNorm.includes(cidadeNorm) || 
                       cidadeNorm.includes(regiaoNorm);
            });
        },
        La = async () => {
            try {
                const e = "user" === l.role ? `?userId=${l.id}&userCod=${l.cod_profissional}` : "",
                    t = await fetchAuth(`${API_URL}/submissions${e}`),
                    a = await t.json();
                C(a.map(e => ({
                    ...e,
                    ordemServico: e.ordem_servico,
                    codProfissional: e.user_cod,
                    fullName: e.user_name,
                    temImagem: e.tem_imagem,
                    imagemComprovante: null,
                    timestamp: new Date(e.created_at).toLocaleString("pt-BR")
                })))
            } catch (e) {
                console.error(e)
            }
        }, Ia = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/users`),
                    t = await e.json();
                S(t.map(e => ({
                    codProfissional: e.cod_profissional,
                    fullName: e.full_name,
                    role: e.role,
                    setor_id: e.setor_id,
                    setor_nome: e.setor_nome,
                    setor_cor: e.setor_cor,
                    createdAt: new Date(e.created_at).toLocaleString("pt-BR")
                })))
            } catch (e) {
                console.error(e)
            }
        }, Fa = async e => {
            try {
                const t = await fetchAuth(`${API_URL}/submissions/${e}/imagem`),
                    a = await t.json();
                C(t => t.map(t => t.id === e ? {
                    ...t,
                    imagemComprovante: a.imagem
                } : t))
            } catch (e) {
                ja("Erro ao carregar imagem", "error")
            }
        }, $a = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/financial/check-terms/${l.cod_profissional}`),
                    t = await e.json();
                if (P(t.hasAccepted), t.hasAccepted) {
                    const e = await fetchAuth(`${API_URL}/financial/data/${l.cod_profissional}`),
                        t = await e.json();
                    D(t.data), Ma()
                }
            } catch (e) {
                console.error(e)
            }
        }, Ma = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/financial/logs/${l.cod_profissional}`),
                    t = await e.json();
                I(t)
            } catch (e) {
                console.error(e)
            }
        }, Oa = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/withdrawals/user/${l.cod_profissional}`);
                if (e.ok) O(await e.json())
            } catch (e) {
                console.error(e)
            }
        }, qa = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/gratuities/user/${l.cod_profissional}`);
                if (e.ok) W(await e.json())
            } catch (e) {
                console.error(e)
            }
        }, Ua = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/withdrawals`);
                if (e.ok) U(await e.json())
            } catch (e) {
                console.error(e)
            }
        }, za = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/gratuities`);
                if (e.ok) H(await e.json())
            } catch (e) {
                console.error(e)
            }
        }, Ba = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/restricted`);
                if (e.ok) Y(await e.json())
            } catch (e) {
                console.error(e)
            }
        }, Va = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/withdrawals/dashboard/conciliacao`);
                if (e.ok) X(await e.json())
            } catch (e) {
                console.error(e)
            }
        }, Ja = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/loja/estoque`);
                Ye(await e.json())
            } catch (e) {
                console.error("Erro ao carregar estoque:", e)
            }
        }, Qa = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/loja/movimentacoes`);
                dt(await e.json())
            } catch (e) {
                console.error("Erro ao carregar movimenta√ß√µes:", e)
            }
        }, Ha = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/loja/produtos`);
                Xe(await e.json())
            } catch (e) {
                console.error("Erro ao carregar produtos:", e)
            }
        }, Ga = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/loja/produtos/ativos`);
                Xe(await e.json())
            } catch (e) {
                console.error("Erro ao carregar produtos:", e)
            }
        }, Wa = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/loja/pedidos`);
                tt(await e.json())
            } catch (e) {
                console.error("Erro ao carregar pedidos:", e)
            }
        }, Za = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/loja/pedidos/user/${l.codProfissional}`);
                lt(await e.json())
            } catch (e) {
                console.error("Erro ao carregar pedidos:", e)
            }
        }, Ya = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/loja/sugestoes`);
                gt(await e.json())
            } catch (e) {
                console.error("Erro ao carregar sugest√µes:", e)
            }
        }, Ka = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/loja/sugestoes/user/${l.codProfissional}`);
                Rt(await e.json())
            } catch (e) {
                console.error("Erro ao carregar sugest√µes:", e)
            }
        }, Xa = () => {
            const e = new URLSearchParams;
            ua.data_inicio && e.append("data_inicio", ua.data_inicio), ua.data_fim && e.append("data_fim", ua.data_fim);
            
            // Se tiver regi√£o selecionada, expandir para clientes e centros de custo
            let clientesParaEnviar = ua.cod_cliente || [];
            let centrosCustoParaEnviar = ua.centro_custo || [];
            let clientesSemFiltroCC = []; // Clientes que devem mostrar TODOS os CC
            
            if (ua.regiao) {
                const regiaoObj = aa.find(r => r.id === parseInt(ua.regiao));
                if (regiaoObj && regiaoObj.clientes) {
                    const itensRegiao = regiaoObj.clientes.map(function(item) {
                        if (typeof item === 'number') {
                            return { cod_cliente: item, centro_custo: null };
                        }
                        return item;
                    });
                    
                    // Separar clientes que t√™m "Todos CC" dos que t√™m CC espec√≠ficos
                    const clientesComTodosCC = itensRegiao
                        .filter(i => i.centro_custo === null)
                        .map(i => String(i.cod_cliente));
                    
                    const clientesComCCEspecifico = itensRegiao
                        .filter(i => i.centro_custo !== null);
                    
                    // Todos os clientes √∫nicos da regi√£o
                    const todosClientes = [...new Set(itensRegiao.map(i => String(i.cod_cliente)))];
                    clientesParaEnviar = todosClientes;
                    
                    // Se h√° clientes com CC espec√≠fico, enviar os centros de custo
                    // Mas tamb√©m precisamos enviar os clientes sem filtro de CC
                    if (clientesComCCEspecifico.length > 0) {
                        const ccEspecificos = clientesComCCEspecifico.map(i => i.centro_custo);
                        centrosCustoParaEnviar = ccEspecificos;
                        clientesSemFiltroCC = clientesComTodosCC;
                    }
                    // Se todos os clientes t√™m "Todos CC", n√£o enviar filtro de centro_custo
                }
            }
            
            clientesParaEnviar && clientesParaEnviar.length > 0 && e.append("cod_cliente", Array.isArray(clientesParaEnviar) ? clientesParaEnviar.join(",") : clientesParaEnviar);
            centrosCustoParaEnviar && centrosCustoParaEnviar.length > 0 && e.append("centro_custo", Array.isArray(centrosCustoParaEnviar) ? centrosCustoParaEnviar.join(",") : centrosCustoParaEnviar);
            clientesSemFiltroCC && clientesSemFiltroCC.length > 0 && e.append("clientes_sem_filtro_cc", clientesSemFiltroCC.join(","));
            ua.cod_prof && e.append("cod_prof", ua.cod_prof), ua.categoria && e.append("categoria", ua.categoria), ua.cidade && e.append("cidade", ua.cidade), ua.status_prazo && e.append("status_prazo", ua.status_prazo), ua.status_retorno && e.append("status_retorno", ua.status_retorno);
            return e;
        }, carregarMapaCalor = async () => {
            try {
                setMapaCalorLoading(true);
                setLoadingMessage("Carregando mapa de calor...");
                setMapaCalorDados(null);
                const params = Xa();
                console.log("üó∫Ô∏è Carregando mapa de calor:", params.toString());
                setLoadingMessage("Buscando coordenadas das entregas...");
                const response = await fetch(API_URL + "/bi/mapa-calor?" + params);
                const data = await response.json();
                setLoadingMessage("Renderizando mapa...");
                console.log("üó∫Ô∏è Dados mapa recebidos:", data);
                setMapaCalorDados(data);
            } catch (e) {
                console.error("Erro mapa calor:", e);
            } finally {
                setMapaCalorLoading(false);
            }
        }, toggleAcompFiltro = (filtro) => {
            setAcompFiltros(prev => {
                const novoEstado = !prev[filtro];
                if (novoEstado) {
                    // Adiciona ao FINAL para aparecer na ordem de sele√ß√£o
                    setAcompFiltrosOrdem(ordemAtual => [...ordemAtual, filtro]);
                } else {
                    setAcompFiltrosOrdem(ordemAtual => ordemAtual.filter(f => f !== filtro));
                }
                return {...prev, [filtro]: novoEstado};
            });
        }, carregarAcompanhamento = async () => {
            try {
                setAcompLoading(true);
                setLoadingMessage("Carregando acompanhamento peri√≥dico...");
                const params = Xa();
                console.log("üìà Carregando acompanhamento - Filtros ua:", JSON.stringify(ua));
                console.log("üìà Carregando acompanhamento - Params:", params.toString());
                setLoadingMessage("Analisando dados do per√≠odo...");
                const response = await fetch(API_URL + "/bi/acompanhamento-periodico?" + params);
                const data = await response.json();
                console.log("üìà Dados recebidos:", data);
                setAcompDados(data);
                
                // Carregar dados de clientes tamb√©m
                try {
                    const clientesRes = await fetch(API_URL + "/bi/acompanhamento-clientes?" + params);
                    const clientesData = await clientesRes.json();
                    console.log("üìä Dados clientes:", clientesData);
                    setAcompClientes(clientesData);
                } catch(e) { console.log("Erro ao carregar clientes:", e); }
                
                // Carregar comparativo semanal
                try {
                    const semanalRes = await fetch(API_URL + "/bi/comparativo-semanal?" + params);
                    const semanalData = await semanalRes.json();
                    console.log("üìÖ Comparativo semanal:", semanalData);
                    if (semanalData && semanalData.semanas) {
                        setComparativoSemanal(semanalData);
                    } else {
                        setComparativoSemanal({semanas: []});
                    }
                } catch(e) { 
                    console.log("Erro ao carregar comparativo semanal:", e); 
                    setComparativoSemanal({semanas: []});
                }
                
                // Carregar comparativo semanal POR CLIENTE
                try {
                    const semanalClientesRes = await fetch(API_URL + "/bi/comparativo-semanal-clientes?" + params);
                    const semanalClientesData = await semanalClientesRes.json();
                    console.log("üìÖ Comparativo semanal por cliente:", semanalClientesData);
                    if (semanalClientesData && semanalClientesData.clientes) {
                        setComparativoSemanalClientes(semanalClientesData);
                    } else {
                        setComparativoSemanalClientes({clientes: []});
                    }
                } catch(e) { 
                    console.log("Erro ao carregar comparativo semanal por cliente:", e);
                    setComparativoSemanalClientes({clientes: []});
                }
            } catch (e) {
                console.error("Erro acompanhamento:", e);
            } finally {
                setAcompLoading(false);
            }
        };
        
        // Fun√ß√£o para carregar dados do m√≥dulo Garantido
        const carregarGarantido = async () => {
            console.log('üí∞üí∞üí∞ FUN√á√ÉO carregarGarantido CHAMADA! üí∞üí∞üí∞');
            try {
                setGarantidoLoading(true);
                
                // Se n√£o tem filtros de data, definir automaticamente (primeiro dia do m√™s at√© √∫ltima data dispon√≠vel)
                let filtrosUsados = {...garantidoFiltros};
                
                if (!filtrosUsados.data_inicio || !filtrosUsados.data_fim) {
                    // Buscar √∫ltima data dispon√≠vel dos dados
                    try {
                        const metaRes = await fetchAuth(`${API_URL}/bi/garantido/meta`);
                        const metaData = await metaRes.json();
                        
                        if (metaData.ultima_data) {
                            const hoje = new Date();
                            const primeiroDiaMes = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
                            const ultimaData = new Date(metaData.ultima_data + 'T12:00:00');
                            
                            // Formatar datas YYYY-MM-DD
                            const formatDate = (d) => d.toISOString().split('T')[0];
                            
                            filtrosUsados.data_inicio = formatDate(primeiroDiaMes);
                            filtrosUsados.data_fim = formatDate(ultimaData);
                            
                            console.log('üí∞ Garantido - Datas autom√°ticas:', filtrosUsados.data_inicio, 'at√©', filtrosUsados.data_fim);
                            
                            // Atualizar estado dos filtros
                            setGarantidoFiltros(filtrosUsados);
                        }
                    } catch (metaErr) {
                        console.log('üí∞ N√£o foi poss√≠vel obter meta do garantido:', metaErr);
                    }
                }
                
                const params = new URLSearchParams();
                if (filtrosUsados.data_inicio) params.append('data_inicio', filtrosUsados.data_inicio);
                if (filtrosUsados.data_fim) params.append('data_fim', filtrosUsados.data_fim);
                if (filtrosUsados.cod_cliente) params.append('cod_cliente', filtrosUsados.cod_cliente);
                if (filtrosUsados.cod_prof) params.append('cod_prof', filtrosUsados.cod_prof);
                if (filtrosUsados.filtro_status && filtrosUsados.filtro_status !== 'todos') {
                    params.append('filtro_status', filtrosUsados.filtro_status);
                }
                
                console.log('üí∞ Garantido - Filtros usados:', filtrosUsados);
                console.log('üí∞ Garantido - URL params:', params.toString() || '(sem filtros)');
                
                // Carregar dados principais
                const url = `${API_URL}/bi/garantido?${params}`;
                console.log('üí∞ Garantido - Chamando URL:', url);
                const response = await fetch(url);
                const data = await response.json();
                console.log('üí∞ Garantido - Resposta:', data);
                setGarantidoData(data.dados || []);
                setGarantidoStats(data.totais || null);
                
                // Carregar an√°lise semanal
                const semanalRes = await fetchAuth(`${API_URL}/bi/garantido/semanal?${params}`);
                const semanalData = await semanalRes.json();
                setGarantidoSemanal(Array.isArray(semanalData) ? semanalData : []);
                
                // Carregar resumo por cliente
                const clienteRes = await fetchAuth(`${API_URL}/bi/garantido/por-cliente?${params}`);
                const clienteData = await clienteRes.json();
                setGarantidoPorCliente(clienteData.dados || []);
                
                // Carregar status salvos
                const statusRes = await fetchAuth(`${API_URL}/bi/garantido/status`);
                const statusData = await statusRes.json();
                setGarantidoStatusMap(statusData || {});
                
            } catch (e) {
                console.error("Erro ao carregar garantido:", e);
                setGarantidoData([]);
                setGarantidoStats(null);
            } finally {
                setGarantidoLoading(false);
            }
        };
        
        // Fun√ß√£o para salvar status do garantido
        const salvarStatusGarantido = async (registro, novoStatus, motivo = '') => {
            try {
                if (novoStatus === 'reprovado' && !motivo) {
                    alert('Informe o motivo da reprova√ß√£o!');
                    return false;
                }
                
                const response = await fetchAuth(`${API_URL}/bi/garantido/status`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        cod_prof: registro.cod_prof,
                        data: registro.data,
                        cod_cliente: registro.cod_cliente_garantido,
                        status: novoStatus,
                        motivo_reprovado: motivo,
                        alterado_por: l?.fullName || l?.username || 'Admin'
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    // Atualizar mapa local
                    const key = `${registro.cod_prof}_${registro.data}_${registro.cod_cliente_garantido}`;
                    setGarantidoStatusMap(prev => ({
                        ...prev,
                        [key]: data.data
                    }));
                    setGarantidoModalStatus(null);
                    setGarantidoMotivoReprovado('');
                    return true;
                } else {
                    alert('Erro ao salvar: ' + (data.error || 'Erro desconhecido'));
                    return false;
                }
            } catch (error) {
                console.error('Erro ao salvar status:', error);
                alert('Erro ao salvar status');
                return false;
            }
        };
        
        // Fun√ß√£o para carregar dados do Cliente 767 (prazo 120min)
        const carregarCliente767 = async () => {
            try {
                setCliente767Loading(true);
                setLoadingMessage("Carregando dados do Cliente 767...");
                const params = new URLSearchParams();
                // Usar filtros espec√≠ficos do Cliente 767
                if (cliente767Filtros.data_inicio) params.append("data_inicio", cliente767Filtros.data_inicio);
                if (cliente767Filtros.data_fim) params.append("data_fim", cliente767Filtros.data_fim);
                if (cliente767Filtros.centros_custo && cliente767Filtros.centros_custo.length > 0) {
                    params.append("centro_custo", cliente767Filtros.centros_custo.join(","));
                }
                
                const response = await fetch(API_URL + "/bi/cliente-767?" + params);
                const data = await response.json();
                console.log("üè¢ Cliente 767 dados:", data);
                setCliente767Dados(data);
            } catch (e) {
                console.error("Erro cliente 767:", e);
            } finally {
                setCliente767Loading(false);
            }
        };
        
        // Fun√ß√£o para gerar relat√≥rio com IA (Gemini)
        const gerarRelatorioIA = async () => {
            try {
                // Validar se tem pelo menos um tipo selecionado
                const tiposSelecionados = [...relatorioIATipos];
                if (tiposSelecionados.length === 0) {
                    setRelatorioIAErro("Selecione pelo menos um tipo de an√°lise");
                    return;
                }
                
                setRelatorioIALoading(true);
                setRelatorioIAErro(null);
                setRelatorioIAResultado(null);
                
                console.log("ü§ñ Gerando relat√≥rio IA tipos:", tiposSelecionados);
                
                // Preparar par√¢metros com filtros do Relat√≥rio IA
                const params = new URLSearchParams();
                
                // Enviar m√∫ltiplos tipos
                tiposSelecionados.forEach(t => params.append("tipo", t));
                
                // Usar filtros pr√≥prios do Relat√≥rio IA
                if (relatorioIAFiltros.data_inicio) params.append("data_inicio", relatorioIAFiltros.data_inicio);
                if (relatorioIAFiltros.data_fim) params.append("data_fim", relatorioIAFiltros.data_fim);
                if (relatorioIAFiltros.cod_cliente) params.append("cod_cliente", relatorioIAFiltros.cod_cliente);
                if (relatorioIAFiltros.centro_custo) params.append("centro_custo", relatorioIAFiltros.centro_custo);
                if (tiposSelecionados.includes("personalizado") && relatorioIAPromptCustom) {
                    params.append("prompt_custom", relatorioIAPromptCustom);
                }
                
                // Enviar dados do usu√°rio para hist√≥rico
                params.append("usuario_id", l.id || l.email || "");
                params.append("usuario_nome", l.fullName || l.email || "Usu√°rio");
                
                const response = await fetchAuth(`${API_URL}/bi/relatorio-ia?${params}`);
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                setRelatorioIAResultado(data);
                
                // Recarregar hist√≥rico do banco
                carregarHistoricoRelatoriosIA();
                
                console.log("‚úÖ Relat√≥rio IA gerado com sucesso");
            } catch (e) {
                console.error("‚ùå Erro ao gerar relat√≥rio IA:", e);
                setRelatorioIAErro(e.message || "Erro ao gerar relat√≥rio");
            } finally {
                setRelatorioIALoading(false);
            }
        };
        
        // Fun√ß√£o para carregar hist√≥rico de relat√≥rios do banco
        const carregarHistoricoRelatoriosIA = async () => {
            try {
                const response = await fetchAuth(`${API_URL}/bi/relatorio-ia/historico`);
                const data = await response.json();
                setRelatorioIAHistoricoDB(Array.isArray(data) ? data : []);
            } catch (e) {
                console.error("Erro ao carregar hist√≥rico:", e);
            }
        };
        
        // Fun√ß√£o para gerar Word de um relat√≥rio do hist√≥rico
        const gerarWordHistorico = async (relatorio) => {
            try {
                const response = await fetchAuth(`${API_URL}/bi/relatorio-ia/word`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        tipo_analise: relatorio.tipo_analise,
                        periodo: { inicio: relatorio.data_inicio, fim: relatorio.data_fim },
                        metricas: relatorio.metricas,
                        relatorio: relatorio.relatorio,
                        filtros: relatorio.filtros
                    })
                });
                
                if (!response.ok) throw new Error('Erro ao gerar documento');
                
                let nomeArquivo = 'relatorio-operacional';
                if (relatorio.cod_cliente) nomeArquivo += '-' + relatorio.cod_cliente;
                nomeArquivo += '-' + new Date(relatorio.created_at).toISOString().split('T')[0] + '.docx';
                
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = nomeArquivo;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            } catch (err) {
                console.error('Erro ao gerar Word:', err);
                alert('Erro ao gerar documento: ' + err.message);
            }
        };
        
        // Fun√ß√£o para deletar relat√≥rio do hist√≥rico
        const deletarRelatorioHistorico = async (id) => {
            if (!confirm('Deseja realmente excluir este relat√≥rio?')) return;
            try {
                await fetchAuth(`${API_URL}/bi/relatorio-ia/historico/${id}`, { method: 'DELETE' });
                carregarHistoricoRelatoriosIA();
                ja('Relat√≥rio exclu√≠do!', 'success');
            } catch (e) {
                ja('Erro ao excluir', 'error');
            }
        };
        
        // useEffect para carregar hist√≥rico ao entrar na aba Relat√≥rio IA
        useEffect(() => {
            if (Et === "relatorio-ia") {
                carregarHistoricoRelatoriosIA();
            }
        }, [Et]);
        
        // Fun√ß√£o para toggle de tipo de relat√≥rio
        const toggleRelatorioIATipo = (tipo) => {
            setRelatorioIATipos(prev => {
                if (prev.includes(tipo)) {
                    return prev.filter(t => t !== tipo);
                } else {
                    return [...prev, tipo];
                }
            });
        };
        
        // Fun√ß√£o para gerar Word do relat√≥rio IA
        const gerarPDFRelatorioIA = async () => {
            if (!relatorioIAResultado) return;
            
            try {
                const response = await fetchAuth(`${API_URL}/bi/relatorio-ia/word`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        tipo_analise: relatorioIAResultado.tipo_analise,
                        periodo: relatorioIAResultado.periodo,
                        metricas: relatorioIAResultado.metricas,
                        relatorio: relatorioIAResultado.relatorio,
                        filtros: relatorioIAResultado.filtros
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Erro ao gerar documento');
                }
                
                // Montar nome do arquivo
                let nomeArquivo = 'relatorio-operacional';
                if (relatorioIAResultado.filtros?.cliente) {
                    nomeArquivo += '-' + relatorioIAResultado.filtros.cliente.codigo;
                }
                nomeArquivo += '-' + new Date().toISOString().split('T')[0] + '.docx';
                
                // Baixar arquivo
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = nomeArquivo;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
            } catch (err) {
                console.error('Erro ao gerar Word:', err);
                alert('Erro ao gerar documento: ' + err.message);
            }
        };
        
        // useEffect para recarregar acompanhamento quando filtros mudam
        useEffect(() => {
            if (Et === "acompanhamento") {
                console.log("üìà Filtros alterados, recarregando acompanhamento...");
                carregarAcompanhamento();
            }
        }, [ua.data_inicio, ua.data_fim, ua.cod_cliente, ua.centro_custo, ua.categoria]);
        
        // useEffect para CARREGAR DADOS DO BI automaticamente quando entrar no m√≥dulo
        useEffect(() => {
            if (Ee === "bi") {
                console.log("üìä Entrando no m√≥dulo BI, carregando dados automaticamente...");
                ll();
                tl();
                al();
                pl();
            }
        }, [Ee]);
        
        // useEffect para carregar mapa de calor quando estiver no dashboard
        useEffect(() => {
            if (Et === "dashboard" && mapaCalorVisivel && !mapaCalorDados && !ba) {
                carregarMapaCalor();
            }
        }, [Et, mapaCalorVisivel, ba]);
        
        // useEffect para recarregar mapa quando filtros mudam
        useEffect(() => {
            if (Et === "dashboard" && mapaCalorVisivel && !ba) {
                carregarMapaCalor();
            }
        }, [ua.data_inicio, ua.data_fim, ua.cod_cliente, ua.centro_custo, ua.categoria]);
        
        // useEffect para RENDERIZAR o mapa quando os dados estiverem dispon√≠veis
        useEffect(() => {
            if (Et === "dashboard" && mapaCalorVisivel && mapaCalorDados && !mapaCalorLoading && !ba) {
                console.log("üó∫Ô∏è Dados do mapa dispon√≠veis, inicializando...");
                setTimeout(() => {
                    if (window.initMapaCalor) {
                        const pontos = mapaCalorDados.pontos || (Array.isArray(mapaCalorDados) ? mapaCalorDados : []);
                        console.log("üó∫Ô∏è Renderizando mapa com", pontos.length, "pontos");
                        window.initMapaCalor(pontos);
                    }
                }, 200);
            }
        }, [Et, mapaCalorVisivel, mapaCalorDados, mapaCalorLoading, ba]);
        
        // Fun√ß√£o para carregar OS de um profissional espec√≠fico
        const carregarOsProfissional = async (codProf) => {
            try {
                setProfOsLoading(codProf);
                const params = new URLSearchParams();
                // Passar TODOS os filtros ativos
                if (ua.data_inicio) params.append("data_inicio", ua.data_inicio);
                if (ua.data_fim) params.append("data_fim", ua.data_fim);
                if (ua.cod_cliente && ua.cod_cliente.length > 0) params.append("cod_cliente", ua.cod_cliente.join(","));
                if (ua.centro_custo && ua.centro_custo.length > 0) params.append("centro_custo", ua.centro_custo.join(","));
                if (ua.categoria) params.append("categoria", ua.categoria);
                if (ua.status_prazo) params.append("status_prazo", ua.status_prazo);
                if (ua.status_retorno) params.append("status_retorno", ua.status_retorno);
                if (ua.cidade) params.append("cidade", ua.cidade);
                
                const response = await fetchAuth(`${API_URL}/bi/os-profissional/${codProf}?${params}`);
                const data = await response.json();
                
                setProfOsExpandido(prev => ({
                    ...prev,
                    [codProf]: data.oss || []
                }));
            } catch (e) {
                console.error("Erro ao carregar OS do profissional:", e);
            } finally {
                setProfOsLoading(null);
            }
        };
        
        // Toggle expandir profissional - carrega OS se necess√°rio
        const toggleProfissionalExpand = (codProf, index) => {
            const chave = `prof-${index}`;
            if (Kt[chave]) {
                // Est√° expandido, apenas fecha
                ml(chave);
            } else {
                // Vai expandir, carrega OS se ainda n√£o tiver
                if (!profOsExpandido[codProf]) {
                    carregarOsProfissional(codProf);
                }
                ml(chave);
            }
        };
        
        const el = async () => {
            try {
                Ra(!0);
                setLoadingMessage("Carregando dashboard...");
                const e = Xa();
                console.log("üìä Carregando dashboard com filtros:", e.toString() || "(sem filtros)");
                setLoadingMessage("Buscando m√©tricas de desempenho...");
                const t = await fetchAuth(`${API_URL}/bi/dashboard-completo?${e}`),
                    a = await t.json();
                setLoadingMessage("Processando dados...");
                console.log("üìä Dados recebidos:", a), Nt(a.metricas || {}), Bt(a.porCliente || []), Jt(a.porProfissional || []);
                const l = a.dadosGraficos || [],
                    r = [{
                        label: "0 a 45 min",
                        min: 0,
                        max: 45
                    }, {
                        label: "45-60 min",
                        min: 45,
                        max: 60
                    }, {
                        label: "60-75 min",
                        min: 60,
                        max: 75
                    }, {
                        label: "75-90 min",
                        min: 75,
                        max: 90
                    }, {
                        label: "90 a 120 min",
                        min: 90,
                        max: 120
                    }, {
                        label: "> 120 min",
                        min: 120,
                        max: 99999
                    }].map(e => ({
                        faixa: e.label,
                        total: l.filter(t => {
                            const a = parseFloat(t.tempo);
                            return null !== a && !isNaN(a) && a >= e.min && a < e.max
                        }).length
                    })),
                    o = [{
                        label: "0-10",
                        min: 0,
                        max: 10
                    }, {
                        label: "11-15",
                        min: 10,
                        max: 15
                    }, {
                        label: "16-20",
                        min: 15,
                        max: 20
                    }, {
                        label: "21-25",
                        min: 20,
                        max: 25
                    }, {
                        label: "26-30",
                        min: 25,
                        max: 30
                    }, {
                        label: "31-35",
                        min: 30,
                        max: 35
                    }, {
                        label: "36-40",
                        min: 35,
                        max: 40
                    }, {
                        label: "41-45",
                        min: 40,
                        max: 45
                    }, {
                        label: "46-50",
                        min: 45,
                        max: 50
                    }, {
                        label: "51-55",
                        min: 50,
                        max: 55
                    }, {
                        label: "56-60",
                        min: 55,
                        max: 60
                    }, {
                        label: "61-65",
                        min: 60,
                        max: 65
                    }, {
                        label: "66-70",
                        min: 65,
                        max: 70
                    }, {
                        label: "Outras",
                        min: 70,
                        max: 99999
                    }].map(e => ({
                        faixa: e.label,
                        total: l.filter(t => {
                            const a = parseFloat(t.km);
                            return null !== a && !isNaN(a) && a >= e.min && a < e.max
                        }).length
                    }));
                Ht({
                    porTempo: r,
                    porKm: o
                })
            } catch (e) {
                console.error("Erro ao carregar BI:", e)
            }
            Ra(!1)
        }, tl = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/bi/prazos`);
                vt(await e.json())
            } catch (e) {
                console.error("Erro ao carregar prazos:", e)
            }
        }, al = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/bi/prazo-padrao`),
                    t = await e.json();
                t && t.length > 0 && (_t(t), Na(t))
            } catch (e) {
                console.error("Erro ao carregar prazo padr√£o:", e)
            }
        }, 
        // Fun√ß√£o para carregar prazos profissionais
        carregarPrazosProf = async () => {
            try {
                // Carregar prazo padr√£o profissional
                const respPadrao = await fetchAuth(`${API_URL}/bi/prazo-prof-padrao`);
                const dataPadrao = await respPadrao.json();
                if (dataPadrao && dataPadrao.length > 0) {
                    setPrazoProfPadrao(dataPadrao);
                }
                // Carregar lista de prazos profissionais espec√≠ficos
                const respLista = await fetchAuth(`${API_URL}/bi/prazos-prof`);
                const dataLista = await respLista.json();
                if (dataLista.success) {
                    setPrazosProfissionais(dataLista.prazos || []);
                }
            } catch (e) {
                console.error("Erro ao carregar prazos profissionais:", e)
            }
        }, ll = async () => {
            try {
                console.log("üìä ll() - Iniciando carregamento do BI...");
                Ra(!0); // Mostrar loading
                setLoadingMessage("Carregando dados do sistema...");
                // Carregar m√°scaras PRIMEIRO junto com os outros dados
                setLoadingMessage("Buscando clientes e profissionais...");
                const [e, t, a, l, r, o, c, s, n, m, mascarasData] = await Promise.all([fetchAuth(`${API_URL}/bi/clientes`).then(e => e.json()), fetchAuth(`${API_URL}/bi/centros-custo`).then(e => e.json()), fetchAuth(`${API_URL}/bi/profissionais`).then(e => e.json()), fetchAuth(`${API_URL}/bi/datas`).then(e => e.json()), fetchAuth(`${API_URL}/bi/uploads`).then(e => e.json()), fetchAuth(`${API_URL}/bi/cidades`).then(e => e.json()).catch(() => []), fetchAuth(`${API_URL}/bi/cliente-centros`).then(e => e.json()).catch(() => ({})), fetchAuth(`${API_URL}/bi/categorias`).then(e => e.json()).catch(() => []), fetchAuth(`${API_URL}/bi/regioes`).then(e => e.json()).catch(() => []), fetchAuth(`${API_URL}/bi/dados-filtro`).then(e => e.json()).catch(() => []), fetchAuth(`${API_URL}/bi/mascaras`).then(e => e.json()).catch(() => [])]), i = (e || []).sort((e, t) => (parseInt(e.cod_cliente) || 0) - (parseInt(t.cod_cliente) || 0));
                // Setar m√°scaras ANTES de tudo
                setLoadingMessage("Aplicando configura√ß√µes...");
                ta(mascarasData || []);
                console.log("üìä M√°scaras carregadas:", (mascarasData || []).length);
                console.log("üìä Datas recebidas:", l?.length || 0);
                console.log("üìä Clientes recebidos:", i?.length || 0);
                Ct(i); St(t || []); Pt(t || []); Dt(c || {}); It(a || []); $t(l || []); Ot(r || []); Yt(o || []); oa(s || []); xa(s || []); la(n || []); ma(m || []); da(i);
                
                // Popular Set de datas com dados para indicador visual no filtro
                if (l && l.length > 0) {
                    const datasSet = new Set();
                    l.forEach(item => {
                        if (item.data) {
                            const dataFormatada = new Date(item.data).toISOString().split('T')[0];
                            datasSet.add(dataFormatada);
                        }
                    });
                    setBiDatasComDados(datasSet);
                    console.log("üìä Datas com dados carregadas:", datasSet.size);
                }
                
                let novosFiltros = {};
                if (l && l.length > 0) {
                    const formatDate = d => {
                            if (!d) return "";
                            return new Date(d).toISOString().split("T")[0]
                        };
                    
                    // OTIMIZA√á√ÉO: Per√≠odo padr√£o = dia 1 do m√™s atual at√© hoje
                    const hoje = new Date();
                    const primeiroDiaMes = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
                    
                    // Verificar se temos dados no m√™s atual
                    const dataMinDisponivel = new Date(l[l.length - 1].data);
                    const dataMaxDisponivel = new Date(l[0].data);
                    
                    // Se o primeiro dia do m√™s √© anterior aos dados dispon√≠veis, usar data m√≠nima dispon√≠vel
                    const dataInicio = primeiroDiaMes < dataMinDisponivel ? dataMinDisponivel : primeiroDiaMes;
                    // Se hoje √© posterior aos dados dispon√≠veis, usar data m√°xima dispon√≠vel
                    const dataFim = hoje > dataMaxDisponivel ? dataMaxDisponivel : hoje;
                    
                    novosFiltros = {
                        ...ua,
                        data_inicio: formatDate(dataInicio),
                        data_fim: formatDate(dataFim),
                        cod_cliente: [],
                        centro_custo: []
                    };
                    console.log("üìä Per√≠odo padr√£o: dia 1 do m√™s at√© hoje");
                    console.log("üìä Datas formatadas:", novosFiltros.data_inicio, "at√©", novosFiltros.data_fim);
                    ga(novosFiltros);
                } else {
                    console.log("üìä Sem datas, usando filtros vazios");
                }
                // Sempre chamar ol para carregar o dashboard
                setLoadingMessage("Carregando dashboard principal...");
                console.log("üìä Chamando ol() com filtros:", JSON.stringify(novosFiltros));
                await ol(novosFiltros);
                console.log("üìä ll() - Carregamento conclu√≠do!");
            } catch (e) {
                console.error("‚ùå Erro ao carregar dropdowns:", e);
                Ra(!1);
            }
        }, rl = e => {
            const t = na;
            if (!t || 0 === t.length) return da(jt), Pt(At), void xa(ra);
            let a = e.cod_cliente || [];
            let centrosCustoRegiao = [];
            if (e.regiao) {
                const t = aa.find(t => t.id === parseInt(e.regiao));
                if (t && t.clientes) {
                    // Suporta formato antigo (array de n√∫meros) e novo (array de objetos)
                    const itensRegiao = t.clientes.map(function(item) {
                        if (typeof item === 'number') {
                            return { cod_cliente: item, centro_custo: null };
                        }
                        return item;
                    });
                    // Extrair clientes √∫nicos
                    a = [...new Set(itensRegiao.map(i => String(i.cod_cliente)))];
                    // Extrair centros de custo espec√≠ficos (ignorar null = todos)
                    centrosCustoRegiao = itensRegiao
                        .filter(i => i.centro_custo !== null)
                        .map(i => i.centro_custo);
                }
            }
            let l = t;
            if (a.length > 0 && (l = l.filter(e => a.includes(String(e.cod_cliente)))), e.categoria && (l = l.filter(t => t.categoria === e.categoria)), e.centro_custo && e.centro_custo.length > 0 && (l = l.filter(t => e.centro_custo.includes(t.centro_custo))), centrosCustoRegiao.length > 0 && (l = l.filter(t => centrosCustoRegiao.includes(t.centro_custo))), 0 === a.length) {
                const e = [...new Set(l.map(e => e.cod_cliente))];
                da(jt.filter(t => e.includes(t.cod_cliente)))
            } else {
                let a = t;
                e.categoria && (a = a.filter(t => t.categoria === e.categoria)), e.centro_custo && e.centro_custo.length > 0 && (a = a.filter(t => e.centro_custo.includes(t.centro_custo)));
                const l = [...new Set(a.map(e => e.cod_cliente))];
                da(jt.filter(e => l.includes(e.cod_cliente)))
            }
            let r = t;
            a.length > 0 && (r = r.filter(e => a.includes(String(e.cod_cliente)))), e.categoria && (r = r.filter(t => t.categoria === e.categoria));
            const o = [...new Set(r.map(e => e.centro_custo).filter(e => e))];
            Pt(At.filter(e => o.includes(e.centro_custo)));
            let c = t;
            a.length > 0 && (c = c.filter(e => a.includes(String(e.cod_cliente)))), e.centro_custo && e.centro_custo.length > 0 && (c = c.filter(t => e.centro_custo.includes(t.centro_custo)));
            const s = [...new Set(c.map(e => e.categoria).filter(e => e))];
            xa(s.sort())
        }, ol = async e => {
            try {
                Ra(!0);
                // Limpar dados expandidos de profissionais para for√ßar recarregamento com novos filtros
                setProfOsExpandido({});
                const t = new URLSearchParams;
                e.data_inicio && t.append("data_inicio", e.data_inicio), e.data_fim && t.append("data_fim", e.data_fim);
                
                // Se tiver regi√£o selecionada, expandir para clientes e centros de custo
                let clientesParaEnviar = e.cod_cliente || [];
                let centrosCustoParaEnviar = e.centro_custo || [];
                let clientesSemFiltroCC = [];
                
                if (e.regiao) {
                    const regiaoObj = aa.find(r => r.id === parseInt(e.regiao));
                    if (regiaoObj && regiaoObj.clientes) {
                        const itensRegiao = regiaoObj.clientes.map(function(item) {
                            if (typeof item === 'number') {
                                return { cod_cliente: item, centro_custo: null };
                            }
                            return item;
                        });
                        
                        // Separar clientes que t√™m "Todos CC" dos que t√™m CC espec√≠ficos
                        const clientesComTodosCC = itensRegiao
                            .filter(i => i.centro_custo === null)
                            .map(i => String(i.cod_cliente));
                        
                        const clientesComCCEspecifico = itensRegiao
                            .filter(i => i.centro_custo !== null);
                        
                        // Todos os clientes √∫nicos
                        clientesParaEnviar = [...new Set(itensRegiao.map(i => String(i.cod_cliente)))];
                        
                        if (clientesComCCEspecifico.length > 0) {
                            centrosCustoParaEnviar = clientesComCCEspecifico.map(i => i.centro_custo);
                            clientesSemFiltroCC = clientesComTodosCC;
                        }
                    }
                }
                
                clientesParaEnviar && clientesParaEnviar.length > 0 && clientesParaEnviar.forEach(c => t.append("cod_cliente", c));
                centrosCustoParaEnviar && centrosCustoParaEnviar.length > 0 && centrosCustoParaEnviar.forEach(c => t.append("centro_custo", c));
                clientesSemFiltroCC && clientesSemFiltroCC.length > 0 && t.append("clientes_sem_filtro_cc", clientesSemFiltroCC.join(","));
                e.cod_prof && t.append("cod_prof", e.cod_prof), e.categoria && t.append("categoria", e.categoria), e.cidade && t.append("cidade", e.cidade), e.status_prazo && t.append("status_prazo", e.status_prazo), e.status_retorno && t.append("status_retorno", e.status_retorno), console.log("üìä loadBiDashboardComFiltros - params:", t.toString());
                const a = await fetchAuth(`${API_URL}/bi/dashboard-completo?${t}`),
                    l = await a.json();
                console.log("üìä loadBiDashboardComFiltros - resposta:", l), console.log("üìä metricas:", l.metricas), console.log("üìä porCliente:", l.porCliente?.length, "registros"), console.log("üìä porProfissional:", l.porProfissional?.length, "registros"), Nt(l.metricas || {}), Bt(l.porCliente || []), Jt(l.porProfissional || []);
                const r = l.dadosGraficos || [],
                    o = [{
                        label: "0 a 45 min",
                        min: 0,
                        max: 45
                    }, {
                        label: "45-60 min",
                        min: 45,
                        max: 60
                    }, {
                        label: "60-75 min",
                        min: 60,
                        max: 75
                    }, {
                        label: "75-90 min",
                        min: 75,
                        max: 90
                    }, {
                        label: "90 a 120 min",
                        min: 90,
                        max: 120
                    }, {
                        label: "> 120 min",
                        min: 120,
                        max: 99999
                    }].map(e => ({
                        faixa: e.label,
                        total: r.filter(t => {
                            const a = parseFloat(t.tempo);
                            return null !== a && !isNaN(a) && a >= e.min && a < e.max
                        }).length
                    })),
                    c = [{
                        label: "0-10",
                        min: 0,
                        max: 10
                    }, {
                        label: "11-15",
                        min: 10,
                        max: 15
                    }, {
                        label: "16-20",
                        min: 15,
                        max: 20
                    }, {
                        label: "21-25",
                        min: 20,
                        max: 25
                    }, {
                        label: "26-30",
                        min: 25,
                        max: 30
                    }, {
                        label: "31-35",
                        min: 30,
                        max: 35
                    }, {
                        label: "36-40",
                        min: 35,
                        max: 40
                    }, {
                        label: "41-45",
                        min: 40,
                        max: 45
                    }, {
                        label: "46-50",
                        min: 45,
                        max: 50
                    }, {
                        label: "51-55",
                        min: 50,
                        max: 55
                    }, {
                        label: "56-60",
                        min: 55,
                        max: 60
                    }, {
                        label: "61-65",
                        min: 60,
                        max: 65
                    }, {
                        label: "66-70",
                        min: 65,
                        max: 70
                    }, {
                        label: "Outras",
                        min: 70,
                        max: 99999
                    }].map(e => ({
                        faixa: e.label,
                        total: r.filter(t => {
                            const a = parseFloat(t.km);
                            return null !== a && !isNaN(a) && a >= e.min && a < e.max
                        }).length
                    }));
                Ht({
                    porTempo: o,
                    porKm: c
                }), Xt({});
                
                // Tamb√©m recarregar a lista de OS com os mesmos filtros
                const osParams = new URLSearchParams;
                e.data_inicio && osParams.append("data_inicio", e.data_inicio);
                e.data_fim && osParams.append("data_fim", e.data_fim);
                e.cod_cliente && e.cod_cliente.length > 0 && osParams.append("cod_cliente", e.cod_cliente.join(","));
                e.centro_custo && e.centro_custo.length > 0 && osParams.append("centro_custo", e.centro_custo.join(","));
                e.cod_prof && osParams.append("cod_prof", e.cod_prof);
                e.categoria && osParams.append("categoria", e.categoria);
                e.cidade && osParams.append("cidade", e.cidade);
                e.status_prazo && osParams.append("status_prazo", e.status_prazo);
                e.status_retorno && osParams.append("status_retorno", e.status_retorno);
                const osResponse = await fetchAuth(`${API_URL}/bi/entregas-lista?${osParams}`);
                const osData = await osResponse.json();
                Ut(Array.isArray(osData) ? osData : []);
                console.log("üìã Lista de OS recarregada com filtros");
            } catch (e) {
                console.error("Erro ao carregar BI:", e)
            }
            Ra(!1)
        }, cl = e => {
            // Fun√ß√£o para formatar tempo em minutos para HH:MM:SS
            // Recebe minutos (ex: 45.5) e retorna "00:45:30"
            if (!e && 0 !== e) return "-";
            const totalMinutos = parseFloat(e) || 0;
            if (totalMinutos <= 0) return "00:00:00";
            
            const totalSegundos = Math.round(totalMinutos * 60);
            const h = Math.floor(totalSegundos / 3600);
            const m = Math.floor((totalSegundos % 3600) / 60);
            const s = totalSegundos % 60;
            
            return `${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`
        }, sl = e => e || 0 === e ? new Intl.NumberFormat("pt-BR", {
            style: "currency",
            currency: "BRL"
        }).format(parseFloat(e) || 0) : "R$0,00", nl = e => parseFloat(e) || 0, ml = e => {
            Xt(t => ({
                ...t,
                [e]: !t[e]
            }))
        }, il = e => {
            const t = ea.find(t => String(t.cod_cliente) === String(e));
            return t ? t.mascara : null
        }, dl = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/bi/mascaras`);
                ta(await e.json())
            } catch (e) {
                console.error("Erro ao carregar m√°scaras:", e)
            }
        }, pl = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/bi/regioes`);
                la(await e.json())
            } catch (e) {
                console.error("Erro ao carregar regi√µes:", e)
            }
        }, xl = async () => {
            try {
                Ra(!0);
                const e = await fetchAuth(`${API_URL}/bi/entregas/recalcular`, {
                        method: "POST"
                    }),
                    t = await e.json();
                ja(`‚úÖ ${t.atualizados} entregas recalculadas!`, "success"), el()
            } catch (e) {
                ja("Erro ao recalcular", "error")
            }
            Ra(!1)
        }, ul = async () => {
            m(!0);
            try {
                await La(), "admin" !== l.role && "admin_master" !== l.role || await Ia(), "user" === l.role && (await Oa(), await qa(), await vl(), await _l(), await Ga(), await Za()), "admin_financeiro" !== l.role && "admin_master" !== l.role || (await Ua(), await za(), await Ba(), await Va(), await gl(), await wl(), await Ia(), await Ja(), await Ha(), await Wa()), "admin" === l.role && hasModuleAccess(l, "financeiro") && (await wl(), await gl()), ja("üîÑ Atualizado!", "success")
            } catch (e) {
                ja("Erro", "error")
            }
            m(!1)
        }, gl = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/promocoes`);
                te(await e.json())
            } catch (e) {
                console.error("Erro ao carregar promo√ß√µes:", e)
            }
        }, bl = ["Domingo", "Segunda-feira", "Ter√ßa-feira", "Quarta-feira", "Quinta-feira", "Sexta-feira", "S√°bado"], Rl = async (e, t) => {
            try {
                await fetchAuth(`${API_URL}/horarios/${e}`, {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(t)
                }), ja("‚úÖ Hor√°rio atualizado!", "success");
                const a = await fetchAuth(`${API_URL}/horarios`),
                    l = await a.json();
                Oe(e => ({
                    ...e,
                    horarios: l
                }))
            } catch (e) {
                ja("Erro ao atualizar", "error")
            }
        }, El = async () => {
            const e = p.novoEspData,
                t = p.novoEspDesc,
                a = p.novoEspFechado,
                l = p.novoEspInicio,
                r = p.novoEspFim;
            if (e) try {
                await fetchAuth(`${API_URL}/horarios/especiais`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        data: e,
                        descricao: t || "Hor√°rio especial",
                        hora_inicio: l,
                        hora_fim: r,
                        fechado: a
                    })
                }), ja("‚úÖ Hor√°rio especial criado!", "success"), x(e => ({
                    ...e,
                    novoEspData: "",
                    novoEspDesc: "",
                    novoEspFechado: !1,
                    novoEspInicio: "09:00",
                    novoEspFim: "18:00"
                }));
                const o = await fetchAuth(`${API_URL}/horarios/especiais`),
                    c = await o.json();
                Oe(e => ({
                    ...e,
                    especiais: c
                }))
            } catch (e) {
                ja("Erro ao criar", "error")
            } else ja("Selecione uma data", "error")
        }, hl = async () => {
            const e = p.novoAvisoTitulo,
                t = p.novoAvisoMensagem,
                a = p.novoAvisoTipo || "info",
                l = p.novoAvisoExibirFora || !1;
            if (e && t) try {
                await fetchAuth(`${API_URL}/avisos`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        titulo: e,
                        mensagem: t,
                        tipo: a,
                        exibir_fora_horario: l
                    })
                }), ja("‚úÖ Aviso criado!", "success"), x(e => ({
                    ...e,
                    novoAvisoTitulo: "",
                    novoAvisoMensagem: "",
                    novoAvisoTipo: "info",
                    novoAvisoExibirFora: !1
                }));
                const r = await fetchAuth(`${API_URL}/avisos`);
                Ue({
                    avisos: await r.json(),
                    loading: !1
                })
            } catch (e) {
                ja("Erro ao criar", "error")
            } else ja("Preencha t√≠tulo e mensagem", "error")
        }, fl = async e => {
            try {
                await fetchAuth(`${API_URL}/avisos/${e.id}`, {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        ...e,
                        ativo: !e.ativo
                    })
                });
                const t = await fetchAuth(`${API_URL}/avisos`);
                Ue({
                    avisos: await t.json(),
                    loading: !1
                })
            } catch (e) {
                ja("Erro", "error")
            }
        }, Nl = async e => {
            if (confirm("Remover este aviso permanentemente?")) try {
                await fetchAuth(`${API_URL}/avisos/${e}`, {
                    method: "DELETE"
                }), ja("‚úÖ Removido!", "success");
                const t = await fetchAuth(`${API_URL}/avisos`);
                Ue({
                    avisos: await t.json(),
                    loading: !1
                })
            } catch (e) {
                ja("Erro", "error")
            }
        }, yl = () => {
            if (!ze?.proximoHorario) return "em breve";
            const e = ze.proximoHorario,
                t = new Date(e.data + "T12:00:00"),
                a = new Date;
            a.setHours(0, 0, 0, 0);
            const l = new Date(e.data + "T00:00:00");
            return l.getTime() === a.getTime() ? `hoje √†s ${e.inicio}` : l.getTime() === a.getTime() + 864e5 ? `amanh√£ √†s ${e.inicio}` : `${t.toLocaleDateString("pt-BR",{weekday:"long",day:"numeric",month:"short"})} √†s ${e.inicio}`
        }, vl = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/promocoes/ativas`);
                te(await e.json())
            } catch (e) {
                console.error("Erro ao carregar promo√ß√µes ativas:", e)
            }
        }, wl = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/indicacoes`);
                le(await e.json())
            } catch (e) {
                console.error("Erro ao carregar indica√ß√µes:", e)
            }
        }, _l = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/indicacoes/usuario/${l.codProfissional}`);
                oe(await e.json())
            } catch (e) {
                console.error("Erro ao carregar minhas indica√ß√µes:", e)
            }
        }, jl = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/indicacao-link/usuario/${l.codProfissional}`),
                    t = await e.json(),
                    a = await fetchAuth(`${API_URL}/indicacao-link/estatisticas/${l.codProfissional}`),
                    r = await a.json();
                await _l(), x(e => ({
                    ...e,
                    meuLinkIndicacao: t,
                    statsIndicacao: r
                }))
            } catch (e) {
                console.error("Erro ao carregar link de indica√ß√£o:", e)
            }
        }, Cl = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/promocoes-novatos`);
                se(await e.json())
            } catch (e) {
                console.error("Erro ao carregar promo√ß√µes novatos:", e)
            }
        },
        // Fun√ß√£o para carregar regi√µes dispon√≠veis da planilha
        carregarRegioesNovatos = async () => {
            try {
                const response = await fetchAuth(`${API_URL}/promocoes-novatos/regioes`);
                const regioes = await response.json();
                setRegioesNovatos(regioes);
            } catch (e) {
                console.error("Erro ao carregar regi√µes novatos:", e);
            }
        },
        // Fun√ß√£o para verificar elegibilidade do usu√°rio para promo√ß√µes novatos
        verificarElegibilidadeNovatos = async () => {
            console.log("üîç Verificando elegibilidade novatos para:", l?.codProfissional);
            if (!l || !l.codProfissional || isNaN(l.codProfissional) || ['admin', 'admin_master', 'admin_financeiro'].includes(l.role)) {
                setElegibilidadeNovatos({ elegivel: false, motivo: 'Usu√°rio n√£o logado', promocoes: [], carregando: false });
                return;
            }
            try {
                const response = await fetchAuth(`${API_URL}/promocoes-novatos/elegibilidade/${l.codProfissional}`);
                const data = await response.json();
                console.log("‚úÖ Resposta elegibilidade novatos:", data);
                setElegibilidadeNovatos({ ...data, carregando: false });
                // SEMPRE atualiza a lista de promo√ß√µes (vazia se n√£o eleg√≠vel)
                se(data.promocoes || []);
            } catch (e) {
                console.error("‚ùå Erro ao verificar elegibilidade novatos:", e);
                setElegibilidadeNovatos({ elegivel: false, motivo: 'Erro ao verificar elegibilidade', promocoes: [], carregando: false });
            }
        },
        Al = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/promocoes-novatos/ativas`);
                se(await e.json())
            } catch (e) {
                console.error("Erro ao carregar promo√ß√µes novatos ativas:", e)
            }
        }, Sl = async () => {
            try {
                await fetchAuth(`${API_URL}/inscricoes-novatos/verificar-expiradas`, {
                    method: "POST"
                });
                const e = await fetchAuth(`${API_URL}/inscricoes-novatos`);
                me(await e.json())
            } catch (e) {
                console.error("Erro ao carregar inscri√ß√µes novatos:", e)
            }
        }, 
        // Fun√ß√£o para rejeitar inscri√ß√£o de novato
        rejeitarInscNovato = async (id) => {
            if (!p.motivoRejeicaoNovato?.trim()) {
                ja("Informe o motivo da rejei√ß√£o", "error");
                return;
            }
            s(!0);
            try {
                const response = await fetchAuth(`${API_URL}/inscricoes-novatos/${id}/rejeitar`, {
                    method: "PATCH",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        motivo_rejeicao: p.motivoRejeicaoNovato,
                        resolved_by: l.fullName
                    })
                });
                if (!response.ok) throw new Error("Erro ao rejeitar");
                ja("‚ùå Inscri√ß√£o rejeitada!", "success");
                x({
                    ...p,
                    modalRejeitarNovatos: null,
                    motivoRejeicaoNovato: ""
                });
                await Sl();
            } catch (e) {
                console.error("Erro ao rejeitar inscri√ß√£o:", e);
                ja("Erro ao rejeitar inscri√ß√£o", "error");
            } finally {
                s(!1);
            }
        },
        kl = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/inscricoes-novatos/usuario/${l.codProfissional}`);
                de(await e.json())
            } catch (e) {
                console.error("Erro ao carregar minhas inscri√ß√µes novatos:", e)
            }
        }, 
        carregarProgressoNovatos = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/inscricoes-novatos/progresso/${l.codProfissional}`);
                const data = await e.json();
                setProgressoNovatos(data);
                console.log("üìä Progresso novatos carregado:", data);
            } catch (e) {
                console.error("Erro ao carregar progresso novatos:", e)
            }
        },
        carregarEntregasInscricao = async (inscricaoId) => {
            try {
                const e = await fetchAuth(`${API_URL}/inscricoes-novatos/${inscricaoId}/entregas`);
                const data = await e.json();
                setModalEntregasNovatos(data);
            } catch (e) {
                console.error("Erro ao carregar entregas da inscri√ß√£o:", e);
                ja("Erro ao carregar entregas", "error");
            }
        },
        carregarClientesPorRegiao = async (regiao) => {
            if (!regiao) {
                setClientesBINovatos([]);
                return;
            }
            setCarregandoClientes(true);
            try {
                const url = regiao === 'Todas' 
                    ? `${API_URL}/bi/clientes-por-regiao`
                    : `${API_URL}/bi/clientes-por-regiao?regiao=${encodeURIComponent(regiao)}`;
                const e = await fetchAuth(url);
                const data = await e.json();
                setClientesBINovatos(data);
                console.log("üìã Clientes carregados para regi√£o", regiao, ":", data.length);
            } catch (e) {
                console.error("Erro ao carregar clientes do BI:", e);
                setClientesBINovatos([]);
            } finally {
                setCarregandoClientes(false);
            }
        },
        Pl = async () => {
            if (p.novatosRegiao && p.novatosApelido && p.novatosValor && clientesSelecionados.length > 0) {
                s(!0);
                try {
                    if (!(await fetchAuth(`${API_URL}/promocoes-novatos`, {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify({
                                regiao: p.novatosRegiao,
                                apelido: p.novatosApelido,
                                clientes: clientesSelecionados,
                                valor_bonus: parseFloat(p.novatosValor),
                                quantidade_entregas: parseInt(p.novatosQtdEntregas) || 50,
                                detalhes: p.novatosDetalhes || null,
                                created_by: l.fullName
                            })
                        })).ok) throw new Error("Erro ao criar promo√ß√£o");
                    ja("‚úÖ Promo√ß√£o Novatos criada!", "success"), x({
                        ...p,
                        novatosRegiao: "",
                        novatosApelido: "",
                        novatosValor: "",
                        novatosQtdEntregas: "",
                        novatosDetalhes: "",
                        editPromoNovatos: null
                    }), setClientesSelecionados([]), setClientesBINovatos([]), await Cl()
                } catch (e) {
                    ja(e.message, "error")
                } finally {
                    s(!1)
                }
            } else if (clientesSelecionados.length === 0) {
                ja("Selecione pelo menos um cliente", "error")
            } else {
                ja("Preencha todos os campos obrigat√≥rios", "error")
            }
        }, Tl = async () => {
            s(!0);
            try {
                if (!(await fetchAuth(`${API_URL}/promocoes-novatos/${p.editPromoNovatos.id}`, {
                        method: "PATCH",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            regiao: p.novatosRegiao,
                            apelido: p.novatosApelido,
                            clientes: clientesSelecionados,
                            valor_bonus: parseFloat(p.novatosValor),
                            quantidade_entregas: parseInt(p.novatosQtdEntregas) || 50,
                            detalhes: p.novatosDetalhes || null
                        })
                    })).ok) throw new Error("Erro ao editar promo√ß√£o");
                ja("‚úÖ Promo√ß√£o atualizada!", "success"), x({
                    ...p,
                    novatosRegiao: "",
                    novatosApelido: "",
                    novatosValor: "",
                    novatosQtdEntregas: "",
                    novatosDetalhes: "",
                    editPromoNovatos: null
                }), setClientesSelecionados([]), setClientesBINovatos([]), await Cl()
            } catch (e) {
                ja(e.message, "error")
            } finally {
                s(!1)
            }
        }, Dl = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/quiz-procedimentos/config`),
                    t = await e.json();
                console.log("üéØ Quiz Config carregado:", t), Ne(t)
            } catch (e) {
                console.error("Erro ao carregar config quiz:", e)
            }
        }, Ll = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/quiz-procedimentos/respostas`);
                ve(await e.json())
            } catch (e) {
                console.error("Erro ao carregar respostas quiz:", e)
            }
        }, Il = async () => {
            try {
                const e = await fetchAuth(`${API_URL}/quiz-procedimentos/verificar/${l.codProfissional}`),
                    t = await e.json();
                _e(t.ja_respondeu), t.dados && Ce(t.dados)
            } catch (e) {
                console.error("Erro ao verificar quiz:", e)
            }
        }, Fl = async () => {
            s(!0);
            try {
                if (!(await fetchAuth(`${API_URL}/quiz-procedimentos/config`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify(fe)
                    })).ok) throw new Error("Erro ao salvar");
                ja("‚úÖ Configura√ß√£o do Quiz salva!", "success")
            } catch (e) {
                ja(e.message, "error")
            } finally {
                s(!1)
            }
        }, $l = async () => {
            if (Te.some(e => null === e)) ja("Responda todas as perguntas!", "error");
            else {
                s(!0);
                try {
                    const e = await fetchAuth(`${API_URL}/quiz-procedimentos/responder`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            user_cod: l.codProfissional,
                            user_name: l.fullName,
                            respostas: Te
                        })
                    });
                    if (!e.ok) {
                        const t = await e.json();
                        throw new Error(t.error || "Erro ao enviar")
                    }
                    const t = await e.json();
                    Ie(t), Se(3), _e(!0), Ce({
                        acertos: t.acertos,
                        passou: t.passou,
                        created_at: (new Date).toISOString()
                    }), t.passou && (ja(`üéâ Parab√©ns! Voc√™ ganhou R$ ${t.valor_gratuidade.toFixed(2).replace(".",",")} de gratuidade!`, "success"), qa())
                } catch (e) {
                    ja(e.message, "error")
                } finally {
                    s(!1)
                }
            }
        }, Ml = async () => {
            if (p.promoRegiao && p.promoValor) {
                s(!0);
                try {
                    if (!(await fetchAuth(`${API_URL}/promocoes`, {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify({
                                regiao: p.promoRegiao,
                                valor_bonus: parseFloat(p.promoValor),
                                detalhes: p.promoDetalhes || null,
                                created_by: l.fullName
                            })
                        })).ok) throw new Error("Erro ao criar promo√ß√£o");
                    ja("‚úÖ Promo√ß√£o criada!", "success"), x({
                        ...p,
                        promoRegiao: "",
                        promoValor: "",
                        promoDetalhes: ""
                    }), await gl()
                } catch (e) {
                    ja(e.message, "error")
                }
                s(!1)
            } else ja("Preencha todos os campos obrigat√≥rios", "error")
        }, Ol = async () => {
            if (p.promoRegiao && p.promoValor) {
                s(!0);
                try {
                    if (!(await fetchAuth(`${API_URL}/promocoes/${p.editPromo.id}`, {
                            method: "PATCH",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify({
                                regiao: p.promoRegiao,
                                valor_bonus: parseFloat(p.promoValor),
                                detalhes: p.promoDetalhes || null
                            })
                        })).ok) throw new Error("Erro ao editar promo√ß√£o");
                    ja("‚úÖ Promo√ß√£o atualizada!", "success"), x({
                        ...p,
                        editPromo: null,
                        promoRegiao: "",
                        promoValor: "",
                        promoDetalhes: ""
                    }), await gl()
                } catch (e) {
                    ja(e.message, "error")
                }
                s(!1)
            } else ja("Preencha todos os campos obrigat√≥rios", "error")
        }, ql = async () => {
            s(!0);
            try {
                const e = await fetchAuth(`${API_URL}/users/login`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        codProfissional: p.cod,
                        password: p.password
                    })
                });
                if (!e.ok) throw new Error("Credenciais inv√°lidas");
                const t = await e.json();
                // Carregar permiss√µes se for admin
                let perms = null;
                if (t.role === "admin" || t.role === "admin_financeiro") {
                    try {
                        const permRes = await fetchAuth(`${API_URL}/admin-permissions/${t.cod_profissional}`);
                        if (permRes.ok) {
                            const permData = await permRes.json();
                            const allowedMods = Array.isArray(permData.allowed_modules) ? permData.allowed_modules : [];
                            const allowedTabs = permData.allowed_tabs && typeof permData.allowed_tabs === 'object' ? permData.allowed_tabs : {};
                            
                            // Se n√£o h√° m√≥dulos configurados, dar acesso a todos (primeira vez)
                            // Se h√° m√≥dulos configurados, usar apenas os que est√£o na lista
                            const hasConfig = allowedMods.length > 0;
                            
                            perms = {
                                allowed_modules: allowedMods,
                                allowed_tabs: allowedTabs,
                                hasConfig: hasConfig,
                                modulos: {
                                    solicitacoes: !hasConfig || allowedMods.includes("solicitacoes"),
                                    financeiro: !hasConfig || allowedMods.includes("financeiro"),
                                    operacional: !hasConfig || allowedMods.includes("operacional"),
                                    disponibilidade: !hasConfig || allowedMods.includes("disponibilidade"),
                                    bi: !hasConfig || allowedMods.includes("bi"),
                                    todo: !hasConfig || allowedMods.includes("todo"),
                                    config: !hasConfig || allowedMods.includes("config")
                                },
                                abas: allowedTabs
                            };
                            console.log("Permiss√µes carregadas:", perms);
                        }
                    } catch (err) {
                        console.log("Sem permiss√µes definidas, usando padr√£o");
                    }
                }
                // Salvar token JWT se retornado
                if (t.token) {
                    setToken(t.token);
                }
                // Salvar refresh token se retornado
                if (t.refreshToken) {
                    setRefreshToken(t.refreshToken);
                }
                o({
                    ...t,
                    codProfissional: t.cod_profissional,
                    fullName: t.full_name,
                    permissions: perms
                }), x({})
            } catch (e) {
                ja(e.message, "error")
            }
            s(!1)
        }, Ul = async () => {
            s(!0);
            try {
                const response = await fetchAuth(`${API_URL}/users/register`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            codProfissional: p.cod,
                            password: p.password,
                            fullName: p.name
                        })
                    });
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.error || "Erro no cadastro");
                }
                const data = await response.json();
                // Salvar token se retornado
                if (data.token) {
                    setToken(data.token);
                }
                // Salvar refresh token se retornado
                if (data.refreshToken) {
                    setRefreshToken(data.refreshToken);
                }
                ja("Cadastro realizado!", "success"), x({
                    view: "login"
                })
            } catch (e) {
                ja(e.message, "error")
            }
            s(!1)
        }, zl = async () => {
            s(!0);
            try {
                await fetchAuth(`${API_URL}/financial/accept-terms`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        userCod: l.codProfissional
                    })
                }), P(!0), ja("‚úÖ Termos aceitos!", "success")
            } catch (e) {
                ja("Erro", "error")
            }
            s(!1)
        }, Bl = async () => {
            if (!p.finName || !p.finCpf || !p.finPix) return void ja("Preencha todos os campos", "error");
            if (!p.pixTipo) return void ja("‚ùå Selecione o tipo da chave PIX", "error");
            // Validar CPF antes de enviar
            const validacaoCpf = validarCPFCompleto(p.finCpf);
            if (!validacaoCpf.valido) return void ja(`‚ùå ${validacaoCpf.mensagem}`, "error");
            const e = tr(p.finPix, p.pixTipo);
            if (e.valido) {
                s(!0);
                try {
                    const response = await fetchAuth(`${API_URL}/financial/data`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            userCod: l.codProfissional,
                            fullName: p.finName,
                            cpf: p.finCpf,
                            pixKey: p.finPix,
                            pixTipo: p.pixTipo
                        })
                    });
                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        throw new Error(errorData.error || "Erro ao salvar dados");
                    }
                    D({
                        full_name: p.finName,
                        cpf: p.finCpf,
                        pix_key: p.finPix,
                        pix_tipo: p.pixTipo
                    }), $(!1), Ma();
                    const tipoNome = {
                        cpf: "CPF",
                        cnpj: "CNPJ",
                        telefone: "Telefone",
                        email: "Email",
                        aleatoria: "Chave Aleat√≥ria"
                    } [p.pixTipo];
                    ja(`‚úÖ Dados salvos! (PIX: ${tipoNome})`, "success")
                } catch (err) {
                    ja(`‚ùå ${err.message}`, "error")
                }
                s(!1)
            } else ja(`‚ùå ${e.mensagem}`, "error")
        }, Vl = async () => {
            const e = parseFloat(p.withdrawAmount);
            if (!e || e <= 0) return void ja("Valor inv√°lido", "error");
            if (e < 10) return void ja("‚ö†Ô∏è Valor m√≠nimo √© R$ 10,00", "error");
            // Verificar saldo Plific (considerando saques pendentes)
            const saldoDisp = calcularSaldoDisponivel();
            if (saldoDisp !== null && e > saldoDisp) {
                return void ja("‚ö†Ô∏è Saldo insuficiente! Seu saldo dispon√≠vel √© R$ " + saldoDisp.toFixed(2).replace(".", ","), "error");
            }
            if (saldoDisp !== null && saldoDisp <= 0) {
                return void ja("‚ö†Ô∏è Voc√™ n√£o possui saldo dispon√≠vel para saque!", "error");
            }
            const t = new Date,
                a = new Date(t.getTime() - 36e5),
                // Filtrar apenas saques n√£o rejeitados na √∫ltima hora
                r = M.filter(e => new Date(e.created_at) >= a && e.status !== "rejeitado");
            if (r.length >= 1) {
                const e = new Date(new Date(r[0].created_at).getTime() + 36e5),
                    a = Math.ceil((e - t) / 6e4);
                return void ja(`‚ö†Ô∏è Permitido apenas 1 saque por hora! Aguarde ${a} minutos para solicitar novamente.`, "error")
            }
            // Com 1 saque por hora, n√£o precisa verificar valor repetido
            s(!0);
            try {
                const response = await fetchAuth(`${API_URL}/withdrawals`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        userCod: l.codProfissional,
                        userName: T.full_name,
                        cpf: T.cpf,
                        pixKey: T.pix_key,
                        requestedAmount: e
                    })
                });
                if (!response.ok) {
                    const err = await response.json();
                    ja("‚ùå " + (err.error || "Erro ao solicitar saque"), "error");
                    s(!1);
                    return;
                }
                ja("‚úÖ Saque solicitado!", "success"), 
                x({
                    ...p,
                    withdrawAmount: ""
                }), 
                // Recarrega saques e saldo (o c√°lculo autom√°tico subtrai pendentes)
                Oa(), 
                setTimeout(() => buscarSaldoPlificUsuario(), 500),
                qa()
            } catch (e) {
                ja("Erro", "error")
            }
            s(!1)
        }, Jl = async (e, t, a = null) => {
            try {
                // Calcular data do d√©bito baseado no toggle de acerto
                let dataDebito = null;
                console.log("üîç Toggle acertoRealizado:", acertoRealizado);
                if (t === "aprovado" || t === "aprovado_gratuidade") {
                    if (acertoRealizado) {
                        // Acerto realizado: data/hora atual
                        dataDebito = new Date().toISOString();
                        console.log("üìÖ Data d√©bito (hoje):", dataDebito);
                    } else {
                        // Acerto pendente: √∫ltimo domingo
                        const hoje = new Date();
                        const diaSemana = hoje.getDay(); // 0 = domingo
                        const diasParaDomingo = diaSemana === 0 ? 7 : diaSemana;
                        const ultimoDomingo = new Date(hoje);
                        ultimoDomingo.setDate(hoje.getDate() - diasParaDomingo);
                        ultimoDomingo.setHours(23, 59, 0, 0);
                        dataDebito = ultimoDomingo.toISOString();
                        console.log("üìÖ Data d√©bito (√∫ltimo domingo):", dataDebito);
                    }
                }
                
                const response = await fetchAuth(`${API_URL}/withdrawals/${e}`, {
                    method: "PATCH",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        status: t,
                        adminId: l.id,
                        adminName: l.fullName || "Admin Financeiro",
                        rejectReason: a,
                        dataDebito: dataDebito
                    })
                });
                
                const data = await response.json();
                if (!response.ok) {
                    ja("‚ùå " + (data.error || "Erro ao atualizar"), "error");
                    return;
                }
                
                ja("‚úÖ Status atualizado!" + (!acertoRealizado && (t === "aprovado" || t === "aprovado_gratuidade") ? " (D√©bito no √∫ltimo domingo)" : ""), "success");
                x({
                    ...p,
                    [`reject_${e}`]: "",
                    [`showReject_${e}`]: !1
                }), Ua()
            } catch (e) {
                ja("Erro", "error")
            }
        }, Ql = async (e, t) => {
            try {
                await fetchAuth(`${API_URL}/withdrawals/${e}/saldo`, {
                    method: "PATCH",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        saldoStatus: t
                    })
                }), Ua(), ja("validado" === t ? "‚úÖ Saldo validado!" : "insuficiente" === t ? "‚ùå Saldo insuficiente!" : "‚Ü© Status de saldo removido", "success")
            } catch (e) {
                ja("Erro ao atualizar saldo", "error")
            }
        }, Hl = async () => {
            if (p.gratUserCod && p.gratQty && p.gratValue && p.gratUserName) {
                s(!0);
                try {
                    await fetchAuth(`${API_URL}/gratuities`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            userCod: p.gratUserCod,
                            userName: p.gratUserName,
                            quantity: parseInt(p.gratQty),
                            value: parseFloat(p.gratValue),
                            reason: p.gratReason || "",
                            createdBy: l.fullName
                        })
                    }), ja("‚úÖ Gratuidade cadastrada!", "success"), x({
                        ...p,
                        gratUserCod: "",
                        gratUserName: "",
                        gratQty: "",
                        gratValue: "",
                        gratReason: ""
                    }), za()
                } catch (e) {
                    ja("Erro", "error")
                }
                s(!1)
            } else ja("Preencha todos os campos obrigat√≥rios", "error")
        }, Gl = async () => {
            if (p.restUserCod && p.restReason && p.restUserName) {
                s(!0);
                try {
                    await fetchAuth(`${API_URL}/restricted`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            userCod: p.restUserCod,
                            userName: p.restUserName,
                            reason: p.restReason,
                            createdBy: l.fullName
                        })
                    }), ja("‚úÖ Restri√ß√£o cadastrada!", "success"), x({
                        ...p,
                        restUserCod: "",
                        restUserName: "",
                        restReason: ""
                    }), Ba()
                } catch (e) {
                    ja("Erro", "error")
                }
                s(!1)
            } else ja("Preencha todos os campos", "error")
        }, Wl = ["Ajuste de Retorno", "Ajuste de Ped√°gio", "Ajuste Sim√µes Filho (Salvador-BA)"], Zl = (e, t = 1920, a = .85) => new Promise((l, r) => {
            const o = new FileReader;
            o.onload = e => {
                const o = new Image;
                o.onload = () => {
                    const e = document.createElement("canvas");
                    let r = o.width,
                        c = o.height;
                    // Redimensionar mantendo propor√ß√£o se maior que o limite
                    if (r > t || c > t) {
                        if (r > c) {
                            c = c * t / r;
                            r = t;
                        } else {
                            r = r * t / c;
                            c = t;
                        }
                    }
                    e.width = r, e.height = c, e.getContext("2d").drawImage(o, 0, 0, r, c), l(e.toDataURL("image/jpeg", a))
                }, o.onerror = r, o.src = e.target.result
            }, o.onerror = r, o.readAsDataURL(e)
        }), Yl = async () => {
            s(!0);
            try {
                const e = p.imagens?.length > 0 ? p.imagens.join("|||") : null;
                await fetchAuth(`${API_URL}/submissions`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        ordemServico: p.os,
                        motivo: p.motivo,
                        userId: l.id,
                        userCod: l.codProfissional,
                        userName: l.fullName,
                        imagemComprovante: e,
                        coordenadas: p.coordenadas || null
                    })
                }), ja("‚úÖ OS enviada!", "success"), x({}), La()
            } catch (e) {
                ja("Erro", "error")
            }
            s(!1)
        }, Kl = async (e, t) => {
            try {
                C(a => a.map(a => a.id === e ? {
                    ...a,
                    status: t ? "aprovado" : "rejeitado",
                    validated_by_name: l.fullName
                } : a)), await fetchAuth(`${API_URL}/submissions/${e}`, {
                    method: "PATCH",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        status: t ? "aprovado" : "rejeitado",
                        observacao: p[`obs_${e}`] || "",
                        validatedBy: l.id,
                        validatedByName: l.fullName || "Admin"
                    })
                }), ja(t ? "‚úÖ Aprovado!" : "‚ùå Rejeitado!", t ? "success" : "error");
                const {
                    pendingFilter: a,
                    adminTab: r
                } = p;
                x({
                    pendingFilter: a,
                    adminTab: r
                }), La()
            } catch (e) {
                ja("Erro", "error"), La()
            }
        }, Xl = e => {
            const t = e.replace(/\D/g, "").slice(0, 11);
            return t.length <= 3 ? t : t.length <= 6 ? `${t.slice(0,3)}.${t.slice(3)}` : t.length <= 9 ? `${t.slice(0,3)}.${t.slice(3,6)}.${t.slice(6)}` : `${t.slice(0,3)}.${t.slice(3,6)}.${t.slice(6,9)}-${t.slice(9)}`
        }, 
        // Fun√ß√£o para validar CPF completo (com d√≠gito verificador)
        validarCPFCompleto = (cpf) => {
            const cpfLimpo = cpf.replace(/\D/g, "");
            if (cpfLimpo.length !== 11) return { valido: false, mensagem: "CPF deve ter 11 d√≠gitos" };
            if (/^(\d)\1{10}$/.test(cpfLimpo)) return { valido: false, mensagem: "CPF inv√°lido - d√≠gitos repetidos" };
            let soma = 0, resto;
            for (let i = 1; i <= 9; i++) soma += parseInt(cpfLimpo.substring(i-1, i)) * (11 - i);
            resto = (soma * 10) % 11;
            if (resto === 10 || resto === 11) resto = 0;
            if (resto !== parseInt(cpfLimpo.substring(9, 10))) return { valido: false, mensagem: "CPF inv√°lido. Verifique se digitou corretamente." };
            soma = 0;
            for (let i = 1; i <= 10; i++) soma += parseInt(cpfLimpo.substring(i-1, i)) * (12 - i);
            resto = (soma * 10) % 11;
            if (resto === 10 || resto === 11) resto = 0;
            if (resto !== parseInt(cpfLimpo.substring(10, 11))) return { valido: false, mensagem: "CPF inv√°lido. Verifique se digitou corretamente." };
            return { valido: true, mensagem: "‚úÖ CPF v√°lido" };
        },
        er = e => parseFloat(e || 0).toLocaleString("pt-BR", {
            style: "currency",
            currency: "BRL"
        }), tr = (e, t) => {
            if (!e || "" === e.trim()) return {
                valido: !1,
                mensagem: ""
            };
            const a = e.trim();
            switch (t) {
                case "cpf":
                    return 11 === a.replace(/\D/g, "").length ? {
                        valido: !0,
                        mensagem: "‚úÖ CPF v√°lido"
                    } : {
                        valido: !1,
                        mensagem: "‚ùå CPF deve ter 11 d√≠gitos"
                    };
                case "cnpj":
                    return 14 === a.replace(/\D/g, "").length ? {
                        valido: !0,
                        mensagem: "‚úÖ CNPJ v√°lido"
                    } : {
                        valido: !1,
                        mensagem: "‚ùå CNPJ deve ter 14 d√≠gitos"
                    };
                case "telefone":
                    const e = a.replace(/\D/g, "");
                    return 10 === e.length || 11 === e.length ? {
                        valido: !0,
                        mensagem: "‚úÖ Telefone v√°lido"
                    } : {
                        valido: !1,
                        mensagem: "‚ùå Telefone deve ter 10 ou 11 d√≠gitos"
                    };
                case "email":
                    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a) ? {
                        valido: !0,
                        mensagem: "‚úÖ Email v√°lido"
                    } : {
                        valido: !1,
                        mensagem: "‚ùå Formato de email inv√°lido"
                    };
                case "aleatoria":
                    return /^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/i.test(a) || /^[a-f0-9]{32}$/i.test(a) ? {
                        valido: !0,
                        mensagem: "‚úÖ Chave aleat√≥ria v√°lida"
                    } : {
                        valido: !1,
                        mensagem: "‚ùå Formato de chave aleat√≥ria inv√°lido"
                    };
                default:
                    return {
                        valido: !1, mensagem: "Selecione o tipo da chave"
                    }
            }
        }, ar = (e, t) => {
            switch (t) {
                case "cpf":
                    return Xl(e);
                case "cnpj":
                    return (e => {
                        const t = e.replace(/\D/g, "").slice(0, 14);
                        return t.length <= 2 ? t : t.length <= 5 ? `${t.slice(0,2)}.${t.slice(2)}` : t.length <= 8 ? `${t.slice(0,2)}.${t.slice(2,5)}.${t.slice(5)}` : t.length <= 12 ? `${t.slice(0,2)}.${t.slice(2,5)}.${t.slice(5,8)}/${t.slice(8)}` : `${t.slice(0,2)}.${t.slice(2,5)}.${t.slice(5,8)}/${t.slice(8,12)}-${t.slice(12)}`
                    })(e);
                case "telefone":
                    return (e => {
                        const t = e.replace(/\D/g, "").slice(0, 11);
                        return t.length <= 2 ? t.length > 0 ? `(${t}` : "" : t.length <= 7 ? `(${t.slice(0,2)}) ${t.slice(2)}` : `(${t.slice(0,2)}) ${t.slice(2,7)}-${t.slice(7)}`
                    })(e);
                default:
                    return e
            }
        }, lr = e => {
            switch (e) {
                case "cpf":
                    return "000.000.000-00";
                case "cnpj":
                    return "00.000.000/0000-00";
                case "telefone":
                    return "(00) 00000-0000";
                case "email":
                    return "seu@email.com";
                case "aleatoria":
                    return "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx";
                default:
                    return "Selecione o tipo acima"
            }
        };
        // ===== SPLASH SCREEN + LOGIN =====
        if (!l) {
            if (!sessionStorage.getItem('tutts_splash_done')) {
                return React.createElement(SplashScreen, {
                    onComplete: () => { sessionStorage.setItem('tutts_splash_done', 'true'); window.location.reload(); }
                });
            }
            return React.createElement("div", {
            className: "min-h-screen bg-gradient-to-br from-purple-100 to-purple-200 flex items-center justify-center p-4"
        }, i && React.createElement(Toast, i), React.createElement("div", {
            className: "bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md login-slide-up"
        }, React.createElement("div", {
            className: "text-center mb-8"
        }, React.createElement("img", {
            src: TUTTS_LOGO_URL,
            alt: "Logo Tutts",
            className: "w-28 h-28 mx-auto mb-4 rounded-xl shadow-lg object-cover"
        }), React.createElement("h1", {
            className: "text-2xl font-bold text-gray-800"
        }, "Central do Entregador Tutts"), React.createElement("p", {
            className: "text-gray-500 text-sm"
        }, "Solicita√ß√µes e Saque Emergencial")), "register" === p.view ? React.createElement("div", {
            className: "space-y-4"
        }, ue && React.createElement("div", {
            className: "bg-blue-50 border border-blue-200 rounded-lg p-3 text-center"
        }, React.createElement("p", {
            className: "text-blue-700 text-sm"
        }, "üìä Carregando lista de profissionais...")), be && React.createElement("div", {
            className: "bg-red-50 border border-red-200 rounded-lg p-3 text-center"
        }, React.createElement("p", {
            className: "text-red-700 text-sm"
        }, "‚ùå ", be), React.createElement("button", {
            onClick: Ta,
            className: "text-red-600 text-xs underline mt-1"
        }, "Tentar novamente")), React.createElement("div", null, React.createElement("label", {
            className: "block text-sm font-medium text-gray-700 mb-1"
        }, "C√≥digo Profissional"), React.createElement("input", {
            type: "text",
            placeholder: "Digite seu c√≥digo",
            value: p.cod || "",
            onChange: e => x({
                ...p,
                cod: e.target.value
            }),
            className: "w-full px-4 py-3 border rounded-lg " + (p.cod && !ue ? p.codValido ? "border-green-500 bg-green-50" : "border-red-500 bg-red-50" : "")
        }), p.cod && !ue && !p.codValido && React.createElement("p", {
            className: "text-red-600 text-sm mt-1"
        }, "‚ùå C√≥digo n√£o encontrado na base"), p.cod && p.codValido && React.createElement("p", {
            className: "text-green-600 text-sm mt-1"
        }, "‚úÖ C√≥digo v√°lido!")), React.createElement("div", null, React.createElement("label", {
            className: "block text-sm font-medium text-gray-700 mb-1"
        }, "Nome Completo"), React.createElement("input", {
            type: "text",
            placeholder: p.codValido ? "Nome carregado automaticamente" : "Digite o c√≥digo primeiro",
            value: p.name || "",
            readOnly: !0,
            className: "w-full px-4 py-3 border rounded-lg bg-gray-100 cursor-not-allowed " + (p.name ? "border-green-500 bg-green-50" : "")
        }), p.name && React.createElement("p", {
            className: "text-green-600 text-xs mt-1"
        }, "üîí Nome vinculado ao c√≥digo")), React.createElement("div", null, React.createElement("label", {
            className: "block text-sm font-medium text-gray-700 mb-1"
        }, "Senha"), React.createElement("input", {
            type: "password",
            placeholder: "Crie sua senha",
            value: p.password || "",
            onChange: e => x({
                ...p,
                password: e.target.value
            }),
            className: "w-full px-4 py-3 border rounded-lg",
            disabled: !p.codValido
        })), React.createElement("div", null, React.createElement("label", {
            className: "block text-sm font-medium text-gray-700 mb-1"
        }, "Confirmar Senha"), React.createElement("input", {
            type: "password",
            placeholder: "Digite a senha novamente",
            value: p.confirmPassword || "",
            onChange: e => x({
                ...p,
                confirmPassword: e.target.value
            }),
            className: "w-full px-4 py-3 border rounded-lg " + (p.confirmPassword ? p.password === p.confirmPassword ? "border-green-500 bg-green-50" : "border-red-500 bg-red-50" : ""),
            disabled: !p.codValido || !p.password
        }), p.confirmPassword && p.password !== p.confirmPassword && React.createElement("p", {
            className: "text-red-600 text-sm mt-1"
        }, "‚ùå As senhas n√£o coincidem"), p.confirmPassword && p.password === p.confirmPassword && React.createElement("p", {
            className: "text-green-600 text-sm mt-1"
        }, "‚úÖ Senhas conferem!")), React.createElement("button", {
            onClick: Ul,
            disabled: c || !p.codValido || !p.password || !p.confirmPassword || p.password !== p.confirmPassword,
            className: "w-full bg-purple-900 text-white py-3 rounded-lg font-semibold hover:bg-purple-800 disabled:opacity-50 disabled:cursor-not-allowed"
        }, c ? "Aguarde..." : "Criar Conta"), React.createElement("button", {
            onClick: () => x({
                view: "login"
            }),
            className: "w-full text-purple-700 text-sm"
        }, "‚Üê Voltar")) : "recuperar" === p.view ? React.createElement("div", {
            className: "space-y-4"
        }, React.createElement("div", {
            className: "bg-purple-50 border border-purple-200 rounded-lg p-6 text-center"
        }, React.createElement("p", {
            className: "text-5xl mb-4"
        }, "üîê"), React.createElement("h2", {
            className: "text-xl font-bold text-purple-800 mb-2"
        }, "Esqueceu sua senha?"), React.createElement("p", {
            className: "text-gray-600 mb-4"
        }, "Entre em contato com o suporte Tutts para obter uma nova senha."), React.createElement("div", {
            className: "bg-white rounded-lg p-4 border border-purple-300"
        }, React.createElement("p", {
            className: "text-sm text-gray-500 mb-1"
        }, "üìû Contato Suporte"), React.createElement("a", {
            href: "https://wa.me/5571989260372",
            target: "_blank",
            className: "text-2xl font-bold text-green-600 hover:text-green-700"
        }, "(71) 98926-0372"), React.createElement("p", {
            className: "text-xs text-gray-400 mt-2"
        }, "Clique para abrir o WhatsApp"))), React.createElement("button", {
            onClick: () => x({
                view: "login"
            }),
            className: "w-full bg-purple-900 text-white py-3 rounded-lg font-semibold hover:bg-purple-800"
        }, "‚Üê Voltar ao Login")) : React.createElement("div", {
            className: "space-y-4"
        }, React.createElement("input", {
            type: "text",
            placeholder: "C√≥digo Profissional",
            value: p.cod || "",
            onChange: e => x({
                ...p,
                cod: e.target.value
            }),
            className: "w-full px-4 py-3 border rounded-lg"
        }), React.createElement("input", {
            type: "password",
            placeholder: "Senha",
            value: p.password || "",
            onChange: e => x({
                ...p,
                password: e.target.value
            }),
            onKeyDown: e => "Enter" === e.key && ql(),
            className: "w-full px-4 py-3 border rounded-lg"
        }), React.createElement("button", {
            onClick: ql,
            disabled: c,
            className: "w-full bg-purple-900 text-white py-3 rounded-lg font-semibold hover:bg-purple-800 disabled:opacity-50"
        }, c ? "Entrando..." : "Entrar"), React.createElement("div", {
            className: "flex justify-between text-sm"
        }, React.createElement("button", {
            onClick: () => x({
                view: "register"
            }),
            className: "text-purple-700 hover:underline"
        }, "Criar nova conta"), React.createElement("button", {
            onClick: () => x({
                view: "recuperar"
            }),
            className: "text-gray-500 hover:underline"
        }, "Esqueci minha senha")))));
        }
        if ("user" === l.role) {
            // Se est√° no m√≥dulo de Filas, renderizar o m√≥dulo
            if ("filas" === Ee) {
                return React.createElement("div", {
                    className: "min-h-screen bg-gray-50"
                }, 
                    i && React.createElement(Toast, i),
                    n && React.createElement(LoadingOverlay, null),
                    // Header simples
                    React.createElement("div", { className: "bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-4 flex items-center gap-4" },
                        React.createElement("button", { 
                            onClick: () => he("home"), 
                            className: "p-2 bg-white/20 rounded-lg hover:bg-white/30" 
                        }, "‚Üê Voltar"),
                        React.createElement("h1", { className: "text-xl font-bold" }, "üë• Fila de Entregas")
                    ),
                    // Conte√∫do
                    React.createElement("div", { className: "p-4" },
                        typeof window.ModuloFilas !== 'undefined' 
                            ? React.createElement(window.ModuloFilas, {
                                usuario: l,
                                apiUrl: API_URL,
                                showToast: ja,
                                abaAtiva: "monitoramento",
                                onChangeTab: () => {}
                            })
                            : React.createElement("div", { className: "text-center py-12" },
                                React.createElement("p", { className: "text-red-500" }, "‚ö†Ô∏è M√≥dulo n√£o carregado")
                            )
                    )
                );
            }
            return React.createElement("div", {
            className: "min-h-screen bg-gray-50"
        }, i && React.createElement(Toast, i), n && React.createElement(LoadingOverlay, null), 
        // Modal de Relat√≥rio N√£o Lido (ci√™ncia) - GLOBAL para usu√°rios
        relatorioNaoLido && React.createElement("div", {
            className: "fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4",
            style: { zIndex: 9999 }
        },
            React.createElement("div", {className: "bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-screen overflow-hidden flex flex-col"},
                // Header
                React.createElement("div", {className: "bg-gradient-to-r from-teal-600 to-teal-700 text-white p-4 flex items-center gap-3"},
                    React.createElement("span", {className: "text-3xl"}, "üì¢"),
                    React.createElement("div", null,
                        React.createElement("h3", {className: "text-lg font-bold"}, "Novo Relat√≥rio Di√°rio"),
                        React.createElement("p", {className: "text-teal-100 text-sm"}, 
                            relatoriosNaoLidos.length > 1 
                                ? relatoriosNaoLidos.length + " relat√≥rios pendentes de leitura"
                                : "1 relat√≥rio pendente de leitura"
                        )
                    )
                ),
                // Info do autor
                React.createElement("div", {className: "p-4 bg-gray-50 border-b flex items-center gap-3"},
                    relatorioNaoLido.usuario_foto 
                        ? React.createElement("img", {
                            src: relatorioNaoLido.usuario_foto,
                            className: "w-12 h-12 rounded-full object-cover border-2 border-teal-200"
                        })
                        : React.createElement("div", {
                            className: "w-12 h-12 rounded-full bg-teal-100 flex items-center justify-center text-teal-600 font-bold text-lg"
                        }, (relatorioNaoLido.usuario_nome || "?").charAt(0).toUpperCase()),
                    React.createElement("div", null,
                        React.createElement("p", {className: "font-bold text-gray-800"}, relatorioNaoLido.titulo),
                        React.createElement("p", {className: "text-sm text-gray-500"}, 
                            relatorioNaoLido.usuario_nome, " ‚Ä¢ ", 
                            new Date(relatorioNaoLido.created_at).toLocaleDateString('pt-BR', {
                                day: '2-digit', month: '2-digit', year: 'numeric',
                                hour: '2-digit', minute: '2-digit'
                            })
                        )
                    )
                ),
                // Conte√∫do
                React.createElement("div", {className: "p-4 overflow-y-auto", style: { maxHeight: '50vh' }},
                    React.createElement("div", {
                        className: "text-gray-700 whitespace-pre-wrap"
                    }, relatorioNaoLido.conteudo || ''),
                    relatorioNaoLido.imagem_url && React.createElement("div", {className: "mt-4"},
                        React.createElement("img", {
                            src: relatorioNaoLido.imagem_url,
                            className: "max-w-full rounded-lg shadow cursor-pointer hover:opacity-90",
                            onClick: () => setRelatorioImagemAmpliada(relatorioNaoLido.imagem_url)
                        })
                    )
                ),
                // Footer com bot√£o de ci√™ncia
                React.createElement("div", {className: "p-4 bg-gray-50 border-t"},
                    React.createElement("button", {
                        onClick: () => marcarRelatorioComoLido(relatorioNaoLido.id),
                        className: "w-full px-6 py-4 bg-teal-600 text-white rounded-xl font-bold text-lg hover:bg-teal-700 flex items-center justify-center gap-2 shadow-lg"
                    }, "‚úÖ Estou Ciente")
                )
            )
        ),
        // Modal de imagem ampliada (relat√≥rio)
        relatorioImagemAmpliada && React.createElement("div", {
            className: "fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-4",
            style: { zIndex: 10000 },
            onClick: () => setRelatorioImagemAmpliada(null)
        },
            React.createElement("div", {className: "relative max-w-4xl"},
                React.createElement("button", {
                    onClick: () => setRelatorioImagemAmpliada(null),
                    className: "absolute -top-10 right-0 text-white text-3xl hover:text-gray-300"
                }, "‚úï"),
                React.createElement("img", {
                    src: relatorioImagemAmpliada,
                    className: "max-w-full max-h-screen rounded-lg shadow-2xl",
                    style: { maxHeight: '85vh' },
                    onClick: (e) => e.stopPropagation()
                })
            )
        ),
        // Modal do Editor de Foto de Perfil
        photoEditorOpen && React.createElement("div", {
            className: "fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-4",
            style: { zIndex: 10001 },
            onClick: () => setPhotoEditorOpen(false)
        },
            React.createElement("div", {
                className: "bg-white rounded-3xl shadow-2xl w-full max-w-md p-6",
                onClick: (e) => e.stopPropagation()
            },
                React.createElement("h3", {className: "text-xl font-bold text-gray-800 mb-4 text-center"}, "‚úÇÔ∏è Ajustar Foto de Perfil"),
                React.createElement("p", {className: "text-sm text-gray-500 mb-4 text-center"}, "Arraste para posicionar e use o zoom para ajustar"),
                
                // √Årea de preview circular
                React.createElement("div", {
                    className: "relative mx-auto mb-4",
                    style: {
                        width: '256px',
                        height: '256px',
                        overflow: 'hidden',
                        borderRadius: '50%',
                        border: '4px solid #7c3aed',
                        cursor: photoEditorDragging ? 'grabbing' : 'grab',
                        touchAction: 'none'
                    },
                    onMouseDown: handlePhotoEditorMouseDown,
                    onMouseMove: handlePhotoEditorMouseMove,
                    onMouseUp: handlePhotoEditorMouseUp,
                    onMouseLeave: handlePhotoEditorMouseUp,
                    onTouchStart: handlePhotoEditorMouseDown,
                    onTouchMove: handlePhotoEditorMouseMove,
                    onTouchEnd: handlePhotoEditorMouseUp
                },
                    React.createElement("img", {
                        src: photoEditorSrc,
                        style: {
                            position: 'absolute',
                            left: '50%',
                            top: '50%',
                            transform: `translate(calc(-50% + ${photoEditorPosition.x}px), calc(-50% + ${photoEditorPosition.y}px)) scale(${photoEditorZoom})`,
                            minWidth: '100%',
                            minHeight: '100%',
                            objectFit: 'cover',
                            pointerEvents: 'none',
                            userSelect: 'none'
                        },
                        draggable: false
                    })
                ),
                
                // Controle de Zoom
                React.createElement("div", {className: "mb-6"},
                    React.createElement("label", {className: "block text-sm font-semibold text-gray-700 mb-2 text-center"}, 
                        "üîç Zoom: ", Math.round(photoEditorZoom * 100), "%"
                    ),
                    React.createElement("input", {
                        type: "range",
                        min: "1",
                        max: "3",
                        step: "0.1",
                        value: photoEditorZoom,
                        onChange: e => {
                            const newZoom = parseFloat(e.target.value);
                            setPhotoEditorZoom(newZoom);
                            // Ajustar posi√ß√£o ao diminuir zoom para n√£o sair dos limites
                            const maxMove = 128 * (newZoom - 1);
                            setPhotoEditorPosition({
                                x: Math.max(-maxMove, Math.min(maxMove, photoEditorPosition.x)),
                                y: Math.max(-maxMove, Math.min(maxMove, photoEditorPosition.y))
                            });
                        },
                        className: "w-full h-2 bg-purple-200 rounded-lg appearance-none cursor-pointer accent-purple-600"
                    })
                ),
                
                // Bot√µes
                React.createElement("div", {className: "flex gap-3"},
                    React.createElement("button", {
                        onClick: () => setPhotoEditorOpen(false),
                        className: "flex-1 py-3 border-2 border-gray-300 text-gray-700 rounded-xl font-semibold hover:bg-gray-50"
                    }, "Cancelar"),
                    React.createElement("button", {
                        onClick: handlePhotoEditorSave,
                        className: "flex-1 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl font-semibold hover:opacity-90"
                    }, "‚úÖ Aplicar")
                )
            )
        ),
        u && React.createElement(ImageModal, {
            imageUrl: u,
            onClose: () => g(null)
        }), 
        // Tutorial do Usu√°rio - Renderiza√ß√£o Direta
        tutorialAtivo && React.createElement("div", {
            className: "fixed inset-0 z-[100] flex items-center justify-center p-4",
            style: { backgroundColor: "rgba(0,0,0,0.85)" },
            onClick: () => { setTutorialAtivo(false); setTutorialPasso(0); localStorage.setItem('tutts_tutorial_visto_' + l?.codProfissional, 'true'); }
        },
            React.createElement("div", {
                className: "bg-white rounded-3xl shadow-2xl w-full max-w-lg overflow-hidden",
                onClick: (e) => e.stopPropagation()
            },
                // Header
                React.createElement("div", {
                    className: "bg-gradient-to-r from-purple-600 via-purple-700 to-indigo-700 p-6 text-white relative overflow-hidden"
                },
                    React.createElement("div", {className: "absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2"}),
                    React.createElement("div", {className: "absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full translate-y-1/2 -translate-x-1/2"}),
                    React.createElement("div", {className: "relative"},
                        React.createElement("div", {className: "flex items-center justify-between mb-2"},
                            React.createElement("span", {className: "text-sm bg-white/20 px-3 py-1 rounded-full"}, 
                                "Passo ", tutorialPasso + 1, " de ", TUTORIAL_PASSOS.length
                            ),
                            React.createElement("button", {
                                onClick: () => { setTutorialAtivo(false); setTutorialPasso(0); localStorage.setItem('tutts_tutorial_visto_' + l?.codProfissional, 'true'); },
                                className: "text-white/70 hover:text-white text-sm hover:bg-white/10 px-3 py-1 rounded transition-all"
                            }, "‚úï Pular")
                        ),
                        React.createElement("div", {className: "text-5xl mb-3"}, TUTORIAL_PASSOS[tutorialPasso]?.icone),
                        React.createElement("h2", {className: "text-2xl font-bold"}, TUTORIAL_PASSOS[tutorialPasso]?.titulo)
                    )
                ),
                // Barra de progresso
                React.createElement("div", {className: "h-1 bg-gray-200"},
                    React.createElement("div", {
                        className: "h-full bg-gradient-to-r from-purple-500 to-indigo-500 transition-all duration-500",
                        style: { width: (((tutorialPasso + 1) / TUTORIAL_PASSOS.length) * 100) + "%" }
                    })
                ),
                // Conte√∫do
                React.createElement("div", {className: "p-6"},
                    React.createElement("p", {className: "text-gray-600 text-lg leading-relaxed"}, TUTORIAL_PASSOS[tutorialPasso]?.descricao),
                    React.createElement("div", {className: "flex justify-center gap-2 mt-6"},
                        TUTORIAL_PASSOS.map((_, idx) => 
                            React.createElement("div", {
                                key: idx,
                                className: "w-2 h-2 rounded-full transition-all " + (idx === tutorialPasso ? "bg-purple-600 w-6" : idx < tutorialPasso ? "bg-purple-300" : "bg-gray-300")
                            })
                        )
                    )
                ),
                // Bot√µes
                React.createElement("div", {className: "flex gap-3 p-6 pt-0"},
                    tutorialPasso > 0 && React.createElement("button", {
                        onClick: () => setTutorialPasso(tutorialPasso - 1),
                        className: "flex-1 px-6 py-3 border-2 border-purple-200 text-purple-700 rounded-xl font-semibold hover:bg-purple-50"
                    }, "‚Üê Anterior"),
                    React.createElement("button", {
                        onClick: () => {
                            if (tutorialPasso < TUTORIAL_PASSOS.length - 1) {
                                setTutorialPasso(tutorialPasso + 1);
                            } else {
                                setTutorialAtivo(false);
                                setTutorialPasso(0);
                                localStorage.setItem('tutts_tutorial_visto_' + l?.codProfissional, 'true');
                            }
                        },
                        className: "flex-1 px-6 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-xl font-semibold hover:from-purple-700 hover:to-indigo-700 shadow-lg"
                    }, tutorialPasso === TUTORIAL_PASSOS.length - 1 ? "Come√ßar! üöÄ" : "Pr√≥ximo ‚Üí")
                )
            )
        ),
        // Modal de Aviso
        avisoAtual && React.createElement("div", {
            className: "fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-2 md:p-4"
        }, React.createElement("div", {
            className: "bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[95vh] overflow-hidden flex flex-col"
        }, 
            React.createElement("div", {
                className: "bg-gradient-to-r from-teal-600 to-teal-700 p-6 text-white flex-shrink-0"
            }, React.createElement("h2", {className: "text-2xl md:text-3xl font-bold flex items-center gap-3"}, "üì¢ ", avisoAtual.titulo)),
            avisoAtual.imagem_url && React.createElement("div", {
                className: "flex-1 flex items-center justify-center bg-gray-100 p-4 overflow-auto"
            }, React.createElement("img", {
                src: avisoAtual.imagem_url,
                className: "max-w-full max-h-[60vh] object-contain rounded-lg shadow-lg"
            })),
            React.createElement("div", {className: "p-6 text-center flex-shrink-0 bg-gray-50"},
                React.createElement("button", {
                    onClick: fecharAviso,
                    className: "w-full max-w-md mx-auto px-8 py-4 bg-teal-600 text-white rounded-xl font-bold text-lg hover:bg-teal-700 shadow-lg hover:shadow-xl transition-all"
                }, "‚úÖ Entendi")
            )
        )),
        // Modal de notifica√ß√£o de tarefas pendentes
        todoNotifModal && todoPendentesNotif.length > 0 && React.createElement("div", {
            className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
        }, React.createElement("div", {
            className: "bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden"
        }, React.createElement("div", {
            className: "bg-gradient-to-r from-orange-500 to-red-500 p-4 text-white"
        }, React.createElement("h2", {className: "text-xl font-bold flex items-center gap-2"}, "‚ö†Ô∏è Aten√ß√£o!"),
            React.createElement("p", {className: "text-orange-100 text-sm"}, "Voc√™ possui tarefas pendentes")
        ), React.createElement("div", {className: "p-4 max-h-60 overflow-y-auto"},
            React.createElement("p", {className: "text-gray-600 mb-3"}, "üìã ", todoPendentesNotif.length, " tarefa(s) precisam da sua aten√ß√£o:"),
            React.createElement("div", {className: "space-y-2"},
                todoPendentesNotif.slice(0, 5).map(t => React.createElement("div", {
                    key: t.id,
                    className: "bg-orange-50 border-l-4 border-orange-500 p-3 rounded"
                }, React.createElement("p", {className: "font-semibold text-gray-800"}, t.titulo),
                    t.data_prazo && React.createElement("p", {className: "text-xs text-orange-600"}, "üìÖ Vence: ", new Date(t.data_prazo).toLocaleDateString("pt-BR"))
                ))
            ),
            todoPendentesNotif.length > 5 && React.createElement("p", {className: "text-sm text-gray-500 mt-2"}, "... e mais ", todoPendentesNotif.length - 5, " tarefa(s)")
        ), React.createElement("div", {className: "flex gap-3 p-4 border-t"},
            React.createElement("button", {
                onClick: () => setTodoNotifModal(false),
                className: "flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300"
            }, "Fechar"),
            React.createElement("button", {
                onClick: () => { setTodoNotifModal(false); he("todo"); },
                className: "flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700"
            }, "üìã Ir para Tarefas")
        ))),
        React.createElement("nav", {
            className: "bg-gradient-to-r from-purple-800 to-purple-900 shadow-lg"
        }, React.createElement("div", {
            className: "max-w-7xl mx-auto px-4 py-4 flex justify-between items-center"
        }, React.createElement("div", {className: "flex items-center gap-3"}, 
            // Foto de perfil
            socialProfile?.profile_photo ? React.createElement("img", {
                src: socialProfile.profile_photo,
                className: "w-10 h-10 rounded-full object-cover border-2 border-white/50"
            }) : React.createElement("div", {
                className: "w-10 h-10 rounded-full bg-purple-600 flex items-center justify-center text-white font-bold border-2 border-white/50"
            }, l.fullName?.charAt(0)?.toUpperCase() || "?"),
            React.createElement("div", null, React.createElement("h1", {
            className: "text-xl font-bold text-white"
        }, "Central do Entregador Tutts"), React.createElement("p", {
            className: "text-sm text-purple-200"
        }, socialProfile?.display_name || l.fullName))), React.createElement("div", {
            className: "flex gap-2"
        }, p.userTab && React.createElement("button", {
            onClick: () => x({
                ...p,
                userTab: null
            }),
            className: "px-4 py-2 bg-white/20 text-white rounded-lg hover:bg-white/30 text-sm font-semibold"
        }, "üè† Menu"), React.createElement("button", {
            onClick: iniciarTutorial,
            className: "px-4 py-2 bg-white/20 text-white rounded-lg hover:bg-white/30 text-sm font-semibold",
            title: "Ver tutorial"
        }, "‚ùì"), React.createElement("button", {
            onClick: ul,
            className: "px-4 py-2 bg-white/20 text-white rounded-lg hover:bg-white/30 text-sm font-semibold"
        }, "üîÑ"), React.createElement("button", {
            onClick: () => o(null),
            className: "px-4 py-2 bg-white/10 text-white hover:bg-white/20 rounded-lg"
        }, "Sair")))), !p.userTab && React.createElement("div", {
            className: "max-w-2xl mx-auto p-6"
        }, 
        // ========== BOT√ÉO CONHE√áA A TUTTS ==========
        React.createElement("button", {
            onClick: () => setSobreTuttsAberto(true),
            className: "w-full mb-6 rounded-2xl p-5 flex items-center gap-4 shadow-lg hover:shadow-xl transition-all hover:scale-[1.02] group",
            style: { background: "linear-gradient(135deg, #550976 0%, #6b1190 50%, #550976 100%)" }
        },
            React.createElement("div", {
                className: "w-14 h-14 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform",
                style: { backgroundColor: "#f37601" }
            }, React.createElement("span", {className: "text-3xl"}, "üöÄ")),
            React.createElement("div", {className: "text-left flex-1"},
                React.createElement("h3", {className: "text-lg font-bold text-white"}, "Conhe√ßa como funciona a Tutts"),
                React.createElement("p", {className: "text-sm", style: { color: "rgba(255,255,255,0.7)" }}, "Tudo sobre modalidades, taxas, incentivos e mais")
            ),
            React.createElement("span", {className: "text-2xl group-hover:translate-x-1 transition-transform", style: { color: "#f37601" }}, "‚Ä∫")
        ),
        
        // ========== MODAL LANDING PAGE COM ANIMA√á√ïES ==========
        sobreTuttsAberto && React.createElement("div", {
            className: "fixed inset-0 z-[100] overflow-y-auto",
            style: { background: "linear-gradient(180deg, #550976 0%, #3d0656 50%, #2a0340 100%)" }
        },
            // CSS para anima√ß√µes
            React.createElement("style", null, `
                @keyframes fadeInUp {
                    from { opacity: 0; transform: translateY(40px); }
                    to { opacity: 1; transform: translateY(0); }
                }
                @keyframes fadeInLeft {
                    from { opacity: 0; transform: translateX(-40px); }
                    to { opacity: 1; transform: translateX(0); }
                }
                @keyframes fadeInRight {
                    from { opacity: 0; transform: translateX(40px); }
                    to { opacity: 1; transform: translateX(0); }
                }
                @keyframes scaleIn {
                    from { opacity: 0; transform: scale(0.8); }
                    to { opacity: 1; transform: scale(1); }
                }
                @keyframes float {
                    0%, 100% { transform: translateY(0px); }
                    50% { transform: translateY(-10px); }
                }
                @keyframes pulse {
                    0%, 100% { transform: scale(1); }
                    50% { transform: scale(1.05); }
                }
                .animate-fadeInUp { animation: fadeInUp 0.6s ease-out forwards; }
                .animate-fadeInLeft { animation: fadeInLeft 0.6s ease-out forwards; }
                .animate-fadeInRight { animation: fadeInRight 0.6s ease-out forwards; }
                .animate-scaleIn { animation: scaleIn 0.5s ease-out forwards; }
                .animate-float { animation: float 3s ease-in-out infinite; }
                .animate-pulse-slow { animation: pulse 2s ease-in-out infinite; }
                .delay-100 { animation-delay: 0.1s; }
                .delay-200 { animation-delay: 0.2s; }
                .delay-300 { animation-delay: 0.3s; }
                .delay-400 { animation-delay: 0.4s; }
                .delay-500 { animation-delay: 0.5s; }
            `),
            
            // Header fixo
            React.createElement("div", {
                className: "sticky top-0 z-10 backdrop-blur-lg border-b border-white/10",
                style: { backgroundColor: "rgba(85, 9, 118, 0.95)" }
            },
                React.createElement("div", {className: "max-w-4xl mx-auto px-4 py-4 flex items-center justify-between"},
                    React.createElement("div", {className: "flex items-center gap-3"},
                        React.createElement("span", {className: "text-3xl animate-float"}, "üöÄ"),
                        React.createElement("h1", {className: "text-xl font-bold text-white"}, "Conhe√ßa a Tutts")
                    ),
                    React.createElement("button", {
                        onClick: () => setSobreTuttsAberto(false),
                        className: "w-10 h-10 rounded-full flex items-center justify-center text-white transition-all hover:scale-110 hover:rotate-90",
                        style: { backgroundColor: "#f37601" }
                    }, "‚úï")
                )
            ),
            
            // Conte√∫do da Landing Page
            React.createElement("div", {className: "max-w-4xl mx-auto px-4 py-8"},
                
                // Hero Section
                React.createElement("div", {className: "text-center mb-12 animate-fadeInUp"},
                    React.createElement("div", {
                        className: "w-24 h-24 rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-2xl animate-pulse-slow",
                        style: { backgroundColor: "#f37601" }
                    }, React.createElement("span", {className: "text-5xl"}, "üèçÔ∏è")),
                    React.createElement("h1", {className: "text-3xl md:text-4xl font-bold text-white mb-4"}, 
                        "Bem-vindo √† ", 
                        React.createElement("span", {style: { color: "#f37601" }}, "Tutts")
                    ),
                    React.createElement("p", {className: "text-lg max-w-2xl mx-auto leading-relaxed", style: { color: "rgba(255,255,255,0.8)" }},
                        "Atue de forma aut√¥noma, com flexibilidade e oportunidades reais de ganho, em um modelo pensado especialmente para o segmento de pe√ßas automotivas."
                    )
                ),
                
                // Se√ß√£o 1: Modelo de Trabalho
                React.createElement("div", {className: "mb-10 animate-fadeInUp", style: { animationDelay: "0.1s", opacity: 0, animationFillMode: "forwards" }},
                    React.createElement("div", {className: "flex items-center gap-3 mb-6"},
                        React.createElement("div", {
                            className: "w-10 h-10 rounded-xl flex items-center justify-center animate-pulse-slow",
                            style: { backgroundColor: "#f37601" }
                        },
                            React.createElement("span", {className: "text-xl"}, "üíº")
                        ),
                        React.createElement("h2", {className: "text-2xl font-bold text-white"}, "Modelo de Trabalho")
                    ),
                    React.createElement("p", {className: "mb-6", style: { color: "rgba(255,255,255,0.7)" }}, "Na Tutts, voc√™ pode rodar em duas modalidades:"),
                    React.createElement("div", {className: "grid md:grid-cols-2 gap-4"},
                        // Card Nuvem
                        React.createElement("div", {
                            className: "rounded-2xl p-6 border transition-all hover:scale-105 hover:shadow-2xl animate-fadeInLeft",
                            style: { backgroundColor: "rgba(255,255,255,0.1)", borderColor: "rgba(243,118,1,0.3)", animationDelay: "0.2s", opacity: 0, animationFillMode: "forwards" }
                        },
                            React.createElement("div", {className: "flex items-center gap-3 mb-4"},
                                React.createElement("div", {
                                    className: "w-12 h-12 rounded-xl flex items-center justify-center shadow-lg animate-float",
                                    style: { background: "linear-gradient(135deg, #3b82f6, #06b6d4)" }
                                },
                                    React.createElement("span", {className: "text-2xl"}, "‚òÅÔ∏è")
                                ),
                                React.createElement("h3", {className: "text-xl font-bold text-white"}, "Modalidade Nuvem")
                            ),
                            React.createElement("p", {className: "leading-relaxed", style: { color: "rgba(255,255,255,0.8)" }},
                                "Voc√™ permanece online no aplicativo e recebe pedidos eventuais, que aparecem diretamente na sua tela. ",
                                React.createElement("span", {className: "font-semibold", style: { color: "#f37601" }}, "Ideal para quem busca flexibilidade"),
                                " e quer rodar conforme a disponibilidade."
                            )
                        ),
                        // Card Dedicada
                        React.createElement("div", {
                            className: "rounded-2xl p-6 border transition-all hover:scale-105 hover:shadow-2xl animate-fadeInRight",
                            style: { backgroundColor: "rgba(255,255,255,0.1)", borderColor: "rgba(243,118,1,0.3)", animationDelay: "0.3s", opacity: 0, animationFillMode: "forwards" }
                        },
                            React.createElement("div", {className: "flex items-center gap-3 mb-4"},
                                React.createElement("div", {
                                    className: "w-12 h-12 rounded-xl flex items-center justify-center shadow-lg animate-float",
                                    style: { backgroundColor: "#f37601", animationDelay: "0.5s" }
                                },
                                    React.createElement("span", {className: "text-2xl"}, "üè™")
                                ),
                                React.createElement("h3", {className: "text-xl font-bold text-white"}, "Modalidade Dedicada")
                            ),
                            React.createElement("p", {className: "leading-relaxed", style: { color: "rgba(255,255,255,0.8)" }},
                                "A demanda √© direcionada para voc√™ durante o hor√°rio de atendimento da loja parceira. ",
                                React.createElement("span", {className: "font-semibold", style: { color: "#f37601" }}, "Opera√ß√£o mais previs√≠vel"),
                                ", com fluxo constante de entregas."
                            )
                        )
                    )
                ),
                
                // Se√ß√£o 2: Necessidade de Ba√∫
                React.createElement("div", {className: "mb-10 animate-fadeInUp", style: { animationDelay: "0.2s", opacity: 0, animationFillMode: "forwards" }},
                    React.createElement("div", {className: "flex items-center gap-3 mb-6"},
                        React.createElement("div", {
                            className: "w-10 h-10 rounded-xl flex items-center justify-center",
                            style: { backgroundColor: "#f37601" }
                        },
                            React.createElement("span", {className: "text-xl"}, "üì¶")
                        ),
                        React.createElement("h2", {className: "text-2xl font-bold text-white"}, "Necessidade de Ba√∫")
                    ),
                    React.createElement("div", {
                        className: "rounded-2xl p-6 border",
                        style: { backgroundColor: "rgba(243,118,1,0.15)", borderColor: "rgba(243,118,1,0.4)" }
                    },
                        // Imagem da moto com ba√∫ - LAZY LOADING
                        React.createElement("div", {className: "flex justify-center mb-6 animate-scaleIn", style: { animationDelay: "0.3s", opacity: 0, animationFillMode: "forwards" }},
                            React.createElement("img", {
                                src: "https://github.com/Leonardodevcloud/tutts-frontend/blob/main/Layer%200%20copy%20(1).png?raw=true",
                                alt: "Moto com ba√∫",
                                loading: "lazy",
                                decoding: "async",
                                className: "max-w-full h-auto max-h-52 object-contain rounded-xl shadow-2xl hover:scale-105 transition-transform"
                            })
                        ),
                        React.createElement("p", {className: "text-lg mb-6", style: { color: "rgba(255,255,255,0.9)" }},
                            "Como o foco √© o transporte de pe√ßas automotivas, ",
                            React.createElement("span", {className: "font-bold", style: { color: "#ff6b6b" }}, "n√£o √© permitido o uso de bags"),
                            ". √â ",
                            React.createElement("span", {className: "font-bold", style: { color: "#51cf66" }}, "obrigat√≥rio o uso de ba√∫ ou caixote"),
                            "."
                        ),
                        React.createElement("p", {className: "mb-4", style: { color: "rgba(255,255,255,0.7)" }}, "Essa exig√™ncia garante:"),
                        React.createElement("div", {className: "grid grid-cols-2 md:grid-cols-4 gap-3"},
                            [
                                {icon: "üõ°Ô∏è", text: "Maior seguran√ßa"},
                                {icon: "üì¶", text: "Mais volume"},
                                {icon: "üöÄ", text: "Mais entregas"},
                                {icon: "üí∞", text: "Mais ganhos"}
                            ].map((item, idx) => 
                                React.createElement("div", {
                                    key: idx,
                                    className: "rounded-xl p-4 text-center transition-all hover:scale-110 animate-fadeInUp",
                                    style: { backgroundColor: "rgba(85,9,118,0.5)", animationDelay: (0.4 + idx * 0.1) + "s", opacity: 0, animationFillMode: "forwards" }
                                },
                                    React.createElement("span", {className: "text-3xl block mb-2 animate-float", style: { animationDelay: idx * 0.2 + "s" }}, item.icon),
                                    React.createElement("span", {className: "text-white text-sm font-medium"}, item.text)
                                )
                            )
                        )
                    )
                ),
                
                // Se√ß√£o 3: Taxas Administrativas
                React.createElement("div", {className: "mb-10 animate-fadeInUp", style: { animationDelay: "0.3s", opacity: 0, animationFillMode: "forwards" }},
                    React.createElement("div", {className: "flex items-center gap-3 mb-6"},
                        React.createElement("div", {
                            className: "w-10 h-10 rounded-xl flex items-center justify-center animate-pulse-slow",
                            style: { backgroundColor: "#22c55e" }
                        },
                            React.createElement("span", {className: "text-xl"}, "üí∞")
                        ),
                        React.createElement("h2", {className: "text-2xl font-bold text-white"}, "Taxas Administrativas")
                    ),
                    React.createElement("div", {
                        className: "rounded-2xl p-6 border",
                        style: { backgroundColor: "rgba(34,197,94,0.15)", borderColor: "rgba(34,197,94,0.4)" }
                    },
                        React.createElement("p", {className: "text-lg mb-6", style: { color: "rgba(255,255,255,0.9)" }},
                            "Com a Tutts, seu dinheiro fica na palma da m√£o. Solicite o saque em ",
                            React.createElement("span", {className: "font-bold text-2xl", style: { color: "#f37601" }}, "at√© 1 hora"),
                            "!"
                        ),
                        React.createElement("div", {className: "grid md:grid-cols-2 gap-4 mb-6"},
                            React.createElement("div", {
                                className: "rounded-xl p-5",
                                style: { backgroundColor: "rgba(255,255,255,0.1)" }
                            },
                                React.createElement("div", {className: "flex items-center gap-3 mb-2"},
                                    React.createElement("span", {className: "text-2xl"}, "‚úÖ"),
                                    React.createElement("span", {className: "text-white font-bold"}, "Saque Emergencial")
                                ),
                                React.createElement("p", {style: { color: "rgba(255,255,255,0.8)" }}, "Libera√ß√£o de 100% do saldo dispon√≠vel")
                            ),
                            React.createElement("div", {
                                className: "rounded-xl p-5",
                                style: { backgroundColor: "rgba(255,255,255,0.1)" }
                            },
                                React.createElement("div", {className: "flex items-center gap-3 mb-2"},
                                    React.createElement("span", {className: "text-2xl"}, "üìä"),
                                    React.createElement("span", {className: "text-white font-bold"}, "Taxa Administrativa")
                                ),
                                React.createElement("p", {style: { color: "rgba(255,255,255,0.8)" }}, "Apenas ", React.createElement("span", {className: "font-bold text-xl", style: { color: "#f37601" }}, "4,5%"), " sobre o valor")
                            )
                        ),
                        React.createElement("div", {
                            className: "rounded-xl p-5 border",
                            style: { backgroundColor: "rgba(85,9,118,0.4)", borderColor: "rgba(243,118,1,0.3)" }
                        },
                            React.createElement("p", {className: "text-white flex items-start gap-3"},
                                React.createElement("span", {className: "text-2xl"}, "üéâ"),
                                React.createElement("span", null,
                                    "A Tutts frequentemente disponibiliza ",
                                    React.createElement("span", {className: "font-bold", style: { color: "#f37601" }}, "promo√ß√µes com isen√ß√£o dessa taxa"),
                                    ", aumentando ainda mais sua rentabilidade!"
                                )
                            )
                        )
                    )
                ),
                
                // Se√ß√£o 4: Canhotos
                React.createElement("div", {className: "mb-10 animate-fadeInUp", style: { animationDelay: "0.4s", opacity: 0, animationFillMode: "forwards" }},
                    React.createElement("div", {className: "flex items-center gap-3 mb-6"},
                        React.createElement("div", {
                            className: "w-10 h-10 rounded-xl flex items-center justify-center animate-pulse-slow",
                            style: { backgroundColor: "#550976" }
                        },
                            React.createElement("span", {className: "text-xl"}, "üìù")
                        ),
                        React.createElement("h2", {className: "text-2xl font-bold text-white"}, "Uso de Canhotos")
                    ),
                    React.createElement("div", {
                        className: "rounded-2xl p-6 border",
                        style: { backgroundColor: "rgba(85,9,118,0.3)", borderColor: "rgba(243,118,1,0.3)" }
                    },
                        React.createElement("p", {className: "text-lg mb-6", style: { color: "rgba(255,255,255,0.9)" }},
                            "√â ",
                            React.createElement("span", {className: "font-bold", style: { color: "#f37601" }}, "obrigat√≥rio o preenchimento do canhoto"),
                            " da nota fiscal pelo cliente."
                        ),
                        React.createElement("div", {className: "space-y-3 mb-6"},
                            [
                                {icon: "‚úçÔ∏è", text: "Canhoto leg√≠vel e sem rasuras"},
                                {icon: "üè™", text: "Devolver √† loja parceira"},
                                {icon: "üì∏", text: "Registrar foto no aplicativo"}
                            ].map((item, idx) => 
                                React.createElement("div", {
                                    key: idx,
                                    className: "rounded-xl p-4 flex items-center gap-4",
                                    style: { backgroundColor: "rgba(255,255,255,0.1)" }
                                },
                                    React.createElement("span", {className: "text-2xl"}, item.icon),
                                    React.createElement("span", {className: "text-white font-medium"}, item.text)
                                )
                            )
                        ),
                        React.createElement("div", {
                            className: "rounded-xl p-4 border",
                            style: { backgroundColor: "rgba(239,68,68,0.2)", borderColor: "rgba(239,68,68,0.4)" }
                        },
                            React.createElement("p", {className: "font-semibold flex items-center gap-2", style: { color: "#fca5a5" }},
                                React.createElement("span", {className: "text-xl"}, "‚ö†Ô∏è"),
                                "Somente com essas etapas a entrega ser√° validada!"
                            )
                        )
                    )
                ),
                
                // Se√ß√£o 5: Incentivos
                React.createElement("div", {className: "mb-10 animate-fadeInUp", style: { animationDelay: "0.5s", opacity: 0, animationFillMode: "forwards" }},
                    React.createElement("div", {className: "flex items-center gap-3 mb-6"},
                        React.createElement("div", {
                            className: "w-10 h-10 rounded-xl flex items-center justify-center animate-pulse-slow",
                            style: { backgroundColor: "#f37601" }
                        },
                            React.createElement("span", {className: "text-xl"}, "üéØ")
                        ),
                        React.createElement("h2", {className: "text-2xl font-bold text-white"}, "Sistema de Incentivos")
                    ),
                    React.createElement("div", {
                        className: "rounded-2xl p-6 border",
                        style: { backgroundColor: "rgba(243,118,1,0.15)", borderColor: "rgba(243,118,1,0.4)" }
                    },
                        React.createElement("p", {className: "text-lg mb-6", style: { color: "rgba(255,255,255,0.9)" }},
                            "A Tutts conta com um sistema de ",
                            React.createElement("span", {className: "font-bold", style: { color: "#f37601" }}, "incentivos progressivos"),
                            ", liberado conforme voc√™ avan√ßa e se mant√©m ativo."
                        ),
                        React.createElement("div", {
                            className: "rounded-xl p-5 border mb-6",
                            style: { backgroundColor: "rgba(85,9,118,0.4)", borderColor: "rgba(243,118,1,0.3)" }
                        },
                            React.createElement("p", {className: "font-semibold mb-4 flex items-center gap-2", style: { color: "#f37601" }},
                                React.createElement("span", {className: "text-xl"}, "üì¢"),
                                "Fique atento:"
                            ),
                            React.createElement("div", {className: "flex flex-wrap gap-3"},
                                ["Grupos oficiais", "Status", "Avisos na Central"].map((item, idx) => 
                                    React.createElement("span", {
                                        key: idx,
                                        className: "px-4 py-2 rounded-full text-white font-medium",
                                        style: { backgroundColor: "rgba(255,255,255,0.15)" }
                                    }, item)
                                )
                            )
                        ),
                        React.createElement("div", {
                            className: "rounded-xl p-6 text-center",
                            style: { background: "linear-gradient(135deg, #f37601 0%, #ff9f43 100%)" }
                        },
                            React.createElement("p", {className: "text-white text-xl font-bold mb-2"},
                                "üöÄ Promo√ß√µes e incentivos para impulsionar seus ganhos!"
                            ),
                            React.createElement("p", {style: { color: "rgba(255,255,255,0.9)" }},
                                "Acompanhe de perto e aproveite cada oportunidade."
                            )
                        )
                    )
                ),
                
                // Bot√£o Fechar
                React.createElement("div", {className: "text-center pt-6 pb-10"},
                    React.createElement("button", {
                        onClick: () => setSobreTuttsAberto(false),
                        className: "px-8 py-4 text-white font-bold text-lg rounded-2xl shadow-lg hover:shadow-xl transition-all hover:scale-105",
                        style: { background: "linear-gradient(135deg, #f37601 0%, #ff6b35 100%)" }
                    }, "‚úÖ Entendi, vamos come√ßar!")
                )
            )
        ),
        
        // ========== FIM LANDING PAGE ==========
        
        React.createElement("div", {
            className: "text-center mb-8"
        }, React.createElement("h2", {
            className: "text-2xl font-bold text-gray-800"
        }, "Ol√°, ", l.fullName?.split(" ")[0], "! üëã"), React.createElement("p", {
            className: "text-gray-600 mt-1"
        }, "O que voc√™ precisa fazer hoje?")), React.createElement("div", {
            className: "space-y-4"
        }, React.createElement("button", {
            onClick: function() { if(typeof window._tuttsSetModulo === 'function') window._tuttsSetModulo("filas"); },
            className: "w-full bg-gradient-to-r from-cyan-500 to-teal-500 rounded-2xl shadow-lg p-6 flex items-center gap-4 hover:shadow-xl transition-all hover:scale-[1.02]"
        }, React.createElement("div", {
            className: "w-16 h-16 bg-white/20 rounded-xl flex items-center justify-center text-3xl"
        }, "üë•"), React.createElement("div", {
            className: "text-left flex-1"
        }, React.createElement("h3", {
            className: "text-lg font-bold text-white"
        }, "Fila de Entregas"), React.createElement("p", {
            className: "text-sm text-white/80"
        }, "Entre na fila e aguarde a disponibilidade de corridas")), React.createElement("span", {
            className: "text-white/60 text-2xl"
        }, "‚Ä∫")), (() => {
            // Nova l√≥gica: usa elegibilidade do backend
            // Mostra se eleg√≠vel OU se ainda est√° carregando (para n√£o piscar)
            if (!l || !l.codProfissional) return !1;
            if (elegibilidadeNovatos.carregando) return !1;
            return elegibilidadeNovatos.elegivel;
        })() && React.createElement("button", {
            onClick: () => {
                verificarElegibilidadeNovatos(); // Recarrega ao clicar
                x({
                ...p,
                userTab: "promo-novatos"
            })},
            className: "w-full bg-white rounded-2xl shadow-lg p-6 flex items-center gap-4 hover:shadow-xl transition-all hover:scale-[1.02] border-l-4 border-orange-500"
        }, React.createElement("div", {
            className: "w-16 h-16 bg-orange-100 rounded-xl flex items-center justify-center text-3xl"
        }, "üöÄ"), React.createElement("div", {
            className: "text-left flex-1"
        }, React.createElement("h3", {
            className: "text-lg font-bold text-gray-800"
        }, "Promo√ß√µes Novatos"), React.createElement("p", {
            className: "text-sm text-gray-500"
        }, elegibilidadeNovatos.motivo || "Promo√ß√µes especiais para voc√™!"), React.createElement("div", {
            className: "flex gap-2 mt-1 flex-wrap"
        }, elegibilidadeNovatos.promocoes && elegibilidadeNovatos.promocoes.length > 0 && React.createElement("span", {
            className: "inline-block px-2 py-0.5 bg-orange-500 text-white text-xs rounded-full"
        }, elegibilidadeNovatos.promocoes.length, " promo√ß√£o(√µes)"), elegibilidadeNovatos.diasSemEntrega !== null && elegibilidadeNovatos.diasSemEntrega !== undefined && React.createElement("span", {
            className: "inline-block px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full font-semibold"
        }, "üìÖ ", elegibilidadeNovatos.diasSemEntrega, " dias sem entregas"))), React.createElement("span", {
            className: "text-orange-400 text-2xl"
        }, "‚Ä∫")), React.createElement("button", {
            onClick: () => x({
                ...p,
                userTab: "solicitacoes"
            }),
            className: "w-full bg-white rounded-2xl shadow-lg p-6 flex items-center gap-4 hover:shadow-xl transition-all hover:scale-[1.02] border-l-4 border-purple-600"
        }, React.createElement("div", {
            className: "w-16 h-16 bg-purple-100 rounded-xl flex items-center justify-center text-3xl"
        }, "üìã"), React.createElement("div", {
            className: "text-left flex-1"
        }, React.createElement("h3", {
            className: "text-lg font-bold text-gray-800"
        }, "Solicitar Ajuste"), React.createElement("p", {
            className: "text-sm text-gray-500"
        }, "Retornos e Ped√°gios")), React.createElement("span", {
            className: "text-purple-400 text-2xl"
        }, "‚Ä∫")), React.createElement("button", {
            onClick: () => x({
                ...p,
                userTab: "saque"
            }),
            className: "w-full bg-white rounded-2xl shadow-lg p-6 flex items-center gap-4 hover:shadow-xl transition-all hover:scale-[1.02] border-l-4 border-green-600"
        }, React.createElement("div", {
            className: "w-16 h-16 bg-green-100 rounded-xl flex items-center justify-center text-3xl"
        }, "üí∞"), React.createElement("div", {
            className: "text-left flex-1"
        }, React.createElement("h3", {
            className: "text-lg font-bold text-gray-800"
        }, "Saque Emergencial"), React.createElement("p", {
            className: "text-sm text-gray-500"
        }, "Solicitar adiantamento")), React.createElement("span", {
            className: "text-green-400 text-2xl"
        }, "‚Ä∫")), React.createElement("button", {
            onClick: () => x({
                ...p,
                userTab: "indicacoes"
            }),
            className: "w-full bg-white rounded-2xl shadow-lg p-6 flex items-center gap-4 hover:shadow-xl transition-all hover:scale-[1.02] border-l-4 border-blue-600"
        }, React.createElement("div", {
            className: "w-16 h-16 bg-blue-100 rounded-xl flex items-center justify-center text-3xl"
        }, "üë•"), React.createElement("div", {
            className: "text-left flex-1"
        }, React.createElement("h3", {
            className: "text-lg font-bold text-gray-800"
        }, "Promo√ß√£o de Indica√ß√£o"), React.createElement("p", {
            className: "text-sm text-gray-500"
        }, "Indique amigos e ganhe b√¥nus"), getPromocoesFiltradas().length > 0 && React.createElement("span", {
            className: "inline-block mt-1 px-2 py-0.5 bg-blue-500 text-white text-xs rounded-full"
        }, getPromocoesFiltradas().length, " promo√ß√£o(√µes) ativa(s)")), React.createElement("span", {
            className: "text-blue-400 text-2xl"
        }, "‚Ä∫")), React.createElement("button", {
            onClick: () => x({
                ...p,
                userTab: "seguro-iza"
            }),
            className: "w-full bg-white rounded-2xl shadow-lg p-6 flex items-center gap-4 hover:shadow-xl transition-all hover:scale-[1.02] border-l-4 border-cyan-500"
        }, React.createElement("div", {
            className: "w-16 h-16 bg-cyan-100 rounded-xl flex items-center justify-center text-3xl"
        }, "üõ°Ô∏è"), React.createElement("div", {
            className: "text-left flex-1"
        }, React.createElement("h3", {
            className: "text-lg font-bold text-gray-800"
        }, "Seguro de Vida - IZA"), React.createElement("p", {
            className: "text-sm text-gray-500"
        }, "Coberturas, valores e como acionar")), React.createElement("span", {
            className: "text-cyan-400 text-2xl"
        }, "‚Ä∫")), React.createElement("button", {
            onClick: () => {
                ot(!0), st(0), Ga(), Za(), x({
                    ...p,
                    userTab: "loja"
                })
            },
            className: "w-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-2xl shadow-lg p-6 flex items-center gap-4 hover:shadow-xl transition-all hover:scale-[1.02]"
        }, React.createElement("div", {
            className: "w-16 h-16 bg-white/20 rounded-xl flex items-center justify-center text-3xl"
        }, "üõí"), React.createElement("div", {
            className: "text-left flex-1"
        }, React.createElement("h3", {
            className: "text-lg font-bold text-white"
        }, "Lojinha Tutts"), React.createElement("p", {
            className: "text-sm text-white/80"
        }, "Ofertas exclusivas com abatimento no saldo!")), React.createElement("span", {
            className: "text-white/60 text-2xl"
        }, "‚Ä∫"))), React.createElement("div", {
            className: "mt-8 grid grid-cols-3 gap-4"
        }, React.createElement("div", {
            className: "bg-white rounded-xl p-4 text-center shadow"
        }, React.createElement("p", {
            className: "text-2xl font-bold text-purple-600"
        }, j.filter(e => "pendente" === e.status).length), React.createElement("p", {
            className: "text-xs text-gray-500"
        }, "Ajustes Pendentes")), React.createElement("div", {
            className: "bg-white rounded-xl p-4 text-center shadow"
        }, React.createElement("p", {
            className: "text-2xl font-bold text-green-600"
        }, M.filter(e => "aguardando_aprovacao" === e.status).length), React.createElement("p", {
            className: "text-xs text-gray-500"
        }, "Saques Pendentes")), React.createElement("div", {
            className: "bg-white rounded-xl p-4 text-center shadow"
        }, React.createElement("p", {
            className: "text-2xl font-bold text-blue-600"
        }, re.filter(e => "pendente" === e.status).length), React.createElement("p", {
            className: "text-xs text-gray-500"
        }, "Indica√ß√µes Pendentes")))), p.userTab && React.createElement("div", {
            className: "max-w-4xl mx-auto p-6"
        }, React.createElement("div", {
            className: "flex items-center gap-4 mb-6"
        }, React.createElement("button", {
            onClick: () => x({
                ...p,
                userTab: null
            }),
            className: "p-2 bg-white rounded-lg shadow hover:bg-gray-50"
        }, "‚Üê Voltar"), React.createElement("h1", {
            className: "text-xl font-bold text-gray-800"
        }, "solicitacoes" === p.userTab && "üìã Solicitar Ajuste", "saque" === p.userTab && "üí∞ Saque Emergencial", "indicacoes" === p.userTab && "üë• Promo√ß√£o de Indica√ß√£o", "promo-novatos" === p.userTab && "üöÄ Promo√ß√µes Novatos", "seguro-iza" === p.userTab && "üõ°Ô∏è Seguro de Vida - IZA", "loja" === p.userTab && "üõí Lojinha Tutts")), "solicitacoes" === p.userTab && React.createElement(React.Fragment, null, React.createElement("div", {
            className: "bg-white rounded-xl shadow p-6 mb-6"
        }, React.createElement("h2", {
            className: "text-lg font-semibold mb-4"
        }, "üìù Enviar OS"), React.createElement("div", {
            className: "space-y-4"
        }, React.createElement("input", {
            type: "text",
            placeholder: "N√∫mero da OS",
            value: p.os || "",
            onChange: e => x({
                ...p,
                os: e.target.value
            }),
            className: "w-full px-4 py-3 border rounded-lg"
        }), React.createElement("select", {
            value: p.motivo || "",
            onChange: e => {
                const t = e.target.value;
                x({
                    ...p,
                    motivo: t,
                    imagens: []
                })
            },
            className: "w-full px-4 py-3 border rounded-lg"
        }, React.createElement("option", {
            value: ""
        }, "Selecione o motivo"), React.createElement("option", null, "Ajuste de Retorno"), React.createElement("option", null, "Ajuste de Ped√°gio"), React.createElement("option", null, "Ajuste Sim√µes Filho (Salvador-BA)")), Wl.includes(p.motivo) && React.createElement("div", {
            className: "border-2 border-dashed border-orange-300 bg-orange-50 rounded-lg p-4"
        }, React.createElement("p", {
            className: "text-sm font-bold text-orange-800 mb-2"
        }, "üìé Fotos OBRIGAT√ìRIAS (m√°x. 2)"), React.createElement("input", {
            type: "file",
            accept: "image/*",
            multiple: !0,
            onChange: async e => {
                const t = Array.from(e.target.files).slice(0, 2);
                if (t.length) {
                    s(!0);
                    try {
                        const e = [];
                        for (const a of t) {
                            if (a.size > 25 * 1024 * 1024) {
                                ja("Imagem muito grande! M√°ximo 25MB por foto", "error");
                                continue;
                            }
                            e.push(await Zl(a));
                        }
                        if (e.length > 0) {
                            x({
                                ...p,
                                imagens: [...p.imagens || [], ...e].slice(0, 2)
                            }), ja("‚úÖ Imagem adicionada!", "success")
                        }
                    } catch {
                        ja("Erro ao processar imagem", "error")
                    }
                    s(!1), e.target.value = ""
                }
            },
            className: "w-full text-sm"
        }), p.imagens?.length > 0 && React.createElement("div", {
            className: "mt-3 flex gap-2"
        }, p.imagens.map((e, t) => React.createElement("div", {
            key: t,
            className: "relative"
        }, React.createElement("img", {
            src: e,
            className: "h-24 rounded border"
        }), React.createElement("button", {
            onClick: () => x({
                ...p,
                imagens: p.imagens.filter((e, a) => a !== t)
            }),
            className: "absolute -top-2 -right-2 bg-red-600 text-white rounded-full w-5 h-5 text-xs"
        }, "‚úï")))), React.createElement("p", {
            className: "text-xs text-gray-500 mt-2"
        }, p.imagens?.length || 0, "/2 fotos")), React.createElement("button", {
            onClick: Yl,
            disabled: c || !p.os || !p.motivo || Wl.includes(p.motivo) && !p.imagens?.length,
            className: "w-full bg-purple-900 text-white py-3 rounded-lg font-semibold disabled:opacity-50"
        }, c ? "‚è≥ Enviando..." : "Enviar"))), React.createElement("div", {
            className: "bg-white rounded-xl shadow p-6"
        }, React.createElement("h2", {
            className: "text-lg font-semibold mb-4"
        }, "üìã Minhas Submiss√µes"), 0 === j.length ? React.createElement("p", {
            className: "text-gray-500"
        }, "Nenhuma submiss√£o") : React.createElement("div", {
            className: "space-y-3"
        }, j.map(e => React.createElement("div", {
            key: e.id,
            className: "border rounded-lg p-4"
        }, React.createElement("div", {
            className: "flex justify-between items-start"
        }, React.createElement("div", null, React.createElement("p", {
            className: "font-mono text-lg font-bold"
        }, "OS: ", e.ordemServico), React.createElement("p", {
            className: "text-sm text-gray-600"
        }, e.motivo)), React.createElement("span", {
            className: "px-3 py-1 rounded-full text-xs font-bold " + ("aprovado" === e.status ? "bg-green-500 text-white" : "rejeitado" === e.status ? "bg-red-500 text-white" : "bg-yellow-500 text-white")
        }, e.status?.toUpperCase())), "rejeitado" === e.status && e.observacao && React.createElement("div", {
            className: "mt-2 p-2 bg-red-50 border border-red-200 rounded"
        }, React.createElement("p", {
            className: "text-xs text-red-800"
        }, React.createElement("strong", null, "Motivo da rejei√ß√£o:"), " ", e.observacao)), e.temImagem && !e.imagemComprovante && React.createElement("button", {
            onClick: () => Fa(e.id),
            className: "mt-2 text-sm text-blue-600 hover:underline"
        }, "üì∑ Ver foto(s)"), e.imagemComprovante && React.createElement("div", {
            className: "mt-2 flex gap-2"
        }, e.imagemComprovante.split("|||").map((e, t) => React.createElement("img", {
            key: t,
            src: e,
            className: "h-20 rounded cursor-pointer",
            onClick: () => g(e)
        }))), React.createElement("p", {
            className: "text-xs text-gray-400 mt-2"
        }, e.timestamp)))))), "saque" === p.userTab && React.createElement(React.Fragment, null, null === ze ? React.createElement("div", {
            className: "flex items-center justify-center py-12"
        }, React.createElement("div", {
            className: "animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"
        }), React.createElement("span", {
            className: "ml-3"
        }, "Verificando hor√°rio...")) : ze.dentroHorario || Ge ? React.createElement(React.Fragment, null, Qe.length > 0 && React.createElement("div", {
            className: "space-y-2 mb-4"
        }, Qe.map(e => React.createElement("div", {
            key: e.id,
            className: "p-3 rounded-xl border-l-4 " + ("error" === e.tipo ? "bg-red-50 border-red-500" : "warning" === e.tipo ? "bg-yellow-50 border-yellow-500" : "success" === e.tipo ? "bg-green-50 border-green-500" : "bg-blue-50 border-blue-500")
        }, React.createElement("p", {
            className: "font-bold text-sm"
        }, e.titulo), React.createElement("p", {
            className: "text-xs text-gray-700"
        }, e.mensagem)))), ze && !ze.dentroHorario && Ge && React.createElement("div", {
            className: "bg-orange-100 border border-orange-300 rounded-xl p-3 mb-4 flex items-center gap-3"
        }, React.createElement("span", {
            className: "text-2xl"
        }, "‚è∞"), React.createElement("div", null, React.createElement("p", {
            className: "text-sm font-semibold text-orange-800"
        }, "Solicita√ß√£o fora do hor√°rio"), React.createElement("p", {
            className: "text-xs text-orange-700"
        }, "Ser√° processada ", yl()))), k ? T?.full_name ? React.createElement(React.Fragment, null, React.createElement("div", {
            className: "bg-white rounded-xl shadow mb-6"
        }, React.createElement("div", {
            className: "flex border-b overflow-x-auto"
        }, React.createElement("button", {
            onClick: () => x({
                ...p,
                saqueTab: "solicitar"
            }),
            className: "flex-1 py-3 font-semibold whitespace-nowrap px-2 " + (p.saqueTab && "solicitar" !== p.saqueTab ? "text-gray-500" : "text-green-700 border-b-2 border-green-600")
        }, "üí∞ Solicitar"), React.createElement("button", {
            onClick: () => x({
                ...p,
                saqueTab: "gratuidades"
            }),
            className: "flex-1 py-3 font-semibold whitespace-nowrap px-2 " + ("gratuidades" === p.saqueTab ? "text-pink-700 border-b-2 border-pink-600" : "text-gray-500")
        }, "üéÅ Gratuidades"), React.createElement("button", {
            onClick: () => x({
                ...p,
                saqueTab: "dados"
            }),
            className: "flex-1 py-3 font-semibold whitespace-nowrap px-2 " + ("dados" === p.saqueTab ? "text-blue-700 border-b-2 border-blue-600" : "text-gray-500")
        }, "üë§ Dados"), React.createElement("button", {
            onClick: () => x({
                ...p,
                saqueTab: "dashboard"
            }),
            className: "flex-1 py-3 font-semibold whitespace-nowrap px-2 " + ("dashboard" === p.saqueTab ? "text-purple-700 border-b-2 border-purple-600" : "text-gray-500")
        }, "üìä Dashboard")), React.createElement("div", {
            className: "p-6"
        }, "dashboard" === p.saqueTab && React.createElement(React.Fragment, null, (() => {
            const e = new Date,
                t = e.getMonth(),
                a = e.getFullYear(),
                l = M.filter(e => {
                    const l = new Date(e.created_at);
                    return l.getMonth() === t && l.getFullYear() === a
                }),
                r = l.filter(e => "aprovado" === e.status || "aprovado_gratuidade" === e.status),
                o = r.reduce((e, t) => e + parseFloat(t.final_amount || 0), 0),
                c = G.reduce((e, t) => e + (t.quantity - t.remaining), 0),
                s = G.reduce((e, t) => e + t.quantity, 0),
                n = [];
            for (let e = 5; e >= 0; e--) {
                const l = new Date(a, t - e, 1),
                    r = l.getMonth(),
                    o = l.getFullYear(),
                    c = M.filter(e => {
                        const t = new Date(e.created_at);
                        return t.getMonth() === r && t.getFullYear() === o && ("aprovado" === e.status || "aprovado_gratuidade" === e.status)
                    }),
                    s = c.reduce((e, t) => e + parseFloat(t.final_amount || 0), 0);
                n.push({
                    mes: l.toLocaleDateString("pt-BR", {
                        month: "short"
                    }).replace(".", ""),
                    valor: s,
                    qtd: c.length
                })
            }
            const m = Math.max(...n.map(e => e.valor), 1),
                i = M.filter(e => "aprovado" === e.status || "aprovado_gratuidade" === e.status).reduce((e, t) => e + parseFloat(t.final_amount || 0), 0),
                d = r.length > 0 ? o / r.length : 0;
            return React.createElement("div", {
                className: "space-y-6"
            }, React.createElement("div", {
                className: "grid grid-cols-1 md:grid-cols-3 gap-4"
            }, React.createElement("div", {
                className: "bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl p-4 text-white"
            }, React.createElement("p", {
                className: "text-xs opacity-80"
            }, "üí∞ Sacado este m√™s"), React.createElement("p", {
                className: "text-2xl font-bold mt-1"
            }, er(o)), React.createElement("p", {
                className: "text-xs opacity-70 mt-1"
            }, r.length, " saque(s)")), React.createElement("div", {
                className: "bg-gradient-to-br from-purple-500 to-pink-600 rounded-xl p-4 text-white"
            }, React.createElement("p", {
                className: "text-xs opacity-80"
            }, "üéÅ Gratuidades"), React.createElement("p", {
                className: "text-2xl font-bold mt-1"
            }, c, "/", s), React.createElement("p", {
                className: "text-xs opacity-70 mt-1"
            }, "usadas/total")), React.createElement("div", {
                className: "bg-gradient-to-br from-orange-500 to-red-500 rounded-xl p-4 text-white"
            }, React.createElement("p", {
                className: "text-xs opacity-80"
            }, "üìà Total Hist√≥rico"), React.createElement("p", {
                className: "text-2xl font-bold mt-1"
            }, er(i)), React.createElement("p", {
                className: "text-xs opacity-70 mt-1"
            }, "todos os tempos"))), React.createElement("div", {
                className: "bg-white border rounded-xl p-4"
            }, React.createElement("h3", {
                className: "font-semibold mb-4"
            }, "üìä Hist√≥rico de Saques (√öltimos 6 meses)"), React.createElement("div", {
                className: "flex items-end justify-between gap-2 h-48"
            }, n.map((e, t) => React.createElement("div", {
                key: t,
                className: "flex-1 flex flex-col items-center"
            }, React.createElement("span", {
                className: "text-xs text-gray-600 mb-1"
            }, er(e.valor)), React.createElement("div", {
                className: "w-full bg-gradient-to-t from-green-500 to-emerald-400 rounded-t-lg transition-all duration-500",
                style: {
                    height: `${Math.max(e.valor/m*100,5)}%`,
                    minHeight: "20px"
                }
            }), React.createElement("span", {
                className: "text-xs font-semibold mt-2 text-gray-700"
            }, e.mes), React.createElement("span", {
                className: "text-xs text-gray-500"
            }, e.qtd, " saque(s)"))))), React.createElement("div", {
                className: "bg-gray-50 rounded-xl p-4"
            }, React.createElement("h3", {
                className: "font-semibold mb-3"
            }, "üìã Resumo do M√™s"), React.createElement("div", {
                className: "grid grid-cols-2 gap-4 text-sm"
            }, React.createElement("div", {
                className: "flex justify-between"
            }, React.createElement("span", {
                className: "text-gray-600"
            }, "M√©dia por saque:"), React.createElement("span", {
                className: "font-semibold"
            }, er(d))), React.createElement("div", {
                className: "flex justify-between"
            }, React.createElement("span", {
                className: "text-gray-600"
            }, "Pendentes:"), React.createElement("span", {
                className: "font-semibold text-yellow-600"
            }, l.filter(e => "aguardando_aprovacao" === e.status).length)), React.createElement("div", {
                className: "flex justify-between"
            }, React.createElement("span", {
                className: "text-gray-600"
            }, "Aprovados:"), React.createElement("span", {
                className: "font-semibold text-green-600"
            }, r.length)), React.createElement("div", {
                className: "flex justify-between"
            }, React.createElement("span", {
                className: "text-gray-600"
            }, "Rejeitados:"), React.createElement("span", {
                className: "font-semibold text-red-600"
            }, l.filter(e => "rejeitado" === e.status).length)))))
        })()), (!p.saqueTab || "solicitar" === p.saqueTab) && React.createElement(React.Fragment, null, (() => {
            const e = G.find(e => "ativa" === e.status && e.remaining > 0),
                t = !!e,
                a = e ? parseFloat(e.value) : 0,
                l = parseFloat(p.withdrawAmount) || 0,
                r = t && l > a,
                o = new Date,
                s = new Date(o.getTime() - 36e5),
                // Filtrar apenas saques pendentes ou aprovados na √∫ltima hora (excluir rejeitados)
                n = M.filter(e => new Date(e.created_at) >= s && e.status !== "rejeitado"),
                // Limite de 1 saque por hora
                m = Math.max(0, 1 - n.length),
                i = n.map(e => parseFloat(e.requested_amount)),
                d = i.includes(l) && l > 0;
            
            // Calcular saldo dispon√≠vel (saldo real - saques pendentes)
            const saquesPend = M.filter(sq => sq.status === "pending" || sq.status === "aguardando_aprovacao");
            const totalPend = saquesPend.reduce((acc, sq) => acc + parseFloat(sq.requested_amount || 0), 0);
            const saldoDisp = saldoPlificUser.saldo !== null ? Math.max(0, saldoPlificUser.saldo - totalPend) : null;
            
            // Calcular tempo restante para habilitar novamente (em segundos para cron√¥metro)
            let tempoRestanteSeg = 0;
            let tempoRestanteStr = "";
            if (n.length >= 1) {
                const saqueMaisRecente = new Date(Math.max(...n.map(e => new Date(e.created_at).getTime())));
                const tempoLiberacao = new Date(saqueMaisRecente.getTime() + 36e5);
                const diffMs = tempoLiberacao - o;
                if (diffMs > 0) {
                    tempoRestanteSeg = Math.ceil(diffMs / 1000);
                    const mins = Math.floor(tempoRestanteSeg / 60);
                    const segs = tempoRestanteSeg % 60;
                    tempoRestanteStr = `${mins.toString().padStart(2, "0")}:${segs.toString().padStart(2, "0")}`;
                }
            }
            
            return React.createElement("div", {
                className: "space-y-4"
            }, 
            // Card Saldo Plific
            React.createElement("div", {
                className: "rounded-xl p-4 border-2 " + (saldoPlificUser.loading ? "bg-gray-50 border-gray-200" : saldoPlificUser.erro ? "bg-red-50 border-red-300" : saldoDisp !== null && saldoDisp <= 0 ? "bg-red-50 border-red-300" : "bg-purple-50 border-purple-300")
            }, 
                React.createElement("div", {className: "flex items-center justify-between"},
                    React.createElement("div", {className: "flex items-center gap-3"},
                        React.createElement("span", {className: "text-3xl"}, "üí∞"),
                        React.createElement("div", null,
                            React.createElement("p", {className: "text-sm font-medium text-gray-600"}, "Seu Saldo Dispon√≠vel"),
                            saldoPlificUser.loading ? 
                                React.createElement("p", {className: "text-lg font-bold text-gray-400"}, "Carregando...") :
                            saldoPlificUser.erro ?
                                React.createElement("p", {className: "text-lg font-bold text-red-600"}, "Erro ao carregar") :
                            saldoDisp !== null ?
                                React.createElement("p", {className: "text-2xl font-bold " + (saldoDisp > 0 ? "text-green-600" : "text-red-600")}, "R$ " + saldoDisp.toFixed(2).replace(".", ",")) :
                                React.createElement("p", {className: "text-lg font-bold text-gray-400"}, "N√£o dispon√≠vel")
                        )
                    ),
                    React.createElement("button", {
                        onClick: function() { buscarSaldoPlificUsuario(true); },
                        disabled: saldoPlificUser.loading,
                        className: "p-2 text-purple-600 hover:bg-purple-100 rounded-lg transition-colors"
                    }, "üîÑ")
                ),
                totalPend > 0 && React.createElement("p", {
                    className: "text-xs text-purple-600 mt-2"
                }, "üìã R$ " + totalPend.toFixed(2).replace(".", ",") + " em saques aguardando aprova√ß√£o"),
                saldoDisp !== null && saldoDisp <= 0 && React.createElement("p", {
                    className: "text-sm text-red-600 mt-2 font-medium"
                }, "‚ö†Ô∏è Voc√™ n√£o possui saldo suficiente para solicitar saque emergencial.")
            ),
            React.createElement("div", {
                className: "rounded-lg p-4 border " + (0 === m ? "bg-red-50 border-red-300" : "bg-green-50 border-green-300")
            }, React.createElement("div", {
                className: "flex items-center justify-between"
            }, React.createElement("div", {
                className: "flex items-center gap-2"
            }, React.createElement("span", {
                className: "text-2xl"
            }, 0 === m ? "‚è≥" : "‚úÖ"), React.createElement("div", null, React.createElement("p", {
                className: "font-semibold " + (0 === m ? "text-red-800" : "text-green-800")
            }, 0 === m ? "Permitido apenas 1 saque por hora!" : "Saque dispon√≠vel"), React.createElement("p", {
                className: "text-sm " + (0 === m ? "text-red-600" : "text-green-600")
            }, 0 === m ? `Tente novamente em: ${tempoRestanteStr || "calculando..."}` : "Voc√™ pode solicitar seu saque emergencial"))))), t && React.createElement("div", {
                className: "bg-green-50 border border-green-300 rounded-lg p-4"
            }, React.createElement("p", {
                className: "text-green-800 font-semibold"
            }, "üéÅ Voc√™ possui gratuidade ativa!"), React.createElement("p", {
                className: "text-green-700 text-sm mt-1"
            }, "Valor m√°ximo permitido: ", React.createElement("strong", null, er(a))), React.createElement("p", {
                className: "text-green-600 text-xs mt-1"
            }, "Restam ", e.remaining, " uso(s) desta gratuidade")), !t && React.createElement("div", {
                className: "bg-yellow-50 border border-yellow-300 rounded-lg p-4"
            }, React.createElement("p", {
                className: "text-yellow-800 font-semibold"
            }, "‚ö†Ô∏è Aten√ß√£o!"), React.createElement("p", {
                className: "text-yellow-700 text-sm mt-1"
            }, "Conforme termo de uso do saque emergencial, ser√° cobrado um valor de ", React.createElement("strong", null, "4,5%"), " na solicita√ß√£o.")), React.createElement("div", null, React.createElement("label", {
                className: "block text-sm font-semibold mb-1"
            }, "Valor ", t && React.createElement("span", {
                className: "text-green-600 text-xs"
            }, "(m√°x: ", er(a), ")"), React.createElement("span", {
                className: "text-gray-500 text-xs ml-1"
            }, "(m√≠n: R$ 10,00)")), React.createElement("input", {
                type: "text",
                inputMode: "decimal",
                value: p.withdrawAmount || "",
                onChange: e => {
                    // Permite apenas n√∫meros e v√≠rgula/ponto para decimais
                    let val = e.target.value;
                    // Remove caracteres inv√°lidos (permite n√∫meros, v√≠rgula e ponto)
                    val = val.replace(/[^0-9.,]/g, '');
                    // Substitui v√≠rgula por ponto para c√°lculos
                    val = val.replace(',', '.');
                    // Garante apenas um ponto decimal
                    const parts = val.split('.');
                    if (parts.length > 2) {
                        val = parts[0] + '.' + parts.slice(1).join('');
                    }
                    // Limita a 2 casas decimais
                    if (parts.length === 2 && parts[1].length > 2) {
                        val = parts[0] + '.' + parts[1].substring(0, 2);
                    }
                    x({...p, withdrawAmount: val});
                },
                placeholder: "Ex: 50,00",
                className: "w-full px-4 py-3 border rounded-lg text-lg " + (r || (p.withdrawAmount && parseFloat(p.withdrawAmount) < 10) ? "border-red-500 bg-red-50" : ""),
                disabled: 0 === m || (saldoDisp !== null && saldoDisp <= 0)
            }), p.withdrawAmount && parseFloat(p.withdrawAmount) > 0 && parseFloat(p.withdrawAmount) < 10 && React.createElement("p", {
                className: "text-red-600 text-sm mt-1 font-semibold"
            }, "‚ùå Valor m√≠nimo √© R$ 10,00"), r && React.createElement("p", {
                className: "text-red-600 text-sm mt-1 font-semibold"
            }, "‚ùå Valor excede o limite da gratuidade (", er(a), ")")), saldoDisp !== null && parseFloat(p.withdrawAmount || 0) > saldoDisp && React.createElement("p", {
                className: "text-red-600 text-sm mt-1 font-semibold"
            }, "‚ùå Valor excede seu saldo dispon√≠vel (R$ " + saldoDisp.toFixed(2).replace(".", ",") + ")"), p.withdrawAmount && parseFloat(p.withdrawAmount) >= 10 && !r && (() => {
                const e = (e => {
                    const t = G.find(e => "ativa" === e.status && e.remaining > 0),
                        a = !!t,
                        l = a ? 0 : .045 * e;
                    return {
                        fee: l,
                        final: e - l,
                        hasGrat: a,
                        maxGratValue: t ? parseFloat(t.value) : 0,
                        gratAtiva: t
                    }
                })(parseFloat(p.withdrawAmount));
                return React.createElement("div", {
                    className: "bg-gray-50 rounded-lg p-4 space-y-2"
                }, React.createElement("div", {
                    className: "flex justify-between"
                }, React.createElement("span", null, "Solicitado:"), React.createElement("span", {
                    className: "font-bold"
                }, er(p.withdrawAmount))), React.createElement("div", {
                    className: "flex justify-between"
                }, React.createElement("span", null, "Taxa:"), React.createElement("span", {
                    className: e.hasGrat ? "text-green-600 font-bold" : "text-red-600"
                }, e.hasGrat ? "ISENTA" : `-${er(e.fee)}`)), React.createElement("hr", null), React.createElement("div", {
                    className: "flex justify-between text-lg"
                }, React.createElement("span", {
                    className: "font-bold"
                }, "Receber:"), React.createElement("span", {
                    className: "font-bold text-green-700"
                }, er(e.final))))
            })(), React.createElement("button", {
                onClick: Vl,
                disabled: c || !p.withdrawAmount || parseFloat(p.withdrawAmount) < 10 || r || 0 === m || (saldoDisp !== null && saldoDisp <= 0) || (saldoDisp !== null && parseFloat(p.withdrawAmount || 0) > saldoDisp),
                className: "w-full bg-green-600 text-white py-3 rounded-lg font-bold disabled:opacity-50"
            }, c ? "..." : 0 === m ? "üö´ Limite Atingido" : parseFloat(p.withdrawAmount || 0) < 10 ? "‚ö†Ô∏è M√≠nimo R$ 10" : "üí∏ Solicitar"))
        })(), React.createElement("h3", {
            className: "text-lg font-semibold mt-8 mb-4"
        }, "üìã Hist√≥rico"), 0 === M.length ? React.createElement("p", {
            className: "text-gray-500"
        }, "Nenhum saque") : React.createElement("div", {
            className: "space-y-3"
        }, M.map(e => {
            const t = "aguardando_aprovacao" === e.status && Date.now() - new Date(e.created_at) > 36e5,
                a = "aprovado" === e.status || "aprovado_gratuidade" === e.status ? "Saque aprovado, em instantes ser√° feito a transfer√™ncia para o seu banco!" : "inativo" === e.status ? "Saque temporariamente inativo por quest√µes t√©cnicas" : "rejeitado" === e.status && e.reject_reason ? `Motivo: ${e.reject_reason}` : null;
            return React.createElement("div", {
                key: e.id,
                className: "border rounded-lg p-4 " + (t ? "border-red-400 bg-red-50" : e.status?.includes("aprovado") ? "border-green-400 bg-green-50" : "rejeitado" === e.status ? "border-red-300 bg-red-50" : "inativo" === e.status ? "border-orange-300 bg-orange-50" : "")
            }, React.createElement("div", {
                className: "flex justify-between"
            }, React.createElement("div", null, React.createElement("p", {
                className: "font-bold"
            }, er(e.requested_amount)), React.createElement("p", {
                className: "text-sm text-gray-600"
            }, "Receber: ", er(e.final_amount))), React.createElement("span", {
                className: "px-3 py-1 rounded-full text-xs font-bold h-fit " + (e.status?.includes("aprovado") ? "bg-green-500 text-white" : "rejeitado" === e.status ? "bg-red-500 text-white" : "inativo" === e.status ? "bg-orange-500 text-white" : "bg-yellow-500 text-white")
            }, t ? "‚ö†Ô∏è ATRASADO" : "aprovado" === e.status || "aprovado_gratuidade" === e.status ? "‚úÖ Aprovado" : "rejeitado" === e.status ? "‚ùå Rejeitado" : "inativo" === e.status ? "‚ö†Ô∏è Inativo" : "‚è≥ Aguardando")), a && React.createElement("p", {
                className: "text-sm mt-2 font-semibold " + (e.status?.includes("aprovado") ? "text-green-700" : "rejeitado" === e.status ? "text-red-600" : "text-orange-600")
            }, a), t && React.createElement("p", {
                className: "text-red-600 text-sm mt-2 font-semibold"
            }, "Entre em contato com o suporte"), React.createElement("p", {
                className: "text-xs text-gray-400 mt-2"
            }, new Date(e.created_at).toLocaleString("pt-BR")))
        }))), "dados" === p.saqueTab && React.createElement("div", {
            className: "space-y-4"
        }, T && !F ? React.createElement(React.Fragment, null, React.createElement("div", {
            className: "bg-green-50 border-2 border-green-300 rounded-xl p-5"
        }, React.createElement("div", {
            className: "flex items-center gap-2 mb-4"
        }, React.createElement("span", {
            className: "text-2xl"
        }, "‚úÖ"), React.createElement("h3", {
            className: "font-bold text-green-800"
        }, "Dados Validados")), React.createElement("div", {
            className: "space-y-3"
        }, React.createElement("div", {
            className: "flex justify-between items-center py-2 border-b border-green-200"
        }, React.createElement("span", {
            className: "text-gray-600 text-sm"
        }, "Nome Completo"), React.createElement("span", {
            className: "font-semibold text-gray-800"
        }, T.full_name)), React.createElement("div", {
            className: "flex justify-between items-center py-2 border-b border-green-200"
        }, React.createElement("span", {
            className: "text-gray-600 text-sm"
        }, "CPF"), React.createElement("span", {
            className: "font-semibold text-gray-800"
        }, T.cpf)), React.createElement("div", {
            className: "flex justify-between items-center py-2 border-b border-green-200"
        }, React.createElement("span", {
            className: "text-gray-600 text-sm"
        }, "Tipo da Chave PIX"), React.createElement("span", {
            className: "px-2 py-1 bg-green-200 text-green-800 rounded-full text-xs font-bold"
        }, {
            cpf: "ü™™ CPF",
            cnpj: "üè¢ CNPJ",
            telefone: "üì± Telefone",
            email: "üìß Email",
            aleatoria: "üîë Aleat√≥ria"
        } [T.pix_tipo] || T.pix_tipo)), React.createElement("div", {
            className: "flex justify-between items-center py-2"
        }, React.createElement("span", {
            className: "text-gray-600 text-sm"
        }, "Chave PIX"), React.createElement("span", {
            className: "font-semibold text-gray-800"
        }, T.pix_key))), React.createElement("button", {
            onClick: () => $(!0),
            className: "w-full mt-4 bg-white border-2 border-green-500 text-green-700 py-3 rounded-lg font-bold hover:bg-green-100 transition"
        }, "‚úèÔ∏è Editar Dados")), L.length > 0 && React.createElement("div", {
            className: "bg-gray-50 border border-gray-200 rounded-xl p-4"
        }, React.createElement("h4", {
            className: "font-semibold text-gray-700 mb-3 flex items-center gap-2"
        }, React.createElement("span", null, "üìã"), " Hist√≥rico de Altera√ß√µes"), React.createElement("div", {
            className: "space-y-2 max-h-48 overflow-y-auto"
        }, L.map((e, t) => React.createElement("div", {
            key: t,
            className: "bg-white border border-gray-200 rounded-lg p-3 text-sm"
        }, React.createElement("div", {
            className: "flex justify-between items-start"
        }, React.createElement("div", null, React.createElement("span", {
            className: "font-semibold text-gray-700"
        }, "ALTERACAO_NOME" === e.action && "üë§ Nome alterado", "ALTERACAO_CPF" === e.action && "ü™™ CPF alterado", "ALTERACAO_PIX" === e.action && "üí≥ Chave PIX alterada", "CADASTRO_DADOS" === e.action && "‚úÖ Cadastro inicial"), e.old_value && e.new_value && React.createElement("p", {
            className: "text-gray-500 text-xs mt-1"
        }, "De: ", React.createElement("span", {
            className: "line-through text-red-500"
        }, e.old_value), React.createElement("br", null), "Para: ", React.createElement("span", {
            className: "text-green-600 font-medium"
        }, e.new_value))), React.createElement("span", {
            className: "text-xs text-gray-400"
        }, new Date(e.created_at).toLocaleDateString("pt-BR"), " ", new Date(e.created_at).toLocaleTimeString("pt-BR", {
            hour: "2-digit",
            minute: "2-digit"
        })))))))) : React.createElement(React.Fragment, null, T && F && React.createElement("div", {
            className: "bg-yellow-50 border border-yellow-300 rounded-lg p-3 mb-2"
        }, React.createElement("p", {
            className: "text-yellow-800 text-sm flex items-center gap-2"
        }, React.createElement("span", null, "‚ö†Ô∏è"), " Voc√™ est√° editando seus dados. As altera√ß√µes ser√£o registradas no hist√≥rico.")), React.createElement("div", null, React.createElement("label", {
            className: "block text-sm font-semibold mb-1"
        }, "Nome Completo"), React.createElement("input", {
            type: "text",
            value: p.finName ?? T?.full_name ?? "",
            onChange: e => x({
                ...p,
                finName: e.target.value
            }),
            className: "w-full px-4 py-2 border rounded-lg",
            placeholder: "Seu nome completo"
        })), React.createElement("div", null, React.createElement("label", {
            className: "block text-sm font-semibold mb-1"
        }, "CPF"), React.createElement("input", {
            type: "text",
            value: p.finCpf ?? T?.cpf ?? "",
            onChange: e => x({
                ...p,
                finCpf: Xl(e.target.value)
            }),
            className: "w-full px-4 py-2 border rounded-lg",
            placeholder: "000.000.000-00",
            maxLength: 14
        })), React.createElement("div", null, React.createElement("label", {
            className: "block text-sm font-semibold mb-2"
        }, "Tipo da Chave PIX"), React.createElement("div", {
            className: "grid grid-cols-5 gap-2"
        }, [{
            id: "cpf",
            label: "CPF",
            icon: "ü™™"
        }, {
            id: "cnpj",
            label: "CNPJ",
            icon: "üè¢"
        }, {
            id: "telefone",
            label: "Telefone",
            icon: "üì±"
        }, {
            id: "email",
            label: "Email",
            icon: "üìß"
        }, {
            id: "aleatoria",
            label: "Aleat√≥ria",
            icon: "üîë"
        }].map(e => React.createElement("button", {
            key: e.id,
            type: "button",
            onClick: () => x({
                ...p,
                pixTipo: e.id,
                finPix: ""
            }),
            className: "p-2 rounded-lg border-2 text-center transition-all " + (p.pixTipo === e.id ? "border-blue-500 bg-blue-50 text-blue-700" : "border-gray-200 hover:border-gray-300")
        }, React.createElement("span", {
            className: "text-xl"
        }, e.icon), React.createElement("p", {
            className: "text-xs font-semibold mt-1"
        }, e.label))))), React.createElement("div", null, React.createElement("label", {
            className: "block text-sm font-semibold mb-1"
        }, "Chave PIX"), React.createElement("input", {
            type: "email" === p.pixTipo ? "email" : "text",
            value: p.finPix ?? T?.pix_key ?? "",
            onChange: e => x({
                ...p,
                finPix: ar(e.target.value, p.pixTipo)
            }),
            placeholder: lr(p.pixTipo),
            disabled: !p.pixTipo,
            maxLength: "cpf" === p.pixTipo ? 14 : "cnpj" === p.pixTipo ? 18 : "telefone" === p.pixTipo ? 15 : 100,
            className: "w-full px-4 py-2 border rounded-lg transition-all " + (p.pixTipo ? p.finPix ? tr(p.finPix, p.pixTipo).valido ? "border-green-500 bg-green-50" : "border-red-500 bg-red-50" : "" : "bg-gray-100 cursor-not-allowed")
        }), p.finPix && p.pixTipo && React.createElement("p", {
            className: "mt-1 text-sm " + (tr(p.finPix, p.pixTipo).valido ? "text-green-600" : "text-red-600")
        }, tr(p.finPix, p.pixTipo).mensagem), !p.pixTipo && React.createElement("p", {
            className: "mt-1 text-sm text-gray-500"
        }, "üëÜ Selecione o tipo da chave acima")), React.createElement("div", {
            className: "flex gap-2"
        }, F && React.createElement("button", {
            onClick: () => {
                $(!1), x(e => ({
                    ...e,
                    finName: T?.full_name || "",
                    finCpf: T?.cpf || "",
                    finPix: T?.pix_key || "",
                    pixTipo: T?.pix_tipo || ""
                }))
            },
            className: "flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition"
        }, "‚úï Cancelar"), React.createElement("button", {
            onClick: Bl,
            disabled: c || !p.pixTipo,
            className: (F ? "flex-1" : "w-full") + " bg-blue-600 text-white py-3 rounded-lg font-bold disabled:opacity-50 disabled:cursor-not-allowed hover:bg-blue-700 transition"
        }, c ? "..." : "üíæ Salvar Dados")))), "gratuidades" === p.saqueTab && React.createElement(React.Fragment, null, React.createElement("h3", {
            className: "font-semibold mb-4"
        }, "üéÅ Minhas Gratuidades"), 0 === G.length ? React.createElement("p", {
            className: "text-gray-500"
        }, "Nenhuma") : React.createElement("div", {
            className: "space-y-3"
        }, G.map(e => React.createElement("div", {
            key: e.id,
            className: "border rounded-lg p-4 " + ("ativa" === e.status ? "border-green-300 bg-green-50" : "bg-gray-50")
        }, React.createElement("div", {
            className: "flex justify-between"
        }, React.createElement("div", null, React.createElement("p", {
            className: "font-bold"
        }, e.remaining, "/", e.quantity, " restantes"), React.createElement("p", {
            className: "text-sm text-gray-600"
        }, "Valor: ", er(e.value))), React.createElement("span", {
            className: "px-3 py-1 rounded-full text-xs font-bold h-fit " + ("ativa" === e.status ? "bg-green-500 text-white" : "bg-gray-400 text-white")
        }, e.status))))))))) : React.createElement("div", {
            className: "bg-white rounded-xl shadow p-6"
        }, React.createElement("h2", {
            className: "text-xl font-bold text-purple-900 mb-4"
        }, "üí≥ Cadastrar Dados Financeiros"), React.createElement("p", {
            className: "text-sm text-gray-600 mb-4"
        }, "Preencha seus dados para receber os saques via PIX."), React.createElement("div", {
            className: "space-y-4"
        }, React.createElement("div", null, React.createElement("label", {
            className: "block text-sm font-semibold mb-1"
        }, "C√≥digo do Profissional"), React.createElement("input", {
            type: "text",
            value: l.codProfissional,
            disabled: !0,
            className: "w-full px-4 py-2 border rounded-lg bg-gray-100 text-gray-600"
        })), React.createElement("div", null, React.createElement("label", {
            className: "block text-sm font-semibold mb-1"
        }, "Nome Completo *"), React.createElement("input", {
            type: "text",
            value: p.finName || "",
            onChange: e => x({
                ...p,
                finName: e.target.value
            }),
            className: "w-full px-4 py-2 border rounded-lg",
            placeholder: "Seu nome completo"
        })), React.createElement("div", null, React.createElement("label", {
            className: "block text-sm font-semibold mb-1"
        }, "CPF *"), React.createElement("input", {
            type: "text",
            value: p.finCpf || "",
            onChange: e => x({
                ...p,
                finCpf: Xl(e.target.value)
            }),
            className: "w-full px-4 py-2 border rounded-lg",
            placeholder: "000.000.000-00",
            maxLength: 14
        })), React.createElement("div", null, React.createElement("label", {
            className: "block text-sm font-semibold mb-2"
        }, "Tipo da Chave PIX *"), React.createElement("div", {
            className: "grid grid-cols-5 gap-2"
        }, [{
            id: "cpf",
            label: "CPF",
            icon: "ü™™"
        }, {
            id: "cnpj",
            label: "CNPJ",
            icon: "üè¢"
        }, {
            id: "telefone",
            label: "Telefone",
            icon: "üì±"
        }, {
            id: "email",
            label: "Email",
            icon: "üìß"
        }, {
            id: "aleatoria",
            label: "Aleat√≥ria",
            icon: "üîë"
        }].map(e => React.createElement("button", {
            key: e.id,
            type: "button",
            onClick: () => x({
                ...p,
                pixTipo: e.id,
                finPix: ""
            }),
            className: "p-2 rounded-lg border-2 text-center transition-all " + (p.pixTipo === e.id ? "border-purple-500 bg-purple-50 text-purple-700" : "border-gray-200 hover:border-gray-300")
        }, React.createElement("span", {
            className: "text-xl"
        }, e.icon), React.createElement("p", {
            className: "text-xs font-semibold mt-1"
        }, e.label))))), React.createElement("div", null, React.createElement("label", {
            className: "block text-sm font-semibold mb-1"
        }, "Chave PIX *"), React.createElement("input", {
            type: "email" === p.pixTipo ? "email" : "text",
            value: p.finPix || "",
            onChange: e => x({
                ...p,
                finPix: ar(e.target.value, p.pixTipo)
            }),
            placeholder: lr(p.pixTipo),
            disabled: !p.pixTipo,
            maxLength: "cpf" === p.pixTipo ? 14 : "cnpj" === p.pixTipo ? 18 : "telefone" === p.pixTipo ? 15 : 100,
            className: "w-full px-4 py-2 border rounded-lg transition-all " + (p.pixTipo ? p.finPix ? tr(p.finPix, p.pixTipo).valido ? "border-green-500 bg-green-50" : "border-red-500 bg-red-50" : "" : "bg-gray-100 cursor-not-allowed")
        }), p.finPix && p.pixTipo && React.createElement("p", {
            className: "mt-1 text-sm " + (tr(p.finPix, p.pixTipo).valido ? "text-green-600" : "text-red-600")
        }, tr(p.finPix, p.pixTipo).mensagem), !p.pixTipo && React.createElement("p", {
            className: "mt-1 text-sm text-gray-500"
        }, "üëÜ Selecione o tipo da chave acima")), React.createElement("button", {
            onClick: Bl,
            disabled: c || !p.pixTipo || !p.finName || !p.finCpf || !p.finPix,
            className: "w-full bg-purple-600 text-white py-3 rounded-lg font-bold disabled:opacity-50 disabled:cursor-not-allowed hover:bg-purple-700 transition"
        }, c ? "‚è≥ Salvando..." : "üíæ Salvar Dados"))) : React.createElement("div", {
            className: "bg-white rounded-xl shadow p-6"
        }, React.createElement("h2", {
            className: "text-2xl font-bold text-purple-900 mb-4 text-center"
        }, "üìã Termos de Uso"), React.createElement("div", {
            className: "bg-gray-50 rounded-lg p-4 mb-6 max-h-80 overflow-y-auto text-sm"
        }, React.createElement("p", {
            className: "text-gray-700 leading-relaxed"
        }, "Uma taxa administrativa de 4,5% ser√° aplicada sobre o valor solicitado e deduzida automaticamente na transfer√™ncia. As solicita√ß√µes s√£o processadas de segunda a sexta, das 09:00 √†s 18:00, e aos s√°bados, das 08:00 √†s 12:00. Solicita√ß√µes feitas fora desse hor√°rio ser√£o atendidas no pr√≥ximo dia √∫til. √â sua responsabilidade garantir que as informa√ß√µes fornecidas estejam corretas, pois n√£o nos responsabilizamos por atrasos ou transfer√™ncias erradas causadas por dados incorretos. O dinheiro ser√° transferido em at√© 1 hora ap√≥s a confirma√ß√£o, dentro do hor√°rio de funcionamento.")), React.createElement("button", {
            onClick: zl,
            disabled: c,
            className: "w-full bg-purple-600 text-white py-3 rounded-lg font-bold disabled:opacity-50"
        }, c ? "Aguarde..." : "‚úì Aceitar e Continuar"))) : React.createElement("div", {
            className: "space-y-4"
        }, Qe.map(e => React.createElement("div", {
            key: e.id,
            className: "p-4 rounded-xl border-l-4 " + ("error" === e.tipo ? "bg-red-50 border-red-500" : "warning" === e.tipo ? "bg-yellow-50 border-yellow-500" : "success" === e.tipo ? "bg-green-50 border-green-500" : "bg-blue-50 border-blue-500")
        }, React.createElement("p", {
            className: "font-bold text-sm mb-1"
        }, e.titulo), React.createElement("p", {
            className: "text-sm text-gray-700"
        }, e.mensagem))), React.createElement("div", {
            className: "bg-orange-50 border-2 border-orange-400 rounded-2xl p-6"
        }, React.createElement("div", {
            className: "text-center mb-6"
        }, React.createElement("div", {
            className: "text-6xl mb-4"
        }, "üïê"), React.createElement("h2", {
            className: "text-xl font-bold text-orange-800 mb-2"
        }, "Fora do Hor√°rio de Atendimento"), React.createElement("p", {
            className: "text-orange-700"
        }, "O atendimento de saques estar√° dispon√≠vel novamente ", React.createElement("strong", null, yl()), ".")), React.createElement("div", {
            className: "bg-white rounded-xl p-4 mb-6"
        }, React.createElement("p", {
            className: "text-sm text-gray-700 text-center"
        }, "‚ö†Ô∏è Voc√™ pode solicitar o saque agora, mas ele s√≥ ser√° processado quando o atendimento reabrir.")), React.createElement("div", {
            className: "bg-orange-100 rounded-xl p-4"
        }, React.createElement("p", {
            className: "text-sm font-semibold text-orange-800 mb-4 text-center"
        }, "Arraste o cursor para confirmar que entendeu:"), React.createElement("div", {
            className: "relative h-14 bg-orange-200 rounded-full overflow-hidden touch-none select-none",
            onTouchStart: e => {
                const t = e.touches[0],
                    a = e.currentTarget.getBoundingClientRect(),
                    l = Math.max(0, Math.min(100, (t.clientX - a.left) / a.width * 100));
                Je(l)
            },
            onTouchMove: e => {
                const t = e.touches[0],
                    a = e.currentTarget.getBoundingClientRect(),
                    l = Math.max(0, Math.min(100, (t.clientX - a.left) / a.width * 100));
                Je(l), l >= 95 && !Ge && (We(!0), ja("‚úÖ Voc√™ pode prosseguir com a solicita√ß√£o!", "success"))
            },
            onMouseDown: e => {
                const t = e.currentTarget.getBoundingClientRect(),
                    a = Math.max(0, Math.min(100, (e.clientX - t.left) / t.width * 100));
                Je(a);
                const l = e => {
                        const a = Math.max(0, Math.min(100, (e.clientX - t.left) / t.width * 100));
                        Je(a), a >= 95 && !Ge && (We(!0), ja("‚úÖ Voc√™ pode prosseguir com a solicita√ß√£o!", "success"))
                    },
                    r = () => {
                        document.removeEventListener("mousemove", l), document.removeEventListener("mouseup", r)
                    };
                document.addEventListener("mousemove", l), document.addEventListener("mouseup", r)
            }
        }, React.createElement("div", {
            className: "absolute top-0 left-0 h-full bg-gradient-to-r from-orange-400 via-yellow-400 to-green-500 rounded-full",
            style: {
                width: `${Ve}%`,
                transition: "none"
            }
        }), React.createElement("div", {
            className: "absolute top-1 w-12 h-12 bg-white rounded-full shadow-lg flex items-center justify-center text-2xl pointer-events-none border-2 border-orange-300",
            style: {
                left: `calc(${Ve}% - ${.48*Ve}px)`,
                transition: "none",
                transform: Ve >= 95 ? "scale(1.1)" : "scale(1)"
            }
        }, Ve < 95 ? "üëâ" : "‚úÖ"), React.createElement("div", {
            className: "absolute inset-0 flex items-center justify-end pr-4 pointer-events-none"
        }, React.createElement("span", {
            className: "font-bold text-sm " + (Ve < 95 ? "text-orange-700" : "text-green-700")
        }, Ve < 30 ? "Arraste ‚Üí‚Üí‚Üí" : Ve < 95 ? "Continue ‚Üí" : "‚úì OK!"))))))), "indicacoes" === p.userTab && React.createElement(React.Fragment, null, React.createElement("div", {
            className: "bg-gradient-to-br from-blue-600 to-purple-700 rounded-xl shadow-lg p-6 mb-6 text-white"
        }, React.createElement("div", {
            className: "flex items-center gap-4 mb-4"
        }, React.createElement("div", {
            className: "text-5xl"
        }, "üîó"), React.createElement("div", null, React.createElement("h2", {
            className: "text-2xl font-bold"
        }, "Indique e Ganhe!"), React.createElement("p", {
            className: "text-blue-200"
        }, "Escolha uma promo√ß√£o e compartilhe seu link de indica√ß√£o"))), p.statsIndicacao && React.createElement("div", {
            className: "grid grid-cols-4 gap-3"
        }, React.createElement("div", {
            className: "bg-white/10 rounded-lg p-3 text-center"
        }, React.createElement("p", {
            className: "text-2xl font-bold"
        }, p.statsIndicacao.total || 0), React.createElement("p", {
            className: "text-xs text-blue-200"
        }, "Total")), React.createElement("div", {
            className: "bg-yellow-500/30 rounded-lg p-3 text-center"
        }, React.createElement("p", {
            className: "text-2xl font-bold"
        }, p.statsIndicacao.pendentes || 0), React.createElement("p", {
            className: "text-xs text-yellow-200"
        }, "Pendentes")), React.createElement("div", {
            className: "bg-green-500/30 rounded-lg p-3 text-center"
        }, React.createElement("p", {
            className: "text-2xl font-bold"
        }, p.statsIndicacao.aprovadas || 0), React.createElement("p", {
            className: "text-xs text-green-200"
        }, "Aprovadas")), React.createElement("div", {
            className: "bg-red-500/30 rounded-lg p-3 text-center"
        }, React.createElement("p", {
            className: "text-2xl font-bold"
        }, p.statsIndicacao.rejeitadas || 0), React.createElement("p", {
            className: "text-xs text-red-200"
        }, "Rejeitadas")))), React.createElement("div", {
            className: "bg-white rounded-xl shadow p-6 mb-6"
        }, React.createElement("h2", {
            className: "text-xl font-bold text-purple-800 mb-4"
        }, "üéØ Promo√ß√µes de Indica√ß√£o Dispon√≠veis"), 0 === getPromocoesFiltradas().length ? React.createElement("div", {
            className: "text-center py-8 text-gray-500"
        }, React.createElement("p", {
            className: "text-4xl mb-2"
        }, "üì¢"), React.createElement("p", null, "Nenhuma promo√ß√£o dispon√≠vel no momento"), React.createElement("p", {
            className: "text-sm"
        }, "Fique atento, novas promo√ß√µes podem aparecer a qualquer momento!")) : React.createElement("div", {
            className: "grid md:grid-cols-2 gap-4"
        }, getPromocoesFiltradas().map(e => React.createElement("div", {
            key: e.id,
            className: "border-2 border-purple-200 bg-gradient-to-br from-purple-50 to-white rounded-xl p-6"
        }, React.createElement("div", {
            className: "flex justify-between items-start mb-3"
        }, React.createElement("span", {
            className: "px-3 py-1 bg-green-500 text-white rounded-full text-xs font-bold"
        }, "üî• ATIVA")), React.createElement("p", {
            className: "text-lg font-bold text-gray-800 mb-1"
        }, "üìç ", e.regiao), React.createElement("p", {
            className: "text-3xl font-bold text-green-600 mb-3"
        }, er(e.valor_bonus)), e.detalhes && React.createElement("div", {
            className: "bg-white border border-purple-200 rounded-lg p-3 mb-4"
        }, React.createElement("p", {
            className: "text-sm text-gray-700 whitespace-pre-wrap"
        }, e.detalhes)), p.linkPromoSelecionada === e.id && p.meuLinkIndicacao?.token ? React.createElement("div", {
            className: "space-y-3"
        }, React.createElement("div", {
            className: "bg-purple-100 rounded-lg p-3"
        }, React.createElement("p", {
            className: "text-xs text-purple-600 mb-1"
        }, "Seu link para esta promo√ß√£o:"), React.createElement("div", {
            className: "flex gap-2"
        }, React.createElement("input", {
            type: "text",
            readOnly: !0,
            value: `${window.location.origin}/#/indicar/${p.meuLinkIndicacao.token}`,
            className: "flex-1 px-3 py-2 bg-white border border-purple-300 rounded-lg text-gray-800 font-mono text-xs"
        }), React.createElement("button", {
            onClick: () => {
                navigator.clipboard.writeText(`${window.location.origin}/#/indicar/${p.meuLinkIndicacao.token}`), ja("‚úÖ Link copiado!", "success")
            },
            className: "px-3 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-bold text-sm"
        }, "üìã"))), React.createElement("button", {
            onClick: () => {
                const e = `üöÄ Fala, parceiro(a)!\n\nEstou te indicando para realizar entregas comigo no aplicativo TUTTS! üíúüì¶ \n\nFa√ßa seu cadastro pelo link abaixo, rode pelo menos 5 dias e garanta um b√¥nus de R$ 30,00 no final! üí∞‚ú®\n\nüëâ Link para cadastro: ${window.location.origin}/#/indicar/${p.meuLinkIndicacao.token}\n\nVem ganhar com a gente! üõµüî•`;
                window.open(`https://wa.me/?text=${encodeURIComponent(e)}`, "_blank")
            },
            className: "w-full px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold flex items-center justify-center gap-2"
        }, React.createElement("span", null, "üì±"), " Compartilhar no WhatsApp")) : React.createElement("button", {
            onClick: async () => {
                try {
                    s(!0);
                    const t = await fetchAuth(`${API_URL}/indicacao-link/gerar`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            user_cod: l.codProfissional,
                            user_name: l.fullName,
                            promocao_id: e.id,
                            regiao: e.regiao,
                            valor_bonus: e.valor_bonus
                        })
                    });
                    if (!t.ok) {
                        const e = await t.json().catch(() => ({}));
                        return ja("‚ùå Erro: " + (e.error || t.status), "error"), void s(!1)
                    }
                    const a = await t.json();
                    if (!a || !a.token) return ja("‚ùå Erro: token n√£o gerado", "error"), void s(!1);
                    x({
                        ...p,
                        meuLinkIndicacao: a,
                        linkPromoSelecionada: e.id
                    }), ja("‚úÖ Link gerado!", "success")
                } catch (e) {
                    ja("‚ùå Erro: " + e.message, "error")
                }
                s(!1)
            },
            disabled: c,
            className: "w-full px-4 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold disabled:opacity-50"
        }, c ? "‚è≥ Gerando..." : "üîó Gerar Link de Indica√ß√£o"))))), React.createElement("div", {
            className: "bg-white rounded-xl shadow p-6 mb-6"
        }, React.createElement("h3", {
            className: "text-lg font-bold text-gray-800 mb-4"
        }, "üìñ Como Funciona"), React.createElement("div", {
            className: "grid md:grid-cols-4 gap-4"
        }, React.createElement("div", {
            className: "bg-blue-50 rounded-lg p-4 text-center"
        }, React.createElement("div", {
            className: "text-3xl mb-2"
        }, "1Ô∏è‚É£"), React.createElement("p", {
            className: "font-semibold text-blue-800"
        }, "Escolha"), React.createElement("p", {
            className: "text-sm text-gray-600"
        }, "Selecione uma promo√ß√£o ativa")), React.createElement("div", {
            className: "bg-purple-50 rounded-lg p-4 text-center"
        }, React.createElement("div", {
            className: "text-3xl mb-2"
        }, "2Ô∏è‚É£"), React.createElement("p", {
            className: "font-semibold text-purple-800"
        }, "Gere o Link"), React.createElement("p", {
            className: "text-sm text-gray-600"
        }, "Clique para criar seu link √∫nico")), React.createElement("div", {
            className: "bg-green-50 rounded-lg p-4 text-center"
        }, React.createElement("div", {
            className: "text-3xl mb-2"
        }, "3Ô∏è‚É£"), React.createElement("p", {
            className: "font-semibold text-green-800"
        }, "Compartilhe"), React.createElement("p", {
            className: "text-sm text-gray-600"
        }, "Envie pelo WhatsApp")), React.createElement("div", {
            className: "bg-yellow-50 rounded-lg p-4 text-center"
        }, React.createElement("div", {
            className: "text-3xl mb-2"
        }, "4Ô∏è‚É£"), React.createElement("p", {
            className: "font-semibold text-yellow-800"
        }, "Ganhe"), React.createElement("p", {
            className: "text-sm text-gray-600"
        }, "Receba o b√¥nus no repasse")))), React.createElement("div", {
            className: "bg-white rounded-xl shadow p-6"
        }, React.createElement("h2", {
            className: "text-lg font-bold text-gray-800 mb-4"
        }, "üìã Minhas Indica√ß√µes"), 0 === re.length ? React.createElement("div", {
            className: "text-center py-8 text-gray-500"
        }, React.createElement("p", {
            className: "text-4xl mb-2"
        }, "üë•"), React.createElement("p", null, "Voc√™ ainda n√£o tem indica√ß√µes"), React.createElement("p", {
            className: "text-sm"
        }, "Compartilhe seu link e comece a indicar!")) : React.createElement("div", {
            className: "space-y-4"
        }, re.map(e => React.createElement("div", {
            key: e.id,
            className: "border rounded-xl p-4 " + ("aprovada" === e.status ? "border-green-300 bg-green-50" : "rejeitada" === e.status ? "border-red-300 bg-red-50" : "border-yellow-300 bg-yellow-50")
        }, React.createElement("div", {
            className: "flex justify-between items-start"
        }, React.createElement("div", null, React.createElement("p", {
            className: "font-bold text-lg"
        }, e.indicado_nome), React.createElement("p", {
            className: "text-sm text-gray-600"
        }, "üìû ", e.indicado_contato), e.regiao && React.createElement("p", {
            className: "text-sm text-purple-600"
        }, "üìç ", e.regiao), e.valor_bonus && React.createElement("p", {
            className: "text-sm text-green-600 font-semibold"
        }, "üí∞ ", er(e.valor_bonus)), React.createElement("p", {
            className: "text-xs text-gray-500 mt-1"
        }, "Cadastrado em ", new Date(e.created_at).toLocaleDateString("pt-BR"))), React.createElement("div", {
            className: "text-right"
        }, React.createElement("span", {
            className: "inline-block px-3 py-1 rounded-full text-xs font-bold " + ("pendente" === e.status ? "bg-yellow-500 text-white" : "aprovada" === e.status ? "bg-green-500 text-white" : "bg-red-500 text-white")
        }, "pendente" === e.status ? "‚è≥ Pendente" : "aprovada" === e.status ? "‚úÖ Aprovada" : "‚ùå Rejeitada"))), "aprovada" === e.status && React.createElement("div", {
            className: "mt-3 bg-green-100 border border-green-300 rounded-lg p-3"
        }, React.createElement("p", {
            className: "text-green-800 text-sm"
        }, "üéâ ", React.createElement("strong", null, "Parab√©ns!"), " Sua indica√ß√£o foi aprovada! ", e.valor_bonus && `B√¥nus de ${er(e.valor_bonus)} ser√° creditado.`)), "rejeitada" === e.status && e.motivo_rejeicao && React.createElement("div", {
            className: "mt-3 bg-red-100 border border-red-300 rounded-lg p-3"
        }, React.createElement("p", {
            className: "text-red-800 text-sm"
        }, React.createElement("strong", null, "Motivo:"), " ", e.motivo_rejeicao))))))), "promo-novatos" === p.userTab && React.createElement(React.Fragment, null, fe.ativo && !we && 0 === Ae && React.createElement("div", {
            className: "bg-gradient-to-r from-purple-600 to-purple-800 rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 text-white"
        }, React.createElement("div", {
            className: "text-center"
        }, React.createElement("div", {
            className: "text-4xl sm:text-5xl mb-3 sm:mb-4"
        }, "üéØ"), React.createElement("h2", {
            className: "text-lg sm:text-xl font-bold mb-2"
        }, fe.titulo), React.createElement("p", {
            className: "text-purple-200 mb-3 sm:mb-4 text-sm sm:text-base"
        }, "Responda corretamente e ganhe gratuidade no seu pr√≥ximo saque!"), React.createElement("div", {
            className: "bg-white/20 rounded-lg p-3 sm:p-4 mb-3 sm:mb-4"
        }, React.createElement("p", {
            className: "text-xl sm:text-2xl font-bold text-yellow-300"
        }, "üí∞ R$ ", fe.valor_gratuidade.toFixed(2).replace(".", ",")), React.createElement("p", {
            className: "text-xs sm:text-sm text-purple-200"
        }, "de gratuidade se acertar tudo!")), React.createElement("button", {
            onClick: () => {
                Se(1), Pe(0)
            },
            className: "px-6 sm:px-8 py-2.5 sm:py-3 bg-yellow-400 text-purple-900 rounded-lg font-bold text-base sm:text-lg hover:bg-yellow-300 active:scale-95 transition-transform"
        }, "üöÄ Come√ßar Quiz!"))), 1 === Ae && React.createElement("div", {
            className: "bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6"
        }, React.createElement("div", {
            className: "text-center mb-3 sm:mb-4"
        }, React.createElement("h2", {
            className: "text-lg sm:text-xl font-bold text-purple-700"
        }, "üì∏ Conhe√ßa os Procedimentos"), React.createElement("p", {
            className: "text-gray-500 text-xs sm:text-sm"
        }, "Veja as imagens com aten√ß√£o antes de responder"), React.createElement("p", {
            className: "text-purple-600 font-semibold mt-2 text-sm sm:text-base"
        }, "Imagem ", ke + 1, " de 4")), React.createElement("div", {
            className: "relative bg-gray-100 rounded-xl overflow-hidden mb-3 sm:mb-4",
            style: {
                minHeight: "200px"
            }
        }, fe.imagens[ke] ? React.createElement("img", {
            src: fe.imagens[ke],
            alt: `Procedimento ${ke+1}`,
            className: "w-full h-full object-contain",
            style: {
                maxHeight: "300px"
            }
        }) : React.createElement("div", {
            className: "flex items-center justify-center h-48 sm:h-64 text-gray-400"
        }, React.createElement("p", null, "Imagem n√£o dispon√≠vel"))), React.createElement("div", {
            className: "flex justify-center gap-2 mb-3 sm:mb-4"
        }, [0, 1, 2, 3].map(e => React.createElement("button", {
            key: e,
            onClick: () => Pe(e),
            className: "w-3 h-3 rounded-full transition " + (ke === e ? "bg-purple-600" : "bg-gray-300")
        }))), React.createElement("div", {
            className: "flex justify-between gap-2"
        }, React.createElement("button", {
            onClick: () => Pe(Math.max(0, ke - 1)),
            disabled: 0 === ke,
            className: "px-4 sm:px-6 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold disabled:opacity-50 text-sm sm:text-base"
        }, "‚Üê Anterior"), ke < 3 ? React.createElement("button", {
            onClick: () => Pe(ke + 1),
            className: "px-4 sm:px-6 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 text-sm sm:text-base"
        }, "Pr√≥xima ‚Üí") : React.createElement("button", {
            onClick: () => Se(2),
            className: "px-4 sm:px-6 py-2 bg-green-600 text-white rounded-lg font-bold hover:bg-green-700 text-sm sm:text-base"
        }, "‚úÖ Ir para o Quiz!"))), 2 === Ae && React.createElement("div", {
            className: "bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6"
        }, React.createElement("div", {
            className: "text-center mb-4 sm:mb-6"
        }, React.createElement("h2", {
            className: "text-lg sm:text-xl font-bold text-purple-700"
        }, "‚ùì Responda: CERTO ou ERRADO?"), React.createElement("p", {
            className: "text-gray-500 text-xs sm:text-sm"
        }, "Acerte as 5 afirma√ß√µes para ganhar a gratuidade")), React.createElement("div", {
            className: "space-y-3 sm:space-y-4 mb-4 sm:mb-6"
        }, fe.perguntas.map((e, t) => React.createElement("div", {
            key: t,
            className: "border-2 rounded-xl p-3 sm:p-4 transition " + (null !== Te[t] ? "border-purple-300 bg-purple-50" : "border-gray-200")
        }, React.createElement("p", {
            className: "font-semibold text-gray-800 mb-2 sm:mb-3 text-sm sm:text-base"
        }, React.createElement("span", {
            className: "text-purple-600"
        }, t + 1, "."), " ", e.texto), React.createElement("div", {
            className: "flex gap-2 sm:gap-3"
        }, React.createElement("button", {
            onClick: () => {
                const e = [...Te];
                e[t] = !0, De(e)
            },
            className: "flex-1 py-2.5 sm:py-3 rounded-lg font-bold text-sm sm:text-lg transition " + (!0 === Te[t] ? "bg-green-500 text-white" : "bg-green-100 text-green-700 hover:bg-green-200")
        }, "‚úì CERTO"), React.createElement("button", {
            onClick: () => {
                const e = [...Te];
                e[t] = !1, De(e)
            },
            className: "flex-1 py-2.5 sm:py-3 rounded-lg font-bold text-sm sm:text-lg transition " + (!1 === Te[t] ? "bg-red-500 text-white" : "bg-red-100 text-red-700 hover:bg-red-200")
        }, "‚úó ERRADO"))))), React.createElement("div", {
            className: "flex flex-col sm:flex-row gap-2 sm:gap-3"
        }, React.createElement("button", {
            onClick: () => Se(1),
            className: "px-4 sm:px-6 py-2.5 sm:py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold text-sm sm:text-base"
        }, "‚Üê Voltar √†s imagens"), React.createElement("button", {
            onClick: $l,
            disabled: c || Te.some(e => null === e),
            className: "flex-1 py-2.5 sm:py-3 bg-purple-600 text-white rounded-lg font-bold text-sm sm:text-lg hover:bg-purple-700 disabled:opacity-50"
        }, c ? "Enviando..." : "üéØ Enviar Respostas")), React.createElement("p", {
            className: "text-center text-xs text-gray-500 mt-3"
        }, "‚ö†Ô∏è Voc√™ tem apenas UMA chance de responder este quiz!")), 3 === Ae && Le && React.createElement("div", {
            className: `rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 text-center ${Le.passou?"bg-green-500":"bg-red-500"} text-white`
        }, React.createElement("div", {
            className: "text-5xl sm:text-6xl mb-3 sm:mb-4"
        }, Le.passou ? "üéâ" : "üò¢"), React.createElement("h2", {
            className: "text-xl sm:text-2xl font-bold mb-2"
        }, Le.passou ? "Parab√©ns! Voc√™ passou!" : "Que pena! N√£o foi dessa vez..."), React.createElement("p", {
            className: "text-base sm:text-lg mb-3 sm:mb-4"
        }, "Voc√™ acertou ", React.createElement("strong", null, Le.acertos), " de ", React.createElement("strong", null, "5"), " perguntas"), Le.passou && React.createElement("div", {
            className: "bg-white/20 rounded-lg p-3 sm:p-4 mb-3 sm:mb-4"
        }, React.createElement("p", {
            className: "text-lg sm:text-xl font-bold"
        }, "üí∞ R$ ", Le.valor_gratuidade.toFixed(2).replace(".", ",")), React.createElement("p", {
            className: "text-xs sm:text-sm"
        }, "foi adicionado √†s suas gratuidades!")), React.createElement("button", {
            onClick: () => Se(0),
            className: "px-6 py-2 bg-white text-gray-800 rounded-lg font-semibold text-sm sm:text-base"
        }, "Fechar")), fe.ativo && we && 0 === Ae && React.createElement("div", {
            className: "bg-gray-100 border-2 border-gray-300 rounded-xl p-4 sm:p-6 mb-4 sm:mb-6 text-center"
        }, React.createElement("div", {
            className: "text-3xl sm:text-4xl mb-2"
        }, "‚úÖ"), React.createElement("p", {
            className: "text-gray-600 font-semibold text-sm sm:text-base"
        }, "Voc√™ j√° participou do Quiz de Procedimentos"), React.createElement("p", {
            className: "text-gray-500 text-xs sm:text-sm"
        }, "Esta promo√ß√£o s√≥ pode ser usada uma vez")), React.createElement("hr", {
            className: "my-4 sm:my-6 border-gray-200"
        }), React.createElement("div", {
            className: "bg-white rounded-xl shadow p-3 sm:p-6 mb-3 sm:mb-6"
        }, React.createElement("h2", {
            className: "text-sm sm:text-lg font-bold text-orange-700 mb-3 sm:mb-4"
        }, "üöÄ Promo√ß√µes Dispon√≠veis"), 0 === ce.length ? React.createElement("div", {
            className: "text-center py-4 sm:py-8"
        }, React.createElement("p", {
            className: "text-4xl sm:text-6xl mb-3"
        }, "üòï"), React.createElement("p", {
            className: "text-gray-500 font-semibold text-xs sm:text-base"
        }, "Nenhuma promo√ß√£o dispon√≠vel no momento"), React.createElement("p", {
            className: "text-gray-400 text-xs"
        }, "Volte mais tarde")) : React.createElement("div", {
            className: "space-y-2 sm:space-y-4"
        }, ce.map(e => {
            const t = ie.some(t => t.promocao_id === e.id);
            return React.createElement("div", {
                key: e.id,
                className: "border border-orange-200 bg-orange-50 rounded-lg p-2.5 sm:p-4"
            }, React.createElement("div", {
                className: "flex justify-between items-start gap-2 mb-1.5 sm:mb-2"
            }, React.createElement("div", {
                className: "flex-1 min-w-0"
            }, React.createElement("p", {
                className: "text-[10px] sm:text-sm text-gray-500"
            }, "üìç ", e.regiao), React.createElement("p", {
                className: "font-bold text-sm sm:text-lg text-gray-800 leading-tight"
            }, "üè¢ ", e.apelido || e.cliente)), React.createElement("span", {
                className: "px-2 py-0.5 sm:py-1 bg-green-500 text-white rounded-full text-[11px] sm:text-sm font-bold flex-shrink-0"
            }, er(e.valor_bonus))), e.detalhes && React.createElement("p", {
                className: "text-[11px] sm:text-sm text-gray-600 mb-2 line-clamp-2 leading-snug"
            }, e.detalhes), React.createElement("div", {
                className: "bg-yellow-100/70 border border-yellow-300 rounded p-1.5 sm:p-2 mb-2 sm:mb-3"
            }, React.createElement("p", {
                className: "text-[10px] sm:text-xs text-yellow-800"
            }, "‚è±Ô∏è Voc√™ ter√° ", React.createElement("strong", null, "15 dias"), " para completar ", React.createElement("strong", null, e.quantidade_entregas || 50, " entregas"))), t ? React.createElement("button", {
                disabled: !0,
                className: "w-full py-2 sm:py-2.5 bg-gray-300 text-gray-600 rounded-lg font-semibold cursor-not-allowed text-xs sm:text-sm"
            }, "‚úÖ J√° inscrito") : React.createElement("button", {
                onClick: () => (async e => {
                    s(!0);
                    try {
                        const t = await fetchAuth(`${API_URL}/inscricoes-novatos`, {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify({
                                promocao_id: e.id,
                                user_cod: l.codProfissional,
                                user_name: l.fullName,
                                valor_bonus: e.valor_bonus,
                                regiao: e.regiao,
                                cliente: e.apelido || e.cliente
                            })
                        });
                        if (!t.ok) {
                            const e = await t.json();
                            throw new Error(e.error || "Erro ao se inscrever")
                        }
                        ja("‚úÖ Inscri√ß√£o realizada! V√°lida por 15 dias.", "success"), await kl(), await carregarProgressoNovatos(), await verificarElegibilidadeNovatos()
                    } catch (e) {
                        ja(e.message, "error")
                    } finally {
                        s(!1)
                    }
                })(e),
                disabled: c,
                className: "w-full py-2 sm:py-2.5 bg-orange-500 text-white rounded-lg font-semibold hover:bg-orange-600 disabled:opacity-50 text-xs sm:text-base active:scale-[0.98] transition-transform"
            }, c ? "..." : "üöÄ Quero me inscrever!"))
        }))), React.createElement("div", {
            className: "bg-white rounded-xl shadow p-3 sm:p-6"
        }, React.createElement("h2", {
            className: "text-sm sm:text-lg font-bold text-gray-800 mb-3 sm:mb-4"
        }, "üìã Minhas Inscri√ß√µes"), je && React.createElement("div", {
            className: "border rounded-lg p-2.5 sm:p-4 mb-3 " + (je.passou ? "border-green-400 bg-green-50" : "border-red-300 bg-red-50")
        }, React.createElement("div", {
            className: "flex justify-between items-start gap-2"
        }, React.createElement("div", {
            className: "flex items-center gap-2"
        }, React.createElement("span", {
            className: "text-xl sm:text-3xl"
        }, je.passou ? "üéâ" : "üìù"), React.createElement("div", null, React.createElement("p", {
            className: "font-bold text-gray-800 text-xs sm:text-base"
        }, "Quiz de Procedimentos"), React.createElement("p", {
            className: "text-[10px] sm:text-sm text-gray-500"
        }, new Date(je.created_at).toLocaleDateString("pt-BR"), " ‚Ä¢ ", je.acertos, "/5 acertos"))), React.createElement("div", {
            className: "text-right flex-shrink-0"
        }, je.passou && React.createElement("p", {
            className: "font-bold text-green-600 text-sm sm:text-lg"
        }, er(fe.valor_gratuidade)), React.createElement("span", {
            className: "inline-block px-1.5 sm:px-3 py-0.5 sm:py-1 rounded-full text-[10px] sm:text-xs font-bold " + (je.passou ? "bg-green-500 text-white" : "bg-red-400 text-white")
        }, je.passou ? "‚úÖ" : "‚ùå"))), je.passou && React.createElement("div", {
            className: "mt-2 bg-green-100 border border-green-300 rounded p-2"
        }, React.createElement("p", {
            className: "text-green-800 text-[10px] sm:text-sm"
        }, "üéâ Gratuidade de ", er(fe.valor_gratuidade), " adicionada!")), !je.passou && React.createElement("div", {
            className: "mt-2 bg-red-100 border border-red-300 rounded p-2"
        }, React.createElement("p", {
            className: "text-red-800 text-[10px] sm:text-sm"
        }, "üò¢ Necess√°rio acertar 5/5 para ganhar."))), 0 !== ie.length || je ? React.createElement("div", {
            className: "space-y-2 sm:space-y-3"
        }, ie.map(e => {
            const t = e.expires_at ? new Date(e.expires_at) : null,
                a = t && new Date > t,
                progresso = progressoNovatos.find(pg => pg.inscricao_id === e.id);
            return React.createElement("div", {
                key: e.id,
                className: "border rounded-lg p-2.5 sm:p-4 " + ("aprovada" === e.status ? "border-green-300 bg-green-50" : "rejeitada" === e.status ? "border-red-300 bg-red-50" : a ? "border-gray-300 bg-gray-50" : "border-yellow-300 bg-yellow-50")
            }, 
            // Header do card
            React.createElement("div", {
                className: "flex justify-between items-start gap-2"
            }, React.createElement("div", {
                className: "flex-1 min-w-0"
            }, React.createElement("p", {
                className: "font-semibold text-gray-800 text-xs sm:text-base leading-tight"
            }, "üè¢ ", e.cliente), React.createElement("p", {
                className: "text-[10px] sm:text-sm text-gray-500"
            }, "üìç ", e.regiao, " ‚Ä¢ ", new Date(e.created_at).toLocaleDateString("pt-BR")), t && "pendente" === e.status && !a && React.createElement("p", {
                className: "text-[10px] sm:text-xs text-orange-600 font-medium"
            }, "‚è±Ô∏è Expira: ", t.toLocaleDateString("pt-BR"))), React.createElement("div", {
                className: "text-right flex-shrink-0"
            }, React.createElement("p", {
                className: "font-bold text-green-600 text-sm sm:text-lg"
            }, er(e.valor_bonus)), React.createElement("span", {
                className: "inline-block mt-0.5 px-1.5 sm:px-2 py-0.5 rounded-full text-[10px] sm:text-xs font-bold " + ("pendente" !== e.status || a ? "aprovada" === e.status ? "bg-green-200 text-green-800" : "rejeitada" === e.status ? "bg-red-200 text-red-800" : "bg-gray-200 text-gray-800" : "bg-yellow-200 text-yellow-800")
            }, "pendente" === e.status && a ? "‚è∞" : "pendente" === e.status ? "‚è≥" : "aprovada" === e.status ? "‚úÖ" : "‚ùå"))), 
            
            // Barra de progresso de entregas (se inscricao pendente e tem progresso)
            progresso && "pendente" === e.status && !a && React.createElement("div", {
                className: "mt-2 pt-2 border-t border-gray-200"
            }, React.createElement("div", {
                className: "flex justify-between items-center mb-1"
            }, React.createElement("p", {
                className: "text-[10px] sm:text-sm font-semibold text-gray-700"
            }, "üì¶ Entregas"), React.createElement("p", {
                className: "text-xs sm:text-base font-bold " + (progresso.meta_atingida ? "text-green-600" : "text-orange-600")
            }, progresso.total_entregas, "/", progresso.meta_entregas)), React.createElement("div", {
                className: "w-full bg-gray-200 rounded-full h-1.5 sm:h-4 mb-1"
            }, React.createElement("div", {
                className: "h-1.5 sm:h-4 rounded-full transition-all duration-500 " + (progresso.meta_atingida ? "bg-green-500" : progresso.percentual >= 50 ? "bg-yellow-500" : "bg-orange-500"),
                style: { width: progresso.percentual + "%" }
            })), React.createElement("div", {
                className: "flex justify-between items-center"
            }, React.createElement("p", {
                className: "text-[10px] sm:text-xs text-gray-500"
            }, progresso.meta_atingida ? "üéâ Meta atingida!" : progresso.percentual + "%"), React.createElement("button", {
                onClick: () => carregarEntregasInscricao(e.id),
                className: "text-[10px] sm:text-xs text-blue-600 font-semibold px-1.5 sm:px-2 py-0.5 sm:py-1 bg-blue-50 rounded active:scale-95"
            }, "üìã Detalhes"))),
            
            "aprovada" === e.status && React.createElement("div", {
                className: "mt-2 bg-green-100 border border-green-300 rounded p-2"
            }, React.createElement("p", {
                className: "text-green-800 text-[10px] sm:text-sm"
            }, "üéâ B√¥nus de ", er(e.valor_bonus), " no pr√≥ximo repasse!")), "rejeitada" === e.status && e.motivo_rejeicao && React.createElement("div", {
                className: "mt-2 bg-red-100 border border-red-300 rounded p-2"
            }, React.createElement("p", {
                className: "text-red-800 text-[10px] sm:text-sm"
            }, "‚ùå ", e.motivo_rejeicao)))
        })) : React.createElement("p", {
            className: "text-gray-500 text-center py-4"
        }, "Voc√™ ainda n√£o participou de nenhuma promo√ß√£o")),
        
        // Modal de detalhes das entregas
        modalEntregasNovatos && React.createElement("div", {
            className: "fixed inset-0 bg-black/50 flex items-end sm:items-center justify-center z-50"
        }, React.createElement("div", {
            className: "bg-white rounded-t-2xl sm:rounded-xl shadow-xl w-full sm:max-w-md sm:mx-4 max-h-[85vh] sm:max-h-[80vh] overflow-hidden flex flex-col"
        }, React.createElement("div", {
            className: "bg-orange-500 text-white p-3 sm:p-4 flex justify-between items-center flex-shrink-0"
        }, React.createElement("h3", {
            className: "font-bold text-sm sm:text-lg"
        }, "üì¶ Entregas da Promo√ß√£o"), React.createElement("button", {
            onClick: () => setModalEntregasNovatos(null),
            className: "text-white text-xl font-bold w-7 h-7 flex items-center justify-center rounded-full hover:bg-white/20"
        }, "√ó")), React.createElement("div", {
            className: "p-2.5 sm:p-4 flex-1 overflow-y-auto"
        }, React.createElement("div", {
            className: "bg-orange-50 border border-orange-200 rounded-lg p-2.5 sm:p-3 mb-3"
        }, React.createElement("div", {
            className: "flex justify-between items-center gap-2"
        }, React.createElement("span", {
            className: "text-[10px] sm:text-sm text-gray-600"
        }, "üìÖ ", modalEntregasNovatos.data_inscricao ? new Date(modalEntregasNovatos.data_inscricao).toLocaleDateString("pt-BR") : "-", " - ", modalEntregasNovatos.data_expiracao ? new Date(modalEntregasNovatos.data_expiracao).toLocaleDateString("pt-BR") : "-"), React.createElement("span", {
            className: "font-bold text-base sm:text-xl " + (modalEntregasNovatos.meta_atingida ? "text-green-600" : "text-orange-600")
        }, modalEntregasNovatos.total_entregas, "/", modalEntregasNovatos.meta_entregas)), React.createElement("div", {
            className: "w-full bg-gray-200 rounded-full h-2 sm:h-3 mt-2"
        }, React.createElement("div", {
            className: "h-2 sm:h-3 rounded-full transition-all " + (modalEntregasNovatos.meta_atingida ? "bg-green-500" : "bg-orange-500"),
            style: { width: modalEntregasNovatos.percentual + "%" }
        })), React.createElement("p", {
            className: "text-[10px] sm:text-xs text-center mt-1.5 font-semibold " + (modalEntregasNovatos.meta_atingida ? "text-green-600" : "text-gray-500")
        }, modalEntregasNovatos.meta_atingida ? "üéâ Meta atingida!" : modalEntregasNovatos.percentual + "%")), 
        
        // Lista de entregas em formato de cards (mais mobile-friendly)
        React.createElement("div", {
            className: "space-y-1.5 sm:space-y-2"
        }, modalEntregasNovatos.entregas && modalEntregasNovatos.entregas.length > 0 ? 
            modalEntregasNovatos.entregas.map((entrega, idx) => React.createElement("div", {
                key: idx,
                className: "bg-gray-50 rounded p-2 sm:p-3 border border-gray-100"
            }, React.createElement("div", {
                className: "flex justify-between items-center"
            }, React.createElement("div", {
                className: "flex-1 min-w-0"
            }, React.createElement("p", {
                className: "font-semibold text-xs sm:text-sm text-gray-800 truncate"
            }, entrega.nome_cliente || "Cliente"), React.createElement("p", {
                className: "text-[10px] sm:text-xs text-gray-400"
            }, "OS ", entrega.os, " ‚Ä¢ ", entrega.data_solicitado ? new Date(entrega.data_solicitado).toLocaleDateString("pt-BR") : "-")), React.createElement("p", {
                className: "font-bold text-green-600 text-xs sm:text-sm ml-2"
            }, entrega.valor_prof ? er(entrega.valor_prof) : "-"))))
        : React.createElement("div", {
            className: "text-center py-6 text-gray-500"
        }, React.createElement("p", {
            className: "text-3xl mb-2"
        }, "üì≠"), React.createElement("p", {
            className: "text-xs"
        }, "Nenhuma entrega registrada"))))))),
        
"seguro-iza" === p.userTab && React.createElement("div", {
            className: "max-w-lg mx-auto"
        }, React.createElement("div", {
            className: "bg-gradient-to-b from-sky-100 to-white rounded-2xl shadow-xl overflow-hidden"
        }, React.createElement("div", {
            className: "bg-gradient-to-r from-blue-600 to-blue-700 text-white text-center py-4 px-4"
        }, React.createElement("h2", {
            className: "text-xl font-bold tracking-wide"
        }, "üõ°Ô∏è SEGURO DE VIDA PARA"), React.createElement("h2", {
            className: "text-xl font-bold tracking-wide"
        }, "ENTREGADORES TUTTS")), React.createElement("div", {
            className: "p-4 space-y-4"
        }, React.createElement("div", {
            className: "bg-white rounded-xl shadow border-l-4 border-yellow-400 overflow-hidden"
        }, React.createElement("div", {
            className: "bg-yellow-400 text-yellow-900 font-bold text-center py-2 text-sm italic"
        }, "QUANDO EST√Å ATIVO?"), React.createElement("div", {
            className: "p-4 space-y-2 text-sm text-gray-700"
        }, React.createElement("p", null, "üïê Durante a entrega (aceite √† finaliza√ß√£o)"), React.createElement("p", null, "‚è≥ ", React.createElement("strong", null, "Limite:"), " 60 min por entrega (encerra ap√≥s)"), React.createElement("p", null, "‚ùå ", React.createElement("strong", null, "N√£o cobre:"), " Trajeto casa/pessoal"))), React.createElement("div", {
            className: "bg-white rounded-xl shadow border-l-4 border-green-500 overflow-hidden"
        }, React.createElement("div", {
            className: "bg-green-500 text-white font-bold text-center py-2 text-sm"
        }, "COBERTURAS E VALORES"), React.createElement("div", {
            className: "p-4 space-y-2 text-sm text-gray-700"
        }, React.createElement("p", null, "‚ò†Ô∏è ", React.createElement("strong", null, "Morte Acidental:"), " R$ 20.000"), React.createElement("p", null, "üí∞ ", React.createElement("strong", null, "Invalidez Perm.:"), " R$ 20.000"), React.createElement("p", null, "üè• ", React.createElement("strong", null, "Desp. M√©dicas/Hosp.:"), " At√© R$ 5.000"), React.createElement("p", null, "üìÖ ", React.createElement("strong", null, "Di√°ria Incapacidade:"), " R$ 80/dia (30 dias)"), React.createElement("p", null, "‚ö∞Ô∏è ", React.createElement("strong", null, "Funeral:"), " R$ 5.000"))), React.createElement("div", {
            className: "bg-white rounded-xl shadow border-l-4 border-red-500 overflow-hidden"
        }, React.createElement("div", {
            className: "bg-red-500 text-white font-bold text-center py-2 text-sm"
        }, "QUANDO N√ÉO COBRE?"), React.createElement("div", {
            className: "p-4 space-y-2 text-sm text-gray-700"
        }, React.createElement("p", null, "‚ö†Ô∏è Cadastro/CPF incorreto"), React.createElement("p", null, "‚ö†Ô∏è Sem CNH v√°lida"), React.createElement("p", null, "‚ö†Ô∏è Ve√≠culo errado"), React.createElement("p", null, "‚ö†Ô∏è Fora de entrega ativa"), React.createElement("p", null, "‚ö†Ô∏è Fraude/M√°-f√©"))), React.createElement("div", {
            className: "bg-white rounded-xl shadow border-l-4 border-gray-500 overflow-hidden"
        }, React.createElement("div", {
            className: "bg-gray-600 text-white font-bold text-center py-2 text-sm"
        }, "COMO ACIONAR? (IZA Seguros)"), React.createElement("div", {
            className: "p-4 space-y-2 text-sm text-gray-700"
        }, React.createElement("p", null, "üì± ", React.createElement("strong", null, "Baixar"), " App IZA"), React.createElement("p", null, "üìã ", React.createElement("strong", null, "Informar"), " Data/Hora/Local"), React.createElement("p", null, "üìÑ ", React.createElement("strong", null, "Anexar Documentos"), " (B.O., atestado)"), React.createElement("p", null, "üìû ", React.createElement("strong", null, "Suporte:"), " Tel (11) 4673-2002"), React.createElement("p", null, "üí¨ ", React.createElement("strong", null, "WhatsApp:"), " ", React.createElement("a", {
            href: "https://wa.me/551146732004",
            target: "_blank",
            rel: "noopener noreferrer",
            className: "text-green-600 font-bold underline hover:text-green-700"
        }, "(11) 4673-2004")), React.createElement("p", null, "üåê ", React.createElement("strong", null, "Site:"), " ", React.createElement("a", {
            href: "https://www.iza.com.vc",
            target: "_blank",
            rel: "noopener noreferrer",
            className: "text-blue-600 underline hover:text-blue-700"
        }, "www.iza.com.vc")))), React.createElement("div", {
            className: "bg-white rounded-xl shadow border-l-4 border-orange-400 overflow-hidden"
        }, React.createElement("div", {
            className: "bg-orange-400 text-white font-bold text-center py-2 text-sm"
        }, "OUTRAS INFORMA√á√ïES"), React.createElement("div", {
            className: "p-4 space-y-2 text-sm text-gray-700"
        }, React.createElement("p", null, "‚ÑπÔ∏è ", React.createElement("strong", null, "Sem car√™ncia"), " (desde 1¬™ entrega)"), React.createElement("p", null, "‚ÑπÔ∏è ", React.createElement("strong", null, "Renova"), " a cada entrega aceita"))), React.createElement("button", {
            onClick: () => x({
                ...p,
                seguroDetalhes: !p.seguroDetalhes
            }),
            className: "w-full py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition-all flex items-center justify-center gap-2"
        }, "üìÑ ", p.seguroDetalhes ? "Ocultar Detalhes" : "Ver Texto com Mais Detalhes"), p.seguroDetalhes && React.createElement("div", {
            className: "bg-white rounded-xl shadow p-4 text-sm text-gray-700 space-y-4 border border-blue-200"
        }, React.createElement("h3", {
            className: "font-bold text-blue-800 text-lg"
        }, "üìã Informa√ß√µes Completas do Seguro"), React.createElement("div", null, React.createElement("h4", {
            className: "font-bold text-gray-800 mb-2"
        }, "Quando o seguro est√° ativo?"), React.createElement("ul", {
            className: "list-disc pl-5 space-y-1"
        }, React.createElement("li", null, "O seguro cobre voc√™ durante o per√≠odo em que estiver realizando uma entrega pela plataforma da Tutts."), React.createElement("li", null, "A cobertura √© ativada automaticamente desde o aceite da entrega at√© a finaliza√ß√£o no destino."), React.createElement("li", null, "N√£o cobre o trajeto de casa para o trabalho ou atividades pessoais."), React.createElement("li", null, "O entregador estar√° coberto durante o per√≠odo da entrega, limitado a at√© 60 minutos. Ou seja, se a entrega ultrapassar esse tempo e for finalizada ap√≥s os 60 minutos, a cobertura do seguro de vida ser√° encerrada."))), React.createElement("div", null, React.createElement("h4", {
            className: "font-bold text-gray-800 mb-2"
        }, "Coberturas e Valores"), React.createElement("ul", {
            className: "list-disc pl-5 space-y-1"
        }, React.createElement("li", null, React.createElement("strong", null, "Morte Acidental:"), " R$ 20.000,00"), React.createElement("li", null, React.createElement("strong", null, "Invalidez Permanente Total ou Parcial por Acidente:"), " R$ 20.000,00"), React.createElement("li", null, React.createElement("strong", null, "Despesas M√©dicas, Hospitalares e Odontol√≥gicos:"), " At√© R$ 5.000,00"), React.createElement("li", null, React.createElement("strong", null, "Di√°ria por Incapacidade Tempor√°ria (at√© 30 dias):"), " R$ 80,00 por dia"), React.createElement("li", null, React.createElement("strong", null, "Funeral:"), " R$ 5.000,00"))), React.createElement("div", null, React.createElement("h4", {
            className: "font-bold text-gray-800 mb-2"
        }, "Quando o seguro n√£o cobre?"), React.createElement("ul", {
            className: "list-disc pl-5 space-y-1"
        }, React.createElement("li", null, "Se o entregador n√£o estiver cadastrado corretamente ou com CPF incorreto."), React.createElement("li", null, "Se estiver sem habilita√ß√£o v√°lida no momento do acidente."), React.createElement("li", null, "Se estiver usando o ve√≠culo errado (ex.: moto em contrato de carro)."), React.createElement("li", null, "Se estiver fora de uma entrega ativa pela plataforma da Tutts."), React.createElement("li", null, "Se for constatado fraude ou m√°-f√©."))), React.createElement("div", null, React.createElement("h4", {
            className: "font-bold text-gray-800 mb-2"
        }, "Como acionar o seguro em caso de acidente?"), React.createElement("ul", {
            className: "list-disc pl-5 space-y-1"
        }, React.createElement("li", null, "Baixe o aplicativo IZA Seguros."), React.createElement("li", null, "Informe: data, hor√°rio e local do acidente."), React.createElement("li", null, "Anexe os documentos solicitados no app (como boletim de ocorr√™ncia ou atestado m√©dico)."), React.createElement("li", null, "D√∫vidas ou suporte: Telefone (11) 4673-2002 | WhatsApp", " ", React.createElement("a", {
            href: "https://wa.me/551146732004",
            target: "_blank",
            rel: "noopener noreferrer",
            className: "text-green-600 font-bold underline"
        }, "(11) 4673-2004")), React.createElement("li", null, "Site:", " ", React.createElement("a", {
            href: "https://www.iza.com.vc",
            target: "_blank",
            rel: "noopener noreferrer",
            className: "text-blue-600 underline"
        }, "www.iza.com.vc")))), React.createElement("div", null, React.createElement("h4", {
            className: "font-bold text-gray-800 mb-2"
        }, "Outras Informa√ß√µes"), React.createElement("ul", {
            className: "list-disc pl-5 space-y-1"
        }, React.createElement("li", null, React.createElement("strong", null, "Sem car√™ncia:"), " voc√™ estar√° coberto a partir da primeira entrega feita no dia."), React.createElement("li", null, "A cobertura se renova a cada entrega aceita na plataforma da Tutts."))))))), "score" === p.userTab && React.createElement(ScoreEntregador, {
            user: l,
            apiUrl: API_URL,
            showToast: ja
        }), "loja" === p.userTab && React.createElement(React.Fragment, null, rt && React.createElement("div", {
            className: "fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
        }, React.createElement("div", {
            className: "bg-white rounded-3xl shadow-2xl max-w-md w-full overflow-hidden"
        }, React.createElement("div", {
            className: "bg-gradient-to-r from-purple-600 to-pink-500 p-6 text-center"
        }, React.createElement("div", {
            className: "text-6xl mb-2"
        }, "üõí‚ú®"), React.createElement("h2", {
            className: "text-2xl font-bold text-white"
        }, "Lojinha Virtual da Tutts")), React.createElement("div", {
            className: "p-6"
        }, React.createElement("p", {
            className: "text-lg mb-4"
        }, React.createElement("span", {
            className: "text-2xl"
        }, "üëã"), " ", React.createElement("strong", null, "Ol√°, entregador!")), React.createElement("p", {
            className: "text-gray-700 mb-4"
        }, "Criamos este espa√ßo para trazer mais ", React.createElement("strong", null, "praticidade"), " e ", React.createElement("strong", null, "acessibilidade"), " na compra de itens essenciais para o seu dia a dia."), React.createElement("p", {
            className: "text-gray-700 mb-4"
        }, "As ofertas dispon√≠veis aqui s√£o ", React.createElement("strong", null, "exclusivas"), " para voc√™, entregador aut√¥nomo que opera ativamente no aplicativo Tutts h√° pelo menos 3 meses e possui um bom score ‚≠êüìä"), React.createElement("p", {
            className: "text-gray-700 mb-2"
        }, "Aproveite os benef√≠cios, equipe sua rotina com qualidade e economize! üíú"), React.createElement("div", {
            className: "bg-purple-50 rounded-xl p-4 mb-6"
        }, React.createElement("p", {
            className: "text-purple-800 font-semibold text-center"
        }, "üí∞ Abatimentos diretamente do saldo do aplicativo!")), React.createElement("button", {
            onClick: () => ot(!1),
            className: "w-full py-4 bg-gradient-to-r from-purple-600 to-pink-500 text-white rounded-xl font-bold text-lg hover:opacity-90 transition-opacity shadow-lg flex items-center justify-center gap-2"
        }, "üõí Siga para a Loja")))), !rt && React.createElement("div", {
            className: "space-y-6"
        }, React.createElement("div", {
            className: "bg-gradient-to-r from-purple-600 to-pink-500 rounded-2xl p-6 text-white text-center"
        }, React.createElement("h2", {
            className: "text-2xl font-bold mb-2"
        }, "üõçÔ∏è Ofertas Exclusivas!"), React.createElement("p", {
            className: "text-white/80"
        }, "Abatimento direto no seu saldo - Sem dor de cabe√ßa!")), React.createElement("a", {
            href: "https://www.mercadolivre.com.br/loja/tutts#from=share_eshop",
            target: "_blank",
            rel: "noopener noreferrer",
            className: "block"
        }, React.createElement("div", {
            className: "bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-400 rounded-2xl shadow-lg p-5 hover:shadow-xl transition-all hover:scale-[1.02] flex items-center gap-4"
        }, React.createElement("div", {
            className: "w-14 h-14 bg-white rounded-xl flex items-center justify-center text-3xl shadow"
        }, "ü§ù"), React.createElement("div", {
            className: "flex-1"
        }, React.createElement("h3", {
            className: "text-lg font-bold text-gray-800"
        }, "Compre na nossa loja online"), React.createElement("p", {
            className: "text-sm text-gray-700"
        }, "Visite nossa loja no Mercado Livre")), React.createElement("span", {
            className: "text-gray-700 text-2xl"
        }, "‚Ä∫"))), React.createElement("button", {
            onClick: () => x({
                ...p,
                lojaSugestaoModal: !0
            }),
            className: "w-full py-3 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity shadow-lg flex items-center justify-center gap-2"
        }, "üí° Sugerir Produto para a Loja"), bt.length > 0 && React.createElement("div", {
            className: "bg-white rounded-xl shadow p-4"
        }, React.createElement("h3", {
            className: "font-bold text-gray-800 mb-3"
        }, "üí° Minhas Sugest√µes"), React.createElement("div", {
            className: "space-y-2"
        }, bt.map(e => React.createElement("div", {
            key: e.id,
            className: "p-3 rounded-lg border " + ("respondido" === e.status ? "border-green-200 bg-green-50" : "recusado" === e.status ? "border-red-200 bg-red-50" : "border-gray-200 bg-gray-50")
        }, React.createElement("p", {
            className: "text-sm text-gray-800"
        }, e.sugestao), React.createElement("p", {
            className: "text-xs text-gray-500 mt-1"
        }, new Date(e.created_at).toLocaleDateString("pt-BR")), "respondido" === e.status && e.resposta && React.createElement("div", {
            className: "mt-2 p-2 bg-green-100 rounded"
        }, React.createElement("p", {
            className: "text-xs font-semibold text-green-800"
        }, "‚úÖ Resposta:"), React.createElement("p", {
            className: "text-sm text-green-700"
        }, e.resposta)), "recusado" === e.status && e.resposta && React.createElement("div", {
            className: "mt-2 p-2 bg-red-100 rounded"
        }, React.createElement("p", {
            className: "text-xs font-semibold text-red-800"
        }, "‚ùå Resposta:"), React.createElement("p", {
            className: "text-sm text-red-700"
        }, e.resposta)), "pendente" === e.status && React.createElement("span", {
            className: "inline-block mt-2 px-2 py-0.5 bg-yellow-100 text-yellow-700 text-xs rounded-full"
        }, "‚è≥ Aguardando an√°lise"))))), p.lojaSugestaoModal && React.createElement("div", {
            className: "fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
        }, React.createElement("div", {
            className: "bg-white rounded-2xl shadow-2xl max-w-md w-full"
        }, React.createElement("div", {
            className: "bg-gradient-to-r from-amber-500 to-orange-500 p-4 rounded-t-2xl text-white"
        }, React.createElement("h2", {
            className: "text-xl font-bold"
        }, "üí° Sugerir Produto"), React.createElement("p", {
            className: "text-sm opacity-80"
        }, "Diga o que voc√™ gostaria de ver na loja")), React.createElement("div", {
            className: "p-6"
        }, React.createElement("textarea", {
            value: p.lojaSugestaoTexto || "",
            onChange: e => x({
                ...p,
                lojaSugestaoTexto: e.target.value
            }),
            placeholder: "Descreva o produto que voc√™ gostaria que tivesse na loja... Ex: T√™nis Nike Air Max tamanho 42, Camiseta do Flamengo M...",
            className: "w-full px-4 py-3 border rounded-xl h-32 resize-none"
        }), React.createElement("p", {
            className: "text-xs text-gray-500 mt-2"
        }, "Sua sugest√£o ser√° analisada pela equipe"), React.createElement("div", {
            className: "flex gap-3 mt-4"
        }, React.createElement("button", {
            onClick: () => x({
                ...p,
                lojaSugestaoModal: !1,
                lojaSugestaoTexto: ""
            }),
            className: "flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold"
        }, "Cancelar"), React.createElement("button", {
            onClick: async () => {
                p.lojaSugestaoTexto?.trim() ? (await fetchAuth(`${API_URL}/loja/sugestoes`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        user_cod: l.codProfissional,
                        user_name: l.fullName,
                        sugestao: p.lojaSugestaoTexto.trim()
                    })
                }), ja("üí° Sugest√£o enviada!", "success"), x({
                    ...p,
                    lojaSugestaoModal: !1,
                    lojaSugestaoTexto: ""
                }), Ka()) : ja("Digite sua sugest√£o", "error")
            },
            className: "flex-1 px-4 py-2 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-lg font-semibold hover:opacity-90"
        }, "üì§ Enviar Sugest√£o"))))), at.length > 0 && React.createElement("div", {
            className: "bg-white rounded-xl shadow p-4"
        }, React.createElement("h3", {
            className: "font-bold text-gray-800 mb-3"
        }, "üì¶ Meus Pedidos"), React.createElement("div", {
            className: "space-y-3"
        }, at.map(e => React.createElement("div", {
            key: e.id,
            className: "p-4 rounded-xl border-2 " + ("aprovado" === e.status ? "border-green-200 bg-green-50" : "rejeitado" === e.status ? "border-red-200 bg-red-50" : "border-gray-200 bg-gray-50")
        }, React.createElement("div", {
            className: "flex justify-between items-start"
        }, React.createElement("div", {
            className: "flex-1"
        }, React.createElement("p", {
            className: "font-bold text-gray-800"
        }, e.produto_nome), e.tamanho && React.createElement("p", {
            className: "text-sm text-purple-600"
        }, "Tamanho: ", e.tamanho), React.createElement("p", {
            className: "text-xs text-gray-500 mt-1"
        }, new Date(e.created_at).toLocaleDateString("pt-BR"), " ‚Ä¢ ", e.tipo_abatimento), React.createElement("p", {
            className: "font-bold text-green-600 mt-1"
        }, "R$ ", parseFloat(e.valor_final).toFixed(2).replace(".", ","), e.parcelas > 1 && React.createElement("span", {
            className: "text-xs font-normal text-gray-500"
        }, " (", e.parcelas, "x)"))), React.createElement("span", {
            className: "px-3 py-1 rounded-full text-xs font-bold " + ("pendente" === e.status ? "bg-yellow-100 text-yellow-700" : "aprovado" === e.status ? "bg-green-100 text-green-700" : "bg-red-100 text-red-700")
        }, "pendente" === e.status ? "‚è≥ Aguardando" : "aprovado" === e.status ? "‚úÖ Aprovado" : "‚ùå Rejeitado")), "aprovado" === e.status && React.createElement("div", {
            className: "mt-3 p-3 bg-green-100 rounded-lg"
        }, React.createElement("p", {
            className: "text-green-800 text-sm font-semibold"
        }, "‚úÖ Pedido Aprovado!"), React.createElement("p", {
            className: "text-green-700 text-xs mt-1"
        }, "Logo mais, um respons√°vel entrar√° em contato para realizar a entrega do produto adquirido.")), "rejeitado" === e.status && React.createElement("div", {
            className: "mt-3 p-3 bg-red-100 rounded-lg"
        }, React.createElement("p", {
            className: "text-red-800 text-sm font-semibold"
        }, "‚ùå Pedido N√£o Aprovado"), e.observacao && React.createElement("p", {
            className: "text-red-700 text-xs mt-1"
        }, React.createElement("span", {
            className: "font-semibold"
        }, "Motivo:"), " ", e.observacao)))))), React.createElement("div", {
            className: "grid gap-4"
        }, 0 === Ke.length ? React.createElement("div", {
            className: "bg-white rounded-xl shadow p-8 text-center"
        }, React.createElement("div", {
            className: "text-6xl mb-4"
        }, "üè™"), React.createElement("p", {
            className: "text-gray-500"
        }, "Nenhum produto dispon√≠vel no momento"), React.createElement("p", {
            className: "text-sm text-gray-400 mt-2"
        }, "Em breve teremos novidades!")) : Ke.map(e => React.createElement("div", {
            key: e.id,
            className: "bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-shadow"
        }, e.imagem_url && React.createElement("div", {
            className: "relative cursor-pointer group bg-gray-100",
            onClick: () => x({
                ...p,
                lojaImagemAmpliada: e.imagem_url
            })
        }, React.createElement("img", {
            src: e.imagem_url,
            alt: e.nome,
            className: "w-full h-64 object-contain group-hover:opacity-90 transition-opacity"
        }), React.createElement("div", {
            className: "absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity bg-black/20"
        }, React.createElement("span", {
            className: "bg-white/90 text-gray-700 px-3 py-1 rounded-full text-sm font-semibold"
        }, "üîç Ampliar"))), React.createElement("div", {
            className: "p-4"
        }, React.createElement("h3", {
            className: "font-bold text-gray-800 text-lg"
        }, e.nome), e.marca && React.createElement("p", {
            className: "text-sm text-purple-600 font-medium"
        }, e.marca), e.descricao && React.createElement("p", {
            className: "text-sm text-gray-600 mt-1 line-clamp-2"
        }, e.descricao), React.createElement("div", {
            className: "mt-3 p-3 bg-gray-50 rounded-lg"
        }, React.createElement("div", {
            className: "flex items-baseline justify-between"
        }, React.createElement("span", {
            className: "text-2xl font-bold text-green-600"
        }, "R$ ", parseFloat(e.valor).toFixed(2).replace(".", ","))), e.parcelas_config && e.parcelas_config.filter(e => e && parseFloat(e.valor_parcela) > 0).length > 0 && React.createElement("div", {
            className: "mt-2 flex flex-wrap gap-1"
        }, e.parcelas_config.filter(e => e && parseFloat(e.valor_parcela) > 0).map((e, t) => React.createElement("span", {
            key: t,
            className: "text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full"
        }, 1 === parseInt(e.parcelas) ? "√Ä vista" : `${e.parcelas}x`, " R$ ", parseFloat(e.valor_parcela).toFixed(2).replace(".", ","))))), React.createElement("button", {
            onClick: () => x({
                ...p,
                lojaProdutoSelecionado: e,
                lojaCompraModal: !0
            }),
            className: "mt-3 w-full py-3 bg-gradient-to-r from-purple-600 to-pink-500 text-white rounded-xl font-bold text-lg hover:opacity-90 transition-opacity shadow-lg"
        }, "üõí Comprar"))))), p.lojaImagemAmpliada && React.createElement("div", {
            className: "fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4",
            onClick: () => x({
                ...p,
                lojaImagemAmpliada: null
            })
        }, React.createElement("button", {
            className: "absolute top-4 right-4 text-white text-4xl hover:text-gray-300",
            onClick: () => x({
                ...p,
                lojaImagemAmpliada: null
            })
        }, "‚úï"), React.createElement("img", {
            src: p.lojaImagemAmpliada,
            alt: "Imagem ampliada",
            className: "max-w-full max-h-full object-contain rounded-lg"
        }))), p.lojaCompraModal && p.lojaProdutoSelecionado && React.createElement("div", {
            className: "fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
        }, React.createElement("div", {
            className: "bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto"
        }, React.createElement("div", {
            className: "bg-gradient-to-r from-purple-600 to-pink-500 p-4 text-white"
        }, React.createElement("h2", {
            className: "text-xl font-bold"
        }, "üõí Finalizar Compra")), React.createElement("div", {
            className: "p-6"
        }, React.createElement("div", {
            className: "flex gap-4 mb-6"
        }, p.lojaProdutoSelecionado.imagem_url && React.createElement("img", {
            src: p.lojaProdutoSelecionado.imagem_url,
            alt: "",
            className: "w-24 h-24 object-cover rounded-lg"
        }), React.createElement("div", null, React.createElement("h3", {
            className: "font-bold text-gray-800"
        }, p.lojaProdutoSelecionado.nome), p.lojaProdutoSelecionado.marca && React.createElement("p", {
            className: "text-sm text-gray-500"
        }, p.lojaProdutoSelecionado.marca), React.createElement("p", {
            className: "text-xl font-bold text-green-600 mt-1"
        }, "R$ ", parseFloat(p.lojaProdutoSelecionado.valor).toFixed(2).replace(".", ",")))), p.lojaProdutoSelecionado.tem_tamanho && p.lojaProdutoSelecionado.tamanhos && p.lojaProdutoSelecionado.tamanhos.length > 0 && React.createElement("div", {
            className: "mb-4"
        }, React.createElement("label", {
            className: "block text-sm font-semibold mb-2"
        }, "Tamanho *"), React.createElement("div", {
            className: "flex flex-wrap gap-2"
        }, p.lojaProdutoSelecionado.tamanhos.map(e => React.createElement("button", {
            key: e.tamanho,
            onClick: () => x({
                ...p,
                lojaCompraTamanho: e.tamanho
            }),
            disabled: e.quantidade <= 0,
            className: "px-4 py-2 rounded-lg border-2 font-semibold transition-all " + (p.lojaCompraTamanho === e.tamanho ? "border-purple-600 bg-purple-50 text-purple-700" : e.quantidade <= 0 ? "border-gray-200 bg-gray-100 text-gray-400 cursor-not-allowed" : "border-gray-300 hover:border-purple-400")
        }, e.tamanho, e.quantidade <= 0 && React.createElement("span", {
            className: "text-xs ml-1"
        }, "(Esgotado)"))))), React.createElement("div", {
            className: "mb-6"
        }, React.createElement("label", {
            className: "block text-sm font-semibold mb-2"
        }, "Forma de Pagamento *"), React.createElement("div", {
            className: "space-y-2"
        }, (() => {
            const e = (p.lojaProdutoSelecionado.parcelas_config || []).filter(e => e && parseFloat(e.valor_parcela) > 0);
            return 0 === e.length ? React.createElement("div", {
                className: "text-center py-4 text-gray-500"
            }, React.createElement("p", null, "Nenhuma op√ß√£o de pagamento configurada"), React.createElement("p", {
                className: "text-xs mt-1"
            }, "Entre em contato com o administrador")) : e.map((e, t) => {
                const a = parseInt(e.parcelas) || 1,
                    l = parseFloat(e.valor_parcela) || 0,
                    r = l * a,
                    o = parseFloat(p.lojaProdutoSelecionado.valor) - r,
                    c = 1 === a ? "√Ä Vista" : `${a}x Semanal`;
                return React.createElement("button", {
                    key: t,
                    onClick: () => x({
                        ...p,
                        lojaCompraTipo: c,
                        lojaCompraParcelas: a,
                        lojaCompraValorFinal: r,
                        lojaCompraValorParcela: l,
                        lojaCompraDesconto: o > 0 ? o : 0
                    }),
                    className: "w-full p-4 rounded-xl border-2 text-left transition-all " + (p.lojaCompraTipo === c ? "border-purple-600 bg-purple-50" : "border-gray-200 hover:border-purple-300")
                }, React.createElement("div", {
                    className: "flex justify-between items-center"
                }, React.createElement("div", null, React.createElement("p", {
                    className: "font-semibold"
                }, c), React.createElement("p", {
                    className: "text-xs text-gray-500"
                }, 1 === a ? "Abatimento √∫nico do saldo" : `${a} abatimentos semanais`)), React.createElement("div", {
                    className: "text-right"
                }, o > 0 && React.createElement("p", {
                    className: "text-xs text-green-600 font-semibold"
                }, "Economia R$ ", o.toFixed(2).replace(".", ",")), React.createElement("p", {
                    className: "font-bold text-purple-700"
                }, a > 1 ? `${a}x de ` : "", "R$ ", l.toFixed(2).replace(".", ",")), a > 1 && React.createElement("p", {
                    className: "text-xs text-gray-500"
                }, "Total: R$ ", r.toFixed(2).replace(".", ",")))))
            })
        })())), p.lojaCompraTipo && React.createElement("div", {
            className: "bg-gray-50 rounded-xl p-4 mb-6"
        }, React.createElement("h4", {
            className: "font-bold text-gray-800 mb-2"
        }, "üìã Resumo do Pedido"), React.createElement("div", {
            className: "space-y-1 text-sm"
        }, React.createElement("div", {
            className: "flex justify-between"
        }, React.createElement("span", {
            className: "text-gray-600"
        }, "Valor original:"), React.createElement("span", null, "R$ ", parseFloat(p.lojaProdutoSelecionado.valor).toFixed(2).replace(".", ","))), p.lojaCompraDesconto > 0 && React.createElement("div", {
            className: "flex justify-between text-green-600"
        }, React.createElement("span", null, "Desconto:"), React.createElement("span", null, "- R$ ", p.lojaCompraDesconto.toFixed(2).replace(".", ","))), React.createElement("div", {
            className: "flex justify-between font-bold text-lg border-t pt-2 mt-2"
        }, React.createElement("span", null, "Total:"), React.createElement("span", {
            className: "text-purple-700"
        }, "R$ ", p.lojaCompraValorFinal.toFixed(2).replace(".", ","))), p.lojaCompraParcelas > 1 && React.createElement("p", {
            className: "text-center text-xs text-gray-500 mt-1"
        }, "em ", p.lojaCompraParcelas, "x de R$ ", p.lojaCompraValorParcela.toFixed(2).replace(".", ",")))), React.createElement("div", {
            className: "flex gap-3"
        }, React.createElement("button", {
            onClick: () => x({
                ...p,
                lojaCompraModal: !1,
                lojaProdutoSelecionado: null,
                lojaCompraTipo: null,
                lojaCompraTamanho: null
            }),
            className: "flex-1 px-4 py-3 bg-gray-200 text-gray-700 rounded-xl font-semibold"
        }, "Cancelar"), React.createElement("button", {
            onClick: async () => {
                if (!p.lojaProdutoSelecionado.tem_tamanho || p.lojaCompraTamanho)
                    if (p.lojaCompraTipo) try {
                        const e = {
                            produto_id: p.lojaProdutoSelecionado.id,
                            user_cod: l.codProfissional,
                            user_name: l.fullName,
                            produto_nome: p.lojaProdutoSelecionado.nome,
                            tamanho: p.lojaCompraTamanho || null,
                            marca: p.lojaProdutoSelecionado.marca || null,
                            valor_original: parseFloat(p.lojaProdutoSelecionado.valor),
                            tipo_abatimento: p.lojaCompraTipo,
                            valor_abatimento: p.lojaCompraDesconto || 0,
                            valor_final: p.lojaCompraValorFinal,
                            parcelas: p.lojaCompraParcelas,
                            valor_parcela: p.lojaCompraValorParcela
                        };
                        await fetchAuth(`${API_URL}/loja/pedidos`, {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify(e)
                        }), ja("‚úÖ Pedido enviado com sucesso!", "success"), x({
                            ...p,
                            lojaCompraModal: !1,
                            lojaProdutoSelecionado: null,
                            lojaCompraTipo: null,
                            lojaCompraTamanho: null
                        }), Za()
                    } catch (e) {
                        ja("Erro ao enviar pedido", "error")
                    } else ja("Selecione a forma de pagamento", "error");
                    else ja("Selecione um tamanho", "error")
            },
            className: "flex-1 px-4 py-3 bg-gradient-to-r from-purple-600 to-pink-500 text-white rounded-xl font-semibold hover:opacity-90"
        }, "‚úÖ Confirmar Pedido"))))))));
        }
        // Verificar permiss√£o para Financeiro (admin comum)
        const canAccessFinanceiro = hasModuleAccess(l, "financeiro");
        if ((canAccessFinanceiro && "financeiro" === Ee) || "admin_financeiro" === l.role) {
            const e = "admin_master" === l.role;
            // M√ìDULO FINANCEIRO - CARREGADO EXTERNAMENTE (ModuloFinanceiro.js)
            if (window.renderModuloFinanceiro) {
                return window.renderModuloFinanceiro({
                    // Estados b√°sicos
                    c, s, p, x, q, U, Q, H, Z, Y, K, X, z, B, V, J,
                    // Estados adicionais
                    A, S, j, C, k, P, T, D, L, I, F, $, M, O, G, W,
                    // Promo√ß√µes
                    ee, te, ae, le, re, oe, ce, se, ne, me,
                    // Planilha de profissionais com cidades (NOVO)
                    planilhaProfissionais: pe, cidadesIndicacao,
                    // Hor√°rios e avisos
                    Me, Oe, qe, Ue, ze, Be,
                    // Loja
                    Ke, Xe, Ze, Ye, et, tt, at, lt, it, dt, ut, gt, bt, Rt,
                    nt, mt, rt, ot, pt, xt, ct, st, Qe, He, Ge, We,
                    // Plific
                    plificState, setPlificState, modalDebitoPlific, setModalDebitoPlific,
                    debitoFormPlific, setDebitoFormPlific, saldoPlificUser, setSaldoPlificUser,
                    // Pagina√ß√£o
                    solicitacoesPagina, setSolicitacoesPagina, conciliacaoPagina, setConciliacaoPagina,
                    solicitacoesPorPagina, conciliacaoPorPagina, acertoRealizado, setAcertoRealizado,
                    // Navega√ß√£o e usu√°rio
                    l, Ee, he, o, f, E, e,
                    // Utilit√°rios
                    er, ja, ul, fetchAuth, API_URL, navegarSidebar,
                    // Componentes
                    HeaderCompacto, Toast, LoadingOverlay, PixQRCodeModal, i, n,
                    // Novatos
                    elegibilidadeNovatos, setElegibilidadeNovatos, regioesNovatos, setRegioesNovatos,
                    clientesBINovatos, setClientesBINovatos, clientesSelecionados, setClientesSelecionados,
                    carregandoClientes, carregarClientesPorRegiao,
                    // Relat√≥rios
                    socialProfile, relatorioNaoLido, setRelatorioNaoLido,
                    relatorioImagemAmpliada, setRelatorioImagemAmpliada,
                    relatoriosNaoLidos, setRelatoriosNaoLidos, marcarRelatorioComoLido,
                    todoNotifModal, setTodoNotifModal, todoPendentesNotif,
                    // Fun√ß√µes de carregamento
                    Ua, za, Ba, Va, Ja, Qa, Ha, Ga, Wa, Za, Ya, Ka, gl, vl, wl, _l, Cl,
                    // Fun√ß√µes de a√ß√£o
                    Rl, El, hl, fl, Nl, yl, bl, Jl, Hl, Gl, Ml, Ol, Sl, Tl, Fl, Pl,
                    lancarDebitoPlific,
                    consultarSaldoPlific,
                    consultarSaldosLotePlific,
                    exportarSaldosCSVPlific,
                    // Quiz
                    fe, Ne, ye, ve, we, _e, je, Ce, Ae, Se, ke, Pe, Te, De, Le, Ie, Fe, $e,
                    // Notifica√ß√µes
                    y, v, w, _
                });
            }
            return React.createElement("p", {className: "p-8 text-red-600 text-center"}, "Erro: ModuloFinanceiro.js n√£o carregado");
        }
        // Verificar permiss√£o para TO-DO (admin comum)
        const canAccessTodo = hasModuleAccess(l, "todo");
        if (canAccessTodo && "todo" === Ee) {
            // Calcular m√©tricas das tarefas atuais
            const tarefasAtuais = todoViewMode === "meudia" ? todoMeuDia : todoTarefas;
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);
            
            const pendentes = tarefasAtuais.filter(t => t.status === "pendente" || t.status === "em_andamento");
            const atrasadas = tarefasAtuais.filter(t => {
                if (t.status === "concluida") return false;
                if (!t.data_prazo) return false;
                const dataVenc = new Date(t.data_prazo);
                dataVenc.setHours(0, 0, 0, 0);
                return dataVenc < hoje;
            });
            const concluidas = tarefasAtuais.filter(t => t.status === "concluida");
            
            // Filtrar tarefas baseado no card selecionado
            let tarefasFiltradas = tarefasAtuais;
            if (todoFiltroCard === "pendentes") tarefasFiltradas = pendentes;
            else if (todoFiltroCard === "atrasadas") tarefasFiltradas = atrasadas;
            else if (todoFiltroCard === "concluidas") tarefasFiltradas = concluidas;
            
            return React.createElement("div", {
                className: "h-screen bg-gray-100 flex overflow-hidden"
            }, i && React.createElement(Toast, i), todoLoading && React.createElement("div", {
                className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50"
            }, React.createElement("div", {
                className: "bg-white rounded-xl p-6 text-center"
            }, React.createElement("div", {
                className: "animate-spin w-8 h-8 border-4 border-purple-600 border-t-transparent rounded-full mx-auto mb-3"
            }), React.createElement("p", null, "Carregando TO-DO..."))),
            
            // Modal de notifica√ß√£o de pendentes
            todoNotifModal && React.createElement("div", {
                className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
            }, React.createElement("div", {
                className: "bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden"
            }, React.createElement("div", {
                className: "bg-gradient-to-r from-orange-500 to-red-500 p-4 text-white"
            }, React.createElement("h2", {className: "text-xl font-bold flex items-center gap-2"}, "‚ö†Ô∏è Aten√ß√£o!"),
                React.createElement("p", {className: "text-orange-100 text-sm"}, "Voc√™ possui tarefas pendentes")
            ), React.createElement("div", {className: "p-4 max-h-60 overflow-y-auto"},
                React.createElement("p", {className: "text-gray-600 mb-3"}, "üìã ", todoPendentesNotif.length, " tarefa(s) precisam da sua aten√ß√£o:"),
                React.createElement("div", {className: "space-y-2"},
                    todoPendentesNotif.slice(0, 5).map(t => React.createElement("div", {
                        key: t.id,
                        className: "bg-orange-50 border-l-4 border-orange-500 p-3 rounded"
                    }, React.createElement("p", {className: "font-semibold text-gray-800"}, t.titulo),
                        t.data_prazo && React.createElement("p", {className: "text-xs text-orange-600"}, "üìÖ Vence: ", new Date(t.data_prazo).toLocaleDateString("pt-BR"))
                    ))
                ),
                todoPendentesNotif.length > 5 && React.createElement("p", {className: "text-sm text-gray-500 mt-2"}, "... e mais ", todoPendentesNotif.length - 5, " tarefa(s)")
            ), React.createElement("div", {className: "flex gap-3 p-4 border-t"},
                React.createElement("button", {
                    onClick: () => setTodoNotifModal(false),
                    className: "flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300"
                }, "Fechar"),
                React.createElement("button", {
                    onClick: () => { setTodoNotifModal(false); he("todo"); },
                    className: "flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700"
                }, "üìã Ir para Tarefas")
            ))),
            
            // Sidebar Esquerda - Apenas Listas e Grupos
            React.createElement("div", {
                className: "w-56 bg-white shadow-lg flex flex-col h-screen border-r"
            }, 
                // Header da Sidebar
                React.createElement("div", {
                    className: "bg-gradient-to-r from-purple-600 to-indigo-600 p-4 text-white"
                }, React.createElement("div", {className: "flex items-center gap-3"},
                    socialProfile?.profile_photo ? React.createElement("img", {
                        src: socialProfile.profile_photo,
                        className: "w-10 h-10 rounded-full object-cover border-2 border-white/50"
                    }) : React.createElement("div", {
                        className: "w-10 h-10 rounded-full bg-purple-500 flex items-center justify-center text-white font-bold border-2 border-white/50"
                    }, l.fullName?.charAt(0)?.toUpperCase() || "?"),
                    React.createElement("div", null,
                        React.createElement("h1", {className: "text-lg font-bold"}, "üìã TO-DO"),
                        React.createElement("p", {className: "text-purple-200 text-xs truncate"}, socialProfile?.display_name || l.fullName)
                    )
                )),
                
                // Listas
                React.createElement("div", {className: "flex-1 overflow-y-auto p-3"},
                    // Meu Dia
                    React.createElement("button", {
                        onClick: async () => {
                            setTodoViewMode("meudia");
                            setTodoGrupoAtivo(null);
                            setTodoFiltroCard(null);
                            setTodoLoading(true);
                            await loadTodoMeuDia();
                            setTodoLoading(false);
                        },
                        className: "w-full text-left px-3 py-3 rounded-xl mb-2 flex items-center gap-3 transition-all " + 
                            (todoViewMode === "meudia" ? "bg-gradient-to-r from-purple-500 to-indigo-500 text-white shadow-md" : "hover:bg-gray-100")
                    }, React.createElement("span", {className: "text-xl"}, "‚òÄÔ∏è"), 
                        React.createElement("span", {className: "flex-1 font-semibold"}, "Meu Dia"),
                        React.createElement("span", {className: "text-sm px-2 py-0.5 rounded-full " + (todoViewMode === "meudia" ? "bg-white/20" : "bg-purple-100 text-purple-700")}, todoMeuDia.length)
                    ),
                    
                    React.createElement("div", {className: "border-t my-3"}),
                    
                    React.createElement("p", {className: "text-xs font-semibold text-gray-400 uppercase mb-2 px-1"}, "Meus Grupos"),
                    
                    todoGrupos.map(g => React.createElement("button", {
                        key: g.id,
                        onClick: async () => {
                            setTodoViewMode("grupo");
                            setTodoGrupoAtivo(g);
                            setTodoFiltroCard(null);
                            setTodoLoading(true);
                            const tarefas = await loadTodoTarefas(g.id);
                            setTodoTarefas(tarefas);
                            setTodoLoading(false);
                        },
                        className: "w-full text-left px-3 py-2 rounded-lg mb-1 flex items-center gap-2 transition-all " + 
                            (todoViewMode === "grupo" && todoGrupoAtivo?.id === g.id ? "bg-purple-100 text-purple-700 font-semibold" : "hover:bg-gray-100 text-gray-700")
                    }, React.createElement("span", null, g.icone || "üìã"), 
                        React.createElement("span", {className: "flex-1 truncate"}, g.nome),
                        g.tipo === "pessoal" && React.createElement("span", {className: "text-xs"}, "üîí")
                    )),
                    
                    React.createElement("button", {
                        onClick: () => setTodoModal({tipo: "novoGrupo"}),
                        className: "w-full text-left px-3 py-2 rounded-lg text-purple-600 hover:bg-purple-50 flex items-center gap-2 mt-2"
                    }, React.createElement("span", null, "‚ûï"), "Novo Grupo")
                ),
                
                // Footer
                React.createElement("div", {className: "p-3 border-t"},
                    React.createElement("button", {
                        onClick: () => he("home"),
                        className: "w-full py-2 bg-gray-100 text-gray-600 rounded-lg font-semibold hover:bg-gray-200 text-sm flex items-center justify-center gap-2"
                    }, "‚Üê Voltar")
                )
            ),
            
            // Modal de Detalhe da Tarefa (Subtarefas, Timer, etc)
            todoTarefaDetalhe && React.createElement("div", {
                className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
            }, React.createElement("div", {
                className: "bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col"
            },
                // Header
                React.createElement("div", {
                    className: "bg-gradient-to-r from-purple-600 to-indigo-600 p-4 text-white flex justify-between items-start"
                },
                    React.createElement("div", {className: "flex-1"},
                        React.createElement("h2", {className: "text-xl font-bold"}, todoTarefaDetalhe.titulo),
                        React.createElement("p", {className: "text-purple-200 text-sm mt-1"}, 
                            todoTarefaDetalhe.grupo_nome || "Sem grupo", " ‚Ä¢ ", 
                            todoTarefaDetalhe.status === "concluida" ? "‚úÖ Conclu√≠da" : 
                            todoTarefaDetalhe.status === "em_andamento" ? "üîÑ Em andamento" : "üìã Pendente"
                        )
                    ),
                    React.createElement("button", {
                        onClick: () => setTodoTarefaDetalhe(null),
                        className: "text-white/70 hover:text-white text-2xl"
                    }, "√ó")
                ),
                
                // Conte√∫do com scroll
                React.createElement("div", {className: "flex-1 overflow-y-auto p-4 space-y-6"},
                    // Descri√ß√£o
                    todoTarefaDetalhe.descricao && React.createElement("div", null,
                        React.createElement("h4", {className: "font-semibold text-gray-700 mb-2"}, "üìù Descri√ß√£o"),
                        React.createElement("p", {className: "text-gray-600 bg-gray-50 p-3 rounded-lg"}, todoTarefaDetalhe.descricao)
                    ),
                    
                    // Info cards
                    React.createElement("div", {className: "grid grid-cols-2 gap-3"},
                        React.createElement("div", {className: "bg-purple-50 p-3 rounded-lg text-center"},
                            React.createElement("p", {className: "text-xs text-purple-600 font-semibold"}, "Prioridade"),
                            React.createElement("p", {className: "font-bold text-purple-800"}, 
                                todoTarefaDetalhe.prioridade === "urgente" ? "üî¥ Urgente" :
                                todoTarefaDetalhe.prioridade === "alta" ? "üü† Alta" :
                                todoTarefaDetalhe.prioridade === "media" ? "üü° M√©dia" : "üü¢ Baixa"
                            )
                        ),
                        React.createElement("div", {className: "bg-blue-50 p-3 rounded-lg text-center"},
                            React.createElement("p", {className: "text-xs text-blue-600 font-semibold"}, "Prazo"),
                            React.createElement("p", {className: "font-bold text-blue-800"}, 
                                todoTarefaDetalhe.data_prazo ? new Date(todoTarefaDetalhe.data_prazo).toLocaleDateString("pt-BR") : "Sem prazo"
                            )
                        )
                    ),
                    
                    // Subtarefas/Checklist
                    React.createElement("div", {className: "bg-gray-50 rounded-xl p-4"},
                        React.createElement("div", {className: "flex items-center justify-between mb-3"},
                            React.createElement("h4", {className: "font-semibold text-gray-700 flex items-center gap-2"}, 
                                "‚òëÔ∏è Checklist",
                                (todoSubtarefas[todoTarefaDetalhe.id]?.length || 0) > 0 && React.createElement("span", {className: "text-sm font-normal text-gray-500"},
                                    "(" + (todoSubtarefas[todoTarefaDetalhe.id]?.filter(s => s.concluida).length || 0) + "/" + (todoSubtarefas[todoTarefaDetalhe.id]?.length || 0) + ")"
                                )
                            ),
                            (todoSubtarefas[todoTarefaDetalhe.id]?.length || 0) > 0 && React.createElement("span", {
                                className: "text-sm font-bold " + ((todoSubtarefas[todoTarefaDetalhe.id]?.filter(s => s.concluida).length || 0) === (todoSubtarefas[todoTarefaDetalhe.id]?.length || 0) ? "text-green-600" : "text-purple-600")
                            }, Math.round(((todoSubtarefas[todoTarefaDetalhe.id]?.filter(s => s.concluida).length || 0) / (todoSubtarefas[todoTarefaDetalhe.id]?.length || 1)) * 100), "%")
                        ),
                        
                        // Barra de progresso
                        (todoSubtarefas[todoTarefaDetalhe.id]?.length || 0) > 0 && React.createElement("div", {className: "w-full bg-gray-200 rounded-full h-2 mb-3"},
                            React.createElement("div", {
                                className: "h-2 rounded-full transition-all " + ((todoSubtarefas[todoTarefaDetalhe.id]?.filter(s => s.concluida).length || 0) === (todoSubtarefas[todoTarefaDetalhe.id]?.length || 0) ? "bg-green-500" : "bg-purple-500"),
                                style: { width: Math.round(((todoSubtarefas[todoTarefaDetalhe.id]?.filter(s => s.concluida).length || 0) / (todoSubtarefas[todoTarefaDetalhe.id]?.length || 1)) * 100) + "%" }
                            })
                        ),
                        
                        // Lista de subtarefas
                        React.createElement("div", {className: "space-y-2 mb-3"},
                            (todoSubtarefas[todoTarefaDetalhe.id] || []).map(sub =>
                                React.createElement("div", {
                                    key: sub.id,
                                    className: "flex items-center gap-2 p-2 rounded-lg " + (sub.concluida ? "bg-green-50" : "bg-white") + " group"
                                },
                                    React.createElement("button", {
                                        onClick: () => toggleTodoSubtarefa(sub.id, sub.concluida, todoTarefaDetalhe.id),
                                        className: "w-5 h-5 rounded border-2 flex items-center justify-center transition-colors " + 
                                            (sub.concluida ? "bg-green-500 border-green-500 text-white" : "border-gray-300 hover:border-purple-500")
                                    }, sub.concluida && "‚úì"),
                                    React.createElement("span", {
                                        className: "flex-1 text-sm " + (sub.concluida ? "line-through text-gray-400" : "text-gray-700")
                                    }, sub.titulo),
                                    React.createElement("button", {
                                        onClick: () => deleteTodoSubtarefa(sub.id, todoTarefaDetalhe.id),
                                        className: "opacity-0 group-hover:opacity-100 text-red-400 hover:text-red-600 transition-opacity"
                                    }, "√ó")
                                )
                            )
                        ),
                        
                        // Input para nova subtarefa
                        React.createElement("div", {className: "flex gap-2"},
                            React.createElement("input", {
                                type: "text",
                                placeholder: "Adicionar item...",
                                className: "flex-1 px-3 py-2 border rounded-lg text-sm focus:ring-2 focus:ring-purple-500 focus:border-purple-500",
                                onKeyPress: async (e) => {
                                    if (e.key === 'Enter' && e.target.value.trim()) {
                                        await addTodoSubtarefa(todoTarefaDetalhe.id, e.target.value.trim());
                                        e.target.value = '';
                                    }
                                }
                            }),
                            React.createElement("button", {
                                onClick: async () => {
                                    const input = document.querySelector('input[placeholder="Adicionar item..."]');
                                    if (input && input.value.trim()) {
                                        await addTodoSubtarefa(todoTarefaDetalhe.id, input.value.trim());
                                        input.value = '';
                                    }
                                },
                                className: "px-4 py-2 bg-purple-600 text-white rounded-lg text-sm font-semibold hover:bg-purple-700"
                            }, "+ Adicionar")
                        )
                    )
                ),
                
                // Footer com a√ß√µes
                React.createElement("div", {className: "border-t p-4 flex justify-between items-center bg-gray-50"},
                    React.createElement("button", {
                        onClick: () => {
                            abrirEditarTarefa(todoTarefaDetalhe);
                            setTodoTarefaDetalhe(null);
                        },
                        className: "px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300"
                    }, "‚úèÔ∏è Editar"),
                    React.createElement("div", {className: "flex gap-2"},
                        todoTarefaDetalhe.status !== "concluida" && React.createElement("button", {
                            onClick: async () => {
                                await fetchAuth(`${API_URL}/todo/tarefas/${todoTarefaDetalhe.id}`, {
                                    method: 'PUT',
                                    headers: {'Content-Type': 'application/json'},
                                    body: JSON.stringify({status: 'concluida', user_cod: l.codProfissional, user_name: l.fullName})
                                });
                                setTodoTarefaDetalhe(null);
                                ja("‚úÖ Tarefa conclu√≠da!", "success");
                                if (todoViewMode === "meudia") await loadTodoMeuDia();
                                else if (todoGrupoAtivo) {
                                    const tarefas = await loadTodoTarefas(todoGrupoAtivo.id);
                                    setTodoTarefas(tarefas);
                                }
                            },
                            className: "px-4 py-2 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700"
                        }, "‚úÖ Concluir Tarefa"),
                        React.createElement("button", {
                            onClick: () => setTodoTarefaDetalhe(null),
                            className: "px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700"
                        }, "Fechar")
                    )
                )
            )),
            
            // √Årea Principal
            React.createElement("div", {className: "flex-1 flex flex-col h-screen"},
                // Header da √°rea (FIXO) com filtros
                React.createElement("div", {className: "bg-white shadow-sm px-6 py-4 flex justify-between items-center flex-shrink-0 border-b"},
                    React.createElement("div", {className: "flex items-center gap-6"},
                        React.createElement("div", null,
                            React.createElement("h2", {className: "text-xl font-bold text-gray-800"}, 
                                todoViewMode === "meudia" ? "‚òÄÔ∏è Meu Dia" : (todoGrupoAtivo?.icone + " " + todoGrupoAtivo?.nome || "Selecione uma lista")
                            ),
                            React.createElement("p", {className: "text-sm text-gray-500"}, 
                                tarefasFiltradas.length, " tarefa(s)"
                            )
                        ),
                        // Cards de Filtro Horizontal
                        React.createElement("div", {className: "flex gap-2"},
                            React.createElement("button", {
                                onClick: () => setTodoFiltroCard(todoFiltroCard === "pendentes" ? null : "pendentes"),
                                className: "px-3 py-1.5 rounded-lg flex items-center gap-2 text-sm font-semibold transition-all " + 
                                    (todoFiltroCard === "pendentes" ? "bg-yellow-500 text-white" : "bg-yellow-100 text-yellow-700 hover:bg-yellow-200")
                            }, "‚è≥ Pendentes (", pendentes.length, ")"),
                            React.createElement("button", {
                                onClick: () => setTodoFiltroCard(todoFiltroCard === "atrasadas" ? null : "atrasadas"),
                                className: "px-3 py-1.5 rounded-lg flex items-center gap-2 text-sm font-semibold transition-all " + 
                                    (todoFiltroCard === "atrasadas" ? "bg-red-500 text-white" : "bg-red-100 text-red-700 hover:bg-red-200")
                            }, "üî• Atrasadas (", atrasadas.length, ")"),
                            React.createElement("button", {
                                onClick: () => setTodoFiltroCard(todoFiltroCard === "concluidas" ? null : "concluidas"),
                                className: "px-3 py-1.5 rounded-lg flex items-center gap-2 text-sm font-semibold transition-all " + 
                                    (todoFiltroCard === "concluidas" ? "bg-green-500 text-white" : "bg-green-100 text-green-700 hover:bg-green-200")
                            }, "‚úÖ Conclu√≠das (", concluidas.length, ")"),
                            todoFiltroCard && React.createElement("button", {
                                onClick: () => setTodoFiltroCard(null),
                                className: "px-2 py-1.5 text-gray-400 hover:text-gray-600"
                            }, "‚úï")
                        )
                    ),
                    React.createElement("div", {className: "flex items-center gap-3"},
                        // Toggle Lista/Kanban
                        React.createElement("div", {className: "flex bg-gray-100 rounded-lg p-1"},
                            React.createElement("button", {
                                onClick: () => setTodoViewType("lista"),
                                className: "px-3 py-1.5 rounded-lg text-sm font-semibold transition-all " + 
                                    (todoViewType === "lista" ? "bg-white shadow text-purple-700" : "text-gray-600 hover:text-gray-800")
                            }, "üìã Lista"),
                            React.createElement("button", {
                                onClick: () => setTodoViewType("kanban"),
                                className: "px-3 py-1.5 rounded-lg text-sm font-semibold transition-all " + 
                                    (todoViewType === "kanban" ? "bg-white shadow text-purple-700" : "text-gray-600 hover:text-gray-800")
                            }, "üìä Kanban")
                        ),
                        React.createElement("button", {
                            onClick: () => he("home"),
                            className: "px-4 py-2 text-gray-600 rounded-lg font-semibold hover:bg-gray-100"
                        }, "‚Üê Voltar"),
                        React.createElement("button", {
                            onClick: () => setTodoModal({tipo: "novaTarefa"}),
                            className: "px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 flex items-center gap-2"
                        }, "‚ûï Nova Tarefa")
                    )
                ),
                
                // √Årea de conte√∫do com scroll
                React.createElement("div", {className: "flex-1 overflow-y-auto p-6 bg-gray-50"},
                
                // KANBAN VIEW
                todoViewType === "kanban" ? React.createElement("div", {className: "flex gap-4 h-full"},
                    // Coluna A FAZER
                    React.createElement("div", {
                        className: "flex-1 bg-yellow-50 rounded-xl p-4 min-w-[300px] transition-all",
                        onDragOver: (e) => { 
                            e.preventDefault(); 
                            e.stopPropagation();
                            e.currentTarget.style.opacity = '0.7';
                        },
                        onDragLeave: (e) => {
                            e.currentTarget.style.opacity = '1';
                        },
                        onDrop: async (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            e.currentTarget.style.opacity = '1';
                            const tarefaId = e.dataTransfer.getData('text/plain');
                            console.log('Drop na coluna TODO, tarefaId:', tarefaId);
                            if (tarefaId) await moverTodoKanban(parseInt(tarefaId), 'todo');
                        }
                    },
                        React.createElement("div", {className: "flex items-center justify-between mb-4 pb-2 border-b-2 border-yellow-200"},
                            React.createElement("div", {className: "flex items-center gap-2"},
                                React.createElement("span", {className: "text-xl"}, "üìã"),
                                React.createElement("h3", {className: "font-bold text-gray-800"}, "A Fazer"),
                                React.createElement("span", {className: "px-2 py-0.5 rounded-full text-xs font-bold bg-yellow-200 text-yellow-800"},
                                    tarefasFiltradas.filter(t => (t.coluna_kanban || 'todo') === 'todo' && t.status !== 'concluida').length
                                )
                            )
                        ),
                        React.createElement("div", {className: "space-y-3 max-h-[calc(100vh-280px)] overflow-y-auto"},
                            tarefasFiltradas.filter(t => (t.coluna_kanban || 'todo') === 'todo' && t.status !== 'concluida').map(t => 
                                React.createElement("div", {
                                    key: t.id,
                                    draggable: "true",
                                    onDragStart: (e) => {
                                        e.dataTransfer.setData('text/plain', t.id.toString());
                                        e.dataTransfer.effectAllowed = 'move';
                                        e.currentTarget.style.opacity = '0.5';
                                    },
                                    onDragEnd: (e) => {
                                        e.currentTarget.style.opacity = '1';
                                    },
                                    onClick: () => abrirTodoDetalhe(t),
                                    className: "bg-white rounded-lg p-3 shadow-sm border-l-4 cursor-move hover:shadow-md transition-all select-none " +
                                        (t.prioridade === 'urgente' ? 'border-l-red-500' : t.prioridade === 'alta' ? 'border-l-orange-500' : t.prioridade === 'media' ? 'border-l-yellow-500' : 'border-l-gray-300')
                                },
                                    React.createElement("h4", {className: "font-semibold text-gray-800 mb-1 pointer-events-none"}, t.titulo),
                                    React.createElement("div", {className: "flex flex-wrap gap-1 mt-2 pointer-events-none"},
                                        t.data_prazo && React.createElement("span", {
                                            className: "text-xs px-2 py-0.5 rounded-full " + (new Date(t.data_prazo) < hoje ? "bg-red-100 text-red-700" : "bg-gray-100 text-gray-600")
                                        }, "üìÖ ", new Date(t.data_prazo).toLocaleDateString('pt-BR')),
                                        t.qtd_subtarefas > 0 && React.createElement("span", {className: "text-xs px-2 py-0.5 rounded-full bg-purple-100 text-purple-700"},
                                            "‚òëÔ∏è ", t.qtd_subtarefas_concluidas || 0, "/", t.qtd_subtarefas
                                        )
                                    )
                                )
                            ),
                            tarefasFiltradas.filter(t => (t.coluna_kanban || 'todo') === 'todo' && t.status !== 'concluida').length === 0 && React.createElement("div", {className: "text-center py-8 text-gray-400"},
                                React.createElement("span", {className: "text-3xl block mb-2"}, "üìã"),
                                React.createElement("p", {className: "text-sm"}, "Nenhuma tarefa")
                            )
                        )
                    ),
                    
                    // Coluna FAZENDO
                    React.createElement("div", {
                        className: "flex-1 bg-blue-50 rounded-xl p-4 min-w-[300px] transition-all",
                        onDragOver: (e) => { 
                            e.preventDefault(); 
                            e.stopPropagation();
                            e.currentTarget.style.opacity = '0.7';
                        },
                        onDragLeave: (e) => {
                            e.currentTarget.style.opacity = '1';
                        },
                        onDrop: async (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            e.currentTarget.style.opacity = '1';
                            const tarefaId = e.dataTransfer.getData('text/plain');
                            console.log('Drop na coluna DOING, tarefaId:', tarefaId);
                            if (tarefaId) await moverTodoKanban(parseInt(tarefaId), 'doing');
                        }
                    },
                        React.createElement("div", {className: "flex items-center justify-between mb-4 pb-2 border-b-2 border-blue-200"},
                            React.createElement("div", {className: "flex items-center gap-2"},
                                React.createElement("span", {className: "text-xl"}, "üîÑ"),
                                React.createElement("h3", {className: "font-bold text-gray-800"}, "Fazendo"),
                                React.createElement("span", {className: "px-2 py-0.5 rounded-full text-xs font-bold bg-blue-200 text-blue-800"},
                                    tarefasFiltradas.filter(t => t.coluna_kanban === 'doing').length
                                )
                            )
                        ),
                        React.createElement("div", {className: "space-y-3 max-h-[calc(100vh-280px)] overflow-y-auto"},
                            tarefasFiltradas.filter(t => t.coluna_kanban === 'doing').map(t => 
                                React.createElement("div", {
                                    key: t.id,
                                    draggable: "true",
                                    onDragStart: (e) => {
                                        e.dataTransfer.setData('text/plain', t.id.toString());
                                        e.dataTransfer.effectAllowed = 'move';
                                        e.currentTarget.style.opacity = '0.5';
                                    },
                                    onDragEnd: (e) => {
                                        e.currentTarget.style.opacity = '1';
                                    },
                                    onClick: () => abrirTodoDetalhe(t),
                                    className: "bg-white rounded-lg p-3 shadow-sm border-l-4 cursor-move hover:shadow-md transition-all select-none " +
                                        (t.prioridade === 'urgente' ? 'border-l-red-500' : t.prioridade === 'alta' ? 'border-l-orange-500' : t.prioridade === 'media' ? 'border-l-yellow-500' : 'border-l-gray-300')
                                },
                                    React.createElement("h4", {className: "font-semibold text-gray-800 mb-1 pointer-events-none"}, t.titulo),
                                    React.createElement("div", {className: "flex flex-wrap gap-1 mt-2 pointer-events-none"},
                                        t.data_prazo && React.createElement("span", {
                                            className: "text-xs px-2 py-0.5 rounded-full " + (new Date(t.data_prazo) < hoje ? "bg-red-100 text-red-700" : "bg-gray-100 text-gray-600")
                                        }, "üìÖ ", new Date(t.data_prazo).toLocaleDateString('pt-BR')),
                                        t.qtd_subtarefas > 0 && React.createElement("span", {className: "text-xs px-2 py-0.5 rounded-full bg-purple-100 text-purple-700"},
                                            "‚òëÔ∏è ", t.qtd_subtarefas_concluidas || 0, "/", t.qtd_subtarefas
                                        )
                                    )
                                )
                            ),
                            tarefasFiltradas.filter(t => t.coluna_kanban === 'doing').length === 0 && React.createElement("div", {className: "text-center py-8 text-gray-400"},
                                React.createElement("span", {className: "text-3xl block mb-2"}, "üîÑ"),
                                React.createElement("p", {className: "text-sm"}, "Arraste tarefas para c√°")
                            )
                        )
                    ),
                    
                    // Coluna CONCLU√çDO
                    React.createElement("div", {
                        className: "flex-1 bg-green-50 rounded-xl p-4 min-w-[300px] transition-all",
                        onDragOver: (e) => { 
                            e.preventDefault(); 
                            e.stopPropagation();
                            e.currentTarget.style.opacity = '0.7';
                        },
                        onDragLeave: (e) => {
                            e.currentTarget.style.opacity = '1';
                        },
                        onDrop: async (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            e.currentTarget.style.opacity = '1';
                            const tarefaId = e.dataTransfer.getData('text/plain');
                            console.log('Drop na coluna DONE, tarefaId:', tarefaId);
                            if (tarefaId) await moverTodoKanban(parseInt(tarefaId), 'done');
                        }
                    },
                        React.createElement("div", {className: "flex items-center justify-between mb-4 pb-2 border-b-2 border-green-200"},
                            React.createElement("div", {className: "flex items-center gap-2"},
                                React.createElement("span", {className: "text-xl"}, "‚úÖ"),
                                React.createElement("h3", {className: "font-bold text-gray-800"}, "Conclu√≠do"),
                                React.createElement("span", {className: "px-2 py-0.5 rounded-full text-xs font-bold bg-green-200 text-green-800"},
                                    tarefasFiltradas.filter(t => t.coluna_kanban === 'done' || t.status === 'concluida').length
                                )
                            )
                        ),
                        React.createElement("div", {className: "space-y-3 max-h-[calc(100vh-280px)] overflow-y-auto"},
                            tarefasFiltradas.filter(t => t.coluna_kanban === 'done' || t.status === 'concluida').map(t => 
                                React.createElement("div", {
                                    key: t.id,
                                    draggable: "true",
                                    onDragStart: (e) => {
                                        e.dataTransfer.setData('text/plain', t.id.toString());
                                        e.dataTransfer.effectAllowed = 'move';
                                        e.currentTarget.style.opacity = '0.5';
                                    },
                                    onDragEnd: (e) => {
                                        e.currentTarget.style.opacity = '1';
                                    },
                                    onClick: () => abrirTodoDetalhe(t),
                                    className: "bg-white rounded-lg p-3 shadow-sm border-l-4 border-l-green-500 cursor-move hover:shadow-md transition-all opacity-75 select-none"
                                },
                                    React.createElement("h4", {className: "font-semibold text-gray-500 mb-1 line-through pointer-events-none"}, t.titulo),
                                    t.data_conclusao && React.createElement("span", {className: "text-xs text-gray-400 pointer-events-none"},
                                        "Conclu√≠do em ", new Date(t.data_conclusao).toLocaleDateString('pt-BR')
                                    )
                                )
                            ),
                            tarefasFiltradas.filter(t => t.coluna_kanban === 'done' || t.status === 'concluida').length === 0 && React.createElement("div", {className: "text-center py-8 text-gray-400"},
                                React.createElement("span", {className: "text-3xl block mb-2"}, "‚úÖ"),
                                React.createElement("p", {className: "text-sm"}, "Nenhuma tarefa conclu√≠da")
                            )
                        )
                    )
                ) :
                
                // LISTA VIEW (original)
                tarefasFiltradas.length === 0 ? 
                    React.createElement("div", {className: "text-center py-12"},
                        React.createElement("span", {className: "text-6xl block mb-4"}, todoViewMode === "meudia" ? "üéâ" : "üìã"),
                        React.createElement("p", {className: "text-gray-500 text-lg"}, 
                            todoViewMode === "meudia" ? "Nenhuma tarefa para hoje! Aproveite seu dia." : "Nenhuma tarefa neste grupo"
                        )
                    ) :
                    React.createElement("div", {className: "grid grid-cols-3 gap-4"},
                        tarefasFiltradas.map(t => {
                            const isAtrasada = t.data_prazo && new Date(t.data_prazo) < hoje && t.status !== "concluida";
                            const isHoje = t.data_prazo && new Date(t.data_prazo).toDateString() === hoje.toDateString();
                            
                            return React.createElement("div", {
                                key: t.id,
                                onClick: () => abrirTodoDetalhe(t),
                                className: "bg-white rounded-xl shadow-md p-4 border-l-4 hover:shadow-lg transition-shadow cursor-pointer " + 
                                    (t.status === "concluida" ? "border-green-500 opacity-75" : 
                                     isAtrasada ? "border-red-500" : 
                                     isHoje ? "border-orange-500" : 
                                     t.prioridade === "alta" ? "border-red-400" : 
                                     t.prioridade === "media" ? "border-yellow-400" : "border-blue-400")
                            },
                                // Header do card
                                React.createElement("div", {className: "flex justify-between items-start mb-2"},
                                    React.createElement("h3", {className: "font-bold text-gray-800 flex-1 " + (t.status === "concluida" ? "line-through text-gray-500" : "")}, t.titulo),
                                    React.createElement("div", {className: "flex gap-1"},
                                        React.createElement("button", {
                                            onClick: (e) => { e.stopPropagation(); abrirEditarTarefa(t); },
                                            className: "p-1 text-gray-400 hover:text-purple-600 hover:bg-purple-50 rounded"
                                        }, "‚úèÔ∏è"),
                                        React.createElement("button", {
                                            onClick: async (e) => {
                                                e.stopPropagation();
                                                if (confirm("Excluir esta tarefa?")) {
                                                    await fetchAuth(`${API_URL}/todo/tarefas/${t.id}`, {method: "DELETE"});
                                                    if (todoViewMode === "meudia") await loadTodoMeuDia();
                                                    else {
                                                        const tarefas = await loadTodoTarefas(todoGrupoAtivo.id);
                                                        setTodoTarefas(tarefas);
                                                    }
                                                    ja("üóëÔ∏è Tarefa exclu√≠da", "success");
                                                }
                                            },
                                            className: "p-1 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded"
                                        }, "üóëÔ∏è")
                                    )
                                ),
                                
                                // Descri√ß√£o
                                t.descricao && React.createElement("p", {className: "text-sm text-gray-600 mb-3 line-clamp-2"}, t.descricao),
                                
                                // Tags
                                React.createElement("div", {className: "flex flex-wrap gap-1 mb-3"},
                                    React.createElement("span", {
                                        className: "text-xs px-2 py-0.5 rounded-full " + 
                                            (t.prioridade === "alta" ? "bg-red-100 text-red-700" : 
                                             t.prioridade === "media" ? "bg-yellow-100 text-yellow-700" : "bg-blue-100 text-blue-700")
                                    }, t.prioridade === "alta" ? "üî¥ Alta" : t.prioridade === "media" ? "üü° M√©dia" : "üîµ Baixa"),
                                    isAtrasada && React.createElement("span", {className: "text-xs px-2 py-0.5 rounded-full bg-red-100 text-red-700"}, "üî• Atrasada"),
                                    isHoje && !isAtrasada && React.createElement("span", {className: "text-xs px-2 py-0.5 rounded-full bg-orange-100 text-orange-700"}, "üìÖ Hoje"),
                                    // Badge de Recorrente com tipo
                                    t.recorrente && React.createElement("span", {
                                        className: "text-xs px-2 py-0.5 rounded-full bg-indigo-100 text-indigo-700"
                                    }, "üîÑ ", 
                                        (t.tipo_recorrencia === "diaria" || t.tipo_recorrencia === "diario") ? "Di√°rio" :
                                        t.tipo_recorrencia === "semanal" ? "Semanal" :
                                        t.tipo_recorrencia === "mensal" ? "Mensal" : 
                                        t.tipo_recorrencia === "personalizado" ? `A cada ${t.intervalo_recorrencia || 1} dias` : "Recorrente"
                                    ),
                                    // Indicador de Subtarefas
                                    t.qtd_subtarefas > 0 && React.createElement("span", {
                                        className: "text-xs px-2 py-0.5 rounded-full " + 
                                            (t.qtd_subtarefas_concluidas === t.qtd_subtarefas ? "bg-green-100 text-green-700" : "bg-purple-100 text-purple-700")
                                    }, "‚òëÔ∏è ", t.qtd_subtarefas_concluidas || 0, "/", t.qtd_subtarefas)
                                ),
                                
                                // Data
                                React.createElement("div", {className: "text-xs text-gray-500"},
                                    t.data_prazo && React.createElement("p", {className: "mb-1"}, "üìÖ ", new Date(t.data_prazo).toLocaleDateString("pt-BR"))
                                ),
                                
                                // Atribu√≠do a - com fotos dos respons√°veis
                                (() => {
                                    try {
                                        let resp = t.responsaveis;
                                        if (typeof resp === 'string') resp = JSON.parse(resp);
                                        if (!Array.isArray(resp) || resp.length === 0) return null;
                                        
                                        return React.createElement("div", {className: "flex items-center gap-2 mt-2 pt-2 border-t border-gray-100"},
                                            React.createElement("span", {className: "text-xs text-gray-500"}, "Atribu√≠do a:"),
                                            React.createElement("div", {className: "flex -space-x-2"},
                                                resp.slice(0, 5).map((r, idx) => {
                                                    const respCod = typeof r === 'string' ? r : (r.cod || r.user_cod);
                                                    const usuario = todoAdmins.find(a => a.cod === respCod || a.nome === respCod);
                                                    const nome = usuario?.nome || (typeof r === 'string' ? r : (r.nome || r.name || '?'));
                                                    
                                                    return usuario?.foto 
                                                        ? React.createElement("img", {
                                                            key: idx,
                                                            src: usuario.foto,
                                                            className: "w-7 h-7 rounded-full object-cover border-2 border-white",
                                                            title: nome
                                                        })
                                                        : React.createElement("div", {
                                                            key: idx,
                                                            className: "w-7 h-7 rounded-full bg-purple-200 flex items-center justify-center text-xs font-bold text-purple-700 border-2 border-white",
                                                            title: nome
                                                        }, nome.charAt(0).toUpperCase());
                                                }),
                                                resp.length > 5 && React.createElement("div", {
                                                    className: "w-7 h-7 rounded-full bg-gray-300 flex items-center justify-center text-xs font-bold text-gray-600 border-2 border-white"
                                                }, "+", resp.length - 5)
                                            )
                                        );
                                    } catch (e) { return null; }
                                })(),
                                
                                // Bot√£o de status
                                React.createElement("div", {className: "mt-3 pt-3 border-t"},
                                    t.status === "concluida" ? 
                                        React.createElement("button", {
                                            onClick: async () => {
                                                await fetchAuth(`${API_URL}/todo/tarefas/${t.id}`, {
                                                    method: "PATCH",
                                                    headers: {"Content-Type": "application/json"},
                                                    body: JSON.stringify({status: "pendente"})
                                                });
                                                if (todoViewMode === "meudia") await loadTodoMeuDia();
                                                else {
                                                    const tarefas = await loadTodoTarefas(todoGrupoAtivo.id);
                                                    setTodoTarefas(tarefas);
                                                }
                                            },
                                            className: "w-full py-2 bg-gray-100 text-gray-600 rounded-lg text-sm font-semibold hover:bg-gray-200"
                                        }, "‚Ü©Ô∏è Reabrir") :
                                        React.createElement("button", {
                                            onClick: async () => {
                                                await fetchAuth(`${API_URL}/todo/tarefas/${t.id}`, {
                                                    method: "PATCH",
                                                    headers: {"Content-Type": "application/json"},
                                                    body: JSON.stringify({status: "concluida"})
                                                });
                                                if (todoViewMode === "meudia") await loadTodoMeuDia();
                                                else {
                                                    const tarefas = await loadTodoTarefas(todoGrupoAtivo.id);
                                                    setTodoTarefas(tarefas);
                                                }
                                                ja("‚úÖ Tarefa conclu√≠da!", "success");
                                            },
                                            className: "w-full py-2 bg-green-500 text-white rounded-lg text-sm font-semibold hover:bg-green-600"
                                        }, "‚úÖ Concluir")
                                )
                            );
                        })
                    ),
                
                // Tabs e M√©tricas (apenas admin_master)
                "admin_master" === l.role && todoTab === "metricas" && todoMetricas && React.createElement("div", {className: "mt-8"},
                    React.createElement("h2", {className: "text-2xl font-bold text-gray-800 mb-6"}, "üìä M√©tricas de Produtividade"),
                    React.createElement("div", {className: "grid grid-cols-4 gap-4"},
                        React.createElement("div", {className: "bg-white rounded-xl shadow p-4"},
                            React.createElement("p", {className: "text-gray-500 text-sm"}, "Total de Tarefas"),
                            React.createElement("p", {className: "text-3xl font-bold text-gray-800"}, todoMetricas.totais?.total || 0)
                        ),
                        React.createElement("div", {className: "bg-white rounded-xl shadow p-4"},
                            React.createElement("p", {className: "text-gray-500 text-sm"}, "Conclu√≠das"),
                            React.createElement("p", {className: "text-3xl font-bold text-green-600"}, todoMetricas.totais?.concluidas || 0)
                        ),
                        React.createElement("div", {className: "bg-white rounded-xl shadow p-4"},
                            React.createElement("p", {className: "text-gray-500 text-sm"}, "No Prazo"),
                            React.createElement("p", {className: "text-3xl font-bold text-blue-600"}, todoMetricas.totais?.no_prazo || 0)
                        ),
                        React.createElement("div", {className: "bg-white rounded-xl shadow p-4"},
                            React.createElement("p", {className: "text-gray-500 text-sm"}, "Vencidas"),
                            React.createElement("p", {className: "text-3xl font-bold text-red-600"}, todoMetricas.totais?.vencidas || 0)
                        )
                    )
                )
                ) // Fecha div de scroll
            ),
            
            // Modal de Novo Grupo
            todoModal?.tipo === "novoGrupo" && React.createElement("div", {
                className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50"
            }, React.createElement("div", {
                className: "bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden"
            }, React.createElement("div", {
                className: "bg-gradient-to-r from-purple-600 to-indigo-600 p-4 text-white flex justify-between items-center"
            }, React.createElement("h2", {className: "text-xl font-bold"}, "üìÅ Novo Grupo"), React.createElement("button", {
                onClick: () => setTodoModal(null),
                className: "text-white/80 hover:text-white text-xl"
            }, "‚úï")), React.createElement("div", {className: "p-6 space-y-4"},
                React.createElement("div", null,
                    React.createElement("label", {className: "block text-sm font-semibold mb-1"}, "Nome do Grupo *"),
                    React.createElement("input", {
                        type: "text",
                        value: todoModal.nome || "",
                        onChange: e => setTodoModal({...todoModal, nome: e.target.value}),
                        className: "w-full px-3 py-2 border rounded-lg",
                        placeholder: "Ex: Projetos Q1"
                    })
                ),
                React.createElement("div", null,
                    React.createElement("label", {className: "block text-sm font-semibold mb-1"}, "√çcone"),
                    React.createElement("select", {
                        value: todoModal.icone || "üìã",
                        onChange: e => setTodoModal({...todoModal, icone: e.target.value}),
                        className: "w-full px-3 py-2 border rounded-lg bg-white"
                    }, ["üìã", "üìÅ", "üéØ", "üíº", "üöÄ", "‚≠ê", "üî•", "üí°", "üìä", "üõ†Ô∏è"].map(ic => 
                        React.createElement("option", {key: ic, value: ic}, ic)
                    ))
                ),
                React.createElement("div", null,
                    React.createElement("label", {className: "block text-sm font-semibold mb-1"}, "Tipo"),
                    React.createElement("select", {
                        value: todoModal.tipoGrupo || "compartilhado",
                        onChange: e => setTodoModal({...todoModal, tipoGrupo: e.target.value}),
                        className: "w-full px-3 py-2 border rounded-lg bg-white"
                    }, React.createElement("option", {value: "compartilhado"}, "üë• Compartilhado"),
                        React.createElement("option", {value: "pessoal"}, "üîí Pessoal"))
                ),
                React.createElement("div", {className: "flex gap-3 pt-4"},
                    React.createElement("button", {
                        onClick: () => setTodoModal(null),
                        className: "flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold"
                    }, "Cancelar"),
                    React.createElement("button", {
                        onClick: async () => {
                            if (!todoModal.nome?.trim()) {
                                ja("Informe o nome do grupo", "error");
                                return;
                            }
                            await fetchAuth(`${API_URL}/todo/grupos`, {
                                method: "POST",
                                headers: {"Content-Type": "application/json"},
                                body: JSON.stringify({
                                    nome: todoModal.nome,
                                    icone: todoModal.icone || "üìã",
                                    tipo: todoModal.tipoGrupo || "compartilhado",
                                    criado_por: l.fullName
                                })
                            });
                            const grupos = await loadTodoGrupos();
                            setTodoGrupos(grupos);
                            setTodoModal(null);
                            ja("‚úÖ Grupo criado!", "success");
                        },
                        className: "flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700"
                    }, "Criar Grupo")
                )
            ))),
            
            // Modal de Nova/Editar Tarefa
            (todoModal?.tipo === "novaTarefa" || todoModal?.tipo === "editarTarefa") && React.createElement("div", {
                className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
            }, React.createElement("div", {
                className: "bg-white rounded-2xl shadow-2xl w-full max-w-6xl max-h-[95vh] overflow-hidden flex flex-col"
            }, React.createElement("div", {
                className: "bg-gradient-to-r from-purple-600 to-indigo-600 p-4 text-white flex justify-between items-center flex-shrink-0"
            }, React.createElement("div", {className: "flex items-center gap-4"},
                    React.createElement("h2", {className: "text-xl font-bold"}, todoModal.tipo === "novaTarefa" ? "üìù Nova Tarefa" : "‚úèÔ∏è Editar Tarefa"),
                    // Info do criador inline no header
                    todoModal.tipo === "novaTarefa" && React.createElement("div", {className: "flex items-center gap-2 bg-white/20 px-3 py-1 rounded-full"},
                        socialProfile?.profile_photo 
                            ? React.createElement("img", {src: socialProfile.profile_photo, className: "w-6 h-6 rounded-full object-cover"})
                            : React.createElement("div", {className: "w-6 h-6 rounded-full bg-white/30 flex items-center justify-center text-white text-xs font-bold"}, 
                                (l.fullName || "?").charAt(0).toUpperCase()
                            ),
                        React.createElement("span", {className: "text-sm"}, l.fullName || l.username)
                    )
                ),
                React.createElement("div", {className: "flex items-center gap-4"},
                    // Toggle de Recorr√™ncia
                    React.createElement("div", {className: "flex items-center gap-2 bg-white/20 px-3 py-1.5 rounded-lg"},
                        React.createElement("span", {className: "text-sm"}, "üîÑ Recorrente"),
                        React.createElement("button", {
                            type: "button",
                            onClick: () => setTodoModal({...todoModal, recorrente: !todoModal.recorrente}),
                            className: `relative w-10 h-5 rounded-full transition-colors ${todoModal.recorrente ? 'bg-green-400' : 'bg-white/30'}`
                        },
                            React.createElement("div", {
                                className: `absolute top-0.5 left-0.5 w-4 h-4 bg-white rounded-full transition-transform ${todoModal.recorrente ? 'translate-x-5' : ''}`
                            })
                        )
                    ),
                    React.createElement("button", {
                        onClick: () => setTodoModal(null),
                        className: "text-white/80 hover:text-white text-xl"
                    }, "‚úï")
                )
            ), 
            
            // Op√ß√µes de Recorr√™ncia (aparece se toggle ativo)
            todoModal.recorrente && React.createElement("div", {className: "px-6 py-2 bg-indigo-50 border-b flex items-center gap-4 flex-wrap"},
                React.createElement("span", {className: "text-sm text-indigo-700 font-medium"}, "‚è∞ Repetir:"),
                ["diaria", "semanal", "mensal", "personalizado"].map(tipo => 
                    React.createElement("button", {
                        key: tipo,
                        type: "button",
                        onClick: () => setTodoModal({...todoModal, tipoRecorrencia: tipo}),
                        className: `px-3 py-1 rounded-lg text-sm font-medium transition-all ${
                            (todoModal.tipoRecorrencia || "diaria") === tipo 
                                ? 'bg-indigo-600 text-white' 
                                : 'bg-white text-gray-600 hover:bg-gray-100'
                        }`
                    }, tipo === "diaria" ? "Di√°rio" : tipo === "semanal" ? "Semanal" : tipo === "mensal" ? "Mensal" : "Personalizado")
                ),
                (todoModal.tipoRecorrencia === "personalizado") && React.createElement("div", {className: "flex items-center gap-2"},
                    React.createElement("span", {className: "text-sm text-gray-600"}, "A cada"),
                    React.createElement("input", {
                        type: "number",
                        min: 1,
                        value: todoModal.intervaloRecorrencia || 1,
                        onChange: e => setTodoModal({...todoModal, intervaloRecorrencia: parseInt(e.target.value) || 1}),
                        className: "w-14 px-2 py-1 border rounded text-sm text-center"
                    }),
                    React.createElement("span", {className: "text-sm text-gray-600"}, "dias")
                )
            ),
            
            // Conte√∫do principal - Layout horizontal em 3 colunas
            React.createElement("div", {className: "p-6 overflow-y-auto flex-1"},
                React.createElement("div", {className: "grid grid-cols-3 gap-6"},
                    
                    // COLUNA 1 - T√≠tulo e Descri√ß√£o
                    React.createElement("div", {className: "space-y-4"},
                        React.createElement("div", null,
                            React.createElement("label", {className: "block text-sm font-semibold text-gray-700 mb-1"}, "T√≠tulo *"),
                            React.createElement("input", {
                                type: "text",
                                value: todoModal.titulo || todoModal.tarefa?.titulo || "",
                                onChange: e => setTodoModal({...todoModal, titulo: e.target.value}),
                                className: "w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:ring-0 transition-colors",
                                placeholder: "O que precisa ser feito?"
                            })
                        ),
                        React.createElement("div", null,
                            React.createElement("label", {className: "block text-sm font-semibold text-gray-700 mb-1"}, "Descri√ß√£o"),
                            React.createElement("textarea", {
                                value: todoModal.descricao || todoModal.tarefa?.descricao || "",
                                onChange: e => setTodoModal({...todoModal, descricao: e.target.value}),
                                className: "w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:ring-0 transition-colors h-32 resize-none",
                                placeholder: "Detalhes da tarefa..."
                            })
                        ),
                        // Checklist compacto
                        React.createElement("div", {className: "bg-gray-50 rounded-xl p-3"},
                            React.createElement("label", {className: "block text-sm font-semibold text-gray-700 mb-2"}, "‚òëÔ∏è Checklist"),
                            (todoModal.checklist || []).length > 0 && React.createElement("div", {className: "space-y-1 mb-2"},
                                (todoModal.checklist || []).map((item, idx) =>
                                    React.createElement("div", {
                                        key: idx,
                                        className: "flex items-center gap-2 bg-white px-2 py-1 rounded text-sm"
                                    },
                                        React.createElement("span", {className: "text-gray-400"}, idx + 1 + "."),
                                        React.createElement("span", {className: "flex-1 text-gray-700"}, item),
                                        React.createElement("button", {
                                            onClick: () => {
                                                const newChecklist = [...(todoModal.checklist || [])];
                                                newChecklist.splice(idx, 1);
                                                setTodoModal({...todoModal, checklist: newChecklist});
                                            },
                                            className: "text-red-400 hover:text-red-600 text-xs"
                                        }, "‚úï")
                                    )
                                )
                            ),
                            React.createElement("div", {className: "flex gap-2"},
                                React.createElement("input", {
                                    type: "text",
                                    id: "novo-checklist-item",
                                    placeholder: "Adicionar item...",
                                    className: "flex-1 px-3 py-2 border rounded-lg text-sm",
                                    onKeyPress: (e) => {
                                        if (e.key === 'Enter' && e.target.value.trim()) {
                                            const newChecklist = [...(todoModal.checklist || []), e.target.value.trim()];
                                            setTodoModal({...todoModal, checklist: newChecklist});
                                            e.target.value = '';
                                        }
                                    }
                                }),
                                React.createElement("button", {
                                    onClick: () => {
                                        const input = document.getElementById('novo-checklist-item');
                                        if (input && input.value.trim()) {
                                            const newChecklist = [...(todoModal.checklist || []), input.value.trim()];
                                            setTodoModal({...todoModal, checklist: newChecklist});
                                            input.value = '';
                                        }
                                    },
                                    className: "px-3 py-2 bg-purple-100 text-purple-700 rounded-lg text-sm font-semibold hover:bg-purple-200"
                                }, "+")
                            )
                        )
                    ),
                    
                    // COLUNA 2 - Configura√ß√µes (Prioridade, Data, Grupo)
                    React.createElement("div", {className: "space-y-4"},
                        React.createElement("div", null,
                            React.createElement("label", {className: "block text-sm font-semibold text-gray-700 mb-1"}, "Prioridade"),
                            React.createElement("div", {className: "grid grid-cols-3 gap-2"},
                                ["baixa", "media", "alta"].map(p => 
                                    React.createElement("button", {
                                        key: p,
                                        type: "button",
                                        onClick: () => setTodoModal({...todoModal, prioridade: p}),
                                        className: `px-3 py-2 rounded-lg text-sm font-medium transition-all ${
                                            (todoModal.prioridade || todoModal.tarefa?.prioridade || "media") === p 
                                                ? (p === "alta" ? "bg-red-500 text-white" : p === "media" ? "bg-yellow-500 text-white" : "bg-blue-500 text-white")
                                                : "bg-gray-100 text-gray-600 hover:bg-gray-200"
                                        }`
                                    }, p === "baixa" ? "üîµ Baixa" : p === "media" ? "üü° M√©dia" : "üî¥ Alta")
                                )
                            )
                        ),
                        React.createElement("div", null,
                            React.createElement("label", {className: "block text-sm font-semibold text-gray-700 mb-1"}, "üìÖ Data de Vencimento"),
                            React.createElement("input", {
                                type: "date",
                                value: todoModal.dataVencimento || (todoModal.tarefa?.data_vencimento ? todoModal.tarefa.data_vencimento.split("T")[0] : ""),
                                onChange: e => setTodoModal({...todoModal, dataVencimento: e.target.value}),
                                className: "w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500"
                            })
                        ),
                        todoModal.tipo === "novaTarefa" && React.createElement("div", null,
                            React.createElement("label", {className: "block text-sm font-semibold text-gray-700 mb-1"}, "üìÅ Grupo"),
                            React.createElement("select", {
                                value: todoModal.grupoId || todoGrupoAtivo?.id || "",
                                onChange: e => setTodoModal({...todoModal, grupoId: e.target.value}),
                                className: "w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 bg-white"
                            }, React.createElement("option", {value: ""}, "Selecione um grupo..."),
                                // Filtra apenas grupos que o usu√°rio criou ou que s√£o compartilhados
                                todoGrupos
                                    .filter(g => g.criado_por === l.codProfissional || g.tipo === 'compartilhado' || l.role === 'admin_master')
                                    .map(g => React.createElement("option", {key: g.id, value: g.id}, g.icone + " " + g.nome))
                            )
                        )
                    ),
                    
                    // COLUNA 3 - Respons√°veis
                    React.createElement("div", {className: "space-y-3"},
                        React.createElement("label", {className: "block text-sm font-semibold text-gray-700"}, "üë• Atribuir para"),
                        
                        // Usu√°rios selecionados
                        (todoModal.responsaveisSelecionados || []).length > 0 && React.createElement("div", {className: "flex flex-wrap gap-2 p-3 bg-purple-50 rounded-xl"},
                            (todoModal.responsaveisSelecionados || []).map(resp => {
                                const usuario = todoAdmins.find(a => a.cod === resp || a.nome === resp);
                                return React.createElement("div", {
                                    key: resp,
                                    className: "flex items-center gap-2 bg-white text-purple-800 px-3 py-1.5 rounded-full shadow-sm"
                                },
                                    usuario?.foto 
                                        ? React.createElement("img", {src: usuario.foto, className: "w-6 h-6 rounded-full object-cover"})
                                        : React.createElement("div", {className: "w-6 h-6 rounded-full bg-purple-200 flex items-center justify-center text-xs font-bold text-purple-700"}, 
                                            (usuario?.nome || resp).charAt(0).toUpperCase()
                                        ),
                                    React.createElement("span", {className: "text-sm font-medium"}, usuario?.nome || resp),
                                    React.createElement("button", {
                                        onClick: () => {
                                            const novos = (todoModal.responsaveisSelecionados || []).filter(r => r !== resp);
                                            setTodoModal({...todoModal, responsaveisSelecionados: novos});
                                        },
                                        className: "text-purple-400 hover:text-purple-600"
                                    }, "‚úï")
                                );
                            })
                        ),
                        
                        // Lista de usu√°rios dispon√≠veis
                        React.createElement("div", {className: "border-2 border-gray-200 rounded-xl overflow-hidden"},
                            React.createElement("div", {className: "max-h-64 overflow-y-auto"},
                                todoAdmins
                                    .filter(a => !(todoModal.responsaveisSelecionados || []).includes(a.cod) && !(todoModal.responsaveisSelecionados || []).includes(a.nome))
                                    .map(a => React.createElement("div", {
                                        key: a.cod,
                                        className: "flex items-center gap-3 p-3 hover:bg-purple-50 cursor-pointer border-b last:border-b-0 transition-colors",
                                        onClick: () => {
                                            const atuais = todoModal.responsaveisSelecionados || [];
                                            if (!atuais.includes(a.cod)) {
                                                setTodoModal({...todoModal, responsaveisSelecionados: [...atuais, a.cod]});
                                            }
                                        }
                                    },
                                        a.foto 
                                            ? React.createElement("img", {src: a.foto, className: "w-10 h-10 rounded-full object-cover"})
                                            : React.createElement("div", {className: "w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center font-bold text-gray-600"}, 
                                                (a.nome || "?").charAt(0).toUpperCase()
                                            ),
                                        React.createElement("div", {className: "flex-1"},
                                            React.createElement("p", {className: "font-medium text-gray-800"}, a.nome),
                                            React.createElement("p", {className: "text-xs text-gray-500"}, a.role === "admin_master" ? "üëë Master" : "üëë Admin")
                                        ),
                                        React.createElement("div", {className: "w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center text-purple-600"}, "+")
                                    ))
                            ),
                            todoAdmins.filter(a => !(todoModal.responsaveisSelecionados || []).includes(a.cod)).length === 0 &&
                                React.createElement("div", {className: "p-4 text-center text-gray-500 text-sm"}, "Todos os usu√°rios j√° foram selecionados")
                        )
                    )
                )
            ),
            
            // Footer com bot√µes
            React.createElement("div", {className: "px-6 py-4 bg-gray-50 border-t flex justify-end gap-3"},
                React.createElement("button", {
                    onClick: () => setTodoModal(null),
                    className: "px-6 py-3 bg-gray-200 text-gray-700 rounded-xl font-semibold hover:bg-gray-300 transition-colors"
                }, "Cancelar"),
                React.createElement("button", {
                    onClick: async () => {
                        const titulo = todoModal.titulo || todoModal.tarefa?.titulo;
                        if (!titulo?.trim()) {
                            ja("Informe o t√≠tulo", "error");
                            return;
                        }
                        const grupoId = todoModal.grupoId || todoGrupoAtivo?.id || todoModal.tarefa?.grupo_id;
                        if (!grupoId) {
                            ja("Selecione um grupo", "error");
                            return;
                        }
                        
                        // Preparar array de respons√°veis (cod dos usu√°rios)
                        const responsaveisFinais = todoModal.responsaveisSelecionados || [];
                        
                        if (todoModal.tipo === "novaTarefa") {
                            const res = await fetchAuth(`${API_URL}/todo/tarefas`, {
                                method: "POST",
                                headers: {"Content-Type": "application/json"},
                                body: JSON.stringify({
                                    grupo_id: grupoId,
                                    titulo: titulo,
                                    descricao: todoModal.descricao || "",
                                    prioridade: todoModal.prioridade || "media",
                                    data_prazo: todoModal.dataVencimento || null,
                                    responsaveis: responsaveisFinais,
                                    criado_por: l.codProfissional,
                                    criado_por_nome: l.fullName,
                                    criado_por_foto: socialProfile?.profile_photo || null,
                                    recorrente: todoModal.recorrente || false,
                                    tipo_recorrencia: todoModal.recorrente ? (todoModal.tipoRecorrencia || "diaria") : null,
                                    intervalo_recorrencia: todoModal.recorrente ? (todoModal.intervaloRecorrencia || 1) : 1
                                })
                            });
                            const novaTarefa = await res.json();
                            
                            // Criar subtarefas do checklist
                            if (todoModal.checklist && todoModal.checklist.length > 0) {
                                for (let i = 0; i < todoModal.checklist.length; i++) {
                                    await fetchAuth(`${API_URL}/todo/tarefas/${novaTarefa.id}/subtarefas`, {
                                        method: "POST",
                                        headers: {"Content-Type": "application/json"},
                                        body: JSON.stringify({ titulo: todoModal.checklist[i], ordem: i })
                                    });
                                }
                            }
                            
                            ja("‚úÖ Tarefa criada!", "success");
                        } else {
                            await fetchAuth(`${API_URL}/todo/tarefas/${todoModal.tarefa.id}`, {
                                method: "PUT",
                                headers: {"Content-Type": "application/json"},
                                body: JSON.stringify({
                                    titulo: titulo,
                                    descricao: todoModal.descricao ?? todoModal.tarefa.descricao,
                                    prioridade: todoModal.prioridade || todoModal.tarefa.prioridade,
                                    data_prazo: todoModal.dataVencimento || todoModal.tarefa.data_prazo,
                                    responsaveis: responsaveisFinais.length > 0 ? responsaveisFinais : (todoModal.tarefa.responsaveis || []),
                                    user_cod: l.codProfissional,
                                    user_name: l.fullName,
                                    recorrente: todoModal.recorrente || false,
                                    tipo_recorrencia: todoModal.recorrente ? (todoModal.tipoRecorrencia || "diaria") : null,
                                    intervalo_recorrencia: todoModal.recorrente ? (todoModal.intervaloRecorrencia || 1) : 1
                                })
                            });
                            ja("‚úÖ Tarefa atualizada!", "success");
                        }
                        
                        if (todoViewMode === "meudia") await loadTodoMeuDia();
                        else if (todoGrupoAtivo) {
                            const tarefas = await loadTodoTarefas(todoGrupoAtivo.id);
                            setTodoTarefas(tarefas);
                        }
                        setTodoModal(null);
                    },
                    className: "px-8 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-xl font-semibold hover:from-purple-700 hover:to-indigo-700 transition-all shadow-lg"
                }, todoModal.tipo === "novaTarefa" ? "üìù Criar Tarefa" : "üíæ Salvar Altera√ß√µes")
            )))
            )
        }
        
        // ========== M√ìDULO FILAS ==========
        if ("filas" === Ee) {
            return React.createElement("div", {
                className: "min-h-screen bg-gray-50"
            }, 
                i && React.createElement(Toast, i),
                n && React.createElement(LoadingOverlay, null),
                // Header
                React.createElement(HeaderCompacto, {
                    usuario: l,
                    moduloAtivo: Ee,
                    abaAtiva: filasTab,
                    socialProfile: socialProfile,
                    isLoading: f,
                    lastUpdate: E,
                    onRefresh: () => window.location.reload(),
                    onLogout: () => o(null),
                    onGoHome: () => he("home"),
                    onNavigate: navegarSidebar,
                    onChangeTab: (abaId) => setFilasTab(abaId)
                }),
                // Conte√∫do
                React.createElement("div", { className: "max-w-7xl mx-auto p-6" },
                    typeof window.ModuloFilas !== 'undefined' 
                        ? React.createElement(window.ModuloFilas, {
                            usuario: l,
                            apiUrl: API_URL,
                            showToast: ja,
                            abaAtiva: filasTab,
                            onChangeTab: setFilasTab
                        })
                        : React.createElement("div", { className: "text-center py-12" },
                            React.createElement("p", { className: "text-red-500" }, "‚ö†Ô∏è M√≥dulo de Filas n√£o carregado. Verifique se o arquivo filas.js est√° presente.")
                        )
                )
            );
        }
        
        // ========== M√ìDULO SOCIAL ==========
        if ("social" === Ee) {
            return React.createElement("div", {
                className: "min-h-screen bg-gradient-to-br from-purple-50 to-pink-50"
            }, i && React.createElement(Toast, i), n && React.createElement(LoadingOverlay, null),
            
            // Modal para enviar mensagem/rea√ß√£o
            socialModalUser && React.createElement("div", {
                className: "fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",
                onClick: () => setSocialModalUser(null)
            }, React.createElement("div", {
                className: "bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden",
                onClick: e => e.stopPropagation()
            }, React.createElement("div", {
                className: "bg-gradient-to-r from-purple-600 to-pink-600 p-4 text-white"
            }, React.createElement("div", {className: "flex items-center gap-3"},
                socialModalUser.profile_photo ? React.createElement("img", {
                    src: socialModalUser.profile_photo,
                    className: "w-12 h-12 rounded-full object-cover border-2 border-white"
                }) : React.createElement("div", {
                    className: "w-12 h-12 rounded-full bg-white/20 flex items-center justify-center text-xl font-bold"
                }, socialModalUser.display_name?.charAt(0)?.toUpperCase() || "?"),
                React.createElement("div", null,
                    React.createElement("p", {className: "font-bold"}, socialModalUser.display_name),
                    React.createElement("p", {className: "text-sm text-purple-200"}, socialModalUser.is_online ? "üü¢ Online" : "‚ö´ Offline")
                )
            )),
            React.createElement("div", {className: "p-6"},
                React.createElement("p", {className: "text-gray-600 text-sm mb-4 text-center italic"}, 
                    "üíú Pratique a gentileza! Envie uma mensagem positiva ao seu colega."),
                React.createElement("div", {className: "mb-4"},
                    React.createElement("p", {className: "font-semibold text-gray-700 mb-2"}, "Escolha uma rea√ß√£o (opcional):"),
                    React.createElement("div", {className: "flex justify-center gap-3"},
                        ["üíú", "ü•á", "üòä", "üòÅ", "ü§©"].map(emoji => 
                            React.createElement("button", {
                                key: emoji,
                                onClick: () => x({...p, socialSelectedEmoji: p.socialSelectedEmoji === emoji ? null : emoji}),
                                className: "text-3xl transition-transform p-2 rounded-full " + 
                                    (p.socialSelectedEmoji === emoji ? "bg-purple-200 scale-125 ring-2 ring-purple-500" : "hover:scale-110 hover:bg-purple-100")
                            }, emoji)
                        )
                    ),
                    p.socialSelectedEmoji && React.createElement("p", {className: "text-center text-sm text-purple-600 mt-2"}, 
                        "‚úì Rea√ß√£o selecionada: ", p.socialSelectedEmoji)
                ),
                React.createElement("div", null,
                    React.createElement("p", {className: "font-semibold text-gray-700 mb-2"}, "Escreva uma mensagem (opcional):"),
                    React.createElement("textarea", {
                        placeholder: "Escreva uma mensagem gentil...",
                        value: p.socialMsgText || "",
                        onChange: e => x({...p, socialMsgText: e.target.value}),
                        className: "w-full px-4 py-3 border border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500 h-24 resize-none"
                    }),
                    React.createElement("button", {
                        onClick: async () => {
                            const hasEmoji = p.socialSelectedEmoji;
                            const hasText = p.socialMsgText?.trim();
                            
                            if (!hasEmoji && !hasText) {
                                ja("Selecione uma rea√ß√£o ou escreva uma mensagem", "error");
                                return;
                            }
                            
                            // Envia rea√ß√£o se selecionada
                            if (hasEmoji) {
                                await sendSocialMessage(socialModalUser.cod_profissional, "reaction", p.socialSelectedEmoji);
                            }
                            
                            // Envia mensagem de texto se preenchida
                            if (hasText) {
                                await sendSocialMessage(socialModalUser.cod_profissional, "message", p.socialMsgText);
                            }
                            
                            // Limpa os campos
                            x({...p, socialMsgText: "", socialSelectedEmoji: null});
                        },
                        disabled: !p.socialSelectedEmoji && !p.socialMsgText?.trim(),
                        className: "w-full mt-3 px-4 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl font-semibold disabled:opacity-50"
                    }, "üíå Enviar")
                )
            ))),
            
            // Navbar
            React.createElement("nav", {
                className: "bg-gradient-to-r from-purple-700 to-pink-700 shadow-lg"
            }, React.createElement("div", {
                className: "max-w-4xl mx-auto px-4 py-4 flex justify-between items-center"
            }, React.createElement("div", {className: "flex items-center gap-3"},
                socialProfile?.profile_photo ? React.createElement("img", {
                    src: socialProfile.profile_photo,
                    className: "w-10 h-10 rounded-full object-cover border-2 border-white/50"
                }) : React.createElement("div", {
                    className: "w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-white font-bold"
                }, l.fullName?.charAt(0)?.toUpperCase() || "?"),
                React.createElement("h1", {className: "text-xl font-bold text-white"}, "üíú Social")
            ),
            React.createElement("div", {className: "flex items-center gap-2"},
                React.createElement("button", {
                    onClick: () => he("home"),
                    className: "px-4 py-2 bg-white/10 text-white rounded-lg hover:bg-white/20 text-sm"
                }, "‚Üê Voltar"),
                React.createElement("button", {
                    onClick: () => o(null),
                    className: "px-4 py-2 text-white hover:bg-white/20 rounded-lg"
                }, "Sair")
            ))),
            
            // Tabs
            React.createElement("div", {
                className: "bg-white border-b sticky top-0 z-10"
            }, React.createElement("div", {
                className: "max-w-4xl mx-auto flex overflow-x-auto"
            },
                React.createElement("button", {
                    onClick: () => setSocialTab("perfil"),
                    className: "flex-1 py-4 text-center font-semibold whitespace-nowrap px-2 " + (socialTab === "perfil" ? "text-purple-600 border-b-2 border-purple-600" : "text-gray-500")
                }, "üë§ Perfil"),
                React.createElement("button", {
                    onClick: () => { setSocialTab("comunidade"); loadSocialUsers(); },
                    className: "flex-1 py-4 text-center font-semibold whitespace-nowrap px-2 " + (socialTab === "comunidade" ? "text-purple-600 border-b-2 border-purple-600" : "text-gray-500")
                }, "üë• Comunidade"),
                React.createElement("button", {
                    onClick: () => { setSocialTab("mensagens"); loadSocialMessages(); markMessagesAsRead(); },
                    className: "flex-1 py-4 text-center font-semibold relative whitespace-nowrap px-2 " + (socialTab === "mensagens" ? "text-purple-600 border-b-2 border-purple-600" : "text-gray-500")
                }, "üíå Mensagens", socialUnread > 0 && React.createElement("span", {
                    className: "absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center"
                }, socialUnread > 9 ? "9+" : socialUnread)),
                // Aba Mensagens da Lideran√ßa (para todos admins verem o hist√≥rico)
                ["admin", "admin_master", "admin_financeiro"].includes(l.role) && React.createElement("button", {
                    onClick: () => { setSocialTab("lideranca_historico"); loadLiderancaHistorico(); },
                    className: "flex-1 py-4 text-center font-semibold whitespace-nowrap px-2 relative " + (socialTab === "lideranca_historico" ? "text-purple-600 border-b-2 border-purple-600" : "text-gray-500")
                }, "üì¢ Lideran√ßa", liderancaPendentes.length > 0 && React.createElement("span", {
                    className: "absolute -top-1 -right-1 bg-orange-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center"
                }, liderancaPendentes.length)),
                // Aba Gerenciar (apenas admin_master)
                l.role === "admin_master" && React.createElement("button", {
                    onClick: () => { setSocialTab("lideranca_gerenciar"); loadLiderancaMensagens(); },
                    className: "flex-1 py-4 text-center font-semibold whitespace-nowrap px-2 " + (socialTab === "lideranca_gerenciar" ? "text-purple-600 border-b-2 border-purple-600" : "text-gray-500")
                }, "‚öôÔ∏è Gerenciar")
            )),
            
            React.createElement("div", {className: "max-w-4xl mx-auto p-4"},
                // Aba Perfil
                socialTab === "perfil" && React.createElement("div", {className: "bg-white rounded-2xl shadow-lg p-6"},
                    React.createElement("h2", {className: "text-xl font-bold text-gray-800 mb-6 text-center"}, "‚ú® Editar Meu Perfil"),
                    React.createElement("div", {className: "flex flex-col items-center mb-6"},
                        React.createElement("div", {className: "relative"},
                            p.socialPhotoPreview || socialProfile?.profile_photo ? 
                                React.createElement("img", {
                                    src: p.socialPhotoPreview || socialProfile?.profile_photo,
                                    className: "w-32 h-32 rounded-full object-cover border-4 border-purple-200"
                                }) : 
                                React.createElement("div", {
                                    className: "w-32 h-32 rounded-full bg-gradient-to-br from-purple-400 to-pink-400 flex items-center justify-center text-white text-4xl font-bold border-4 border-purple-200"
                                }, l.fullName?.charAt(0)?.toUpperCase() || "?"),
                            React.createElement("label", {
                                className: "absolute bottom-0 right-0 bg-purple-600 text-white p-2 rounded-full cursor-pointer hover:bg-purple-700 shadow-lg"
                            }, "üì∑", React.createElement("input", {
                                type: "file",
                                accept: "image/*",
                                className: "hidden",
                                onChange: e => {
                                    const file = e.target.files[0];
                                    if (file) handlePhotoEditorOpen(file);
                                    e.target.value = '';
                                }
                            }))
                        ),
                        React.createElement("p", {className: "text-sm text-gray-500 mt-2"}, "üì∑ Clique para alterar (m√°x. 10MB)")
                    ),
                    React.createElement("div", {className: "mb-4"},
                        React.createElement("label", {className: "block text-sm font-semibold text-gray-700 mb-1"}, "Nome de Exibi√ß√£o"),
                        React.createElement("input", {
                            type: "text",
                            value: p.socialDisplayName !== undefined ? p.socialDisplayName : (socialProfile?.display_name || l.fullName || ""),
                            onChange: e => x({...p, socialDisplayName: e.target.value}),
                            className: "w-full px-4 py-3 border border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500",
                            placeholder: "Como voc√™ quer ser chamado?"
                        })
                    ),
                    React.createElement("button", {
                        onClick: async () => {
                            const displayName = p.socialDisplayName !== undefined ? p.socialDisplayName : (socialProfile?.display_name || l.fullName);
                            const photo = p.socialPhotoPreview || socialProfile?.profile_photo;
                            await saveSocialProfile(displayName, photo);
                            x({...p, socialPhotoPreview: undefined, socialDisplayName: undefined});
                        },
                        disabled: socialLoading,
                        className: "w-full py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl font-bold text-lg disabled:opacity-50"
                    }, socialLoading ? "Salvando..." : "üíæ Salvar Perfil")
                ),
                
                // Aba Comunidade
                socialTab === "comunidade" && React.createElement("div", null,
                    React.createElement("div", {className: "mb-4 text-center"},
                        React.createElement("p", {className: "text-gray-600"}, "üë• ", socialUsers.filter(u => u.role === "admin" || u.role === "admin_master" || u.role === "admin_financeiro").length, " admins | üü¢ ", socialUsers.filter(u => u.is_online && (u.role === "admin" || u.role === "admin_master" || u.role === "admin_financeiro")).length, " online")
                    ),
                    React.createElement("div", {className: "grid gap-3"},
                        socialUsers.filter(u => u.cod_profissional !== l.codProfissional && (u.role === "admin" || u.role === "admin_master" || u.role === "admin_financeiro")).map(user => 
                            React.createElement("div", {
                                key: user.cod_profissional,
                                className: "bg-white rounded-xl shadow p-4 flex items-center justify-between hover:shadow-lg transition-shadow"
                            },
                                React.createElement("div", {className: "flex items-center gap-3"},
                                    React.createElement("div", {className: "relative"},
                                        user.profile_photo ? 
                                            React.createElement("img", {
                                                src: user.profile_photo,
                                                className: "w-12 h-12 rounded-full object-cover"
                                            }) : 
                                            React.createElement("div", {
                                                className: "w-12 h-12 rounded-full bg-gradient-to-br from-purple-400 to-pink-400 flex items-center justify-center text-white font-bold"
                                            }, user.display_name?.charAt(0)?.toUpperCase() || "?"),
                                        React.createElement("span", {
                                            className: "absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 border-white " + (user.is_online ? "bg-green-500" : "bg-gray-400")
                                        })
                                    ),
                                    React.createElement("div", null,
                                        React.createElement("p", {className: "font-semibold text-gray-800"}, user.display_name),
                                        React.createElement("p", {className: "text-xs text-gray-500"}, user.is_online ? "üü¢ Online agora" : 
                                            user.last_seen ? "Visto: " + new Date(user.last_seen).toLocaleString("pt-BR") : "Offline")
                                    )
                                ),
                                React.createElement("button", {
                                    onClick: () => setSocialModalUser(user),
                                    className: "px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg font-semibold hover:from-purple-600 hover:to-pink-600"
                                }, "üíú Interagir")
                            )
                        )
                    )
                ),
                
                // Aba Mensagens
                socialTab === "mensagens" && React.createElement("div", null,
                    socialMessages.length === 0 ? 
                        React.createElement("div", {className: "bg-white rounded-2xl shadow-lg p-8 text-center"},
                            React.createElement("span", {className: "text-6xl block mb-4"}, "üíå"),
                            React.createElement("p", {className: "text-gray-500"}, "Nenhuma mensagem ainda"),
                            React.createElement("p", {className: "text-sm text-gray-400 mt-2"}, "Quando algu√©m enviar uma mensagem ou rea√ß√£o, aparecer√° aqui!")
                        ) :
                        React.createElement("div", {className: "space-y-3"},
                            socialMessages.map(msg => 
                                React.createElement("div", {
                                    key: msg.id,
                                    className: "bg-white rounded-xl shadow p-4 " + (!msg.is_read ? "border-l-4 border-purple-500" : "")
                                },
                                    React.createElement("div", {className: "flex items-start gap-3"},
                                        React.createElement("div", {
                                            className: "w-10 h-10 rounded-full bg-gradient-to-br from-purple-400 to-pink-400 flex items-center justify-center text-white font-bold flex-shrink-0"
                                        }, msg.from_user_name?.charAt(0)?.toUpperCase() || "?"),
                                        React.createElement("div", {className: "flex-1"},
                                            React.createElement("div", {className: "flex items-center justify-between"},
                                                React.createElement("p", {className: "font-semibold text-gray-800"}, msg.from_user_name),
                                                React.createElement("p", {className: "text-xs text-gray-400"}, new Date(msg.created_at).toLocaleString("pt-BR"))
                                            ),
                                            msg.message_type === "reaction" ?
                                                React.createElement("p", {className: "text-4xl mt-2"}, msg.content) :
                                                React.createElement("p", {className: "text-gray-600 mt-1 bg-purple-50 p-3 rounded-lg"}, msg.content)
                                        )
                                    )
                                )
                            )
                        )
                ),
                
                // ========== ABA MENSAGENS DA LIDERAN√áA (HIST√ìRICO) ==========
                socialTab === "lideranca_historico" && React.createElement("div", null,
                    React.createElement("div", {className: "bg-gradient-to-r from-orange-500 to-amber-500 rounded-2xl p-4 mb-4 text-white"},
                        React.createElement("h2", {className: "text-xl font-bold flex items-center gap-2"}, "üì¢ Mensagens da Lideran√ßa"),
                        React.createElement("p", {className: "text-sm text-orange-100 mt-1"}, "Comunicados importantes para a equipe")
                    ),
                    liderancaHistorico.length === 0 ?
                        React.createElement("div", {className: "bg-white rounded-2xl shadow-lg p-8 text-center"},
                            React.createElement("span", {className: "text-6xl block mb-4"}, "üì≠"),
                            React.createElement("p", {className: "text-gray-500"}, "Nenhuma mensagem visualizada ainda"),
                            React.createElement("p", {className: "text-sm text-gray-400 mt-2"}, "Quando voc√™ visualizar uma mensagem da lideran√ßa, ela aparecer√° aqui")
                        ) :
                        React.createElement("div", {className: "space-y-4"},
                            liderancaHistorico.map(msg => 
                                React.createElement("div", {
                                    key: msg.id,
                                    className: "bg-white rounded-xl shadow-lg overflow-hidden"
                                },
                                    React.createElement("div", {className: "bg-gradient-to-r from-orange-100 to-amber-100 p-4 border-b"},
                                        React.createElement("div", {className: "flex items-center gap-3"},
                                            msg.criado_por_foto ? 
                                                React.createElement("img", {src: msg.criado_por_foto, className: "w-12 h-12 rounded-full object-cover border-2 border-orange-300"}) :
                                                React.createElement("div", {className: "w-12 h-12 rounded-full bg-gradient-to-br from-orange-400 to-amber-400 flex items-center justify-center text-white font-bold text-lg"}, 
                                                    msg.criado_por_nome?.charAt(0)?.toUpperCase() || "?"
                                                ),
                                            React.createElement("div", {className: "flex-1"},
                                                React.createElement("p", {className: "font-bold text-gray-800"}, msg.titulo),
                                                React.createElement("p", {className: "text-sm text-gray-600"}, "Por: ", msg.criado_por_nome)
                                            ),
                                            React.createElement("div", {className: "text-right text-xs text-gray-500"},
                                                React.createElement("p", null, "Criada: ", new Date(msg.created_at).toLocaleDateString("pt-BR")),
                                                React.createElement("p", null, "Visualizada: ", new Date(msg.visualizado_em).toLocaleDateString("pt-BR"))
                                            )
                                        )
                                    ),
                                    React.createElement("div", {className: "p-4"},
                                        React.createElement("div", {
                                            className: "prose prose-sm max-w-none text-gray-700",
                                            dangerouslySetInnerHTML: {__html: msg.conteudo?.replace(/\n/g, '<br>') || ''}
                                        }),
                                        msg.midia_url && msg.midia_tipo === 'video' && React.createElement("div", {className: "mt-4"},
                                            msg.midia_url.includes('youtube') || msg.midia_url.includes('youtu.be') ?
                                                React.createElement("iframe", {
                                                    src: msg.midia_url.replace('watch?v=', 'embed/').replace('youtu.be/', 'youtube.com/embed/'),
                                                    className: "w-full aspect-video rounded-lg",
                                                    allowFullScreen: true
                                                }) :
                                                React.createElement("video", {src: msg.midia_url, controls: true, className: "w-full rounded-lg"})
                                        ),
                                        msg.midia_url && msg.midia_tipo === 'imagem' && React.createElement("img", {
                                            src: msg.midia_url,
                                            onClick: () => setLiderancaImagemExpandida(msg.midia_url),
                                            className: "mt-4 w-full rounded-lg max-h-96 object-contain cursor-pointer hover:opacity-90 transition-opacity",
                                            title: "Clique para expandir"
                                        }),
                                        msg.midia_url && msg.midia_tipo === 'audio' && React.createElement("audio", {
                                            src: msg.midia_url,
                                            controls: true,
                                            className: "mt-4 w-full"
                                        }),
                                        msg.recorrente && React.createElement("div", {className: "mt-3 flex items-center gap-2 text-xs text-orange-600 bg-orange-50 px-3 py-1 rounded-full w-fit"},
                                            React.createElement("span", null, "üîÑ"),
                                            React.createElement("span", null, "Recorrente: ", msg.tipo_recorrencia)
                                        )
                                    ),
                                    // Rodap√© com visualiza√ß√µes e rea√ß√µes
                                    React.createElement("div", {className: "px-4 py-3 bg-gray-50 border-t flex items-center justify-between"},
                                        // Fotos dos usu√°rios que visualizaram
                                        React.createElement("div", {className: "flex items-center gap-2"},
                                            React.createElement("span", {className: "text-xs text-gray-500 mr-1"}, "üëÅÔ∏è Visto por:"),
                                            React.createElement("div", {className: "flex -space-x-2"},
                                                (liderancaVizPorMsg[msg.id] || []).slice(0, 8).map((viz, idx) => 
                                                    viz.user_foto ?
                                                        React.createElement("img", {
                                                            key: idx,
                                                            src: viz.user_foto,
                                                            title: viz.user_nome,
                                                            className: "w-7 h-7 rounded-full border-2 border-white object-cover hover:scale-110 transition-transform cursor-pointer"
                                                        }) :
                                                        React.createElement("div", {
                                                            key: idx,
                                                            title: viz.user_nome,
                                                            className: "w-7 h-7 rounded-full border-2 border-white bg-gradient-to-br from-orange-400 to-amber-400 flex items-center justify-center text-white text-xs font-bold hover:scale-110 transition-transform cursor-pointer"
                                                        }, viz.user_nome?.charAt(0)?.toUpperCase() || "?")
                                                ),
                                                (liderancaVizPorMsg[msg.id] || []).length > 8 && React.createElement("div", {
                                                    className: "w-7 h-7 rounded-full border-2 border-white bg-gray-400 flex items-center justify-center text-white text-xs font-bold"
                                                }, "+", (liderancaVizPorMsg[msg.id] || []).length - 8)
                                            )
                                        ),
                                        // Rea√ß√µes
                                        React.createElement("div", {className: "flex items-center gap-1"},
                                            (liderancaReacoes[msg.id] || []).length > 0 && React.createElement("div", {className: "flex items-center gap-1 mr-2 bg-white px-2 py-1 rounded-full shadow-sm"},
                                                [...new Set((liderancaReacoes[msg.id] || []).map(r => r.emoji))].map((emoji, idx) => 
                                                    React.createElement("span", {key: idx, className: "text-sm", title: (liderancaReacoes[msg.id] || []).filter(r => r.emoji === emoji).map(r => r.user_nome).join(', ')}, emoji)
                                                ),
                                                React.createElement("span", {className: "text-xs text-gray-500 ml-1"}, (liderancaReacoes[msg.id] || []).length)
                                            ),
                                            // Bot√µes de rea√ß√£o
                                            ["‚úÖ", "üî•", "üéâ", "üíú", "üòç"].map(emoji => 
                                                React.createElement("button", {
                                                    key: emoji,
                                                    onClick: () => enviarReacaoLideranca(msg.id, emoji),
                                                    className: "text-lg hover:scale-125 transition-transform hover:bg-gray-200 rounded-full p-1"
                                                }, emoji)
                                            )
                                        )
                                    )
                                )
                            )
                        )
                ),
                
                // ========== ABA GERENCIAR MENSAGENS (ADMIN_MASTER) ==========
                socialTab === "lideranca_gerenciar" && l.role === "admin_master" && React.createElement("div", null,
                    React.createElement("div", {className: "bg-gradient-to-r from-purple-600 to-indigo-600 rounded-2xl p-4 mb-4 text-white flex justify-between items-center"},
                        React.createElement("div", null,
                            React.createElement("h2", {className: "text-xl font-bold flex items-center gap-2"}, "‚öôÔ∏è Gerenciar Mensagens"),
                            React.createElement("p", {className: "text-sm text-purple-200 mt-1"}, "Crie e gerencie comunicados para a equipe")
                        ),
                        React.createElement("button", {
                            onClick: () => setLiderancaModal({tipo: 'criar', dados: {}}),
                            className: "px-4 py-2 bg-white text-purple-600 rounded-xl font-bold hover:bg-purple-50 flex items-center gap-2"
                        }, "‚ûï Nova Mensagem")
                    ),
                    liderancaMensagens.length === 0 ?
                        React.createElement("div", {className: "bg-white rounded-2xl shadow-lg p-8 text-center"},
                            React.createElement("span", {className: "text-6xl block mb-4"}, "üìù"),
                            React.createElement("p", {className: "text-gray-500"}, "Nenhuma mensagem criada ainda"),
                            React.createElement("button", {
                                onClick: () => setLiderancaModal({tipo: 'criar', dados: {}}),
                                className: "mt-4 px-6 py-3 bg-purple-600 text-white rounded-xl font-semibold hover:bg-purple-700"
                            }, "‚ûï Criar Primeira Mensagem")
                        ) :
                        React.createElement("div", {className: "space-y-4"},
                            liderancaMensagens.map(msg => 
                                React.createElement("div", {
                                    key: msg.id,
                                    className: "bg-white rounded-xl shadow-lg overflow-hidden"
                                },
                                    React.createElement("div", {className: "p-4 border-b flex items-center justify-between"},
                                        React.createElement("div", {className: "flex items-center gap-3"},
                                            msg.criado_por_foto ? 
                                                React.createElement("img", {src: msg.criado_por_foto, className: "w-10 h-10 rounded-full object-cover"}) :
                                                React.createElement("div", {className: "w-10 h-10 rounded-full bg-purple-200 flex items-center justify-center font-bold text-purple-700"}, 
                                                    msg.criado_por_nome?.charAt(0)?.toUpperCase() || "?"
                                                ),
                                            React.createElement("div", null,
                                                React.createElement("p", {className: "font-bold text-gray-800"}, msg.titulo),
                                                React.createElement("p", {className: "text-xs text-gray-500"}, "Criada em ", new Date(msg.created_at).toLocaleString("pt-BR"))
                                            )
                                        ),
                                        React.createElement("div", {className: "flex items-center gap-2"},
                                            React.createElement("span", {
                                                className: "px-3 py-1 rounded-full text-xs font-semibold " + (msg.ativo ? "bg-green-100 text-green-700" : "bg-gray-100 text-gray-500")
                                            }, msg.ativo ? "‚úì Ativo" : "Inativo"),
                                            msg.recorrente && React.createElement("span", {className: "px-3 py-1 rounded-full text-xs font-semibold bg-orange-100 text-orange-700"}, "üîÑ ", msg.tipo_recorrencia)
                                        )
                                    ),
                                    React.createElement("div", {className: "p-4 bg-gray-50"},
                                        React.createElement("p", {className: "text-sm text-gray-600 line-clamp-2"}, msg.conteudo?.substring(0, 150), msg.conteudo?.length > 150 ? "..." : "")
                                    ),
                                    React.createElement("div", {className: "p-4 flex justify-between items-center border-t"},
                                        React.createElement("button", {
                                            onClick: async () => { await loadVisualizacoes(msg.id); setLiderancaModal({tipo: 'visualizacoes', dados: msg}); },
                                            className: "text-sm text-purple-600 hover:underline flex items-center gap-1"
                                        }, "üëÅÔ∏è ", msg.total_visualizacoes || 0, " visualiza√ß√£o(√µes)"),
                                        React.createElement("div", {className: "flex gap-2"},
                                            React.createElement("button", {
                                                onClick: () => setLiderancaModal({tipo: 'editar', dados: msg}),
                                                className: "px-3 py-1 bg-blue-100 text-blue-700 rounded-lg text-sm hover:bg-blue-200"
                                            }, "‚úèÔ∏è Editar"),
                                            React.createElement("button", {
                                                onClick: () => deletarLiderancaMensagem(msg.id),
                                                className: "px-3 py-1 bg-red-100 text-red-700 rounded-lg text-sm hover:bg-red-200"
                                            }, "üóëÔ∏è Excluir")
                                        )
                                    )
                                )
                            )
                        )
                ),
                
                // ========== MODAL CRIAR/EDITAR MENSAGEM DA LIDERAN√áA ==========
                (liderancaModal?.tipo === 'criar' || liderancaModal?.tipo === 'editar') && React.createElement("div", {
                    className: "fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",
                    onClick: () => setLiderancaModal(null)
                },
                    React.createElement("div", {
                        className: "bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",
                        onClick: e => e.stopPropagation()
                    },
                        React.createElement("div", {className: "bg-gradient-to-r from-purple-600 to-indigo-600 p-4 text-white sticky top-0"},
                            React.createElement("h2", {className: "text-xl font-bold"}, liderancaModal?.tipo === 'criar' ? "‚ûï Nova Mensagem" : "‚úèÔ∏è Editar Mensagem"),
                            React.createElement("p", {className: "text-sm text-purple-200"}, "Crie um comunicado para todos os admins")
                        ),
                        React.createElement("div", {className: "p-6 space-y-4"},
                            // T√≠tulo
                            React.createElement("div", null,
                                React.createElement("label", {className: "block text-sm font-semibold text-gray-700 mb-1"}, "üìù T√≠tulo"),
                                React.createElement("input", {
                                    type: "text",
                                    value: liderancaModal?.dados?.titulo || '',
                                    onChange: e => setLiderancaModal({...liderancaModal, dados: {...liderancaModal.dados, titulo: e.target.value}}),
                                    className: "w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500",
                                    placeholder: "T√≠tulo da mensagem..."
                                })
                            ),
                            // Conte√∫do
                            React.createElement("div", null,
                                React.createElement("label", {className: "block text-sm font-semibold text-gray-700 mb-1"}, "üí¨ Conte√∫do"),
                                React.createElement("textarea", {
                                    value: liderancaModal?.dados?.conteudo || '',
                                    onChange: e => setLiderancaModal({...liderancaModal, dados: {...liderancaModal.dados, conteudo: e.target.value}}),
                                    className: "w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 h-40 resize-none",
                                    placeholder: "Digite o conte√∫do da mensagem...\n\nVoc√™ pode usar quebras de linha para formatar."
                                }),
                                React.createElement("p", {className: "text-xs text-gray-500 mt-1"}, "üí° Use Enter para quebrar linhas. A formata√ß√£o ser√° preservada.")
                            ),
                            // M√≠dia
                            React.createElement("div", {className: "bg-gray-50 rounded-xl p-4"},
                                React.createElement("label", {className: "block text-sm font-semibold text-gray-700 mb-2"}, "üìé M√≠dia (opcional)"),
                                React.createElement("div", {className: "flex gap-2 mb-3 flex-wrap"},
                                    React.createElement("button", {
                                        onClick: () => { limparLiderancaMidia(); setLiderancaModal({...liderancaModal, dados: {...liderancaModal.dados, midia_tipo: 'video', midia_url: ''}}); },
                                        className: "px-3 py-2 rounded-lg text-sm " + (liderancaModal?.dados?.midia_tipo === 'video' ? "bg-purple-600 text-white" : "bg-gray-200 text-gray-700")
                                    }, "üé¨ V√≠deo"),
                                    React.createElement("button", {
                                        onClick: () => { limparLiderancaMidia(); setLiderancaModal({...liderancaModal, dados: {...liderancaModal.dados, midia_tipo: 'imagem', midia_url: ''}}); },
                                        className: "px-3 py-2 rounded-lg text-sm " + (liderancaModal?.dados?.midia_tipo === 'imagem' ? "bg-purple-600 text-white" : "bg-gray-200 text-gray-700")
                                    }, "üñºÔ∏è Imagem"),
                                    React.createElement("button", {
                                        onClick: () => { limparLiderancaMidia(); setLiderancaModal({...liderancaModal, dados: {...liderancaModal.dados, midia_tipo: 'audio', midia_url: ''}}); },
                                        className: "px-3 py-2 rounded-lg text-sm " + (liderancaModal?.dados?.midia_tipo === 'audio' ? "bg-purple-600 text-white" : "bg-gray-200 text-gray-700")
                                    }, "üéµ √Åudio"),
                                    liderancaModal?.dados?.midia_tipo && React.createElement("button", {
                                        onClick: limparLiderancaMidia,
                                        className: "px-3 py-2 rounded-lg text-sm bg-red-100 text-red-600 hover:bg-red-200"
                                    }, "‚úï Limpar")
                                ),
                                
                                // V√≠deo - Input de URL
                                liderancaModal?.dados?.midia_tipo === 'video' && React.createElement("div", null,
                                    React.createElement("input", {
                                        type: "text",
                                        value: liderancaModal?.dados?.midia_url || '',
                                        onChange: e => setLiderancaModal({...liderancaModal, dados: {...liderancaModal.dados, midia_url: e.target.value}}),
                                        className: "w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500",
                                        placeholder: "Cole o link do YouTube ou URL do v√≠deo..."
                                    }),
                                    React.createElement("p", {className: "text-xs text-gray-500 mt-2"}, "üí° Links do YouTube ser√£o reproduzidos automaticamente!")
                                ),
                                
                                // Imagem - Upload ou URL
                                liderancaModal?.dados?.midia_tipo === 'imagem' && React.createElement("div", {className: "space-y-3"},
                                    React.createElement("div", {className: "flex gap-2"},
                                        React.createElement("label", {
                                            className: "flex-1 py-3 bg-purple-100 text-purple-700 rounded-xl font-semibold text-center cursor-pointer hover:bg-purple-200 transition-colors"
                                        },
                                            "üì§ Fazer Upload",
                                            React.createElement("input", {
                                                type: "file",
                                                accept: "image/*",
                                                className: "hidden",
                                                onChange: e => handleLiderancaImagemUpload(e.target.files[0])
                                            })
                                        )
                                    ),
                                    React.createElement("div", {className: "flex items-center gap-2"},
                                        React.createElement("div", {className: "flex-1 h-px bg-gray-300"}),
                                        React.createElement("span", {className: "text-xs text-gray-500"}, "ou cole uma URL"),
                                        React.createElement("div", {className: "flex-1 h-px bg-gray-300"})
                                    ),
                                    React.createElement("input", {
                                        type: "text",
                                        value: !liderancaModal?.dados?.midia_url?.startsWith('data:') ? (liderancaModal?.dados?.midia_url || '') : '',
                                        onChange: e => setLiderancaModal({...liderancaModal, dados: {...liderancaModal.dados, midia_url: e.target.value}}),
                                        className: "w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500",
                                        placeholder: "Cole a URL da imagem..."
                                    }),
                                    // Preview da imagem
                                    (liderancaImagemPreview || liderancaModal?.dados?.midia_url) && React.createElement("div", {className: "mt-3"},
                                        React.createElement("p", {className: "text-xs text-gray-500 mb-2"}, "üì∑ Preview:"),
                                        React.createElement("img", {
                                            src: liderancaImagemPreview || liderancaModal?.dados?.midia_url,
                                            className: "max-h-48 rounded-lg border object-contain"
                                        })
                                    )
                                ),
                                
                                // √Åudio - Grava√ß√£o ou URL
                                liderancaModal?.dados?.midia_tipo === 'audio' && React.createElement("div", {className: "space-y-3"},
                                    // Bot√µes de grava√ß√£o
                                    React.createElement("div", {className: "flex gap-2"},
                                        !liderancaGravando ? 
                                            React.createElement("button", {
                                                onClick: iniciarGravacaoAudio,
                                                className: "flex-1 py-3 bg-red-500 text-white rounded-xl font-semibold hover:bg-red-600 flex items-center justify-center gap-2"
                                            }, "üéôÔ∏è Iniciar Grava√ß√£o") :
                                            React.createElement("button", {
                                                onClick: pararGravacaoAudio,
                                                className: "flex-1 py-3 bg-gray-800 text-white rounded-xl font-semibold hover:bg-gray-900 flex items-center justify-center gap-2 animate-pulse"
                                            }, "‚èπÔ∏è Parar Grava√ß√£o")
                                    ),
                                    liderancaGravando && React.createElement("div", {className: "flex items-center justify-center gap-2 text-red-600"},
                                        React.createElement("span", {className: "w-3 h-3 bg-red-600 rounded-full animate-pulse"}),
                                        React.createElement("span", {className: "text-sm font-medium"}, "Gravando...")
                                    ),
                                    React.createElement("div", {className: "flex items-center gap-2"},
                                        React.createElement("div", {className: "flex-1 h-px bg-gray-300"}),
                                        React.createElement("span", {className: "text-xs text-gray-500"}, "ou cole uma URL"),
                                        React.createElement("div", {className: "flex-1 h-px bg-gray-300"})
                                    ),
                                    React.createElement("input", {
                                        type: "text",
                                        value: !liderancaModal?.dados?.midia_url?.startsWith('data:') ? (liderancaModal?.dados?.midia_url || '') : '',
                                        onChange: e => setLiderancaModal({...liderancaModal, dados: {...liderancaModal.dados, midia_url: e.target.value}}),
                                        className: "w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500",
                                        placeholder: "Cole a URL do √°udio..."
                                    }),
                                    // Preview do √°udio
                                    (liderancaAudioPreview || liderancaModal?.dados?.midia_url) && React.createElement("div", {className: "mt-3"},
                                        React.createElement("p", {className: "text-xs text-gray-500 mb-2"}, "üéµ Preview:"),
                                        React.createElement("audio", {
                                            src: liderancaAudioPreview || liderancaModal?.dados?.midia_url,
                                            controls: true,
                                            className: "w-full"
                                        })
                                    )
                                )
                            ),
                            // Recorr√™ncia
                            React.createElement("div", {className: "bg-orange-50 rounded-xl p-4"},
                                React.createElement("div", {className: "flex items-center gap-3 mb-3"},
                                    React.createElement("input", {
                                        type: "checkbox",
                                        id: "recorrente",
                                        checked: liderancaModal?.dados?.recorrente || false,
                                        onChange: e => setLiderancaModal({...liderancaModal, dados: {...liderancaModal.dados, recorrente: e.target.checked}}),
                                        className: "w-5 h-5 text-orange-600 rounded"
                                    }),
                                    React.createElement("label", {htmlFor: "recorrente", className: "font-semibold text-gray-700"}, "üîÑ Mensagem Recorrente")
                                ),
                                liderancaModal?.dados?.recorrente && React.createElement("div", {className: "grid grid-cols-2 gap-3"},
                                    React.createElement("div", null,
                                        React.createElement("label", {className: "block text-xs text-gray-600 mb-1"}, "Tipo"),
                                        React.createElement("select", {
                                            value: liderancaModal?.dados?.tipo_recorrencia || 'diaria',
                                            onChange: e => setLiderancaModal({...liderancaModal, dados: {...liderancaModal.dados, tipo_recorrencia: e.target.value}}),
                                            className: "w-full px-3 py-2 border rounded-lg"
                                        },
                                            React.createElement("option", {value: "diaria"}, "Di√°ria"),
                                            React.createElement("option", {value: "semanal"}, "Semanal"),
                                            React.createElement("option", {value: "mensal"}, "Mensal")
                                        )
                                    ),
                                    React.createElement("div", null,
                                        React.createElement("label", {className: "block text-xs text-gray-600 mb-1"}, "Intervalo"),
                                        React.createElement("input", {
                                            type: "number",
                                            min: "1",
                                            value: liderancaModal?.dados?.intervalo_recorrencia || 1,
                                            onChange: e => setLiderancaModal({...liderancaModal, dados: {...liderancaModal.dados, intervalo_recorrencia: parseInt(e.target.value) || 1}}),
                                            className: "w-full px-3 py-2 border rounded-lg"
                                        })
                                    )
                                ),
                                liderancaModal?.dados?.recorrente && React.createElement("p", {className: "text-xs text-orange-600 mt-2"}, 
                                    "üìÖ A mensagem ser√° reexibida a cada ", liderancaModal?.dados?.intervalo_recorrencia || 1, " ",
                                    liderancaModal?.dados?.tipo_recorrencia === 'diaria' ? 'dia(s)' : 
                                    liderancaModal?.dados?.tipo_recorrencia === 'semanal' ? 'semana(s)' : 'm√™s(es)'
                                )
                            ),
                            // Bot√µes
                            React.createElement("div", {className: "flex gap-3 pt-4"},
                                React.createElement("button", {
                                    onClick: () => setLiderancaModal(null),
                                    className: "flex-1 py-3 border-2 border-gray-300 text-gray-700 rounded-xl font-semibold hover:bg-gray-50"
                                }, "Cancelar"),
                                React.createElement("button", {
                                    onClick: async () => {
                                        if (!liderancaModal?.dados?.titulo?.trim()) {
                                            ja("Informe o t√≠tulo", "error");
                                            return;
                                        }
                                        if (!liderancaModal?.dados?.conteudo?.trim()) {
                                            ja("Informe o conte√∫do", "error");
                                            return;
                                        }
                                        if (liderancaModal.tipo === 'criar') {
                                            await criarLiderancaMensagem(liderancaModal.dados);
                                        } else {
                                            // Editar
                                            try {
                                                const res = await fetchAuth(`${API_URL}/lideranca/mensagens/${liderancaModal.dados.id}`, {
                                                    method: "PUT",
                                                    headers: {"Content-Type": "application/json"},
                                                    body: JSON.stringify(liderancaModal.dados)
                                                });
                                                if (res.ok) {
                                                    ja("‚úÖ Mensagem atualizada!", "success");
                                                    setLiderancaModal(null);
                                                    await loadLiderancaMensagens();
                                                }
                                            } catch (err) {
                                                ja("Erro ao atualizar", "error");
                                            }
                                        }
                                    },
                                    className: "flex-1 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-xl font-semibold hover:opacity-90"
                                }, liderancaModal?.tipo === 'criar' ? "üì¢ Publicar Mensagem" : "üíæ Salvar Altera√ß√µes")
                            )
                        )
                    )
                ),
                
                // ========== MODAL NOTIFICA√á√ÉO DE MENSAGEM ==========
                liderancaModal?.tipo === 'notificacao' && React.createElement("div", {
                    className: "fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4"
                },
                    React.createElement("div", {
                        className: "bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto animate-bounce-in"
                    },
                        React.createElement("div", {className: "bg-gradient-to-r from-orange-500 to-amber-500 p-6 text-white text-center"},
                            React.createElement("div", {className: "text-5xl mb-2"}, "üì¢"),
                            React.createElement("h2", {className: "text-2xl font-bold"}, "Mensagem da Lideran√ßa"),
                            liderancaModal?.fila?.length > 1 && React.createElement("p", {className: "text-sm text-orange-100 mt-1"}, 
                                "1 de ", liderancaModal.fila.length, " mensagens"
                            )
                        ),
                        React.createElement("div", {className: "p-6"},
                            // Autor
                            React.createElement("div", {className: "flex items-center gap-3 mb-4 pb-4 border-b"},
                                liderancaModal?.dados?.criado_por_foto ?
                                    React.createElement("img", {src: liderancaModal.dados.criado_por_foto, className: "w-14 h-14 rounded-full object-cover border-2 border-orange-300"}) :
                                    React.createElement("div", {className: "w-14 h-14 rounded-full bg-gradient-to-br from-orange-400 to-amber-400 flex items-center justify-center text-white font-bold text-xl"}, 
                                        liderancaModal?.dados?.criado_por_nome?.charAt(0)?.toUpperCase() || "?"
                                    ),
                                React.createElement("div", null,
                                    React.createElement("p", {className: "font-bold text-lg text-gray-800"}, liderancaModal?.dados?.criado_por_nome),
                                    React.createElement("p", {className: "text-sm text-gray-500"}, new Date(liderancaModal?.dados?.created_at).toLocaleString("pt-BR"))
                                )
                            ),
                            // T√≠tulo
                            React.createElement("h3", {className: "text-xl font-bold text-gray-800 mb-3"}, liderancaModal?.dados?.titulo),
                            // Conte√∫do
                            React.createElement("div", {
                                className: "text-gray-700 whitespace-pre-wrap mb-4",
                                dangerouslySetInnerHTML: {__html: liderancaModal?.dados?.conteudo?.replace(/\n/g, '<br>') || ''}
                            }),
                            // M√≠dia
                            liderancaModal?.dados?.midia_url && liderancaModal?.dados?.midia_tipo === 'video' && React.createElement("div", {className: "mb-4"},
                                (liderancaModal.dados.midia_url.includes('youtube') || liderancaModal.dados.midia_url.includes('youtu.be')) ?
                                    React.createElement("iframe", {
                                        src: liderancaModal.dados.midia_url.replace('watch?v=', 'embed/').replace('youtu.be/', 'youtube.com/embed/'),
                                        className: "w-full aspect-video rounded-lg",
                                        allowFullScreen: true
                                    }) :
                                    React.createElement("video", {src: liderancaModal.dados.midia_url, controls: true, className: "w-full rounded-lg"})
                            ),
                            liderancaModal?.dados?.midia_url && liderancaModal?.dados?.midia_tipo === 'imagem' && React.createElement("img", {
                                src: liderancaModal.dados.midia_url,
                                onClick: () => setLiderancaImagemExpandida(liderancaModal.dados.midia_url),
                                className: "mb-4 w-full rounded-lg max-h-64 object-contain cursor-pointer hover:opacity-90 transition-opacity",
                                title: "Clique para expandir"
                            }),
                            liderancaModal?.dados?.midia_url && liderancaModal?.dados?.midia_tipo === 'audio' && React.createElement("audio", {
                                src: liderancaModal.dados.midia_url,
                                controls: true,
                                className: "mb-4 w-full"
                            }),
                            // Emojis de rea√ß√£o
                            React.createElement("div", {className: "mb-4"},
                                React.createElement("p", {className: "text-sm text-gray-600 mb-2 text-center"}, "Deixe sua rea√ß√£o:"),
                                React.createElement("div", {className: "flex justify-center gap-2"},
                                    ["‚úÖ", "üî•", "üéâ", "üíú", "üòç"].map(emoji => 
                                        React.createElement("button", {
                                            key: emoji,
                                            onClick: async () => {
                                                await enviarReacaoLideranca(liderancaModal.dados.id, emoji);
                                                ja(`${emoji} Rea√ß√£o enviada!`, "success");
                                            },
                                            className: "text-3xl hover:scale-125 transition-transform hover:bg-orange-100 rounded-full p-2"
                                        }, emoji)
                                    )
                                )
                            ),
                            // Bot√£o
                            React.createElement("button", {
                                onClick: async () => {
                                    await marcarLiderancaVisualizada(liderancaModal.dados.id);
                                    const filaRestante = liderancaModal.fila?.slice(1) || [];
                                    if (filaRestante.length > 0) {
                                        setLiderancaModal({tipo: 'notificacao', dados: filaRestante[0], fila: filaRestante});
                                    } else {
                                        setLiderancaModal(null);
                                        await loadLiderancaHistorico();
                                    }
                                },
                                className: "w-full py-4 bg-gradient-to-r from-orange-500 to-amber-500 text-white rounded-xl font-bold text-lg hover:opacity-90"
                            }, liderancaModal?.fila?.length > 1 ? "‚úì Entendido - Pr√≥xima" : "‚úì Entendido")
                        )
                    )
                ),
                
                // ========== MODAL IMAGEM EXPANDIDA ==========
                liderancaImagemExpandida && React.createElement("div", {
                    className: "fixed inset-0 bg-black/90 z-[60] flex items-center justify-center p-4 cursor-pointer",
                    onClick: () => setLiderancaImagemExpandida(null)
                },
                    React.createElement("button", {
                        onClick: () => setLiderancaImagemExpandida(null),
                        className: "absolute top-4 right-4 text-white text-4xl hover:text-gray-300 z-10"
                    }, "‚úï"),
                    React.createElement("img", {
                        src: liderancaImagemExpandida,
                        className: "max-w-full max-h-full object-contain rounded-lg shadow-2xl",
                        onClick: e => e.stopPropagation()
                    }),
                    React.createElement("p", {
                        className: "absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white/70 text-sm"
                    }, "Clique fora da imagem ou no ‚úï para fechar")
                ),
                
                // ========== MODAL VISUALIZA√á√ïES ==========
                liderancaModal?.tipo === 'visualizacoes' && React.createElement("div", {
                    className: "fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",
                    onClick: () => setLiderancaModal(null)
                },
                    React.createElement("div", {
                        className: "bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[80vh] overflow-hidden",
                        onClick: e => e.stopPropagation()
                    },
                        React.createElement("div", {className: "bg-gradient-to-r from-purple-600 to-indigo-600 p-4 text-white"},
                            React.createElement("h2", {className: "text-lg font-bold"}, "üëÅÔ∏è Visualiza√ß√µes"),
                            React.createElement("p", {className: "text-sm text-purple-200"}, liderancaModal?.dados?.titulo)
                        ),
                        React.createElement("div", {className: "p-4 max-h-[60vh] overflow-y-auto"},
                            liderancaVisualizacoes.length === 0 ?
                                React.createElement("p", {className: "text-center text-gray-500 py-8"}, "Ningu√©m visualizou ainda") :
                                React.createElement("div", {className: "space-y-3"},
                                    liderancaVisualizacoes.map(v => 
                                        React.createElement("div", {key: v.id, className: "flex items-center gap-3 p-3 bg-gray-50 rounded-xl"},
                                            v.user_foto ?
                                                React.createElement("img", {src: v.user_foto, className: "w-10 h-10 rounded-full object-cover"}) :
                                                React.createElement("div", {className: "w-10 h-10 rounded-full bg-purple-200 flex items-center justify-center font-bold text-purple-700"}, 
                                                    v.user_nome?.charAt(0)?.toUpperCase() || "?"
                                                ),
                                            React.createElement("div", {className: "flex-1"},
                                                React.createElement("p", {className: "font-semibold text-gray-800"}, v.user_nome),
                                                React.createElement("p", {className: "text-xs text-gray-500"}, new Date(v.visualizado_em).toLocaleString("pt-BR"))
                                            ),
                                            React.createElement("span", {className: "text-green-500"}, "‚úì")
                                        )
                                    )
                                )
                        ),
                        React.createElement("div", {className: "p-4 border-t"},
                            React.createElement("button", {
                                onClick: () => setLiderancaModal(null),
                                className: "w-full py-2 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200"
                            }, "Fechar")
                        )
                    )
                ),
                
                // Modal do Editor de Foto de Perfil (dentro do m√≥dulo Social)
                photoEditorOpen && React.createElement("div", {
                    className: "fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-4",
                    style: { zIndex: 10001 },
                    onClick: () => setPhotoEditorOpen(false)
                },
                    React.createElement("div", {
                        className: "bg-white rounded-3xl shadow-2xl w-full max-w-md p-6",
                        onClick: (e) => e.stopPropagation()
                    },
                        React.createElement("h3", {className: "text-xl font-bold text-gray-800 mb-4 text-center"}, "‚úÇÔ∏è Ajustar Foto de Perfil"),
                        React.createElement("p", {className: "text-sm text-gray-500 mb-4 text-center"}, "Arraste para posicionar e use o zoom para ajustar"),
                        
                        // √Årea de preview circular
                        React.createElement("div", {
                            className: "relative mx-auto mb-4",
                            style: {
                                width: '256px',
                                height: '256px',
                                overflow: 'hidden',
                                borderRadius: '50%',
                                border: '4px solid #7c3aed',
                                background: '#f3f4f6',
                                cursor: photoEditorDragging ? 'grabbing' : 'grab',
                                touchAction: 'none'
                            },
                            onMouseDown: handlePhotoEditorMouseDown,
                            onMouseMove: handlePhotoEditorMouseMove,
                            onMouseUp: handlePhotoEditorMouseUp,
                            onMouseLeave: handlePhotoEditorMouseUp,
                            onTouchStart: handlePhotoEditorMouseDown,
                            onTouchMove: handlePhotoEditorMouseMove,
                            onTouchEnd: handlePhotoEditorMouseUp
                        },
                            photoEditorSrc && React.createElement("img", {
                                src: photoEditorSrc,
                                style: {
                                    position: 'absolute',
                                    left: '50%',
                                    top: '50%',
                                    transform: `translate(calc(-50% + ${photoEditorPosition.x}px), calc(-50% + ${photoEditorPosition.y}px)) scale(${photoEditorZoom})`,
                                    minWidth: '100%',
                                    minHeight: '100%',
                                    objectFit: 'cover',
                                    pointerEvents: 'none',
                                    userSelect: 'none'
                                },
                                draggable: false
                            })
                        ),
                        
                        // Controle de Zoom
                        React.createElement("div", {className: "mb-6"},
                            React.createElement("label", {className: "block text-sm font-semibold text-gray-700 mb-2 text-center"}, 
                                "üîç Zoom: ", Math.round(photoEditorZoom * 100), "%"
                            ),
                            React.createElement("input", {
                                type: "range",
                                min: "1",
                                max: "3",
                                step: "0.1",
                                value: photoEditorZoom,
                                onChange: e => {
                                    const newZoom = parseFloat(e.target.value);
                                    setPhotoEditorZoom(newZoom);
                                    const maxMove = 128 * (newZoom - 1);
                                    setPhotoEditorPosition({
                                        x: Math.max(-maxMove, Math.min(maxMove, photoEditorPosition.x)),
                                        y: Math.max(-maxMove, Math.min(maxMove, photoEditorPosition.y))
                                    });
                                },
                                className: "w-full h-2 bg-purple-200 rounded-lg appearance-none cursor-pointer accent-purple-600"
                            })
                        ),
                        
                        // Bot√µes
                        React.createElement("div", {className: "flex gap-3"},
                            React.createElement("button", {
                                onClick: () => setPhotoEditorOpen(false),
                                className: "flex-1 py-3 border-2 border-gray-300 text-gray-700 rounded-xl font-semibold hover:bg-gray-50"
                            }, "Cancelar"),
                            React.createElement("button", {
                                onClick: handlePhotoEditorSave,
                                className: "flex-1 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl font-semibold hover:opacity-90"
                            }, "‚úÖ Aplicar")
                        )
                    )
                )
            ))
        }
        // ========== M√ìDULO OPERACIONAL (CARREGAMENTO EXTERNO) ==========
        const canAccessOperacional = hasModuleAccess(l, "operacional");
        if (canAccessOperacional && "operacional" === Ee) {
            if (typeof window.ModuloOperacionalComponent !== 'undefined') {
                return React.createElement(window.ModuloOperacionalComponent, {
                    // B√°sicos
                    l, p, x, ja, s, n, f, i, E,
                    API_URL, getToken,
                    // Componentes
                    HeaderCompacto, Toast, LoadingOverlay,
                    // Navega√ß√£o
                    Ee, socialProfile, ul, o, he, navegarSidebar,
                    // Avisos
                    avisoModal, setAvisoModal, avisoEdit, setAvisoEdit,
                    avisoForm, setAvisoForm, avisosData, avisosRegioes,
                    carregarAvisos, salvarAviso, deletarAviso, handleAvisoImageUpload,
                    // Opera√ß√µes
                    operacaoModal, setOperacaoModal, operacaoEdit, setOperacaoEdit,
                    operacaoForm, setOperacaoForm, operacoesData,
                    operacaoSubTab, setOperacaoSubTab, carregarOperacoes, notificarOperacaoSalva,
                    gerarRelatorioOperacao, calcularContadorRegressivo,
                    checklistMotos, setChecklistMotos,
                    // Recrutamento
                    recrutamentoModal, setRecrutamentoModal,
                    recrutamentoEdit, setRecrutamentoEdit,
                    recrutamentoForm, setRecrutamentoForm,
                    recrutamentoData, recrutamentoSubTab, setRecrutamentoSubTab,
                    recrutamentoCodBusca, setRecrutamentoCodBusca, recrutamentoLoading,
                    recrutamentoStats, setRecrutamentoStats,
                    carregarRecrutamento, salvarRecrutamento,
                    buscarProfissionalRecrutamento, atribuirProfissionalRecrutamento,
                    removerAtribuicaoRecrutamento, deletarRecrutamento,
                    // Localiza√ß√£o
                    localizacaoSubTab, setLocalizacaoSubTab,
                    localizacaoFiltro, setLocalizacaoFiltro,
                    localizacaoClientes, carregarLocalizacaoClientes,
                    localizacaoLoading,
                    // Relat√≥rios
                    showRelatorioModal, setShowRelatorioModal,
                    relatorioForm, setRelatorioForm,
                    relatorioEdit, setRelatorioEdit,
                    relatorioImagemAmpliada, setRelatorioImagemAmpliada,
                    relatoriosDiarios, relatoriosNaoLidos, relatoriosLoading,
                    abrirNovoRelatorio, abrirEditarRelatorio,
                    salvarRelatorio, excluirRelatorio, gerarLinkWaze,
                    // Regi√µes e Setores
                    aa, setores,
                    // Incentivos Operacionais
                    incentivosData, setIncentivosData, incentivosStats,
                    incentivoModal, setIncentivoModal, incentivoEdit, setIncentivoEdit,
                    incentivoForm, setIncentivoForm, carregarIncentivos, salvarIncentivo, deletarIncentivo,
                    incentivosCalendarioMes, setIncentivosCalendarioMes,
                    incentivoClientesBi, incentivoClientesLoading, carregarClientesBiIncentivos
                });
            } else {
                return React.createElement("div", {className: "min-h-screen bg-gray-50 flex items-center justify-center"},
                    React.createElement("div", {className: "text-center"},
                        React.createElement("div", {className: "animate-spin w-12 h-12 border-4 border-teal-500 border-t-transparent rounded-full mx-auto mb-4"}),
                        React.createElement("p", {className: "text-gray-600"}, "Carregando m√≥dulo operacional...")
                    )
                );
            }
        }

        // ========== M√ìDULO CONFIGURA√á√ïES (CARREGAMENTO EXTERNO) ==========
        const canAccessConfig = hasModuleAccess(l, "config");
        if (canAccessConfig && "config" === Ee) {
            if (typeof window.ModuloConfigComponent !== 'undefined') {
                return React.createElement(window.ModuloConfigComponent, {
                    usuario: l,
                    estado: p,
                    setEstado: x,
                    usuarios: A,
                    setores: setores,
                    showToast: ja,
                    setLoading: s,
                    carregarUsuarios: Ia,
                    API_URL: API_URL,
                    fetchAuth: fetchAuth,
                    getToken: getToken,
                    SISTEMA_MODULOS_CONFIG: SISTEMA_MODULOS_CONFIG,
                    APP_VERSION: APP_VERSION,
                    VERSION_KEY: VERSION_KEY,
                    HeaderCompacto: HeaderCompacto,
                    Toast: Toast,
                    LoadingOverlay: LoadingOverlay,
                    AuditLogs: AuditLogs,
                    moduloAtivo: Ee,
                    socialProfile: socialProfile,
                    isLoading: n,
                    lastUpdate: E,
                    onRefresh: ul,
                    onLogout: () => o(null),
                    onGoHome: () => he("home"),
                    onNavigate: navegarSidebar,
                    atualizarSetorUsuario: atualizarSetorUsuario,
                    setorExpandido: setorExpandido,
                    setSetorExpandido: setSetorExpandido,
                    showSetorModal: showSetorModal,
                    setShowSetorModal: setShowSetorModal,
                    setorEdit: setorEdit,
                    setSetorEdit: setSetorEdit,
                    setorForm: setorForm,
                    setSetorForm: setSetorForm,
                    salvarSetor: salvarSetor,
                    excluirSetor: excluirSetor,
                    toastData: i
                });
            } else {
                return React.createElement("div", {className: "min-h-screen bg-gray-100 flex items-center justify-center"},
                    React.createElement("div", {className: "text-center"},
                        React.createElement("div", {className: "animate-spin w-12 h-12 border-4 border-purple-500 border-t-transparent rounded-full mx-auto mb-4"}),
                        React.createElement("p", {className: "text-gray-600"}, "Carregando m√≥dulo de configura√ß√µes...")
                    )
                );
            }
        }

        // Verificar permiss√£o para BI (admin comum)
        const canAccessBI = hasModuleAccess(l, "bi");
        if (canAccessBI && "bi" === Ee) {
            return React.createElement("div", {
                className: "min-h-screen bg-gray-100"
            }, i && React.createElement(Toast, i), n && React.createElement(LoadingOverlay, null),
            // ========== HEADER COM NAVEGA√á√ÉO - BI ==========
            React.createElement(HeaderCompacto, {
                usuario: l,
                moduloAtivo: Ee,
                abaAtiva: Et || "home-bi",
                socialProfile: socialProfile,
                isLoading: f,
                lastUpdate: E,
                onRefresh: ul,
                onLogout: () => o(null),
                onGoHome: () => he("home"),
                onNavigate: navegarSidebar,
                onChangeTab: (abaId) => ht(abaId)
            }),
            // Barra de info do BI
            React.createElement("div", {
                className: "bg-white border-b px-4 py-2 text-xs text-gray-500 flex justify-between items-center"
            }, 
                React.createElement("div", null,
                    React.createElement("span", null, "√ölt. Leitura: ", (new Date).toLocaleString("pt-BR")), 
                    React.createElement("span", { className: "ml-4" }, "Dados atualizados: ", ua.data_fim ? new Date(ua.data_fim).toLocaleDateString("pt-BR") : "-")
                ),
                React.createElement("button", {
                    onClick: () => _a(!0),
                    className: "px-3 py-1 bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 text-xs font-semibold"
                }, "üîç Filtros")
            ), 
            
            // ===== BARRA DE FILTROS ATIVOS =====
            (Et === "dashboard" || Et === "acompanhamento" || Et === "profissionais" || Et === "os") && (
                (ua.cod_cliente && ua.cod_cliente.length > 0) || 
                (ua.centro_custo && ua.centro_custo.length > 0) || 
                ua.categoria || 
                ua.regiao ||
                ua.status_prazo ||
                ua.status_retorno
            ) && React.createElement("div", {
                className: "bg-gradient-to-r from-purple-50 to-violet-50 border-b border-purple-200 px-4 py-2"
            },
                React.createElement("div", {className: "max-w-full mx-auto flex items-center gap-2 flex-wrap"},
                    React.createElement("span", {className: "text-xs font-semibold text-purple-700"}, "üîç Filtros:"),
                    
                    // Per√≠odo
                    ua.data_inicio && React.createElement("span", {className: "inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs"},
                        "üìÖ " + new Date(ua.data_inicio + "T12:00:00").toLocaleDateString("pt-BR") + " a " + new Date(ua.data_fim + "T12:00:00").toLocaleDateString("pt-BR")
                    ),
                    
                    // Regi√£o
                    ua.regiao && React.createElement("span", {className: "inline-flex items-center gap-1 px-2 py-1 bg-indigo-100 text-indigo-700 rounded-full text-xs"},
                        "üó∫Ô∏è " + (aa.find(r => r.id === parseInt(ua.regiao))?.nome || "Regi√£o " + ua.regiao)
                    ),
                    
                    // Clientes - com tooltip quando h√° m√∫ltiplos
                    ua.cod_cliente && ua.cod_cliente.length > 0 && React.createElement("span", {
                        className: "inline-flex items-center gap-1 px-2 py-1 bg-purple-100 text-purple-700 rounded-full text-xs cursor-pointer relative group",
                        title: ua.cod_cliente.length > 1 ? ua.cod_cliente.map(c => c + " - " + (il(c) || "Cliente")).join("\n") : ""
                    },
                        "üè¢ " + (ua.cod_cliente.length === 1 
                            ? (il(ua.cod_cliente[0]) || "Cliente " + ua.cod_cliente[0])
                            : ua.cod_cliente.length + " clientes"),
                        // Tooltip customizado
                        ua.cod_cliente.length > 1 && React.createElement("div", {
                            className: "absolute left-0 top-full mt-1 bg-gray-900 text-white text-xs rounded-lg p-2 shadow-xl z-50 hidden group-hover:block whitespace-nowrap min-w-max"
                        },
                            React.createElement("div", {className: "font-semibold mb-1 text-purple-300"}, "üè¢ Clientes selecionados:"),
                            ua.cod_cliente.map((c, i) => React.createElement("div", {key: c, className: "py-0.5"},
                                c + " - " + (il(c) || "Cliente")
                            ))
                        )
                    ),
                    
                    // Centros de Custo - com tooltip quando h√° m√∫ltiplos
                    ua.centro_custo && ua.centro_custo.length > 0 && React.createElement("span", {
                        className: "inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs cursor-pointer relative group",
                        title: ua.centro_custo.length > 1 ? ua.centro_custo.join("\n") : ""
                    },
                        "üìÅ " + (ua.centro_custo.length === 1 ? ua.centro_custo[0] : ua.centro_custo.length + " centros"),
                        // Tooltip customizado
                        ua.centro_custo.length > 1 && React.createElement("div", {
                            className: "absolute left-0 top-full mt-1 bg-gray-900 text-white text-xs rounded-lg p-2 shadow-xl z-50 hidden group-hover:block whitespace-nowrap min-w-max"
                        },
                            React.createElement("div", {className: "font-semibold mb-1 text-green-300"}, "üìÅ Centros de custo:"),
                            ua.centro_custo.map((cc, i) => React.createElement("div", {key: cc, className: "py-0.5"}, cc))
                        )
                    ),
                    
                    // Categoria
                    ua.categoria && React.createElement("span", {className: "inline-flex items-center gap-1 px-2 py-1 bg-yellow-100 text-yellow-700 rounded-full text-xs"},
                        "üè∑Ô∏è " + ua.categoria
                    ),
                    
                    // Status Prazo
                    ua.status_prazo && React.createElement("span", {className: "inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs " + (ua.status_prazo === "dentro" ? "bg-green-100 text-green-700" : "bg-red-100 text-red-700")},
                        ua.status_prazo === "dentro" ? "‚úÖ No Prazo" : "‚ùå Fora Prazo"
                    ),
                    
                    // Status Retorno
                    ua.status_retorno && React.createElement("span", {className: "inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs " + (ua.status_retorno === "sem_retorno" ? "bg-green-100 text-green-700" : "bg-orange-100 text-orange-700")},
                        ua.status_retorno === "sem_retorno" ? "‚úÖ Sem Retorno" : "üîÑ Com Retorno"
                    ),
                    
                    // Bot√£o limpar
                    React.createElement("button", {
                        onClick: () => {
                            const novoFiltro = {
                                ...ua,
                                cod_cliente: [],
                                centro_custo: [],
                                categoria: "",
                                status_prazo: "",
                                status_prazo_prof: "",
                                status_retorno: "",
                                regiao: ""
                            };
                            ga(novoFiltro);
                            rl(novoFiltro);
                        },
                        className: "ml-auto px-2 py-1 text-xs text-red-600 hover:bg-red-100 rounded-full transition-colors"
                    }, "‚úï Limpar")
                )
            ),
            
            wa && React.createElement("div", {
                className: "fixed inset-0 bg-black/50 z-50 flex items-start justify-center pt-10 overflow-hidden"
            }, React.createElement("div", {
                className: "bg-white rounded-xl shadow-2xl w-full max-w-5xl max-h-[85vh] overflow-y-auto"
            }, React.createElement("div", {
                className: "sticky top-0 bg-purple-700 text-white px-6 py-4 flex justify-between items-center z-10"
            }, React.createElement("h2", {
                className: "text-lg font-bold"
            }, "üîç Filtros Inteligentes"), React.createElement("button", {
                onClick: () => _a(!1),
                className: "text-white hover:bg-white/20 rounded-lg px-3 py-1 text-xl"
            }, "‚úï")), React.createElement("div", {
                className: "p-6"
            }, React.createElement("div", {
                className: "grid grid-cols-2 md:grid-cols-4 gap-4 mb-4"
            }, 
            // Calend√°rio Data In√≠cio
            React.createElement("div", {
                className: "border rounded-lg p-3 bg-gray-50 relative"
            }, React.createElement("h3", {
                className: "font-semibold text-gray-700 mb-2 text-sm"
            }, "üìÖ Data In√≠cio"),
            React.createElement("div", {
                className: "relative"
            },
                React.createElement("input", {
                    type: "text",
                    readOnly: true,
                    value: ua.data_inicio ? new Date(ua.data_inicio + 'T12:00:00').toLocaleDateString('pt-BR') : '',
                    onClick: () => { setCalDataInicioAberto(!calDataInicioAberto); setCalDataFimAberto(false); setCalMesAtual(ua.data_inicio ? new Date(ua.data_inicio + 'T12:00:00') : new Date()); },
                    placeholder: "Selecione...",
                    className: "w-full px-3 py-2 border rounded text-sm cursor-pointer"
                })
            ),
            // Calend√°rio dropdown Data In√≠cio
            calDataInicioAberto && React.createElement("div", {
                className: "absolute z-50 mt-1 bg-white border rounded-lg shadow-xl p-3 left-0 right-0"
            },
                // Header do calend√°rio
                React.createElement("div", {className: "flex items-center justify-between mb-3"},
                    React.createElement("button", {
                        onClick: () => setCalMesAtual(new Date(calMesAtual.getFullYear(), calMesAtual.getMonth() - 1, 1)),
                        className: "p-1 hover:bg-gray-100 rounded"
                    }, "‚óÄ"),
                    React.createElement("span", {className: "font-semibold text-sm"},
                        calMesAtual.toLocaleDateString('pt-BR', {month: 'long', year: 'numeric'})
                    ),
                    React.createElement("button", {
                        onClick: () => setCalMesAtual(new Date(calMesAtual.getFullYear(), calMesAtual.getMonth() + 1, 1)),
                        className: "p-1 hover:bg-gray-100 rounded"
                    }, "‚ñ∂")
                ),
                // Dias da semana
                React.createElement("div", {className: "grid grid-cols-7 gap-1 mb-1"},
                    ['D', 'S', 'T', 'Q', 'Q', 'S', 'S'].map((d, i) => 
                        React.createElement("div", {key: i, className: "text-center text-xs font-semibold text-gray-500 py-1"}, d)
                    )
                ),
                // Dias do m√™s
                React.createElement("div", {className: "grid grid-cols-7 gap-1"},
                    (() => {
                        const ano = calMesAtual.getFullYear();
                        const mes = calMesAtual.getMonth();
                        const primeiroDia = new Date(ano, mes, 1).getDay();
                        const ultimoDia = new Date(ano, mes + 1, 0).getDate();
                        const dias = [];
                        // Dias vazios antes
                        for (let i = 0; i < primeiroDia; i++) {
                            dias.push(React.createElement("div", {key: 'empty-' + i}));
                        }
                        // Dias do m√™s
                        for (let dia = 1; dia <= ultimoDia; dia++) {
                            const dataStr = `${ano}-${String(mes + 1).padStart(2, '0')}-${String(dia).padStart(2, '0')}`;
                            const temDados = biDatasComDados.has(dataStr);
                            const selecionado = ua.data_inicio === dataStr;
                            dias.push(React.createElement("button", {
                                key: dia,
                                onClick: () => { ga({...ua, data_inicio: dataStr}); setCalDataInicioAberto(false); },
                                className: "p-1.5 text-xs rounded-full transition-all " + 
                                    (selecionado ? "bg-purple-600 text-white font-bold" : 
                                    temDados ? "bg-green-100 text-green-700 hover:bg-green-200 font-semibold" : 
                                    "text-gray-400 hover:bg-gray-100")
                            }, dia));
                        }
                        return dias;
                    })()
                ),
                // Legenda
                React.createElement("div", {className: "flex items-center justify-center gap-4 mt-3 pt-2 border-t text-xs"},
                    React.createElement("span", {className: "flex items-center gap-1"},
                        React.createElement("span", {className: "w-3 h-3 rounded-full bg-green-200"}),
                        "Com dados"
                    ),
                    React.createElement("span", {className: "flex items-center gap-1"},
                        React.createElement("span", {className: "w-3 h-3 rounded-full bg-gray-200"}),
                        "Sem dados"
                    )
                ),
                // Bot√£o fechar
                React.createElement("button", {
                    onClick: () => setCalDataInicioAberto(false),
                    className: "w-full mt-2 py-1 text-xs text-gray-500 hover:text-gray-700"
                }, "Fechar")
            )),
            
            // Calend√°rio Data Fim
            React.createElement("div", {
                className: "border rounded-lg p-3 bg-gray-50 relative"
            }, React.createElement("h3", {
                className: "font-semibold text-gray-700 mb-2 text-sm"
            }, "üìÖ Data Fim"),
            React.createElement("div", {
                className: "relative"
            },
                React.createElement("input", {
                    type: "text",
                    readOnly: true,
                    value: ua.data_fim ? new Date(ua.data_fim + 'T12:00:00').toLocaleDateString('pt-BR') : '',
                    onClick: () => { setCalDataFimAberto(!calDataFimAberto); setCalDataInicioAberto(false); setCalMesAtual(ua.data_fim ? new Date(ua.data_fim + 'T12:00:00') : new Date()); },
                    placeholder: "Selecione...",
                    className: "w-full px-3 py-2 border rounded text-sm cursor-pointer"
                })
            ),
            // Calend√°rio dropdown Data Fim
            calDataFimAberto && React.createElement("div", {
                className: "absolute z-50 mt-1 bg-white border rounded-lg shadow-xl p-3 left-0 right-0"
            },
                // Header do calend√°rio
                React.createElement("div", {className: "flex items-center justify-between mb-3"},
                    React.createElement("button", {
                        onClick: () => setCalMesAtual(new Date(calMesAtual.getFullYear(), calMesAtual.getMonth() - 1, 1)),
                        className: "p-1 hover:bg-gray-100 rounded"
                    }, "‚óÄ"),
                    React.createElement("span", {className: "font-semibold text-sm"},
                        calMesAtual.toLocaleDateString('pt-BR', {month: 'long', year: 'numeric'})
                    ),
                    React.createElement("button", {
                        onClick: () => setCalMesAtual(new Date(calMesAtual.getFullYear(), calMesAtual.getMonth() + 1, 1)),
                        className: "p-1 hover:bg-gray-100 rounded"
                    }, "‚ñ∂")
                ),
                // Dias da semana
                React.createElement("div", {className: "grid grid-cols-7 gap-1 mb-1"},
                    ['D', 'S', 'T', 'Q', 'Q', 'S', 'S'].map((d, i) => 
                        React.createElement("div", {key: i, className: "text-center text-xs font-semibold text-gray-500 py-1"}, d)
                    )
                ),
                // Dias do m√™s
                React.createElement("div", {className: "grid grid-cols-7 gap-1"},
                    (() => {
                        const ano = calMesAtual.getFullYear();
                        const mes = calMesAtual.getMonth();
                        const primeiroDia = new Date(ano, mes, 1).getDay();
                        const ultimoDia = new Date(ano, mes + 1, 0).getDate();
                        const dias = [];
                        // Dias vazios antes
                        for (let i = 0; i < primeiroDia; i++) {
                            dias.push(React.createElement("div", {key: 'empty-' + i}));
                        }
                        // Dias do m√™s
                        for (let dia = 1; dia <= ultimoDia; dia++) {
                            const dataStr = `${ano}-${String(mes + 1).padStart(2, '0')}-${String(dia).padStart(2, '0')}`;
                            const temDados = biDatasComDados.has(dataStr);
                            const selecionado = ua.data_fim === dataStr;
                            dias.push(React.createElement("button", {
                                key: dia,
                                onClick: () => { ga({...ua, data_fim: dataStr}); setCalDataFimAberto(false); },
                                className: "p-1.5 text-xs rounded-full transition-all " + 
                                    (selecionado ? "bg-purple-600 text-white font-bold" : 
                                    temDados ? "bg-green-100 text-green-700 hover:bg-green-200 font-semibold" : 
                                    "text-gray-400 hover:bg-gray-100")
                            }, dia));
                        }
                        return dias;
                    })()
                ),
                // Legenda
                React.createElement("div", {className: "flex items-center justify-center gap-4 mt-3 pt-2 border-t text-xs"},
                    React.createElement("span", {className: "flex items-center gap-1"},
                        React.createElement("span", {className: "w-3 h-3 rounded-full bg-green-200"}),
                        "Com dados"
                    ),
                    React.createElement("span", {className: "flex items-center gap-1"},
                        React.createElement("span", {className: "w-3 h-3 rounded-full bg-gray-200"}),
                        "Sem dados"
                    )
                ),
                // Bot√£o fechar
                React.createElement("button", {
                    onClick: () => setCalDataFimAberto(false),
                    className: "w-full mt-2 py-1 text-xs text-gray-500 hover:text-gray-700"
                }, "Fechar")
            )),
            
            React.createElement("div", {
                className: "border rounded-lg p-3 bg-gray-50"
            }, React.createElement("h3", {
                className: "font-semibold text-gray-700 mb-2 text-sm"
            }, "‚è±Ô∏è Status Prazo"), React.createElement("select", {
                value: ua.status_prazo,
                onChange: e => ga({
                    ...ua,
                    status_prazo: e.target.value
                }),
                className: "w-full px-3 py-2 border rounded text-sm"
            }, React.createElement("option", {
                value: ""
            }, "Todos"), React.createElement("option", {
                value: "dentro"
            }, "‚úÖ Dentro do Prazo"), React.createElement("option", {
                value: "fora"
            }, "‚ùå Fora do Prazo"))), Et === "os" && React.createElement("div", {
                className: "border rounded-lg p-3 bg-blue-50"
            }, React.createElement("h3", {
                className: "font-semibold text-blue-700 mb-2 text-sm"
            }, "‚è±Ô∏è Prazo Prof"), React.createElement("select", {
                value: ua.status_prazo_prof || "",
                onChange: e => ga({
                    ...ua,
                    status_prazo_prof: e.target.value
                }),
                className: "w-full px-3 py-2 border border-blue-300 rounded text-sm"
            }, React.createElement("option", {
                value: ""
            }, "Todos"), React.createElement("option", {
                value: "dentro"
            }, "‚úÖ Dentro do Prazo Prof"), React.createElement("option", {
                value: "fora"
            }, "‚ùå Fora do Prazo Prof"))), React.createElement("div", {
                className: "border rounded-lg p-3 bg-gray-50"
            }, React.createElement("h3", {
                className: "font-semibold text-gray-700 mb-2 text-sm"
            }, "üîÑ Retorno"), React.createElement("select", {
                value: ua.status_retorno || "",
                onChange: e => ga({
                    ...ua,
                    status_retorno: e.target.value
                }),
                className: "w-full px-3 py-2 border rounded text-sm"
            }, React.createElement("option", {
                value: ""
            }, "Todos"), React.createElement("option", {
                value: "com_retorno"
            }, "üîÑ Com Retorno"), React.createElement("option", {
                value: "sem_retorno"
            }, "‚úÖ Sem Retorno"))), React.createElement("div", {
                className: "border rounded-lg p-3 bg-gray-50"
            }, React.createElement("h3", {
                className: "font-semibold text-gray-700 mb-2 text-sm"
            }, "üó∫Ô∏è Regi√£o"), React.createElement("select", {
                value: ua.regiao || "",
                onChange: e => {
                    const t = e.target.value;
                    let a;
                    if (t) {
                        const e = aa.find(e => e.id === parseInt(t)),
                            l = e?.clientes?.map(e => String(e)) || [];
                        a = {
                            ...ua,
                            regiao: t,
                            cod_cliente: l,
                            centro_custo: [],
                            categoria: ""
                        }
                    } else a = {
                        ...ua,
                        regiao: "",
                        cod_cliente: [],
                        centro_custo: [],
                        categoria: ""
                    };
                    ga(a), rl(a)
                },
                className: "w-full px-3 py-2 border rounded text-sm"
            }, React.createElement("option", {
                value: ""
            }, "Todas as Regi√µes"), aa.map(e => React.createElement("option", {
                key: e.id,
                value: e.id
            }, e.nome, " (", e.clientes?.length || 0, " clientes)"))))), React.createElement("div", {
                className: "grid grid-cols-1 gap-4 mb-4"
            }, React.createElement("div", {
                className: "border rounded-lg p-3 bg-blue-50"
            }, React.createElement("h3", {
                className: "font-semibold text-gray-700 mb-2 text-sm"
            }, "üè∑Ô∏è Categoria"), React.createElement("select", {
                value: ua.categoria,
                onChange: e => {
                    const t = {
                        ...ua,
                        categoria: e.target.value
                    };
                    ga(t), rl(t)
                },
                className: "w-full px-3 py-2 border rounded text-sm"
            }, React.createElement("option", {
                value: ""
            }, "Todas as Categorias (", pa.length, " dispon√≠veis)"), pa.map(e => React.createElement("option", {
                key: e,
                value: e
            }, e))))), React.createElement("div", {
                className: "grid grid-cols-1 md:grid-cols-2 gap-4"
            }, React.createElement("div", {
                className: "border rounded-lg p-4 bg-purple-50"
            }, React.createElement("div", {
                className: "flex justify-between items-center mb-3"
            }, React.createElement("h3", {
                className: "font-bold text-purple-800"
            }, "üè¢ Cliente (Loja)"), (ua.cod_cliente || []).length > 0 ? React.createElement("button", {
                onClick: () => {
                    const e = {
                        ...ua,
                        cod_cliente: [],
                        centro_custo: [],
                        regiao: ""
                    };
                    ga(e), rl(e)
                },
                className: "text-xs bg-purple-200 text-purple-800 px-2 py-1 rounded-full font-semibold hover:bg-purple-300 cursor-pointer"
            }, (ua.cod_cliente || []).length, " selecionado(s) ‚úï") : React.createElement("span", {
                className: "text-xs text-purple-600"
            }, "Todas")), 
            // Campo de busca
            React.createElement("input", {
                type: "text",
                placeholder: "üîç Buscar por c√≥digo ou nome...",
                value: buscaClienteModal,
                onChange: e => setBuscaClienteModal(e.target.value),
                className: "w-full px-3 py-2 border-2 border-purple-200 rounded-lg text-sm mb-2 focus:border-purple-500 focus:ring-2 focus:ring-purple-200"
            }),
            React.createElement("select", {
                multiple: !0,
                size: "10",
                value: ua.cod_cliente || [],
                onChange: e => {
                    const t = Array.from(e.target.selectedOptions, e => e.value),
                        a = {
                            ...ua,
                            cod_cliente: t,
                            centro_custo: [],
                            regiao: ""
                        };
                    ga(a), rl(a)
                },
                className: "w-full px-3 py-2 border-2 border-purple-200 rounded-lg text-sm bg-white focus:border-purple-500 focus:ring-2 focus:ring-purple-200"
            }, (function() {
                // Filtrar e remover duplicatas por cod_cliente
                var clientesUnicos = [];
                var codigosVistos = {};
                ia.filter(function(e) {
                    if (!buscaClienteModal) return true;
                    var termo = buscaClienteModal.toLowerCase();
                    var codigo = String(e.cod_cliente).toLowerCase();
                    var nome = (il(e.cod_cliente) || e.nome_cliente || "").toLowerCase();
                    return codigo.includes(termo) || nome.includes(termo);
                }).forEach(function(e) {
                    if (!codigosVistos[e.cod_cliente]) {
                        codigosVistos[e.cod_cliente] = true;
                        clientesUnicos.push(e);
                    }
                });
                return clientesUnicos;
            })().map(e => React.createElement("option", {
                key: e.cod_cliente,
                value: String(e.cod_cliente),
                className: "py-1"
            }, e.cod_cliente, " - ", il(e.cod_cliente) || e.nome_cliente || "Cliente"))), React.createElement("p", {
                className: "text-xs text-purple-600 mt-2"
            }, "üí° Ctrl+Click para multi-sele√ß√£o | Sem sele√ß√£o = Todas")), React.createElement("div", {
                className: "border rounded-lg p-4 bg-green-50"
            }, React.createElement("div", {
                className: "flex justify-between items-center mb-3"
            }, React.createElement("h3", {
                className: "font-bold text-green-800"
            }, "üìÅ Centro de Custo"), (ua.centro_custo || []).length > 0 ? React.createElement("button", {
                onClick: () => {
                    const e = {
                        ...ua,
                        centro_custo: []
                    };
                    ga(e), rl(e)
                },
                className: "text-xs bg-green-200 text-green-800 px-2 py-1 rounded-full font-semibold hover:bg-green-300 cursor-pointer"
            }, (ua.centro_custo || []).length, " selecionado(s) ‚úï") : React.createElement("span", {
                className: "text-xs text-green-600"
            }, "Todos")), React.createElement("select", {
                multiple: !0,
                size: "10",
                value: ua.centro_custo || [],
                onChange: e => {
                    const t = Array.from(e.target.selectedOptions, e => e.value),
                        a = {
                            ...ua,
                            centro_custo: t
                        };
                    ga(a), rl(a)
                },
                className: "w-full px-3 py-2 border-2 border-green-200 rounded-lg text-sm bg-white focus:border-green-500 focus:ring-2 focus:ring-green-200"
            }, (function() {
                // Remover duplicatas de centro de custo
                var centrosUnicos = [];
                var centrosVistos = {};
                kt.forEach(function(e) {
                    if (e.centro_custo && !centrosVistos[e.centro_custo]) {
                        centrosVistos[e.centro_custo] = true;
                        centrosUnicos.push(e);
                    }
                });
                return centrosUnicos;
            })().map(e => {
                const t = Object.keys(Tt).find(t => (Tt[t] || []).includes(e.centro_custo));
                return React.createElement("option", {
                    key: e.centro_custo,
                    value: e.centro_custo,
                    className: "py-1"
                }, t ? t + " - " : "", e.centro_custo)
            })), React.createElement("p", {
                className: "text-xs text-green-600 mt-2"
            }, "üí° Ctrl+Click para multi-sele√ß√£o | Sem sele√ß√£o = Todos")))), React.createElement("div", {
                className: "sticky bottom-0 bg-gray-100 px-6 py-4 flex justify-between border-t"
            }, React.createElement("button", {
                onClick: () => {
                    const e = {
                        ...ua,
                        cod_cliente: [],
                        centro_custo: [],
                        categoria: "",
                        status_prazo: "",
                        status_prazo_prof: "",
                        status_retorno: "",
                        regiao: ""
                    };
                    ga(e), da(jt), Pt(At), xa(ra)
                },
                className: "px-5 py-2.5 bg-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-400 transition"
            }, "üóëÔ∏è Limpar Filtros"), React.createElement("button", {
                onClick: () => {
                    _a(!1), ol(ua)
                },
                className: "px-6 py-2.5 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 transition shadow-lg"
            }, "üîç Aplicar Filtros")))), React.createElement("div", {
                className: "max-w-full mx-auto p-4"
            }, ba ? React.createElement("div", {
                className: "flex flex-col items-center justify-center py-20"
            }, 
            // Container principal do loading
            React.createElement("div", {
                className: "w-full max-w-md"
            },
            // √çcone animado
            React.createElement("div", {
                className: "flex justify-center mb-6"
            }, React.createElement("div", {
                className: "relative"
            }, React.createElement("div", {
                className: "w-20 h-20 border-4 border-purple-200 rounded-full"
            }), React.createElement("div", {
                className: "absolute top-0 left-0 w-20 h-20 border-4 border-purple-600 rounded-full border-t-transparent animate-spin"
            }), React.createElement("div", {
                className: "absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-2xl"
            }, "üìä"))),
            // Barra de progresso
            React.createElement("div", {
                className: "w-full bg-purple-100 rounded-full h-3 mb-4 overflow-hidden"
            }, React.createElement("div", {
                className: "h-full bg-gradient-to-r from-purple-500 via-purple-600 to-purple-500 rounded-full transition-all duration-300 animate-pulse",
                style: { 
                    width: "100%",
                    backgroundSize: "200% 100%",
                    animation: "shimmer 1.5s infinite linear"
                }
            })),
            // Mensagem din√¢mica
            React.createElement("p", {
                className: "text-center text-purple-700 font-medium mb-2"
            }, loadingMessage),
            // Dicas/textos secund√°rios
            React.createElement("p", {
                className: "text-center text-gray-400 text-sm animate-pulse"
            }, ["Processando milhares de registros...", "Analisando m√©tricas de desempenho...", "Calculando indicadores...", "Organizando dados por regi√£o...", "Gerando visualiza√ß√µes..."][Math.floor(Date.now() / 2000) % 5])
            )) : React.createElement(React.Fragment, null, 
            
            // =============================================
            // HOME BI - P√°gina Inicial do M√≥dulo
            // =============================================
            "home-bi" === Et && React.createElement("div", {className: "min-h-screen bg-gradient-to-br from-purple-50 via-white to-violet-50"},
                // Hero Section com Logo
                React.createElement("div", {className: "flex flex-col items-center justify-center py-12"},
                    React.createElement("img", {
                        src: "https://github.com/Leonardodevcloud/tutts-frontend/blob/main/Tutts%20BI(1).png?raw=true",
                        alt: "Tutts BI",
                        className: "w-64 h-64 object-contain mb-6 drop-shadow-2xl"
                    }),
                    React.createElement("h1", {className: "text-3xl font-bold text-gray-800 mb-2"}, "Business Intelligence"),
                    React.createElement("p", {className: "text-gray-500 text-center max-w-xl"}, 
                        "An√°lise completa de dados operacionais, m√©tricas de desempenho e relat√≥rios inteligentes para tomada de decis√£o estrat√©gica."
                    )
                ),
                
                // Cards de Navega√ß√£o
                React.createElement("div", {className: "max-w-6xl mx-auto px-6 pb-12"},
                    React.createElement("div", {className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"},
                        
                        // Card Dashboard
                        React.createElement("div", {
                            onClick: () => { ht("dashboard"); el(); },
                            className: "bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 cursor-pointer group overflow-hidden border border-gray-100 hover:border-purple-300"
                        },
                            React.createElement("div", {className: "h-2 bg-gradient-to-r from-purple-500 to-violet-600"}),
                            React.createElement("div", {className: "p-6"},
                                React.createElement("div", {className: "w-14 h-14 bg-purple-100 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"},
                                    React.createElement("span", {className: "text-3xl"}, "üìä")
                                ),
                                React.createElement("h3", {className: "text-lg font-bold text-gray-800 mb-2"}, "Dashboard"),
                                React.createElement("p", {className: "text-sm text-gray-500"}, "Vis√£o geral com m√©tricas, gr√°ficos e indicadores de desempenho em tempo real.")
                            )
                        ),
                        
                        // Card Acompanhamento
                        React.createElement("div", {
                            onClick: () => { ht("acompanhamento"); carregarAcompanhamento(); },
                            className: "bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 cursor-pointer group overflow-hidden border border-gray-100 hover:border-blue-300"
                        },
                            React.createElement("div", {className: "h-2 bg-gradient-to-r from-blue-500 to-cyan-600"}),
                            React.createElement("div", {className: "p-6"},
                                React.createElement("div", {className: "w-14 h-14 bg-blue-100 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"},
                                    React.createElement("span", {className: "text-3xl"}, "üìà")
                                ),
                                React.createElement("h3", {className: "text-lg font-bold text-gray-800 mb-2"}, "Acompanhamento"),
                                React.createElement("p", {className: "text-sm text-gray-500"}, "An√°lise temporal com m√∫ltiplas m√©tricas e evolu√ß√£o de indicadores.")
                            )
                        ),
                        
                        // Card Por Profissional
                        React.createElement("div", {
                            onClick: () => { ht("profissionais"); el(); },
                            className: "bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 cursor-pointer group overflow-hidden border border-gray-100 hover:border-green-300"
                        },
                            React.createElement("div", {className: "h-2 bg-gradient-to-r from-green-500 to-emerald-600"}),
                            React.createElement("div", {className: "p-6"},
                                React.createElement("div", {className: "w-14 h-14 bg-green-100 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"},
                                    React.createElement("span", {className: "text-3xl"}, "üë§")
                                ),
                                React.createElement("h3", {className: "text-lg font-bold text-gray-800 mb-2"}, "Por Profissional"),
                                React.createElement("p", {className: "text-sm text-gray-500"}, "Ranking e an√°lise detalhada do desempenho individual de cada entregador.")
                            )
                        ),
                        
                        // Card An√°lise por OS
                        React.createElement("div", {
                            onClick: () => { ht("os"); },
                            className: "bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 cursor-pointer group overflow-hidden border border-gray-100 hover:border-amber-300"
                        },
                            React.createElement("div", {className: "h-2 bg-gradient-to-r from-amber-500 to-orange-600"}),
                            React.createElement("div", {className: "p-6"},
                                React.createElement("div", {className: "w-14 h-14 bg-amber-100 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"},
                                    React.createElement("span", {className: "text-3xl"}, "üìã")
                                ),
                                React.createElement("h3", {className: "text-lg font-bold text-gray-800 mb-2"}, "An√°lise por OS"),
                                React.createElement("p", {className: "text-sm text-gray-500"}, "Detalhamento completo de cada ordem de servi√ßo e seus pontos de entrega.")
                            )
                        ),
                        
                        // Card Cliente 767
                        React.createElement("div", {
                            onClick: () => { ht("cliente767"); carregarCliente767(); },
                            className: "bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 cursor-pointer group overflow-hidden border border-gray-100 hover:border-orange-300"
                        },
                            React.createElement("div", {className: "h-2 bg-gradient-to-r from-orange-500 to-red-500"}),
                            React.createElement("div", {className: "p-6"},
                                React.createElement("div", {className: "w-14 h-14 bg-orange-100 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"},
                                    React.createElement("span", {className: "text-3xl"}, "üè¢")
                                ),
                                React.createElement("h3", {className: "text-lg font-bold text-gray-800 mb-2"}, "Cliente 767"),
                                React.createElement("p", {className: "text-sm text-gray-500"}, "Dashboard exclusivo com prazo especial de 120 minutos e meta mensal.")
                            )
                        ),
                        
                        // Card Garantido
                        React.createElement("div", {
                            onClick: () => { ht("garantido"); carregarGarantido(); },
                            className: "bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 cursor-pointer group overflow-hidden border border-gray-100 hover:border-emerald-300"
                        },
                            React.createElement("div", {className: "h-2 bg-gradient-to-r from-emerald-500 to-green-600"}),
                            React.createElement("div", {className: "p-6"},
                                React.createElement("div", {className: "w-14 h-14 bg-emerald-100 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"},
                                    React.createElement("span", {className: "text-3xl"}, "üí∞")
                                ),
                                React.createElement("h3", {className: "text-lg font-bold text-gray-800 mb-2"}, "Garantido"),
                                React.createElement("p", {className: "text-sm text-gray-500"}, "An√°lise de m√≠nimo garantido, complementos e acompanhamento semanal.")
                            )
                        ),
                        
                        // Card Relat√≥rio IA
                        React.createElement("div", {
                            onClick: () => { ht("relatorio-ia"); },
                            className: "bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 cursor-pointer group overflow-hidden border border-gray-100 hover:border-violet-300"
                        },
                            React.createElement("div", {className: "h-2 bg-gradient-to-r from-violet-500 to-purple-600"}),
                            React.createElement("div", {className: "p-6"},
                                React.createElement("div", {className: "w-14 h-14 bg-violet-100 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"},
                                    React.createElement("img", {src: "https://raw.githubusercontent.com/Leonardodevcloud/tutts-frontend/main/gemini-app-icon-hd.png", className: "w-8 h-8 rounded"})
                                ),
                                React.createElement("h3", {className: "text-lg font-bold text-gray-800 mb-2"}, "Relat√≥rio IA"),
                                React.createElement("p", {className: "text-sm text-gray-500"}, "An√°lises autom√°ticas com Intelig√™ncia Artificial e gera√ß√£o de documentos.")
                            )
                        ),
                        
                        // Card Upload
                        React.createElement("div", {
                            onClick: () => { ht("upload"); },
                            className: "bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 cursor-pointer group overflow-hidden border border-gray-100 hover:border-teal-300"
                        },
                            React.createElement("div", {className: "h-2 bg-gradient-to-r from-teal-500 to-cyan-600"}),
                            React.createElement("div", {className: "p-6"},
                                React.createElement("div", {className: "w-14 h-14 bg-teal-100 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"},
                                    React.createElement("span", {className: "text-3xl"}, "üì§")
                                ),
                                React.createElement("h3", {className: "text-lg font-bold text-gray-800 mb-2"}, "Upload"),
                                React.createElement("p", {className: "text-sm text-gray-500"}, "Importa√ß√£o de planilhas e gerenciamento de dados operacionais.")
                            )
                        ),
                        
                        // Card Configura√ß√µes
                        React.createElement("div", {
                            onClick: () => { ht("config"); tl(); al(); carregarPrazosProf(); },
                            className: "bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 cursor-pointer group overflow-hidden border border-gray-100 hover:border-gray-300"
                        },
                            React.createElement("div", {className: "h-2 bg-gradient-to-r from-gray-500 to-slate-600"}),
                            React.createElement("div", {className: "p-6"},
                                React.createElement("div", {className: "w-14 h-14 bg-gray-100 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"},
                                    React.createElement("span", {className: "text-3xl"}, "‚öôÔ∏è")
                                ),
                                React.createElement("h3", {className: "text-lg font-bold text-gray-800 mb-2"}, "Configura√ß√µes"),
                                React.createElement("p", {className: "text-sm text-gray-500"}, "Regi√µes, m√°scaras, prazos personalizados e regras de contagem.")
                            )
                        )
                    ),
                    
                    // Estat√≠sticas R√°pidas
                    ft && React.createElement("div", {className: "mt-10"},
                        React.createElement("div", {className: "flex items-center justify-between mb-4"},
                            React.createElement("h2", {className: "text-xl font-bold text-gray-800 flex items-center gap-2"},
                                React.createElement("span", null, "‚ö°"),
                                "Resumo R√°pido"
                            ),
                            React.createElement("div", {className: "bg-purple-100 text-purple-700 px-4 py-2 rounded-full text-sm font-semibold"},
                                "üìÖ ",
                                ua.data_inicio ? new Date(ua.data_inicio + "T12:00:00").toLocaleDateString("pt-BR") : "-",
                                " a ",
                                ua.data_fim ? new Date(ua.data_fim + "T12:00:00").toLocaleDateString("pt-BR") : "-"
                            )
                        ),
                        React.createElement("div", {className: "grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4"},
                            React.createElement("div", {className: "bg-white rounded-xl p-4 shadow text-center"},
                                React.createElement("p", {className: "text-2xl font-bold text-purple-600"}, ft.total_os?.toLocaleString() || 0),
                                React.createElement("p", {className: "text-xs text-gray-500"}, "Total OS")
                            ),
                            React.createElement("div", {className: "bg-white rounded-xl p-4 shadow text-center"},
                                React.createElement("p", {className: "text-2xl font-bold text-blue-600"}, ft.total_entregas?.toLocaleString() || 0),
                                React.createElement("p", {className: "text-xs text-gray-500"}, "Entregas")
                            ),
                            React.createElement("div", {className: "bg-white rounded-xl p-4 shadow text-center"},
                                React.createElement("p", {className: "text-2xl font-bold text-green-600"}, ft.taxa_prazo || 0, "%"),
                                React.createElement("p", {className: "text-xs text-gray-500"}, "No Prazo")
                            ),
                            React.createElement("div", {className: "bg-white rounded-xl p-4 shadow text-center"},
                                React.createElement("p", {className: "text-2xl font-bold text-amber-600"}, ft.total_profissionais || 0),
                                React.createElement("p", {className: "text-xs text-gray-500"}, "Entregadores")
                            ),
                            React.createElement("div", {className: "bg-white rounded-xl p-4 shadow text-center"},
                                React.createElement("p", {className: "text-2xl font-bold text-violet-600"}, sl(ft.valor_total || 0)),
                                React.createElement("p", {className: "text-xs text-gray-500"}, "Valor Total")
                            ),
                            React.createElement("div", {className: "bg-white rounded-xl p-4 shadow text-center"},
                                React.createElement("p", {className: "text-2xl font-bold text-teal-600"}, sl(ft.faturamento_total || 0)),
                                React.createElement("p", {className: "text-xs text-gray-500"}, "Faturamento")
                            )
                        )
                    )
                )
            ),
            
            "dashboard" === Et && React.createElement(React.Fragment, null, 
            
            // === LINHA 1: FINANCEIRO (5 cards compactos) ===
            React.createElement("div", {
                className: "grid grid-cols-5 gap-2 mb-3"
            }, React.createElement("div", {
                className: "bg-white rounded-lg p-3 shadow border-l-3 border-violet-500"
            }, React.createElement("div", {
                className: "flex items-center gap-2 mb-1"
            }, React.createElement("span", {
                className: "text-base"
            }, "üíµ"), React.createElement("span", {
                className: "text-[10px] text-violet-600 bg-violet-50 px-1.5 py-0.5 rounded"
            }, "Cliente")), React.createElement("p", {
                className: "text-lg font-bold text-gray-800"
            }, sl(ft?.valor_total || 0)), React.createElement("p", {
                className: "text-[10px] text-gray-500"
            }, "Valor Total")), React.createElement("div", {
                className: "bg-white rounded-lg p-3 shadow border-l-3 border-blue-500"
            }, React.createElement("div", {
                className: "flex items-center gap-2 mb-1"
            }, React.createElement("span", {
                className: "text-base"
            }, "üë∑"), React.createElement("span", {
                className: "text-[10px] text-blue-600 bg-blue-50 px-1.5 py-0.5 rounded"
            }, "Entregador")), React.createElement("p", {
                className: "text-lg font-bold text-gray-800"
            }, sl(ft?.valor_prof_total || 0)), React.createElement("p", {
                className: "text-[10px] text-gray-500"
            }, "Valor Profissional")), React.createElement("div", {
                className: "bg-white rounded-lg p-3 shadow border-l-3 border-purple-500"
            }, React.createElement("div", {
                className: "flex items-center gap-2 mb-1"
            }, React.createElement("span", {
                className: "text-base"
            }, "üìà"), React.createElement("span", {
                className: "text-[10px] text-purple-600 bg-purple-50 px-1.5 py-0.5 rounded"
            }, "Lucro")), React.createElement("p", {
                className: "text-lg font-bold text-gray-800"
            }, sl(nl(ft?.valor_total) - nl(ft?.valor_prof_total))), React.createElement("p", {
                className: "text-[10px] text-gray-500"
            }, "Faturamento")), React.createElement("div", {
                className: "bg-white rounded-lg p-3 shadow border-l-3 border-amber-500"
            }, React.createElement("div", {
                className: "flex items-center gap-2 mb-1"
            }, React.createElement("span", {
                className: "text-base"
            }, "üé´"), React.createElement("span", {
                className: "text-[10px] text-amber-600 bg-amber-50 px-1.5 py-0.5 rounded"
            }, "Por OS")), React.createElement("p", {
                className: "text-lg font-bold text-gray-800"
            }, sl(ft?.ticket_medio || 0)), React.createElement("p", {
                className: "text-[10px] text-gray-500"
            }, "Ticket M√©dio")), React.createElement("div", {
                className: "bg-white rounded-lg p-3 shadow border-l-3 border-violet-500"
            }, React.createElement("div", {
                className: "flex items-center gap-2 mb-1"
            }, React.createElement("span", {
                className: "text-base"
            }, "üìä"), React.createElement("span", {
                className: "text-[10px] text-violet-600 bg-violet-50 px-1.5 py-0.5 rounded"
            }, "M√©dia")), React.createElement("p", {
                className: "text-lg font-bold text-gray-800"
            }, nl(ft?.media_entregas_por_prof).toFixed(2)), React.createElement("p", {
                className: "text-[10px] text-gray-500"
            }, "Ent/Entregador"))),
            
            // === LINHA 2: OPERACIONAL + TEMPO (7 cards compactos) ===
            React.createElement("div", {
                className: "grid grid-cols-7 gap-2 mb-3"
            }, React.createElement("div", {
                className: "bg-white rounded-lg p-3 shadow"
            }, React.createElement("span", {
                className: "text-base"
            }, "üìã"), React.createElement("p", {
                className: "text-xl font-bold text-gray-800"
            }, nl(ft?.total_os).toLocaleString("pt-BR")), React.createElement("p", {
                className: "text-[10px] text-gray-500"
            }, "Qtd OS")), React.createElement("div", {
                className: "bg-white rounded-lg p-3 shadow"
            }, React.createElement("span", {
                className: "text-base"
            }, "üöö"), React.createElement("p", {
                className: "text-xl font-bold text-gray-800"
            }, nl(ft?.total_entregas).toLocaleString("pt-BR")), React.createElement("p", {
                className: "text-[10px] text-gray-500"
            }, "Entregas")), React.createElement("div", {
                className: "bg-white rounded-lg p-3 shadow"
            }, React.createElement("span", {
                className: "text-base"
            }, "üîÑ"), React.createElement("p", {
                className: "text-xl font-bold text-gray-800"
            }, nl(ft?.total_retornos).toLocaleString("pt-BR")), React.createElement("p", {
                className: "text-[10px] text-gray-500"
            }, "Retornos")), React.createElement("div", {
                className: "bg-white rounded-lg p-3 shadow"
            }, React.createElement("span", {
                className: "text-base"
            }, "üèçÔ∏è"), React.createElement("p", {
                className: "text-xl font-bold text-gray-800"
            }, nl(ft?.total_profissionais).toLocaleString("pt-BR")), React.createElement("p", {
                className: "text-[10px] text-gray-500"
            }, "Entregadores")), React.createElement("div", {
                className: "bg-gradient-to-br from-sky-500 to-blue-600 rounded-lg p-3 shadow"
            }, React.createElement("div", {
                className: "flex items-center gap-1 mb-1"
            }, React.createElement("span", {
                className: "text-base"
            }, "üöÄ"), React.createElement("span", {
                className: "text-[10px] text-sky-100 bg-white/20 px-1 py-0.5 rounded"
            }, "Entrega")), React.createElement("p", {
                className: "text-xl font-bold text-white"
            }, cl(ft?.tempo_medio)), React.createElement("p", {
                className: "text-[10px] text-sky-100"
            }, "Tempo M√©dio")), React.createElement("div", {
                className: "bg-gradient-to-br from-amber-500 to-orange-600 rounded-lg p-3 shadow"
            }, React.createElement("div", {
                className: "flex items-center gap-1 mb-1"
            }, React.createElement("span", {
                className: "text-base"
            }, "üì¶"), React.createElement("span", {
                className: "text-[10px] text-amber-100 bg-white/20 px-1 py-0.5 rounded"
            }, "Coleta")), React.createElement("p", {
                className: "text-xl font-bold text-white"
            }, cl(ft?.tempo_medio_coleta || ft?.tempo_medio_alocacao)), React.createElement("p", {
                className: "text-[10px] text-amber-100"
            }, "Tempo M√©dio")), React.createElement("div", {
                className: "bg-gradient-to-br from-pink-500 to-rose-600 rounded-lg p-3 shadow"
            }, React.createElement("div", {
                className: "flex items-center gap-1 mb-1"
            }, React.createElement("span", {
                className: "text-base"
            }, "‚è≥"), React.createElement("span", {
                className: "text-[10px] text-pink-100 bg-white/20 px-1 py-0.5 rounded"
            }, "Aloca√ß√£o")), React.createElement("p", {
                className: "text-xl font-bold text-white"
            }, cl(ft?.tempo_medio_alocacao)), React.createElement("p", {
                className: "text-[10px] text-pink-100"
            }, "Tempo M√©dio"))),
            
            // === LINHA 3: STATUS DE PRAZO (2 cards compactos) ===
            React.createElement("div", {
                className: "grid grid-cols-2 gap-2 mb-4"
            }, 
            // ===== CARD PRAZO CONSOLIDADO =====
            React.createElement("div", {
                className: "bg-white rounded-lg p-4 shadow border-l-4 border-green-500"
            }, React.createElement("h4", {
                className: "text-sm font-bold text-gray-700 mb-3"
            }, "üìä Prazo de Entrega"), React.createElement("div", {
                className: "grid grid-cols-2 gap-3"
            }, React.createElement("div", {
                className: "text-center p-2 bg-green-50 rounded-lg"
            }, React.createElement("p", {
                className: "text-[10px] text-green-600 font-medium"
            }, "‚úÖ No Prazo"), React.createElement("p", {
                className: "text-xl font-bold text-green-700"
            }, nl(ft?.dentro_prazo).toLocaleString("pt-BR")), React.createElement("p", {
                className: "text-sm font-semibold text-green-600"
            }, (nl(ft?.dentro_prazo) / (nl(ft?.total_entregas) || 1) * 100).toFixed(1), "%")), React.createElement("div", {
                className: "text-center p-2 bg-red-50 rounded-lg"
            }, React.createElement("p", {
                className: "text-[10px] text-red-600 font-medium"
            }, "‚ùå Fora do Prazo"), React.createElement("p", {
                className: "text-xl font-bold text-red-700"
            }, nl(ft?.fora_prazo).toLocaleString("pt-BR")), React.createElement("p", {
                className: "text-sm font-semibold text-red-600"
            }, (nl(ft?.fora_prazo) / (nl(ft?.total_entregas) || 1) * 100).toFixed(1), "%")))),
            
            // ===== CARD PRAZO PROF CONSOLIDADO =====
            React.createElement("div", {
                className: "bg-white rounded-lg p-4 shadow border-l-4 border-blue-500"
            }, React.createElement("h4", {
                className: "text-sm font-bold text-gray-700 mb-3"
            }, "üë®‚Äçüíº Prazo Profissional"), React.createElement("div", {
                className: "grid grid-cols-3 gap-2"
            }, React.createElement("div", {
                className: "text-center p-2 bg-blue-50 rounded-lg"
            }, React.createElement("p", {
                className: "text-[10px] text-blue-600 font-medium"
            }, "‚úÖ No Prazo"), React.createElement("p", {
                className: "text-xl font-bold text-blue-700"
            }, nl(ft?.dentro_prazo_prof).toLocaleString("pt-BR")), React.createElement("p", {
                className: "text-sm font-semibold text-blue-600"
            }, (nl(ft?.dentro_prazo_prof) / ((nl(ft?.dentro_prazo_prof) + nl(ft?.fora_prazo_prof)) || 1) * 100).toFixed(1), "%")), React.createElement("div", {
                className: "text-center p-2 bg-orange-50 rounded-lg"
            }, React.createElement("p", {
                className: "text-[10px] text-orange-600 font-medium"
            }, "‚ùå Fora do Prazo"), React.createElement("p", {
                className: "text-xl font-bold text-orange-700"
            }, nl(ft?.fora_prazo_prof).toLocaleString("pt-BR")), React.createElement("p", {
                className: "text-sm font-semibold text-orange-600"
            }, (nl(ft?.fora_prazo_prof) / ((nl(ft?.dentro_prazo_prof) + nl(ft?.fora_prazo_prof)) || 1) * 100).toFixed(1), "%")), React.createElement("div", {
                className: "text-center p-2 bg-indigo-50 rounded-lg"
            }, React.createElement("p", {
                className: "text-[10px] text-indigo-600 font-medium"
            }, "‚è±Ô∏è T. M√©dio"), React.createElement("p", {
                className: "text-xl font-bold text-indigo-700"
            }, cl(ft?.tempo_medio_entrega_prof)))))),
            
            React.createElement("div", {
                className: "bg-white rounded-lg shadow overflow-hidden"
            }, React.createElement("div", {
                className: "bg-purple-100 px-4 py-3"
            }, React.createElement("h3", {
                className: "font-bold text-purple-900"
            }, "Resumo Geral por Cliente"), ((ua.cod_cliente || []).length > 0 || (ua.centro_custo || []).length > 0 || ua.categoria || ua.regiao) && React.createElement("div", {
                className: "mt-2 flex flex-wrap gap-2"
            }, ua.regiao && React.createElement("span", {
                className: "text-xs bg-blue-200 text-blue-800 px-2 py-1 rounded-full"
            }, "üó∫Ô∏è Regi√£o: ", aa.find(e => e.id === parseInt(ua.regiao))?.nome || ua.regiao), (ua.cod_cliente || []).length > 0 && !ua.regiao && React.createElement("span", {
                className: "text-xs bg-purple-200 text-purple-800 px-2 py-1 rounded-full"
            }, "üè¢ ", (ua.cod_cliente || []).length, " cliente(s)"), (ua.centro_custo || []).length > 0 && React.createElement("span", {
                className: "text-xs bg-green-200 text-green-800 px-2 py-1 rounded-full"
            }, "üìÅ Centro(s): ", (ua.centro_custo || []).join(", ")), ua.categoria && React.createElement("span", {
                className: "text-xs bg-yellow-200 text-yellow-800 px-2 py-1 rounded-full"
            }, "üè∑Ô∏è ", ua.categoria))), React.createElement("div", {
                className: "overflow-x-auto"
            }, React.createElement("table", {
                className: "w-full text-sm"
            }, React.createElement("thead", {
                className: "bg-purple-50"
            }, React.createElement("tr", null, React.createElement("th", {
                className: "px-2 py-2 text-left text-purple-900 w-8"
            }), React.createElement("th", {
                className: "px-2 py-2 text-left text-purple-900 max-w-[150px]"
            }, "Cliente"), React.createElement("th", {
                className: "px-2 py-2 text-right text-purple-900"
            }, "OS"), React.createElement("th", {
                className: "px-2 py-2 text-right text-purple-900"
            }, "Entregas"), React.createElement("th", {
                className: "px-2 py-2 text-right text-purple-900"
            }, "Retornos"), React.createElement("th", {
                className: "px-3 py-2 text-center text-green-700 bg-green-50 min-w-[100px]"
            }, "No Prazo"), React.createElement("th", {
                className: "px-3 py-2 text-center text-red-700 bg-red-50 min-w-[100px]"
            }, "Fora Prazo"), React.createElement("th", {
                className: "px-3 py-2 text-center text-blue-700 bg-blue-50 min-w-[100px]"
            }, "Prazo Prof"), React.createElement("th", {
                className: "px-3 py-2 text-center text-orange-700 bg-orange-50 min-w-[100px]"
            }, "Fora Prof"), React.createElement("th", {
                className: "px-2 py-2 text-right text-purple-900"
            }, "M√©dia"), React.createElement("th", {
                className: "px-2 py-2 text-right text-purple-900"
            }, "Val. Cliente"), React.createElement("th", {
                className: "px-2 py-2 text-right text-purple-900"
            }, "Val. Prof."), React.createElement("th", {
                className: "px-2 py-2 text-right text-purple-900"
            }, "Faturamento"), React.createElement("th", {
                className: "px-2 py-2 text-right text-purple-900"
            }, "Tckt. M√©dio"), React.createElement("th", {
                className: "px-2 py-2 text-right text-purple-900"
            }, "Entregadores"), React.createElement("th", {
                className: "px-2 py-2 text-right text-purple-900"
            }, "Ent/Entreg"), React.createElement("th", {
                className: "px-2 py-2 text-right text-purple-900"
            }, "√ölt. Entrega"))), React.createElement("tbody", null, (zt || []).filter(e => parseInt(e.total_os) > 0 || parseInt(e.total_entregas) > 0).map((e, t) => React.createElement(React.Fragment, {
                key: t
            }, React.createElement("tr", {
                className: "border-b hover:bg-purple-50 " + (t % 2 == 0 ? "bg-white" : "bg-gray-50")
            }, React.createElement("td", {
                className: "px-2 py-2"
            }, React.createElement("button", {
                onClick: () => ml(`dash-cli-${t}`),
                className: "text-purple-600 hover:text-purple-800 font-bold"
            }, Kt[`dash-cli-${t}`] ? "‚ûñ" : "‚ûï")), React.createElement("td", {
                className: "px-2 py-2 font-medium max-w-[150px] truncate",
                title: e.cod_cliente + " - " + (e.nome_display || e.nome_cliente)
            }, e.cod_cliente, " - ", e.nome_display || e.nome_cliente), React.createElement("td", {
                className: "px-2 py-2 text-right"
            }, nl(e.total_os).toLocaleString("pt-BR")), React.createElement("td", {
                className: "px-2 py-2 text-right"
            }, nl(e.total_entregas).toLocaleString("pt-BR")), React.createElement("td", {
                className: "px-2 py-2 text-right text-orange-600"
            }, nl(e.total_retornos).toLocaleString("pt-BR")), React.createElement("td", {
                className: "px-3 py-2 text-center text-green-700 bg-green-50"
            }, React.createElement("div", { className: "font-bold" }, nl(e.dentro_prazo).toLocaleString("pt-BR")), React.createElement("div", { className: "text-sm font-semibold" }, (nl(e.dentro_prazo) / (nl(e.total_entregas) || 1) * 100).toFixed(1), "%")), React.createElement("td", {
                className: "px-3 py-2 text-center text-red-700 bg-red-50"
            }, React.createElement("div", { className: "font-bold" }, nl(e.fora_prazo).toLocaleString("pt-BR")), React.createElement("div", { className: "text-sm font-semibold" }, (nl(e.fora_prazo) / (nl(e.total_entregas) || 1) * 100).toFixed(1), "%")), React.createElement("td", {
                className: "px-3 py-2 text-center text-blue-700 bg-blue-50"
            }, React.createElement("div", { className: "font-bold" }, nl(e.dentro_prazo_prof || 0).toLocaleString("pt-BR")), React.createElement("div", { className: "text-sm font-semibold" }, (nl(e.dentro_prazo_prof || 0) / (nl(e.total_entregas) || 1) * 100).toFixed(1), "%")), React.createElement("td", {
                className: "px-3 py-2 text-center text-orange-700 bg-orange-50"
            }, React.createElement("div", { className: "font-bold" }, nl(e.fora_prazo_prof || 0).toLocaleString("pt-BR")), React.createElement("div", { className: "text-sm font-semibold" }, (nl(e.fora_prazo_prof || 0) / (nl(e.total_entregas) || 1) * 100).toFixed(1), "%")), React.createElement("td", {
                className: "px-2 py-2 text-right"
            }, cl(e.tempo_medio)), React.createElement("td", {
                className: "px-2 py-2 text-right"
            }, sl(e.valor_total)), React.createElement("td", {
                className: "px-2 py-2 text-right"
            }, sl(e.valor_prof)), React.createElement("td", {
                className: "px-2 py-2 text-right font-medium"
            }, sl(nl(e.valor_total) - nl(e.valor_prof))), React.createElement("td", {
                className: "px-2 py-2 text-right"
            }, sl(e.ticket_medio)), React.createElement("td", {
                className: "px-2 py-2 text-right"
            }, nl(e.total_profissionais).toLocaleString("pt-BR")), React.createElement("td", {
                className: "px-2 py-2 text-right"
            }, nl(e.entregas_por_prof).toLocaleString("pt-BR", {
                minimumFractionDigits: 2
            })), React.createElement("td", {
                className: "px-3 py-2 text-right text-xs"
            }, e.ultima_entrega ? React.createElement("span", {
                className: new Date(e.ultima_entrega) > new Date(Date.now() - 6048e5) ? "text-green-600" : "text-orange-500"
            }, "‚óè ", new Date(e.ultima_entrega).toLocaleDateString("pt-BR")) : "-")), Kt[`dash-cli-${t}`] && (e.centros_custo || []).map((a, l) => React.createElement("tr", {
                key: `${t}-cc-${l}`,
                className: "bg-purple-50 border-l-4 border-purple-400"
            }, React.createElement("td", {
                className: "px-2 py-2 text-purple-400 text-center"
            }, "‚îî"), React.createElement("td", {
                className: "px-2 py-2 text-purple-700 pl-4 max-w-[150px] truncate text-sm"
            }, "üìÅ ", a.centro_custo), React.createElement("td", {
                className: "px-2 py-2 text-right text-purple-600"
            }, nl(a.total_os).toLocaleString("pt-BR")), React.createElement("td", {
                className: "px-2 py-2 text-right text-purple-600"
            }, nl(a.total_entregas).toLocaleString("pt-BR")), React.createElement("td", {
                className: "px-2 py-2 text-right text-orange-500"
            }, nl(a.total_retornos || 0).toLocaleString("pt-BR")), React.createElement("td", {
                className: "px-3 py-2 text-center text-green-600 bg-green-50"
            }, React.createElement("div", { className: "font-medium" }, nl(a.dentro_prazo).toLocaleString("pt-BR")), React.createElement("div", { className: "text-sm" }, (nl(a.dentro_prazo) / (nl(a.total_entregas) || 1) * 100).toFixed(1), "%")), React.createElement("td", {
                className: "px-3 py-2 text-center text-red-600 bg-red-50"
            }, React.createElement("div", { className: "font-medium" }, nl(a.fora_prazo).toLocaleString("pt-BR")), React.createElement("div", { className: "text-sm" }, (nl(a.fora_prazo) / (nl(a.total_entregas) || 1) * 100).toFixed(1), "%")), React.createElement("td", {
                className: "px-3 py-2 text-center text-blue-600 bg-blue-50"
            }, React.createElement("div", { className: "font-medium" }, nl(a.dentro_prazo_prof || 0).toLocaleString("pt-BR")), React.createElement("div", { className: "text-sm" }, (nl(a.dentro_prazo_prof || 0) / (nl(a.total_entregas) || 1) * 100).toFixed(1), "%")), React.createElement("td", {
                className: "px-3 py-2 text-center text-orange-600 bg-orange-50"
            }, React.createElement("div", { className: "font-medium" }, nl(a.fora_prazo_prof || 0).toLocaleString("pt-BR")), React.createElement("div", { className: "text-sm" }, (nl(a.fora_prazo_prof || 0) / (nl(a.total_entregas) || 1) * 100).toFixed(1), "%")), React.createElement("td", {
                className: "px-2 py-2 text-right text-purple-600"
            }, cl(a.tempo_medio)), React.createElement("td", {
                className: "px-2 py-2 text-right text-purple-600"
            }, sl(a.valor_total)), React.createElement("td", {
                className: "px-2 py-2 text-right text-purple-600"
            }, sl(a.valor_prof)), React.createElement("td", {
                className: "px-2 py-2 text-right text-purple-600"
            }, sl(nl(a.valor_total) - nl(a.valor_prof))), React.createElement("td", {
                className: "px-2 py-2 text-right text-purple-600"
            }, a.total_entregas > 0 ? sl(nl(a.valor_total) / a.total_entregas) : "-"), React.createElement("td", {
                colSpan: "3",
                className: "px-2 py-2 text-center text-gray-400"
            }, "-")))))), React.createElement("tfoot", {
                className: "bg-purple-200 font-bold"
            }, React.createElement("tr", null, React.createElement("td", {
                className: "px-2 py-2"
            }), React.createElement("td", {
                className: "px-2 py-2"
            }, "Total"), React.createElement("td", {
                className: "px-2 py-2 text-right"
            }, nl(ft?.total_os).toLocaleString("pt-BR")), React.createElement("td", {
                className: "px-2 py-2 text-right"
            }, nl(ft?.total_entregas).toLocaleString("pt-BR")), React.createElement("td", {
                className: "px-2 py-2 text-right text-orange-700"
            }, nl(ft?.total_retornos).toLocaleString("pt-BR")), React.createElement("td", {
                className: "px-3 py-2 text-center text-green-700 bg-green-100"
            }, React.createElement("div", null, nl(ft?.dentro_prazo).toLocaleString("pt-BR")), React.createElement("div", { className: "text-sm" }, (nl(ft?.dentro_prazo) / (nl(ft?.total_entregas) || 1) * 100).toFixed(1), "%")), React.createElement("td", {
                className: "px-3 py-2 text-center text-red-700 bg-red-100"
            }, React.createElement("div", null, nl(ft?.fora_prazo).toLocaleString("pt-BR")), React.createElement("div", { className: "text-sm" }, (nl(ft?.fora_prazo) / (nl(ft?.total_entregas) || 1) * 100).toFixed(1), "%")), React.createElement("td", {
                className: "px-3 py-2 text-center text-blue-700 bg-blue-100"
            }, React.createElement("div", null, nl(ft?.dentro_prazo_prof).toLocaleString("pt-BR")), React.createElement("div", { className: "text-sm" }, (nl(ft?.dentro_prazo_prof) / (nl(ft?.total_entregas) || 1) * 100).toFixed(1), "%")), React.createElement("td", {
                className: "px-3 py-2 text-center text-orange-700 bg-orange-100"
            }, React.createElement("div", null, nl(ft?.fora_prazo_prof).toLocaleString("pt-BR")), React.createElement("div", { className: "text-sm" }, (nl(ft?.fora_prazo_prof) / (nl(ft?.total_entregas) || 1) * 100).toFixed(1), "%")), React.createElement("td", {
                className: "px-2 py-2 text-right"
            }, cl(ft?.tempo_medio)), React.createElement("td", {
                className: "px-2 py-2 text-right"
            }, sl(ft?.valor_total)), React.createElement("td", {
                className: "px-2 py-2 text-right"
            }, sl(ft?.valor_prof_total)), React.createElement("td", {
                className: "px-2 py-2 text-right"
            }, sl(nl(ft?.valor_total) - nl(ft?.valor_prof_total))), React.createElement("td", {
                className: "px-2 py-2 text-right"
            }, sl(ft?.ticket_medio)), React.createElement("td", {
                className: "px-2 py-2 text-right"
            }, nl(ft?.total_profissionais).toLocaleString("pt-BR")), React.createElement("td", {
                className: "px-2 py-2 text-right"
            }, nl(ft?.media_entregas_por_prof).toLocaleString("pt-BR", {
                minimumFractionDigits: 2
            })), React.createElement("td", {
                className: "px-2 py-2 text-right"
            }, ft?.ultima_entrega ? new Date(ft.ultima_entrega).toLocaleDateString("pt-BR") : "-")))))), React.createElement("div", {
                className: "space-y-6 mt-6"
            }, 
            // ========== GR√ÅFICO 1: DISTRIBUI√á√ÉO POR TEMPO (Design Moderno) ==========
            React.createElement("div", {
                className: "bg-white rounded-xl shadow-lg p-6 border border-gray-100"
            }, 
                React.createElement("div", {className: "flex items-center justify-between mb-6"},
                    React.createElement("h3", {className: "font-bold text-gray-800 text-lg flex items-center gap-2"}, 
                        React.createElement("span", {className: "w-8 h-8 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-lg flex items-center justify-center text-white text-sm"}, "‚è±"),
                        "Distribuicao por Tempo de Entrega"
                    )
                ),
                React.createElement("div", {
                    className: "flex items-end gap-3 pt-4",
                    style: {height: "280px"}
                }, (() => {
                    const dados = Qt.porTempo || [];
                    const maxVal = Math.max(...dados.map(e => e.total || 0), 1);
                    const total = dados.reduce((acc, e) => acc + (e.total || 0), 0) || 1;
                    const cores = [
                        "from-emerald-400 to-emerald-600",
                        "from-blue-400 to-blue-600",
                        "from-purple-400 to-purple-600",
                        "from-amber-400 to-amber-600",
                        "from-orange-400 to-orange-600",
                        "from-red-400 to-red-600"
                    ];
                    return dados.map((item, idx) => {
                        const val = item.total || 0;
                        const pct = (val / total * 100).toFixed(1);
                        const altura = maxVal > 0 ? (val / maxVal * 200) : 0;
                        return React.createElement("div", {
                            key: idx,
                            className: "flex-1 flex flex-col items-center justify-end group cursor-pointer"
                        },
                            React.createElement("div", {
                                className: "opacity-0 group-hover:opacity-100 transition-all duration-200 bg-gray-900 text-white text-xs px-3 py-2 rounded-lg mb-2 shadow-lg whitespace-nowrap"
                            }, val.toLocaleString("pt-BR"), " entregas"),
                            React.createElement("div", {className: "text-xs font-bold text-gray-500 mb-1"}, pct + "%"),
                            React.createElement("div", {className: "text-lg font-bold text-gray-800 mb-2"}, val.toLocaleString("pt-BR")),
                            React.createElement("div", {
                                className: "w-full bg-gradient-to-t " + cores[idx % cores.length] + " rounded-t-lg transition-all duration-500 group-hover:scale-105 shadow-md",
                                style: {height: Math.max(altura, val > 0 ? 25 : 8) + "px", minWidth: "50px"}
                            }),
                            React.createElement("div", {
                                className: "mt-3 px-2 py-1 bg-gray-100 rounded-full text-xs font-semibold text-gray-700 text-center whitespace-nowrap"
                            }, item.faixa)
                        );
                    });
                })())
            ),
            
            // ========== GR√ÅFICO 2: DISTRIBUI√á√ÉO POR KM (Design Moderno) ==========
            React.createElement("div", {
                className: "bg-white rounded-xl shadow-lg p-6 border border-gray-100"
            },
                React.createElement("div", {className: "flex items-center justify-between mb-6"},
                    React.createElement("h3", {className: "font-bold text-gray-800 text-lg flex items-center gap-2"}, 
                        React.createElement("span", {className: "w-8 h-8 bg-gradient-to-br from-orange-500 to-red-600 rounded-lg flex items-center justify-center text-white text-sm"}, "üìç"),
                        "Distribuicao por Distancia (Km)"
                    ),
                    React.createElement("div", {className: "text-sm text-gray-500"}, 
                        "Faixas visiveis: ", React.createElement("span", {className: "font-bold text-orange-600"}, 
                            ((Qt.porKm || []).filter(e => !Gt?.includes(e.faixa)).length)
                        )
                    )
                ),
                React.createElement("div", {className: "flex gap-6"},
                    React.createElement("div", {className: "flex-1"},
                        React.createElement("div", {
                            className: "flex items-end gap-1 pt-4",
                            style: {height: "280px"}
                        }, (() => {
                            const dados = (Qt.porKm || []).filter(e => !Gt?.includes(e.faixa));
                            const maxVal = Math.max(...dados.map(e => e.total || 0), 1);
                            const total = dados.reduce((acc, e) => acc + (e.total || 0), 0) || 1;
                            return dados.map((item, idx) => {
                                const val = item.total || 0;
                                const pct = (val / total * 100).toFixed(1);
                                const altura = maxVal > 0 ? (val / maxVal * 200) : 0;
                                const hue = Math.max(0, 120 - (idx * 10));
                                return React.createElement("div", {
                                    key: idx,
                                    className: "flex-1 min-w-[28px] flex flex-col items-center justify-end group cursor-pointer"
                                },
                                    React.createElement("div", {
                                        className: "opacity-0 group-hover:opacity-100 transition-all duration-200 bg-gray-900 text-white text-xs px-2 py-1.5 rounded-lg mb-1 shadow-lg whitespace-nowrap z-10"
                                    }, val.toLocaleString("pt-BR"), " (", pct, "%)"),
                                    React.createElement("div", {className: "text-[10px] font-bold text-gray-400 mb-0.5"}, pct + "%"),
                                    React.createElement("div", {className: "text-xs font-bold text-gray-700 mb-1"}, val.toLocaleString("pt-BR")),
                                    React.createElement("div", {
                                        className: "w-full rounded-t-md transition-all duration-300 group-hover:scale-110 shadow-sm",
                                        style: {
                                            height: Math.max(altura, val > 0 ? 15 : 4) + "px",
                                            background: "linear-gradient(to top, hsl(" + hue + ", 70%, 45%), hsl(" + hue + ", 70%, 60%))",
                                            maxWidth: "24px",
                                            margin: "0 auto"
                                        }
                                    }),
                                    React.createElement("div", {
                                        className: "mt-2 text-[9px] font-medium text-gray-600 text-center"
                                    }, item.faixa)
                                );
                            });
                        })())
                    ),
                    React.createElement("div", {className: "w-44 flex-shrink-0 border-l border-gray-200 pl-4"},
                        React.createElement("div", {className: "text-sm font-bold text-gray-700 mb-3 flex items-center gap-2"},
                            "Filtrar Faixas"
                        ),
                        React.createElement("div", {className: "space-y-1 max-h-56 overflow-y-auto pr-2"},
                            (Qt.porKm || []).map((item, idx) => {
                                const isVisible = !Gt?.includes(item.faixa);
                                return React.createElement("label", {
                                    key: idx,
                                    className: "flex items-center gap-2 cursor-pointer px-2 py-1.5 rounded-lg transition-all " + (isVisible ? "bg-purple-50 hover:bg-purple-100" : "bg-gray-50 hover:bg-gray-100 opacity-60")
                                },
                                    React.createElement("input", {
                                        type: "checkbox",
                                        checked: isVisible,
                                        onChange: function(e) {
                                            e.target.checked 
                                                ? Wt(function(prev) { return (prev || []).filter(function(f) { return f !== item.faixa; }); })
                                                : Wt(function(prev) { return [...(prev || []), item.faixa]; });
                                        },
                                        className: "w-4 h-4 accent-purple-600 rounded"
                                    }),
                                    React.createElement("span", {className: "text-xs font-medium " + (isVisible ? "text-gray-800" : "text-gray-500")}, 
                                        item.faixa, " km"
                                    ),
                                    item.total > 0 && React.createElement("span", {
                                        className: "ml-auto text-[10px] px-1.5 py-0.5 rounded-full " + (isVisible ? "bg-orange-100 text-orange-600" : "bg-gray-200 text-gray-500")
                                    }, item.total)
                                );
                            })
                        ),
                        React.createElement("div", {className: "mt-3 pt-3 border-t border-gray-200 flex gap-2"},
                            React.createElement("button", {
                                onClick: function() { Wt([]); },
                                className: "flex-1 text-xs px-2 py-1.5 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
                            }, "Todos"),
                            React.createElement("button", {
                                onClick: function() { Wt((Qt.porKm || []).map(function(e) { return e.faixa; })); },
                                className: "flex-1 text-xs px-2 py-1.5 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
                            }, "Nenhum")
                        )
                    )
                )
            ))), "dashboard" === Et && React.createElement("div", {className: "bg-white rounded-xl shadow-lg p-6 mt-6 max-w-4xl mx-auto", style: {overflow: "hidden"}}, 
                React.createElement("div", {className: "flex items-center justify-between mb-4"}, 
                    React.createElement("h3", {className: "text-lg font-bold text-gray-800"}, "üó∫Ô∏è Acompanhamento Regional"),
                    React.createElement("button", {onClick: function() { setMapaCalorVisivel(!mapaCalorVisivel); if (!mapaCalorVisivel && window.destroyMapaCalor) window.destroyMapaCalor(); }, className: "px-3 py-1 text-sm rounded-lg " + (mapaCalorVisivel ? "bg-purple-600 text-white" : "bg-gray-200 text-gray-600")}, mapaCalorVisivel ? "üëÅÔ∏è Ocultar" : "üëÅÔ∏è Mostrar")
                ), 
                mapaCalorVisivel && React.createElement("div", {style: {position: "relative", minHeight: "600px", overflow: "hidden", borderRadius: "12px"}},
                    React.createElement("div", {id: "mapa-calor-leaflet", style: {height: "600px", width: "100%", borderRadius: "12px", backgroundColor: "#e5e7eb"}}),
                    mapaCalorLoading && React.createElement("div", {style: {position: "absolute", top: 0, left: 0, right: 0, bottom: 0, backgroundColor: "rgba(255,255,255,0.8)", display: "flex", alignItems: "center", justifyContent: "center", borderRadius: "12px", zIndex: 1000}}, React.createElement("div", {className: "text-center"}, React.createElement("div", {className: "animate-spin text-4xl"}, "‚è≥"), React.createElement("span", {className: "text-gray-600"}, "Carregando mapa...")))
                )
            ), "acompanhamento" === Et && React.createElement("div", {className: "space-y-6"}, React.createElement("div", {className: "bg-gradient-to-r from-purple-600 to-purple-800 rounded-xl p-6 text-white"}, React.createElement("h2", {className: "text-2xl font-bold mb-2"}, "üìà Acompanhamento Peri√≥dico"), React.createElement("p", {className: "opacity-80"}, "An√°lise temporal com m√∫ltiplas m√©tricas")), React.createElement("div", {className: "bg-white rounded-xl shadow-lg p-6"}, React.createElement("h3", {className: "text-lg font-bold text-gray-800 mb-4"}, "üìä Selecione as M√©tricas"), React.createElement("div", {className: "grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-2"}, React.createElement("label", {className: "flex items-center gap-2 p-2 border rounded-lg cursor-pointer text-xs " + (acompFiltros.os ? "border-blue-500 bg-blue-50" : "border-gray-200")}, React.createElement("input", {type: "checkbox", checked: acompFiltros.os, onChange: function() { toggleAcompFiltro("os"); }, className: "w-3 h-3"}), "OS"), React.createElement("label", {className: "flex items-center gap-2 p-2 border rounded-lg cursor-pointer text-xs " + (acompFiltros.entregas ? "border-sky-500 bg-sky-50" : "border-gray-200")}, React.createElement("input", {type: "checkbox", checked: acompFiltros.entregas, onChange: function() { toggleAcompFiltro("entregas"); }, className: "w-3 h-3"}), "Entregas"), React.createElement("label", {className: "flex items-center gap-2 p-2 border rounded-lg cursor-pointer text-xs " + (acompFiltros.noPrazo ? "border-green-500 bg-green-50" : "border-gray-200")}, React.createElement("input", {type: "checkbox", checked: acompFiltros.noPrazo, onChange: function() { toggleAcompFiltro("noPrazo"); }, className: "w-3 h-3"}), "No Prazo"), React.createElement("label", {className: "flex items-center gap-2 p-2 border rounded-lg cursor-pointer text-xs " + (acompFiltros.foraPrazo ? "border-red-500 bg-red-50" : "border-gray-200")}, React.createElement("input", {type: "checkbox", checked: acompFiltros.foraPrazo, onChange: function() { toggleAcompFiltro("foraPrazo"); }, className: "w-3 h-3"}), "Fora Prazo"), React.createElement("label", {className: "flex items-center gap-2 p-2 border rounded-lg cursor-pointer text-xs " + (acompFiltros.retornos ? "border-orange-500 bg-orange-50" : "border-gray-200")}, React.createElement("input", {type: "checkbox", checked: acompFiltros.retornos, onChange: function() { toggleAcompFiltro("retornos"); }, className: "w-3 h-3"}), "Retornos"), React.createElement("label", {className: "flex items-center gap-2 p-2 border rounded-lg cursor-pointer text-xs " + (acompFiltros.valorTotal ? "border-purple-500 bg-purple-50" : "border-gray-200")}, React.createElement("input", {type: "checkbox", checked: acompFiltros.valorTotal, onChange: function() { toggleAcompFiltro("valorTotal"); }, className: "w-3 h-3"}), "Valor Total"), React.createElement("label", {className: "flex items-center gap-2 p-2 border rounded-lg cursor-pointer text-xs " + (acompFiltros.valorProf ? "border-amber-500 bg-amber-50" : "border-gray-200")}, React.createElement("input", {type: "checkbox", checked: acompFiltros.valorProf, onChange: function() { toggleAcompFiltro("valorProf"); }, className: "w-3 h-3"}), "Valor Prof."), React.createElement("label", {className: "flex items-center gap-2 p-2 border rounded-lg cursor-pointer text-xs " + (acompFiltros.faturamentoTotal ? "border-violet-500 bg-violet-50" : "border-gray-200")}, React.createElement("input", {type: "checkbox", checked: acompFiltros.faturamentoTotal, onChange: function() { toggleAcompFiltro("faturamentoTotal"); }, className: "w-3 h-3"}), "Fat. Total"), React.createElement("label", {className: "flex items-center gap-2 p-2 border rounded-lg cursor-pointer text-xs " + (acompFiltros.ticketMedio ? "border-cyan-500 bg-cyan-50" : "border-gray-200")}, React.createElement("input", {type: "checkbox", checked: acompFiltros.ticketMedio, onChange: function() { toggleAcompFiltro("ticketMedio"); }, className: "w-3 h-3"}), "Ticket M√©dio"), React.createElement("label", {className: "flex items-center gap-2 p-2 border rounded-lg cursor-pointer text-xs " + (acompFiltros.tempoMedioEntrega ? "border-rose-500 bg-rose-50" : "border-gray-200")}, React.createElement("input", {type: "checkbox", checked: acompFiltros.tempoMedioEntrega, onChange: function() { toggleAcompFiltro("tempoMedioEntrega"); }, className: "w-3 h-3"}), "Temp. M√©dio Entrega"), React.createElement("label", {className: "flex items-center gap-2 p-2 border rounded-lg cursor-pointer text-xs " + (acompFiltros.tempoMedioAlocacao ? "border-pink-500 bg-pink-50" : "border-gray-200")}, React.createElement("input", {type: "checkbox", checked: acompFiltros.tempoMedioAlocacao, onChange: function() { toggleAcompFiltro("tempoMedioAlocacao"); }, className: "w-3 h-3"}), "Temp. M√©dio Aloca√ß√£o"), React.createElement("label", {className: "flex items-center gap-2 p-2 border rounded-lg cursor-pointer text-xs " + (acompFiltros.tempoMedioColeta ? "border-fuchsia-500 bg-fuchsia-50" : "border-gray-200")}, React.createElement("input", {type: "checkbox", checked: acompFiltros.tempoMedioColeta, onChange: function() { toggleAcompFiltro("tempoMedioColeta"); }, className: "w-3 h-3"}), "Temp. M√©dio Coleta"), React.createElement("label", {className: "flex items-center gap-2 p-2 border rounded-lg cursor-pointer text-xs " + (acompFiltros.totalEntregadores ? "border-teal-500 bg-teal-50" : "border-gray-200")}, React.createElement("input", {type: "checkbox", checked: acompFiltros.totalEntregadores, onChange: function() { toggleAcompFiltro("totalEntregadores"); }, className: "w-3 h-3"}), "Total Entregadores"), React.createElement("label", {className: "flex items-center gap-2 p-2 border rounded-lg cursor-pointer text-xs " + (acompFiltros.mediaEntProfissional ? "border-violet-500 bg-violet-50" : "border-gray-200")}, React.createElement("input", {type: "checkbox", checked: acompFiltros.mediaEntProfissional, onChange: function() { toggleAcompFiltro("mediaEntProfissional"); }, className: "w-3 h-3"}), "M√©dia Ent. Profissional"), React.createElement("label", {className: "flex items-center gap-2 p-2 border rounded-lg cursor-pointer text-xs " + (acompFiltros.evolucaoSemanal ? "border-violet-500 bg-violet-50" : "border-gray-200")}, React.createElement("input", {type: "checkbox", checked: acompFiltros.evolucaoSemanal, onChange: function() { toggleAcompFiltro("evolucaoSemanal"); }, className: "w-3 h-3"}), "Evolu√ß√£o Semanal"))),
            
            // TABELA DE RESUMO POR CLIENTE - DIN√ÇMICA BASEADA NOS SUBFILTROS
            !acompLoading && acompClientes && acompClientes.clientes && acompClientes.clientes.length > 0 && acompFiltrosOrdem.length > 0 && React.createElement("div", {className: "bg-white rounded-xl shadow-lg p-6"}, 
                React.createElement("div", {className: "flex items-center justify-between mb-4"},
                    React.createElement("h3", {className: "text-lg font-bold text-gray-800"}, "üìä Resumo Geral por Cliente"),
                    React.createElement("span", {className: "px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm font-medium"}, "üìã " + acompClientes.clientes.length + " cliente(s)")
                ),
                React.createElement("div", {className: "overflow-x-auto"},
                    React.createElement("table", {className: "text-xs"},
                        React.createElement("thead", null,
                            React.createElement("tr", {className: "bg-purple-100"},
                                React.createElement("th", {className: "px-2 py-2 text-center font-bold text-purple-800 w-8"}, ""),
                                React.createElement("th", {className: "px-3 py-2 text-left font-bold text-purple-800 whitespace-nowrap"}, "Clientes"),
                                acompFiltrosOrdem.map(function(filtro) {
                                    var labels = {os: "OS", entregas: "Entregas", noPrazo: "No Prazo", foraPrazo: "Fora Prazo", retornos: "Retornos", valorTotal: "Valor Total", valorProf: "Valor Prof.", ticketMedio: "Ticket M√©dio", tempoMedioEntrega: "T. Entrega", tempoMedioAlocacao: "T. Aloca√ß√£o", tempoMedioColeta: "T. Coleta", totalEntregadores: "Profissionais", mediaEntProfissional: "M√©d Ent/Prof", faturamentoTotal: "Fat. Total"};
                                    var align = (filtro === "valorTotal" || filtro === "valorProf" || filtro === "faturamentoTotal" || filtro === "ticketMedio") ? "text-right" : "text-center";
                                    return React.createElement("th", {key: filtro, className: "px-3 py-2 font-bold text-purple-800 whitespace-nowrap " + align}, labels[filtro] || filtro);
                                })
                            )
                        ),
                        React.createElement("tbody", null,
                            acompClientes.clientes.map(function(c, i) {
                                var temCC = c.centros_custo && c.centros_custo.length > 0;
                                var expandido = Kt["acomp-cli-" + i];
                                return React.createElement(React.Fragment, {key: i},
                                    React.createElement("tr", {className: i % 2 === 0 ? "bg-white hover:bg-gray-50" : "bg-gray-50 hover:bg-gray-100"},
                                        React.createElement("td", {className: "px-2 py-2 text-center"},
                                            temCC && React.createElement("button", {
                                                onClick: function() { ml("acomp-cli-" + i); },
                                                className: "text-purple-600 hover:text-purple-800 font-bold text-sm"
                                            }, expandido ? "‚ûñ" : "‚ûï")
                                        ),
                                        React.createElement("td", {className: "px-3 py-2 font-medium text-gray-800 whitespace-nowrap " + (i % 2 === 0 ? "bg-white" : "bg-gray-50")}, 
                                            c.cod_cliente, " - ", il(c.cod_cliente) || c.cliente
                                        ),
                                        acompFiltrosOrdem.map(function(filtro) {
                                            if (filtro === "os") return React.createElement("td", {key: filtro, className: "px-3 py-2 text-center font-bold text-blue-600 whitespace-nowrap"}, c.os);
                                            if (filtro === "entregas") return React.createElement("td", {key: filtro, className: "px-3 py-2 text-center text-sky-600 whitespace-nowrap"}, c.entregas);
                                            if (filtro === "noPrazo") return React.createElement("td", {key: filtro, className: "px-3 py-2 text-center whitespace-nowrap"}, React.createElement("span", {className: "px-2 py-0.5 rounded text-xs font-bold " + (c.noPrazo >= 80 ? "bg-green-100 text-green-700" : c.noPrazo >= 60 ? "bg-yellow-100 text-yellow-700" : "bg-red-100 text-red-700")}, c.noPrazo.toFixed(2) + "%"));
                                            if (filtro === "foraPrazo") return React.createElement("td", {key: filtro, className: "px-3 py-2 text-center whitespace-nowrap"}, React.createElement("span", {className: "px-2 py-0.5 rounded text-xs font-bold " + (c.foraPrazo <= 20 ? "bg-green-100 text-green-700" : c.foraPrazo <= 40 ? "bg-yellow-100 text-yellow-700" : "bg-red-100 text-red-700")}, c.foraPrazo.toFixed(2) + "%"));
                                            if (filtro === "retornos") return React.createElement("td", {key: filtro, className: "px-3 py-2 text-center text-orange-600 font-medium whitespace-nowrap"}, c.retornos);
                                            if (filtro === "valorTotal") return React.createElement("td", {key: filtro, className: "px-3 py-2 text-right text-purple-600 font-medium whitespace-nowrap"}, "R$" + c.valorTotal.toLocaleString("pt-BR", {minimumFractionDigits: 2}));
                                            if (filtro === "valorProf") return React.createElement("td", {key: filtro, className: "px-3 py-2 text-right text-amber-600 font-medium whitespace-nowrap"}, "R$" + c.valorProf.toLocaleString("pt-BR", {minimumFractionDigits: 2}));
                                            if (filtro === "faturamentoTotal") return React.createElement("td", {key: filtro, className: "px-3 py-2 text-right text-violet-600 font-medium whitespace-nowrap"}, "R$" + c.faturamentoTotal.toLocaleString("pt-BR", {minimumFractionDigits: 2}));
                                            if (filtro === "ticketMedio") return React.createElement("td", {key: filtro, className: "px-3 py-2 text-right text-cyan-600 font-medium whitespace-nowrap"}, "R$" + c.ticketMedio.toLocaleString("pt-BR", {minimumFractionDigits: 2}));
                                            if (filtro === "tempoMedioEntrega") return React.createElement("td", {key: filtro, className: "px-3 py-2 text-center text-rose-600 whitespace-nowrap"}, c.tempoMedioEntrega || "00:00:00");
                                            if (filtro === "tempoMedioAlocacao") return React.createElement("td", {key: filtro, className: "px-3 py-2 text-center text-pink-600 whitespace-nowrap"}, c.tempoMedioAlocacao || "00:00:00");
                                            if (filtro === "tempoMedioColeta") return React.createElement("td", {key: filtro, className: "px-3 py-2 text-center text-fuchsia-600 whitespace-nowrap"}, c.tempoMedioColeta || "00:00:00");
                                            if (filtro === "totalEntregadores") return React.createElement("td", {key: filtro, className: "px-3 py-2 text-center text-teal-600 whitespace-nowrap"}, c.totalProfissionais);
                                            if (filtro === "mediaEntProfissional") return React.createElement("td", {key: filtro, className: "px-3 py-2 text-center text-violet-600 whitespace-nowrap"}, c.mediaEntProfissional || (c.entregas / Math.max(c.totalProfissionais, 1)).toFixed(1));
                                            return null;
                                        })
                                    ),
                                    // Linhas expandidas dos centros de custo
                                    expandido && c.centros_custo && c.centros_custo.map(function(cc, j) {
                                        return React.createElement("tr", {key: i + "-cc-" + j, className: "bg-purple-50 border-l-4 border-purple-400"},
                                            React.createElement("td", {className: "px-2 py-2 text-purple-400 text-center"}, "‚îî"),
                                            React.createElement("td", {className: "px-3 py-2 text-purple-700 pl-4 whitespace-nowrap"}, "üìÅ ", c.cod_cliente, " - ", cc.centro_custo),
                                            acompFiltrosOrdem.map(function(filtro) {
                                                if (filtro === "os") return React.createElement("td", {key: filtro, className: "px-2 py-2 text-center text-purple-600"}, cc.total_os);
                                                if (filtro === "entregas") return React.createElement("td", {key: filtro, className: "px-2 py-2 text-center text-purple-600"}, cc.total_entregas);
                                                if (filtro === "noPrazo") return React.createElement("td", {key: filtro, className: "px-2 py-2 text-center"}, React.createElement("span", {className: "px-2 py-0.5 rounded text-xs font-bold " + (cc.taxa_no_prazo >= 80 ? "bg-green-100 text-green-700" : cc.taxa_no_prazo >= 60 ? "bg-yellow-100 text-yellow-700" : "bg-red-100 text-red-700")}, (cc.taxa_no_prazo || 0).toFixed(2) + "%"));
                                                if (filtro === "foraPrazo") return React.createElement("td", {key: filtro, className: "px-2 py-2 text-center"}, React.createElement("span", {className: "px-2 py-0.5 rounded text-xs font-bold " + (cc.taxa_fora_prazo <= 20 ? "bg-green-100 text-green-700" : cc.taxa_fora_prazo <= 40 ? "bg-yellow-100 text-yellow-700" : "bg-red-100 text-red-700")}, (cc.taxa_fora_prazo || 0).toFixed(2) + "%"));
                                                if (filtro === "retornos") return React.createElement("td", {key: filtro, className: "px-2 py-2 text-center text-orange-500"}, cc.retornos || 0);
                                                if (filtro === "valorTotal") return React.createElement("td", {key: filtro, className: "px-2 py-2 text-right text-purple-600"}, "R$" + (cc.valor_total || 0).toLocaleString("pt-BR", {minimumFractionDigits: 2}));
                                                if (filtro === "valorProf") return React.createElement("td", {key: filtro, className: "px-2 py-2 text-right text-purple-600"}, "R$" + (cc.valor_prof || 0).toLocaleString("pt-BR", {minimumFractionDigits: 2}));
                                                if (filtro === "faturamentoTotal") return React.createElement("td", {key: filtro, className: "px-2 py-2 text-right text-purple-600"}, "R$" + ((cc.valor_total || 0) - (cc.valor_prof || 0)).toLocaleString("pt-BR", {minimumFractionDigits: 2}));
                                                if (filtro === "ticketMedio") return React.createElement("td", {key: filtro, className: "px-2 py-2 text-right text-purple-600"}, "-");
                                                if (filtro === "tempoMedioEntrega") return React.createElement("td", {key: filtro, className: "px-2 py-2 text-center text-purple-600"}, cc.tempo_medio || "00:00:00");
                                                if (filtro === "tempoMedioAlocacao") return React.createElement("td", {key: filtro, className: "px-2 py-2 text-center text-purple-600"}, "-");
                                                if (filtro === "tempoMedioColeta") return React.createElement("td", {key: filtro, className: "px-2 py-2 text-center text-purple-600"}, "-");
                                                if (filtro === "totalEntregadores") return React.createElement("td", {key: filtro, className: "px-2 py-2 text-center text-purple-600"}, "-");
                                                if (filtro === "mediaEntProfissional") return React.createElement("td", {key: filtro, className: "px-2 py-2 text-center text-purple-600"}, "-");
                                                return null;
                                            })
                                        );
                                    })
                                );
                            }),
                            acompClientes.totais && React.createElement("tr", {className: "bg-purple-200 font-bold border-t-2 border-purple-400"},
                                React.createElement("td", {className: "px-2 py-2"}),
                                React.createElement("td", {className: "px-3 py-2 text-purple-900 sticky left-0 bg-purple-200"}, "Total"),
                                acompFiltrosOrdem.map(function(filtro) {
                                    var t = acompClientes.totais;
                                    if (filtro === "os") return React.createElement("td", {key: filtro, className: "px-2 py-2 text-center text-purple-900"}, t.os);
                                    if (filtro === "entregas") return React.createElement("td", {key: filtro, className: "px-2 py-2 text-center text-purple-900"}, t.entregas);
                                    if (filtro === "noPrazo") return React.createElement("td", {key: filtro, className: "px-2 py-2 text-center"}, React.createElement("span", {className: "px-2 py-0.5 rounded text-xs font-bold " + (t.noPrazo >= 80 ? "bg-green-200 text-green-800" : t.noPrazo >= 60 ? "bg-yellow-200 text-yellow-800" : "bg-red-200 text-red-800")}, t.noPrazo.toFixed(2) + "%"));
                                    if (filtro === "foraPrazo") return React.createElement("td", {key: filtro, className: "px-2 py-2 text-center"}, React.createElement("span", {className: "px-2 py-0.5 rounded text-xs font-bold " + (t.foraPrazo <= 20 ? "bg-green-200 text-green-800" : t.foraPrazo <= 40 ? "bg-yellow-200 text-yellow-800" : "bg-red-200 text-red-800")}, t.foraPrazo.toFixed(2) + "%"));
                                    if (filtro === "retornos") return React.createElement("td", {key: filtro, className: "px-2 py-2 text-center text-purple-900"}, t.retornos);
                                    if (filtro === "valorTotal") return React.createElement("td", {key: filtro, className: "px-2 py-2 text-right text-purple-900"}, "R$" + t.valorTotal.toLocaleString("pt-BR", {minimumFractionDigits: 2}));
                                    if (filtro === "valorProf") return React.createElement("td", {key: filtro, className: "px-2 py-2 text-right text-purple-900"}, "R$" + t.valorProf.toLocaleString("pt-BR", {minimumFractionDigits: 2}));
                                    if (filtro === "faturamentoTotal") return React.createElement("td", {key: filtro, className: "px-2 py-2 text-right text-purple-900"}, "R$" + t.faturamentoTotal.toLocaleString("pt-BR", {minimumFractionDigits: 2}));
                                    if (filtro === "ticketMedio") return React.createElement("td", {key: filtro, className: "px-2 py-2 text-right text-purple-900"}, "R$" + t.ticketMedio.toLocaleString("pt-BR", {minimumFractionDigits: 2}));
                                    if (filtro === "tempoMedioEntrega") return React.createElement("td", {key: filtro, className: "px-2 py-2 text-center text-purple-900"}, t.tempoMedioEntrega || "00:00:00");
                                    if (filtro === "tempoMedioAlocacao") return React.createElement("td", {key: filtro, className: "px-2 py-2 text-center text-purple-900"}, t.tempoMedioAlocacao || "00:00:00");
                                    if (filtro === "tempoMedioColeta") return React.createElement("td", {key: filtro, className: "px-2 py-2 text-center text-purple-900"}, t.tempoMedioColeta || "00:00:00");
                                    if (filtro === "totalEntregadores") return React.createElement("td", {key: filtro, className: "px-2 py-2 text-center text-purple-900"}, t.totalProfissionais);
                                    if (filtro === "mediaEntProfissional") return React.createElement("td", {key: filtro, className: "px-2 py-2 text-center text-purple-900"}, t.mediaEntProfissional || (t.entregas / Math.max(t.totalProfissionais, 1)).toFixed(1));
                                    return null;
                                })
                            )
                        )
                    )
                )
            ),
            
            acompLoading && React.createElement("div", {className: "bg-white rounded-xl shadow-lg p-12 text-center"}, React.createElement("div", {className: "animate-spin text-5xl mb-4"}, "‚è≥"), React.createElement("p", {className: "text-gray-600"}, "Carregando...")), !acompLoading && acompDados && acompDados.porData && acompDados.porData.length > 0 && (acompFiltros.os || acompFiltros.entregas || acompFiltros.noPrazo || acompFiltros.foraPrazo || acompFiltros.retornos || acompFiltros.valorTotal || acompFiltros.valorProf || acompFiltros.ticketMedio || acompFiltros.tempoMedioEntrega || acompFiltros.tempoMedioAlocacao || acompFiltros.tempoMedioColeta || acompFiltros.totalEntregadores || acompFiltros.mediaEntProfissional || acompFiltros.evolucaoSemanal) && React.createElement("div", {className: "bg-white rounded-xl shadow-lg p-6"}, React.createElement("div", {className: "relative"}, React.createElement("div", {id: "acomp-tooltip", style: {display: "none", position: "absolute", background: "white", border: "1px solid #ccc", borderRadius: "8px", padding: "12px", boxShadow: "0 4px 12px rgba(0,0,0,0.15)", zIndex: 1000, minWidth: "220px", fontSize: "11px"}}), // Gr√°fico de Acompanhamento - NOVA VERS√ÉO COM ESCALAS SEPARADAS
// ViewBox: 0 0 1000 450, altura √∫til: 20-400
// Dividido em 4 faixas horizontais:
// - Faixa 1 (topo): 30-120 - Percentuais (Taxa Prazo, Evolu√ß√£o)
// - Faixa 2: 140-220 - Contadores pequenos (OS, Entregas, Fora Prazo, Retornos, Entregadores, M√©dia Ent/Prof)
// - Faixa 3: 240-320 - Valores monet√°rios (Valor Total, Valor Prof, Ticket)
// - Faixa 4 (base): 340-390 - Tempos (Entrega, Aloca√ß√£o, Coleta)

// Gr√°fico de Acompanhamento - V3 - CADA M√âTRICA COM SUA PR√ìPRIA FAIXA
// ViewBox: 0 0 1000 500 (aumentado para caber tudo)
// 14 m√©tricas = 14 faixas de ~30px cada, bem espa√ßadas
// Ordem de cima para baixo:
// 1. Taxa Prazo (30-55)
// 2. Evolu√ß√£o Semanal (60-85)
// 3. OS (95-120)
// 4. Entregas (125-150)
// 5. Fora Prazo (155-180)
// 6. Retornos (185-210)
// 7. Total Entregadores (215-240)
// 8. M√©dia Ent/Prof (245-270)
// 9. Valor Total (280-305)
// 10. Valor Prof (310-335)
// 11. Ticket M√©dio (340-365)
// 12. Tempo Entrega (375-400)
// 13. Tempo Aloca√ß√£o (405-430)
// 14. Tempo Coleta (435-460)

// Gr√°fico DIN√ÇMICO - expande conforme sele√ß√£o
// Cada m√©trica ativa = 80px de altura
(function() {
  // Calcular quais m√©tricas est√£o ativas
  var metricas = [];
  if(acompFiltros.noPrazo) metricas.push({id: "noPrazo", label: "Taxa Prazo", color: "#22c55e", bgColor: "#f0fdf4", field: "taxa_prazo", isPercent: true});
  if(acompFiltros.evolucaoSemanal) metricas.push({id: "evolucao", label: "Evolu√ß√£o Semanal", color: "#8b5cf6", bgColor: "#faf5ff", field: "evolucao_semanal", isVariation: true});
  if(acompFiltros.os) metricas.push({id: "os", label: "OS", color: "#2563eb", bgColor: "#eff6ff", field: "total_os", isInt: true});
  if(acompFiltros.entregas) metricas.push({id: "entregas", label: "Entregas", color: "#0ea5e9", bgColor: "#f0f9ff", field: "total_entregas", isInt: true});
  if(acompFiltros.foraPrazo) metricas.push({id: "foraPrazo", label: "Fora Prazo", color: "#ef4444", bgColor: "#fef2f2", field: "fora_prazo", isInt: true});
  if(acompFiltros.retornos) metricas.push({id: "retornos", label: "Retornos", color: "#f97316", bgColor: "#fff7ed", field: "retornos", isInt: true});
  if(acompFiltros.totalEntregadores) metricas.push({id: "entregadores", label: "Total Entregadores", color: "#14b8a6", bgColor: "#f0fdfa", field: "total_entregadores", isInt: true});
  if(acompFiltros.mediaEntProfissional) metricas.push({id: "mediaEnt", label: "M√©dia Ent/Prof", color: "#10b981", bgColor: "#ecfdf5", field: "media_ent_profissional", isFloat: true});
  if(acompFiltros.valorTotal) metricas.push({id: "valorTotal", label: "Valor Total", color: "#8b5cf6", bgColor: "#faf5ff", field: "valor_total", isMoney: true});
  if(acompFiltros.valorProf) metricas.push({id: "valorProf", label: "Valor Prof", color: "#f59e0b", bgColor: "#fffbeb", field: "valor_motoboy", isMoney: true});
  if(acompFiltros.ticketMedio) metricas.push({id: "ticket", label: "Ticket M√©dio", color: "#06b6d4", bgColor: "#ecfeff", field: "ticket_medio", isMoney: true, noK: true});
  if(acompFiltros.tempoMedioEntrega) metricas.push({id: "tempoEnt", label: "Tempo Entrega", color: "#e11d48", bgColor: "#fff1f2", field: "tempo_medio_entrega", isTime: true});
  if(acompFiltros.tempoMedioAlocacao) metricas.push({id: "tempoAloc", label: "Tempo Aloca√ß√£o", color: "#ec4899", bgColor: "#fdf2f8", field: "tempo_medio_alocacao", isTime: true});
  if(acompFiltros.tempoMedioColeta) metricas.push({id: "tempoCol", label: "Tempo Coleta", color: "#d946ef", bgColor: "#fdf4ff", field: "tempo_medio_coleta", isTime: true});
  
  var alturaPorMetrica = 80;
  var alturaTotal = Math.max(metricas.length * alturaPorMetrica + 50, 150);
  var dados = acompDados.porData;
  
  // Fun√ß√£o para formatar valor
  var formatVal = function(m, val) {
    if(m.isTime) { var h = Math.floor(val/60); var mn = Math.floor(val%60); return String(h).padStart(2,"0")+":"+String(mn).padStart(2,"0"); }
    if(m.isMoney) return "R$"+(m.noK ? val.toFixed(0) : (val>=1000?(val/1000).toFixed(1)+"k":val.toFixed(0)));
    if(m.isPercent) return val.toFixed(1)+"%";
    if(m.isVariation) return (val>=0?"+":"")+val+"%";
    if(m.isFloat) return val.toFixed(1);
    return val.toString();
  };
  
  // Criar elementos
  var elementos = [];
  
  // Fundo e linhas de grade
  elementos.push(React.createElement("rect", {key: "bg", x: 0, y: 0, width: 1000, height: alturaTotal, fill: "#fafafa", rx: 8}));
  
  // Colunas verticais e datas
  dados.forEach(function(d, i) {
    var x = 80 + i * 870 / Math.max(dados.length-1, 1);
    elementos.push(React.createElement("line", {key: "vline"+i, x1: x, y1: 10, x2: x, y2: alturaTotal-40, stroke: "#e5e7eb", strokeWidth: 1}));
    elementos.push(React.createElement("text", {key: "data"+i, x: x, y: alturaTotal-20, textAnchor: "middle", fontSize: "10", fill: "#666"}, d.data_formatada));
  });
  
  // Para cada m√©trica ativa, criar sua faixa
  metricas.forEach(function(m, idx) {
    var yBase = 15 + idx * alturaPorMetrica;
    var yMid = yBase + alturaPorMetrica/2;
    var yTop = yBase + 12;
    var yBot = yBase + alturaPorMetrica - 12;
    var range = yBot - yTop;
    
    // Fundo da faixa
    elementos.push(React.createElement("rect", {key: "bg"+m.id, x: 75, y: yBase, width: 880, height: alturaPorMetrica-5, fill: m.bgColor, rx: 6}));
    
    // Label da m√©trica (vertical √† esquerda)
    elementos.push(React.createElement("text", {key: "label"+m.id, x: 70, y: yMid, textAnchor: "end", fontSize: "11", fontWeight: "bold", fill: m.color, dominantBaseline: "middle"}, m.label));
    
    // Linha horizontal de refer√™ncia (meio)
    elementos.push(React.createElement("line", {key: "hline"+m.id, x1: 80, y1: yMid, x2: 950, y2: yMid, stroke: m.color, strokeWidth: 0.5, strokeDasharray: "3,3", opacity: 0.3}));
    
    // Calcular max para normaliza√ß√£o
    var maxVal = 1;
    if(m.isPercent) {
      maxVal = 100;
    } else if(m.isVariation) {
      maxVal = Math.max.apply(null, dados.map(function(d){ return Math.abs(parseFloat(d[m.field])||0); })) || 50;
    } else {
      maxVal = Math.max.apply(null, dados.map(function(d){ return parseFloat(d[m.field])||0; })) || 1;
    }
    
    // Polyline
    var points = dados.map(function(d, i) {
      var x = 80 + i * 870 / Math.max(dados.length-1, 1);
      var val = parseFloat(d[m.field]) || 0;
      var pct;
      if(m.isVariation) {
        pct = 0.5 + (val / maxVal) * 0.4; // -100% a +100% mapeado para 0.1 a 0.9
        pct = Math.max(0.1, Math.min(0.9, pct));
      } else {
        pct = val / maxVal;
      }
      var y = yBot - pct * range;
      return x + "," + y;
    }).join(" ");
    
    elementos.push(React.createElement("polyline", {key: "line"+m.id, points: points, fill: "none", stroke: m.color, strokeWidth: "3", strokeLinecap: "round", strokeLinejoin: "round"}));
    
    // √Årea preenchida (gradiente suave)
    var areaPoints = "80," + yBot + " " + points + " " + (80 + (dados.length-1) * 870 / Math.max(dados.length-1, 1)) + "," + yBot;
    elementos.push(React.createElement("polygon", {key: "area"+m.id, points: areaPoints, fill: m.color, opacity: 0.1}));
    
    // Pontos e valores
    dados.forEach(function(d, i) {
      var x = 80 + i * 870 / Math.max(dados.length-1, 1);
      var val = parseFloat(d[m.field]) || 0;
      var pct;
      if(m.isVariation) {
        if(d[m.field] === null) return;
        pct = 0.5 + (val / maxVal) * 0.4;
        pct = Math.max(0.1, Math.min(0.9, pct));
      } else {
        pct = val / maxVal;
      }
      var y = yBot - pct * range;
      
      // Cor do ponto
      var pointColor = m.color;
      if(m.isPercent) pointColor = val >= 80 ? "#22c55e" : val >= 60 ? "#eab308" : "#ef4444";
      if(m.isVariation) pointColor = val >= 0 ? "#22c55e" : "#ef4444";
      
      elementos.push(React.createElement("circle", {key: "pt"+m.id+i, cx: x, cy: y, r: 6, fill: pointColor, stroke: "white", strokeWidth: 2}));
      elementos.push(React.createElement("text", {key: "val"+m.id+i, x: x, y: y - 12, textAnchor: "middle", fontSize: "10", fontWeight: "bold", fill: pointColor}, formatVal(m, val)));
    });
  });
  
  // Tooltip overlay (√°reas clic√°veis)
  dados.forEach(function(d, i) {
    var x = 80 + i * 870 / Math.max(dados.length-1, 1);
    elementos.push(React.createElement("rect", {
      key: "hover"+i, 
      x: x-30, 
      y: 10, 
      width: 60, 
      height: alturaTotal-50, 
      fill: "transparent", 
      style: {cursor: "pointer"},
      onMouseEnter: function(e) {
        var tooltip = document.getElementById("acomp-tooltip");
        if(tooltip) {
          var content = "<div style='font-weight:bold;margin-bottom:8px;border-bottom:1px solid #eee;padding-bottom:6px;font-size:13px'>"+d.data_formatada+"</div>";
          metricas.forEach(function(m) {
            var val = parseFloat(d[m.field]) || 0;
            if(m.isVariation && d[m.field] === null) return;
            var displayVal = formatVal(m, val);
            var valColor = m.color;
            if(m.isPercent) valColor = val >= 80 ? "#22c55e" : val >= 60 ? "#eab308" : "#ef4444";
            if(m.isVariation) valColor = val >= 0 ? "#22c55e" : "#ef4444";
            content += "<div style='display:flex;justify-content:space-between;margin:3px 0'><span style='color:"+m.color+"'>‚óè "+m.label+"</span><span style='font-weight:600;color:"+valColor+"'>"+displayVal+"</span></div>";
          });
          tooltip.innerHTML = content;
          tooltip.style.display = "block";
          tooltip.style.left = Math.min(x-110, 780)+"px";
          tooltip.style.top = "30px";
        }
      },
      onMouseLeave: function() {
        var tooltip = document.getElementById("acomp-tooltip");
        if(tooltip) tooltip.style.display = "none";
      }
    }));
  });
  
  return React.createElement("svg", {viewBox: "0 0 1000 " + alturaTotal, className: "w-full", style: {height: alturaTotal + "px", minHeight: "150px"}}, elementos);
})())), !acompLoading && acompDados && acompDados.porData && acompDados.porData.length > 0 && React.createElement("div", {className: "bg-white rounded-xl shadow-lg p-6"}, React.createElement("h3", {className: "text-lg font-bold text-gray-800 mb-4"}, "üìã Dados Detalhados"), React.createElement("div", {className: "overflow-x-auto"}, React.createElement("table", {className: "w-full text-xs"}, React.createElement("thead", null, React.createElement("tr", {className: "bg-purple-50"}, React.createElement("th", {className: "px-2 py-2 text-left"}, "Data"), React.createElement("th", {className: "px-2 py-2 text-center"}, "OS"), React.createElement("th", {className: "px-2 py-2 text-center"}, "Entregas"), React.createElement("th", {className: "px-2 py-2 text-center"}, "No Prazo"), React.createElement("th", {className: "px-2 py-2 text-center"}, "Fora"), React.createElement("th", {className: "px-2 py-2 text-center"}, "Retornos"), React.createElement("th", {className: "px-2 py-2 text-center"}, "Taxa"), React.createElement("th", {className: "px-2 py-2 text-right"}, "Valor Total"), React.createElement("th", {className: "px-2 py-2 text-right"}, "Valor Prof."), React.createElement("th", {className: "px-2 py-2 text-center"}, "Ticket"), React.createElement("th", {className: "px-2 py-2 text-center"}, "T.Entrega"), React.createElement("th", {className: "px-2 py-2 text-center"}, "Entreg."))), React.createElement("tbody", null, acompDados.porData.map(function(d,i){ var mins = parseFloat(d.tempo_medio_entrega)||0; var h = Math.floor(mins/60); var m = Math.floor(mins%60); return React.createElement("tr", {key: i, className: i%2===0?"bg-white":"bg-gray-50"}, React.createElement("td", {className: "px-2 py-1 font-medium"}, d.data_formatada), React.createElement("td", {className: "px-2 py-1 text-center font-bold text-blue-600"}, d.total_os), React.createElement("td", {className: "px-2 py-1 text-center text-sky-600"}, d.total_entregas), React.createElement("td", {className: "px-2 py-1 text-center text-green-600"}, d.dentro_prazo), React.createElement("td", {className: "px-2 py-1 text-center text-red-600"}, d.fora_prazo), React.createElement("td", {className: "px-2 py-1 text-center text-orange-600"}, d.retornos||0), React.createElement("td", {className: "px-2 py-1 text-center"}, React.createElement("span", {className: "px-1 py-0 rounded text-xs font-bold "+(parseFloat(d.taxa_prazo)>=80?"bg-green-100 text-green-700":parseFloat(d.taxa_prazo)>=60?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700")}, d.taxa_prazo+"%")), React.createElement("td", {className: "px-2 py-1 text-right text-purple-600"}, "R$", parseFloat(d.valor_total||0).toLocaleString("pt-BR",{minimumFractionDigits:0})), React.createElement("td", {className: "px-2 py-1 text-right text-amber-600"}, "R$", parseFloat(d.valor_motoboy||0).toLocaleString("pt-BR",{minimumFractionDigits:0})), React.createElement("td", {className: "px-2 py-1 text-center text-cyan-600"}, "R$", d.ticket_medio), React.createElement("td", {className: "px-2 py-1 text-center text-rose-600"}, String(h).padStart(2,"0")+":"+String(m).padStart(2,"0")), React.createElement("td", {className: "px-2 py-1 text-center text-teal-600"}, d.total_entregadores)); })))))), !acompLoading && comparativoSemanal && comparativoSemanal.semanas && comparativoSemanal.semanas.length > 0 && (function() {
  var semanas = comparativoSemanal.semanas;
  if (!semanas || semanas.length === 0) return null;
  
  // Fun√ß√£o para formatar tempo
  var fmtTempo = function(mins) {
    var m = parseFloat(mins) || 0;
    var h = Math.floor(m / 60);
    var mn = Math.floor(m % 60);
    return String(h).padStart(2, "0") + ":" + String(mn).padStart(2, "0");
  };
  
  // Definir colunas baseadas nos subfiltros - usando os campos corretos do backend
  var colunas = [];
  colunas.push({id: "periodo", label: "Semana", align: "left"});
  
  if (acompFiltros.os) colunas.push({id: "os", label: "OS", field: "total_os", color: "blue", align: "center"});
  if (acompFiltros.entregas) colunas.push({id: "entregas", label: "Entregas", field: "total_entregas", color: "sky", align: "center", showVar: true});
  if (acompFiltros.noPrazo) colunas.push({id: "prazo", label: "Taxa Prazo", field: "taxa_prazo", color: "green", align: "center", isPercent: true, showVar: true});
  if (acompFiltros.foraPrazo) colunas.push({id: "fora", label: "Fora Prazo", field: "fora_prazo", color: "red", align: "center", showVar: true, invertVar: true});
  if (acompFiltros.retornos) colunas.push({id: "retornos", label: "Retornos", field: "retornos", color: "orange", align: "center", showVar: true, invertVar: true});
  if (acompFiltros.valorTotal) colunas.push({id: "valorTotal", label: "Valor Total", field: "valor_total", color: "purple", align: "right", isMoney: true, showVar: true});
  if (acompFiltros.valorProf) colunas.push({id: "valorProf", label: "Valor Prof", field: "valor_prof", color: "amber", align: "right", isMoney: true, showVar: true});
  if (acompFiltros.ticketMedio) colunas.push({id: "ticket", label: "Ticket", field: "ticket_medio", color: "cyan", align: "center", isMoney: true, showVar: true});
  if (acompFiltros.tempoMedioEntrega) colunas.push({id: "tEntrega", label: "T.Entrega", field: "tempo_medio_entrega", color: "rose", align: "center", isTime: true, showVar: true, invertVar: true});
  if (acompFiltros.tempoMedioAlocacao) colunas.push({id: "tAlocacao", label: "T.Aloca√ß√£o", field: "tempo_medio_alocacao", color: "pink", align: "center", isTime: true, showVar: true, invertVar: true});
  if (acompFiltros.tempoMedioColeta) colunas.push({id: "tColeta", label: "T.Coleta", field: "tempo_medio_coleta", color: "fuchsia", align: "center", isTime: true, showVar: true, invertVar: true});
  if (acompFiltros.totalEntregadores) colunas.push({id: "entregadores", label: "Entregadores", field: "total_entregadores", color: "teal", align: "center", showVar: true});
  if (acompFiltros.mediaEntProfissional) colunas.push({id: "mediaEnt", label: "M√©dia/Prof", field: "media_ent_profissional", color: "emerald", align: "center", isFloat: true, showVar: true});
  
  // Se nenhum filtro selecionado, mostrar colunas padr√£o
  if (colunas.length === 1) {
    colunas.push({id: "entregas", label: "Entregas", field: "total_entregas", color: "sky", align: "center", showVar: true});
    colunas.push({id: "prazo", label: "Taxa Prazo", field: "taxa_prazo", color: "green", align: "center", isPercent: true, showVar: true});
    colunas.push({id: "valorTotal", label: "Valor", field: "valor_total", color: "purple", align: "right", isMoney: true, showVar: true});
  }
  
  // Fun√ß√£o para renderizar valor
  var renderVal = function(col, val) {
    if (col.isTime) return fmtTempo(val);
    if (col.isMoney) return "R$ " + parseFloat(val || 0).toLocaleString("pt-BR", {minimumFractionDigits: 0});
    if (col.isPercent) return (val || 0) + "%";
    if (col.isFloat) return parseFloat(val || 0).toFixed(1);
    return val || 0;
  };
  
  // Fun√ß√£o para renderizar varia√ß√£o
  var renderVar = function(col, semanaAtual, semanaAnterior, idx) {
    if (!col.showVar || idx === semanas.length - 1 || !semanaAnterior) return null;
    
    var valAtual = parseFloat(semanaAtual[col.field]) || 0;
    var valAnterior = parseFloat(semanaAnterior[col.field]) || 0;
    
    if (valAnterior === 0) return null;
    
    var varPct = ((valAtual - valAnterior) / valAnterior * 100).toFixed(1);
    var isPositive = parseFloat(varPct) >= 0;
    var isGood = col.invertVar ? !isPositive : isPositive;
    
    return React.createElement("div", {className: "text-xs font-bold " + (isGood ? "text-green-600" : "text-red-600")},
      (isPositive ? "‚Üë" : "‚Üì") + " " + Math.abs(parseFloat(varPct)) + "%"
    );
  };
  
  // Cores por tipo
  var getColorClass = function(color, type) {
    var colors = {
      blue: {bg: "bg-blue-100", text: "text-blue-700", border: "border-blue-200"},
      sky: {bg: "bg-sky-100", text: "text-sky-700", border: "border-sky-200"},
      green: {bg: "bg-green-100", text: "text-green-700", border: "border-green-200"},
      red: {bg: "bg-red-100", text: "text-red-700", border: "border-red-200"},
      orange: {bg: "bg-orange-100", text: "text-orange-700", border: "border-orange-200"},
      purple: {bg: "bg-purple-100", text: "text-purple-700", border: "border-purple-200"},
      amber: {bg: "bg-amber-100", text: "text-amber-700", border: "border-amber-200"},
      cyan: {bg: "bg-cyan-100", text: "text-cyan-700", border: "border-cyan-200"},
      rose: {bg: "bg-rose-100", text: "text-rose-700", border: "border-rose-200"},
      pink: {bg: "bg-pink-100", text: "text-pink-700", border: "border-pink-200"},
      fuchsia: {bg: "bg-fuchsia-100", text: "text-fuchsia-700", border: "border-fuchsia-200"},
      teal: {bg: "bg-teal-100", text: "text-teal-700", border: "border-teal-200"},
      emerald: {bg: "bg-emerald-100", text: "text-emerald-700", border: "border-violet-200"}
    };
    return colors[color] ? colors[color][type] : "";
  };
  
  return React.createElement("div", {className: "bg-white rounded-xl shadow-lg p-6 mt-4"},
    React.createElement("h3", {className: "text-lg font-bold text-gray-800 mb-4"}, "üìÖ Comparativo Semanal (", semanas.length, " semanas)"),
    
    // Cards de resumo da semana atual vs anterior
    semanas.length >= 2 && React.createElement("div", {className: "grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3 mb-6"},
      colunas.filter(function(c) { return c.showVar; }).slice(0, 6).map(function(col) {
        var valAtual = parseFloat(semanas[0][col.field]) || 0;
        var valAnterior = parseFloat(semanas[1][col.field]) || 0;
        var varPct = valAnterior ? ((valAtual - valAnterior) / valAnterior * 100).toFixed(1) : null;
        var isPositive = varPct && parseFloat(varPct) >= 0;
        var isGood = col.invertVar ? !isPositive : isPositive;
        
        return React.createElement("div", {key: col.id, className: "rounded-xl p-3 border " + getColorClass(col.color, "bg") + " " + getColorClass(col.color, "border")},
          React.createElement("div", {className: "text-xs font-medium mb-1 " + getColorClass(col.color, "text")}, col.label),
          React.createElement("div", {className: "text-xl font-bold " + getColorClass(col.color, "text")}, renderVal(col, valAtual)),
          varPct && React.createElement("div", {className: "text-sm font-bold " + (isGood ? "text-green-600" : "text-red-600")},
            (isPositive ? "‚Üë " : "‚Üì ") + Math.abs(parseFloat(varPct)) + "%"
          )
        );
      })
    ),
    
    // Tabela
    React.createElement("div", {className: "overflow-x-auto"},
      React.createElement("table", {className: "w-full text-xs"},
        React.createElement("thead", null,
          React.createElement("tr", {className: "bg-indigo-100"},
            colunas.map(function(col) {
              return React.createElement("th", {key: col.id, className: "px-3 py-2 text-" + col.align + " font-bold"}, col.label);
            })
          )
        ),
        React.createElement("tbody", null,
          semanas.map(function(s, i) {
            var semanaAnterior = semanas[i + 1];
            return React.createElement("tr", {key: i, className: i === 0 ? "bg-blue-50 border-l-4 border-blue-500" : (i % 2 === 0 ? "bg-white" : "bg-gray-50")},
              colunas.map(function(col) {
                if (col.id === "periodo") {
                  return React.createElement("td", {key: col.id, className: "px-3 py-2 font-medium"}, i === 0 ? "üìç " + s.periodo : s.periodo);
                }
                
                var val = s[col.field];
                var varEl = renderVar(col, s, semanaAnterior, i);
                
                return React.createElement("td", {key: col.id, className: "px-3 py-2 text-" + col.align},
                  React.createElement("div", {className: "flex flex-col items-" + (col.align === "right" ? "end" : col.align === "center" ? "center" : "start")},
                    React.createElement("span", {className: "font-bold " + getColorClass(col.color, "text")}, renderVal(col, val)),
                    varEl
                  )
                );
              })
            );
          })
        )
      )
    )
  );
})(), !acompLoading && comparativoSemanalClientes && comparativoSemanalClientes.clientes && comparativoSemanalClientes.clientes.length > 0 && // Comparativo Semanal por Cliente - Ordem din√¢mica de colunas
(function() {
  var clientes = comparativoSemanalClientes.clientes;
  if (!clientes || clientes.length === 0) return null;
  
  var fmtTempo = function(mins) {
    var m = parseFloat(mins) || 0;
    var h = Math.floor(m / 60);
    var mn = Math.floor(m % 60);
    return String(h).padStart(2, "0") + ":" + String(mn).padStart(2, "0");
  };
  
  // Mapa de configura√ß√£o das colunas
  var colunasConfig = {
    os: {id: "os", label: "OS", field: "total_os", color: "#2563eb"},
    entregas: {id: "entregas", label: "Entregas", field: "total_entregas", color: "#0ea5e9", showVar: true},
    noPrazo: {id: "prazo", label: "Taxa Prazo", field: "taxa_prazo", color: "#16a34a", isPercent: true, showVar: true},
    foraPrazo: {id: "fora", label: "Fora Prazo", field: "fora_prazo", color: "#dc2626", showVar: true, invertVar: true},
    retornos: {id: "retornos", label: "Retornos", field: "retornos", color: "#ea580c", showVar: true, invertVar: true},
    valorTotal: {id: "valorTotal", label: "Valor Total", field: "valor_total", color: "#7c3aed", isMoney: true, showVar: true},
    valorProf: {id: "valorProf", label: "Valor Prof", field: "valor_prof", color: "#d97706", isMoney: true, showVar: true},
    ticketMedio: {id: "ticket", label: "Ticket M√©dio", field: "ticket_medio", color: "#0891b2", isMoney: true},
    tempoMedioEntrega: {id: "tEntrega", label: "T. Entrega", field: "tempo_medio_entrega", color: "#e11d48", isTime: true, showVar: true, invertVar: true},
    tempoMedioAlocacao: {id: "tAlocacao", label: "T. Aloca√ß√£o", field: "tempo_medio_alocacao", color: "#db2777", isTime: true, showVar: true, invertVar: true},
    tempoMedioColeta: {id: "tColeta", label: "T. Coleta", field: "tempo_medio_coleta", color: "#c026d3", isTime: true, showVar: true, invertVar: true},
    totalEntregadores: {id: "entregadores", label: "Entregadores", field: "total_entregadores", color: "#0d9488"},
    mediaEntProfissional: {id: "mediaEnt", label: "M√©d/Prof", field: "media_ent_profissional", color: "#059669", isFloat: true}
  };
  
  // Montar colunas na ordem de sele√ß√£o
  var colunas = [];
  colunas.push({id: "periodo", label: "Semana"});
  
  // Usar acompFiltrosOrdem para manter a ordem de sele√ß√£o
  acompFiltrosOrdem.forEach(function(filtro) {
    if (acompFiltros[filtro] && colunasConfig[filtro]) {
      colunas.push(colunasConfig[filtro]);
    }
  });
  
  var temFiltros = colunas.length > 1;
  
  var renderVal = function(col, val) {
    if (col.isTime) return fmtTempo(val);
    if (col.isMoney) return "R$ " + parseFloat(val || 0).toLocaleString("pt-BR", {minimumFractionDigits: 0});
    if (col.isPercent) return (parseFloat(val) || 0).toFixed(1) + "%";
    if (col.isFloat) return parseFloat(val || 0).toFixed(1);
    return val || 0;
  };
  
  var getVar = function(col, atual, anterior) {
    if (!col.showVar || !anterior) return null;
    var valAtual = parseFloat(atual[col.field]) || 0;
    var valAnterior = parseFloat(anterior[col.field]) || 0;
    if (valAnterior === 0) return null;
    var pct = ((valAtual - valAnterior) / valAnterior * 100).toFixed(1);
    var isPositive = parseFloat(pct) >= 0;
    var isGood = col.invertVar ? !isPositive : isPositive;
    return {pct: Math.abs(parseFloat(pct)), isPositive: isPositive, isGood: isGood};
  };
  
  return React.createElement("div", {className: "bg-white rounded-xl shadow-lg p-6 mt-4"},
    React.createElement("h3", {className: "text-lg font-bold text-gray-800 mb-4"}, "üè¢ Comparativo por Cliente"),
    
    !temFiltros && React.createElement("div", {className: "text-center text-gray-400 py-8"}, "Selecione m√©tricas acima para ver os dados"),
    
    temFiltros && React.createElement("div", {className: "space-y-4"},
      clientes.map(function(cli, cliIdx) {
        return React.createElement("div", {key: cliIdx, className: "border border-gray-200 rounded-lg overflow-hidden"},
          React.createElement("div", {className: "bg-slate-700 px-4 py-2 flex justify-between items-center"},
            React.createElement("span", {className: "font-bold text-white"}, cli.nome_fantasia),
            React.createElement("div", {className: "flex gap-4 text-sm text-white/80"},
              React.createElement("span", null, cli.semanas.length, " sem"),
              React.createElement("span", null, "üì¶ ", cli.resumo.total_entregas),
              React.createElement("span", {className: cli.resumo.media_taxa_prazo >= 80 ? "text-green-300" : cli.resumo.media_taxa_prazo >= 60 ? "text-yellow-300" : "text-red-300"}, "‚úì ", cli.resumo.media_taxa_prazo, "%")
            )
          ),
          React.createElement("div", {className: "overflow-x-auto"},
            React.createElement("table", {className: "text-sm"},
              React.createElement("thead", null,
                React.createElement("tr", {className: "bg-gray-50"},
                  colunas.map(function(col, colIdx) {
                    return React.createElement("th", {
                      key: col.id, 
                      className: "px-4 py-2 text-left font-semibold text-gray-600 border-b border-gray-200 whitespace-nowrap"
                    }, col.label);
                  })
                )
              ),
              React.createElement("tbody", null,
                cli.semanas.map(function(sem, semIdx) {
                  var semAnterior = cli.semanas[semIdx + 1];
                  var isFirst = semIdx === 0;
                  
                  return React.createElement("tr", {key: semIdx, className: isFirst ? "bg-blue-50" : (semIdx % 2 === 0 ? "bg-white" : "bg-gray-50/50")},
                    colunas.map(function(col) {
                      if (col.id === "periodo") {
                        return React.createElement("td", {key: col.id, className: "px-4 py-2 font-semibold text-gray-700 whitespace-nowrap"},
                          isFirst && React.createElement("span", {className: "inline-block w-2 h-2 rounded-full bg-blue-500 mr-2"}),
                          sem.periodo
                        );
                      }
                      
                      var val = sem[col.field];
                      var varInfo = getVar(col, sem, semAnterior);
                      
                      return React.createElement("td", {key: col.id, className: "px-4 py-2 whitespace-nowrap"},
                        React.createElement("span", {className: "font-bold", style: {color: col.color}}, renderVal(col, val)),
                        varInfo && React.createElement("span", {className: "ml-2 text-xs font-semibold " + (varInfo.isGood ? "text-green-600" : "text-red-600")}, varInfo.isPositive ? "‚Üë" : "‚Üì", varInfo.pct.toFixed(1), "%")
                      );
                    })
                  );
                })
              )
            )
          )
        );
      })
    )
  );
})(), 
            
            // === SE√á√ÉO CLIENTE 767 ===
            "cliente767" === Et && React.createElement("div", {className: "space-y-4"}, 
                React.createElement("div", {className: "bg-gradient-to-r from-orange-500 to-amber-600 rounded-xl p-6 text-white"}, 
                    React.createElement("h2", {className: "text-2xl font-bold mb-2"}, "üè¢ Cliente 767 - Prazo Especial"),
                    React.createElement("p", {className: "opacity-90"}, "Prazo de entrega: 120 minutos (2 horas)"),
                    React.createElement("div", {className: "mt-3 flex flex-wrap gap-2 items-center"}, 
                        cliente767Filtros.data_inicio && React.createElement("span", {className: "px-3 py-1 bg-white/20 rounded-lg text-sm"}, "üìÖ De: ", cliente767Filtros.data_inicio),
                        cliente767Filtros.data_fim && React.createElement("span", {className: "px-3 py-1 bg-white/20 rounded-lg text-sm"}, "üìÖ At√©: ", cliente767Filtros.data_fim),
                        cliente767Filtros.centros_custo && cliente767Filtros.centros_custo.length > 0 && React.createElement("span", {className: "px-3 py-1 bg-white/20 rounded-lg text-sm"}, "üè™ ", cliente767Filtros.centros_custo.length, " CC"),
                        React.createElement("button", {onClick: function(){ setCliente767ModalFiltro(true); }, className: "px-4 py-2 bg-white/20 rounded-lg text-sm font-semibold hover:bg-white/30"}, "üîç Filtros"),
                        React.createElement("button", {onClick: carregarCliente767, className: "px-4 py-2 bg-white/20 rounded-lg text-sm font-semibold hover:bg-white/30"}, "üîÑ Recarregar")
                    )
                ),
                
                // Modal de Filtro espec√≠fico do Cliente 767
                cliente767ModalFiltro && React.createElement("div", {className: "fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4"},
                    React.createElement("div", {className: "bg-white rounded-xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto"},
                        React.createElement("div", {className: "sticky top-0 bg-orange-600 text-white px-6 py-4 rounded-t-xl flex justify-between items-center"},
                            React.createElement("h3", {className: "text-lg font-bold"}, "üîç Filtrar - Cliente 767"),
                            React.createElement("button", {onClick: function(){ setCliente767ModalFiltro(false); }, className: "text-white hover:bg-white/20 rounded-lg px-3 py-1 text-xl"}, "‚úï")
                        ),
                        React.createElement("div", {className: "p-6 space-y-4"},
                            // Filtros de Data
                            React.createElement("div", {className: "grid grid-cols-2 gap-4"},
                                React.createElement("div", null,
                                    React.createElement("label", {className: "block text-sm font-medium text-gray-700 mb-1"}, "Data In√≠cio"),
                                    React.createElement("input", {
                                        type: "date",
                                        value: cliente767Filtros.data_inicio,
                                        onChange: function(e) { setCliente767Filtros(function(f) { return {...f, data_inicio: e.target.value}; }); },
                                        className: "w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                                    })
                                ),
                                React.createElement("div", null,
                                    React.createElement("label", {className: "block text-sm font-medium text-gray-700 mb-1"}, "Data Fim"),
                                    React.createElement("input", {
                                        type: "date",
                                        value: cliente767Filtros.data_fim,
                                        onChange: function(e) { setCliente767Filtros(function(f) { return {...f, data_fim: e.target.value}; }); },
                                        className: "w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                                    })
                                )
                            ),
                            React.createElement("div", {className: "flex gap-2"},
                                React.createElement("button", {
                                    onClick: function() {
                                        var hoje = new Date();
                                        var primeiroDia = new Date(hoje.getFullYear(), hoje.getMonth(), 1).toISOString().split('T')[0];
                                        var ultimoDia = new Date(hoje.getFullYear(), hoje.getMonth() + 1, 0).toISOString().split('T')[0];
                                        setCliente767Filtros(function(f) { return {...f, data_inicio: primeiroDia, data_fim: ultimoDia}; });
                                    },
                                    className: "flex-1 px-3 py-2 bg-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-200"
                                }, "M√™s Atual"),
                                React.createElement("button", {
                                    onClick: function() {
                                        var hoje = new Date();
                                        var primeiroDia = new Date(hoje.getFullYear(), hoje.getMonth() - 1, 1).toISOString().split('T')[0];
                                        var ultimoDia = new Date(hoje.getFullYear(), hoje.getMonth(), 0).toISOString().split('T')[0];
                                        setCliente767Filtros(function(f) { return {...f, data_inicio: primeiroDia, data_fim: ultimoDia}; });
                                    },
                                    className: "flex-1 px-3 py-2 bg-purple-100 text-purple-700 rounded-lg text-sm font-medium hover:bg-purple-200"
                                }, "M√™s Anterior")
                            ),
                            
                            // Filtro de Centro de Custo
                            React.createElement("div", null,
                                React.createElement("label", {className: "block text-sm font-medium text-gray-700 mb-2"}, "üè™ Centro de Custo"),
                                React.createElement("div", {className: "border rounded-lg p-3 max-h-48 overflow-y-auto bg-gray-50"},
                                    cliente767Dados && cliente767Dados.centrosCustoDisponiveis && cliente767Dados.centrosCustoDisponiveis.length > 0 ? 
                                        React.createElement(React.Fragment, null,
                                            React.createElement("div", {className: "flex gap-2 mb-2 pb-2 border-b"},
                                                React.createElement("button", {
                                                    onClick: function() { 
                                                        setCliente767Filtros(function(f) { 
                                                            return {...f, centros_custo: cliente767Dados.centrosCustoDisponiveis.slice()}; 
                                                        }); 
                                                    },
                                                    className: "px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-medium hover:bg-green-200"
                                                }, "Selecionar Todos"),
                                                React.createElement("button", {
                                                    onClick: function() { 
                                                        setCliente767Filtros(function(f) { return {...f, centros_custo: []}; }); 
                                                    },
                                                    className: "px-2 py-1 bg-red-100 text-red-700 rounded text-xs font-medium hover:bg-red-200"
                                                }, "Limpar Sele√ß√£o")
                                            ),
                                            cliente767Dados.centrosCustoDisponiveis.map(function(cc) {
                                                var selecionado = cliente767Filtros.centros_custo.includes(cc);
                                                return React.createElement("label", {
                                                    key: cc,
                                                    className: "flex items-center gap-2 p-2 rounded cursor-pointer hover:bg-white " + (selecionado ? "bg-orange-100" : "")
                                                },
                                                    React.createElement("input", {
                                                        type: "checkbox",
                                                        checked: selecionado,
                                                        onChange: function() {
                                                            setCliente767Filtros(function(f) {
                                                                var novosCentros = selecionado 
                                                                    ? f.centros_custo.filter(function(c) { return c !== cc; })
                                                                    : f.centros_custo.concat([cc]);
                                                                return {...f, centros_custo: novosCentros};
                                                            });
                                                        },
                                                        className: "w-4 h-4 text-orange-600 rounded focus:ring-orange-500"
                                                    }),
                                                    React.createElement("span", {className: "text-sm " + (selecionado ? "font-medium text-orange-700" : "text-gray-700")}, cc)
                                                );
                                            })
                                        )
                                    : React.createElement("p", {className: "text-gray-500 text-sm text-center py-4"}, "Carregue os dados primeiro para ver os centros de custo dispon√≠veis")
                                ),
                                cliente767Filtros.centros_custo.length > 0 && React.createElement("p", {className: "text-xs text-orange-600 mt-1"}, cliente767Filtros.centros_custo.length, " centro(s) selecionado(s)")
                            ),
                            
                            // Bot√£o Limpar Tudo
                            React.createElement("button", {
                                onClick: function() { setCliente767Filtros({ data_inicio: '', data_fim: '', centros_custo: [] }); },
                                className: "w-full px-3 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200"
                            }, "üóëÔ∏è Limpar Todos os Filtros")
                        ),
                        React.createElement("div", {className: "sticky bottom-0 bg-white px-6 py-4 border-t flex gap-3"},
                            React.createElement("button", {
                                onClick: function() { setCliente767ModalFiltro(false); },
                                className: "flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50"
                            }, "Cancelar"),
                            React.createElement("button", {
                                onClick: function() { setCliente767ModalFiltro(false); carregarCliente767(); },
                                className: "flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg font-medium hover:bg-orange-700"
                            }, "Aplicar Filtros")
                        )
                    )
                ),
                
                cliente767Loading && React.createElement("div", {className: "bg-white rounded-xl shadow-lg p-12 text-center"}, 
                    React.createElement("div", {className: "animate-spin text-5xl mb-4"}, "‚è≥"), 
                    React.createElement("p", {className: "text-gray-600"}, "Carregando dados...")
                ),
                
                !cliente767Loading && cliente767Dados && cliente767Dados.metricas && React.createElement(React.Fragment, null,
                    // Cards de m√©tricas
                    React.createElement("div", {className: "grid grid-cols-2 md:grid-cols-4 gap-3"},
                        React.createElement("div", {className: "bg-white rounded-lg p-4 shadow border-l-4 border-blue-500"},
                            React.createElement("p", {className: "text-xs text-gray-500"}, "Total OS"),
                            React.createElement("p", {className: "text-2xl font-bold text-gray-800"}, cliente767Dados.metricas.total_os)
                        ),
                        React.createElement("div", {className: "bg-white rounded-lg p-4 shadow border-l-4 border-cyan-500"},
                            React.createElement("p", {className: "text-xs text-gray-500"}, "Total Entregas"),
                            React.createElement("p", {className: "text-2xl font-bold text-gray-800"}, cliente767Dados.metricas.total_entregas)
                        ),
                        React.createElement("div", {className: "bg-white rounded-lg p-4 shadow border-l-4 border-green-500"},
                            React.createElement("p", {className: "text-xs text-gray-500"}, "No Prazo (‚â§120min)"),
                            React.createElement("p", {className: "text-2xl font-bold text-green-600"}, cliente767Dados.metricas.dentro_prazo)
                        ),
                        React.createElement("div", {className: "bg-white rounded-lg p-4 shadow border-l-4 border-red-500"},
                            React.createElement("p", {className: "text-xs text-gray-500"}, "Fora Prazo (>120min)"),
                            React.createElement("p", {className: "text-2xl font-bold text-red-600"}, cliente767Dados.metricas.fora_prazo)
                        )
                    ),
                    
                    // Cards de taxa e tempo
                    React.createElement("div", {className: "grid grid-cols-2 md:grid-cols-4 gap-3"},
                        React.createElement("div", {className: "bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg p-4 shadow text-white"},
                            React.createElement("p", {className: "text-xs opacity-80"}, "Taxa No Prazo"),
                            React.createElement("p", {className: "text-3xl font-bold"}, cliente767Dados.metricas.taxa_prazo, "%")
                        ),
                        React.createElement("div", {className: "bg-gradient-to-br from-sky-500 to-blue-600 rounded-lg p-4 shadow text-white"},
                            React.createElement("p", {className: "text-xs opacity-80"}, "Tempo M√©dio Entrega"),
                            React.createElement("p", {className: "text-2xl font-bold"}, cliente767Dados.metricas.tempo_medio || "00:00")
                        ),
                        React.createElement("div", {className: "bg-gradient-to-br from-amber-500 to-orange-600 rounded-lg p-4 shadow text-white"},
                            React.createElement("p", {className: "text-xs opacity-80"}, "Tempo M√©dio Coleta"),
                            React.createElement("p", {className: "text-2xl font-bold"}, cliente767Dados.metricas.tempo_medio_coleta || "00:00")
                        ),
                        React.createElement("div", {className: "bg-gradient-to-br from-pink-500 to-rose-600 rounded-lg p-4 shadow text-white"},
                            React.createElement("p", {className: "text-xs opacity-80"}, "Tempo M√©dio Aloca√ß√£o"),
                            React.createElement("p", {className: "text-2xl font-bold"}, cliente767Dados.metricas.tempo_medio_alocacao || "00:00")
                        )
                    ),
                    
                    // Cards financeiros
                    React.createElement("div", {className: "grid grid-cols-2 md:grid-cols-4 gap-3"},
                        React.createElement("div", {className: "bg-white rounded-lg p-4 shadow border-l-4 border-purple-500"},
                            React.createElement("p", {className: "text-xs text-gray-500"}, "Valor Total"),
                            React.createElement("p", {className: "text-xl font-bold text-purple-600"}, "R$ ", parseFloat(cliente767Dados.metricas.valor_total||0).toLocaleString("pt-BR", {minimumFractionDigits: 2}))
                        ),
                        React.createElement("div", {className: "bg-white rounded-lg p-4 shadow border-l-4 border-amber-500"},
                            React.createElement("p", {className: "text-xs text-gray-500"}, "Valor Profissional"),
                            React.createElement("p", {className: "text-xl font-bold text-amber-600"}, "R$ ", parseFloat(cliente767Dados.metricas.valor_prof_total||0).toLocaleString("pt-BR", {minimumFractionDigits: 2}))
                        ),
                        React.createElement("div", {className: "bg-white rounded-lg p-4 shadow border-l-4 border-violet-500"},
                            React.createElement("p", {className: "text-xs text-gray-500"}, "Faturamento"),
                            React.createElement("p", {className: "text-xl font-bold text-violet-600"}, "R$ ", (parseFloat(cliente767Dados.metricas.valor_total||0) - parseFloat(cliente767Dados.metricas.valor_prof_total||0)).toLocaleString("pt-BR", {minimumFractionDigits: 2}))
                        ),
                        React.createElement("div", {className: "bg-white rounded-lg p-4 shadow border-l-4 border-teal-500"},
                            React.createElement("p", {className: "text-xs text-gray-500"}, "Entregadores"),
                            React.createElement("p", {className: "text-xl font-bold text-teal-600"}, cliente767Dados.metricas.total_profissionais)
                        )
                    ),
                    
                    // =============================================
                    // INDICADOR DE META MENSAL
                    // =============================================
                    cliente767Dados.indicadorMeta && React.createElement("div", {className: "bg-gradient-to-r " + (cliente767Dados.indicadorMeta.meta_atingivel ? (cliente767Dados.indicadorMeta.taxa_minima_restante <= 0 ? "from-green-500 to-emerald-600" : "from-blue-500 to-indigo-600") : "from-red-500 to-rose-600") + " rounded-xl p-5 text-white shadow-lg"},
                        React.createElement("div", {className: "flex items-center justify-between mb-4"},
                            React.createElement("h3", {className: "text-lg font-bold flex items-center gap-2"}, "üéØ Meta Mensal de 95%"),
                            React.createElement("span", {className: "text-sm opacity-80"}, cliente767Dados.indicadorMeta.mes_referencia)
                        ),
                        React.createElement("div", {className: "grid grid-cols-2 md:grid-cols-4 gap-4 mb-4"},
                            React.createElement("div", {className: "bg-white/20 rounded-lg p-3"},
                                React.createElement("p", {className: "text-xs opacity-80"}, "Taxa Atual"),
                                React.createElement("p", {className: "text-2xl font-bold"}, cliente767Dados.indicadorMeta.taxa_atual, "%")
                            ),
                            React.createElement("div", {className: "bg-white/20 rounded-lg p-3"},
                                React.createElement("p", {className: "text-xs opacity-80"}, "Dias Restantes"),
                                React.createElement("p", {className: "text-2xl font-bold"}, cliente767Dados.indicadorMeta.dias_restantes)
                            ),
                            React.createElement("div", {className: "bg-white/20 rounded-lg p-3"},
                                React.createElement("p", {className: "text-xs opacity-80"}, "No Prazo / Total"),
                                React.createElement("p", {className: "text-xl font-bold"}, cliente767Dados.indicadorMeta.dentro_prazo_ate_agora, " / ", cliente767Dados.indicadorMeta.total_entregas_ate_agora)
                            ),
                            React.createElement("div", {className: "bg-white/20 rounded-lg p-3"},
                                React.createElement("p", {className: "text-xs opacity-80"}, "Taxa M√≠nima Necess√°ria"),
                                React.createElement("p", {className: "text-2xl font-bold"}, cliente767Dados.indicadorMeta.taxa_minima_restante > 100 ? ">100" : cliente767Dados.indicadorMeta.taxa_minima_restante, "%")
                            )
                        ),
                        React.createElement("div", {className: "bg-white/10 rounded-lg p-3"},
                            React.createElement("div", {className: "flex items-center gap-2"},
                                React.createElement("span", {className: "text-2xl"}, cliente767Dados.indicadorMeta.meta_atingivel ? (cliente767Dados.indicadorMeta.taxa_minima_restante <= 0 ? "‚úÖ" : "üìä") : "‚ö†Ô∏è"),
                                React.createElement("div", null,
                                    React.createElement("p", {className: "font-bold"}, cliente767Dados.indicadorMeta.mensagem),
                                    cliente767Dados.indicadorMeta.dias_restantes > 0 && cliente767Dados.indicadorMeta.taxa_minima_restante > 0 && cliente767Dados.indicadorMeta.taxa_minima_restante <= 100 && React.createElement("p", {className: "text-sm opacity-80"}, "Faltam ", cliente767Dados.indicadorMeta.entregas_no_prazo_faltam, " entregas no prazo de ~", cliente767Dados.indicadorMeta.entregas_estimadas_restantes, " estimadas")
                                )
                            )
                        )
                    ),
                    
                    // =============================================
                    // TABELA POR CENTRO DE CUSTO
                    // =============================================
                    cliente767Dados.porCentroCusto && cliente767Dados.porCentroCusto.length > 0 && React.createElement("div", {className: "bg-white rounded-xl shadow-lg p-4"},
                        React.createElement("h3", {className: "text-lg font-bold text-gray-800 mb-4"}, "üè™ Desempenho por Centro de Custo"),
                        React.createElement("div", {className: "overflow-x-auto"},
                            React.createElement("table", {className: "w-full text-sm"},
                                React.createElement("thead", null,
                                    React.createElement("tr", {className: "bg-purple-50"},
                                        React.createElement("th", {className: "px-3 py-2 text-left font-bold"}, "Centro de Custo"),
                                        React.createElement("th", {className: "px-3 py-2 text-center font-bold"}, "OS"),
                                        React.createElement("th", {className: "px-3 py-2 text-center font-bold"}, "Entregas"),
                                        React.createElement("th", {className: "px-3 py-2 text-center font-bold text-green-700"}, "No Prazo"),
                                        React.createElement("th", {className: "px-3 py-2 text-center font-bold text-red-700"}, "Fora Prazo"),
                                        React.createElement("th", {className: "px-3 py-2 text-center font-bold"}, "Taxa")
                                    )
                                ),
                                React.createElement("tbody", null,
                                    cliente767Dados.porCentroCusto.map(function(cc, i) {
                                        var taxa = parseFloat(cc.taxa_prazo) || 0;
                                        return React.createElement("tr", {key: i, className: i%2===0?"bg-white":"bg-gray-50"},
                                            React.createElement("td", {className: "px-3 py-2 font-medium"}, cc.centro_custo),
                                            React.createElement("td", {className: "px-3 py-2 text-center text-blue-600 font-bold"}, cc.total_os),
                                            React.createElement("td", {className: "px-3 py-2 text-center text-sky-600"}, cc.total_entregas),
                                            React.createElement("td", {className: "px-3 py-2 text-center text-green-600 font-medium"}, cc.dentro_prazo),
                                            React.createElement("td", {className: "px-3 py-2 text-center text-red-600 font-medium"}, cc.fora_prazo),
                                            React.createElement("td", {className: "px-3 py-2 text-center"},
                                                React.createElement("span", {className: "px-2 py-1 rounded text-xs font-bold " + (taxa >= 95 ? "bg-green-100 text-green-700" : taxa >= 80 ? "bg-yellow-100 text-yellow-700" : "bg-red-100 text-red-700")}, cc.taxa_prazo + "%")
                                            )
                                        );
                                    })
                                )
                            )
                        )
                    ),
                    
                    // Tabela por data
                    cliente767Dados.porData && cliente767Dados.porData.length > 0 && React.createElement("div", {className: "bg-white rounded-xl shadow-lg p-4"},
                        React.createElement("h3", {className: "text-lg font-bold text-gray-800 mb-4"}, "üìÖ Evolu√ß√£o Di√°ria"),
                        React.createElement("div", {className: "overflow-x-auto"},
                            React.createElement("table", {className: "w-full text-xs"},
                                React.createElement("thead", null,
                                    React.createElement("tr", {className: "bg-orange-50"},
                                        React.createElement("th", {className: "px-2 py-2 text-left"}, "Data"),
                                        React.createElement("th", {className: "px-2 py-2 text-center"}, "OS"),
                                        React.createElement("th", {className: "px-2 py-2 text-center"}, "Entregas"),
                                        React.createElement("th", {className: "px-2 py-2 text-center"}, "No Prazo"),
                                        React.createElement("th", {className: "px-2 py-2 text-center"}, "Fora"),
                                        React.createElement("th", {className: "px-2 py-2 text-center"}, "Taxa"),
                                        React.createElement("th", {className: "px-2 py-2 text-center"}, "T.Entrega"),
                                        React.createElement("th", {className: "px-2 py-2 text-right"}, "Valor")
                                    )
                                ),
                                React.createElement("tbody", null,
                                    cliente767Dados.porData.map(function(d, i) {
                                        var mins = parseFloat(d.tempo_medio_entrega)||0;
                                        var h = Math.floor(mins/60);
                                        var m = Math.floor(mins%60);
                                        return React.createElement("tr", {key: i, className: i%2===0?"bg-white":"bg-gray-50"},
                                            React.createElement("td", {className: "px-2 py-1 font-medium"}, d.data_formatada),
                                            React.createElement("td", {className: "px-2 py-1 text-center font-bold text-blue-600"}, d.total_os),
                                            React.createElement("td", {className: "px-2 py-1 text-center text-sky-600"}, d.total_entregas),
                                            React.createElement("td", {className: "px-2 py-1 text-center text-green-600"}, d.dentro_prazo),
                                            React.createElement("td", {className: "px-2 py-1 text-center text-red-600"}, d.fora_prazo),
                                            React.createElement("td", {className: "px-2 py-1 text-center"},
                                                React.createElement("span", {className: "px-1 py-0 rounded text-xs font-bold " + (parseFloat(d.taxa_prazo)>=80?"bg-green-100 text-green-700":parseFloat(d.taxa_prazo)>=60?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700")}, d.taxa_prazo + "%")
                                            ),
                                            React.createElement("td", {className: "px-2 py-1 text-center text-rose-600"}, String(h).padStart(2,"0")+":"+String(m).padStart(2,"0")),
                                            React.createElement("td", {className: "px-2 py-1 text-right text-purple-600"}, "R$", parseFloat(d.valor_total||0).toLocaleString("pt-BR", {minimumFractionDigits: 0}))
                                        );
                                    })
                                )
                            )
                        )
                    )
                ),
                
                !cliente767Loading && !cliente767Dados && React.createElement("div", {className: "bg-orange-50 border-2 border-orange-200 rounded-xl p-8 text-center"},
                    React.createElement("div", {className: "text-5xl mb-4"}, "üè¢"),
                    React.createElement("p", {className: "text-orange-800 font-semibold mb-4"}, "Clique para carregar dados do Cliente 767"),
                    React.createElement("button", {onClick: carregarCliente767, className: "px-6 py-3 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700"}, "üîÑ Carregar Dados")
                )
            ),
            
            "profissionais" === Et && React.createElement("div", {
                className: "bg-white rounded-lg shadow overflow-hidden"
            }, React.createElement("div", {
                className: "bg-purple-100 px-4 py-3 flex justify-between items-center"
            }, React.createElement("h3", {
                className: "font-bold text-purple-900"
            }, "An√°lise por Profissional"), React.createElement("span", {
                className: "text-sm text-purple-700"
            }, Vt.filter(e => parseInt(e.total_entregas) > 0).length, " profissional(is)")), React.createElement("div", {
                className: "overflow-x-auto"
            }, React.createElement("table", {
                className: "w-full text-sm"
            }, React.createElement("thead", {
                className: "bg-purple-50"
            }, React.createElement("tr", null, React.createElement("th", {
                className: "px-3 py-2 text-left text-purple-900 w-10"
            }), React.createElement("th", {
                className: "px-3 py-2 text-left text-purple-900"
            }, "Profissional"), React.createElement("th", {
                className: "px-3 py-2 text-right text-purple-900"
            }, "Entregas"), React.createElement("th", {
                className: "px-3 py-2 text-right text-purple-900"
            }, "T.Aloca√ß√£o"), React.createElement("th", {
                className: "px-3 py-2 text-right text-purple-900"
            }, "T.Coleta"), React.createElement("th", {
                className: "px-3 py-2 text-right text-purple-900"
            }, "T.Entrega"), React.createElement("th", {
                className: "px-3 py-2 text-center text-purple-900 bg-green-50"
            }, "‚úÖ No Prazo"), React.createElement("th", {
                className: "px-3 py-2 text-center text-purple-900 bg-red-50"
            }, "‚ùå Fora Prazo"), React.createElement("th", {
                className: "px-3 py-2 text-center text-purple-900 bg-violet-50"
            }, "‚úÖ No Prazo Prof"), React.createElement("th", {
                className: "px-3 py-2 text-center text-purple-900 bg-orange-50"
            }, "‚ùå Fora Prazo Prof"), React.createElement("th", {
                className: "px-3 py-2 text-right text-purple-900"
            }, "Dist√¢ncia"), React.createElement("th", {
                className: "px-3 py-2 text-right text-purple-900"
            }, "Retorno"), React.createElement("th", {
                className: "px-3 py-2 text-right text-purple-900"
            }, "Valor"))), React.createElement("tbody", null, 
                // Pagina√ß√£o: 20 por p√°gina - filtrar apenas profissionais com dados
                Vt.filter(e => parseInt(e.total_entregas) > 0).slice((profPaginaAtual - 1) * 20, profPaginaAtual * 20).map((e, t) => {
                    var indexReal = (profPaginaAtual - 1) * 20 + t;
                    var expandido = Kt["prof-" + indexReal];
                    var osDoProf = profOsExpandido[e.cod_prof] || [];
                    var carregandoOS = profOsLoading === e.cod_prof;
                    var pctDentro = (nl(e.dentro_prazo) / (nl(e.total_entregas) || 1) * 100);
                    var pctFora = (nl(e.fora_prazo) / (nl(e.total_entregas) || 1) * 100);
                    var pctDentroProf = (nl(e.dentro_prazo_prof) / (nl(e.total_entregas) || 1) * 100);
                    var pctForaProf = (nl(e.fora_prazo_prof) / (nl(e.total_entregas) || 1) * 100);
                    return React.createElement(React.Fragment, {key: indexReal},
                        React.createElement("tr", {
                            className: "border-b hover:bg-purple-50 " + (t % 2 == 0 ? "bg-white" : "bg-gray-50")
                        }, 
                            React.createElement("td", {className: "px-3 py-2"}, 
                                React.createElement("button", {
                                    onClick: function() { toggleProfissionalExpand(e.cod_prof, indexReal); },
                                    className: "text-purple-600 hover:text-purple-800 font-bold"
                                }, expandido ? "‚ûñ" : "‚ûï")
                            ), 
                            React.createElement("td", {className: "px-3 py-2 font-medium"}, e.cod_prof, " - ", e.nome_prof), 
                            React.createElement("td", {className: "px-3 py-2 text-right font-bold text-blue-600"}, nl(e.total_entregas).toLocaleString("pt-BR")), 
                            React.createElement("td", {className: "px-3 py-2 text-right text-pink-600"}, cl(e.tempo_alocado)), 
                            React.createElement("td", {className: "px-3 py-2 text-right text-fuchsia-600"}, cl(e.tempo_coleta)), 
                            React.createElement("td", {className: "px-3 py-2 text-right text-rose-600"}, cl(e.tempo_medio)), 
                            React.createElement("td", {className: "px-3 py-2 text-center bg-green-50"}, 
                                React.createElement("div", {className: "text-green-700 font-bold"}, nl(e.dentro_prazo).toLocaleString("pt-BR")),
                                React.createElement("span", {className: "px-2 py-0.5 rounded text-xs font-bold " + (pctDentro >= 80 ? "bg-green-100 text-green-700" : pctDentro >= 60 ? "bg-yellow-100 text-yellow-700" : "bg-red-100 text-red-700")}, pctDentro.toFixed(1), "%")
                            ), 
                            React.createElement("td", {className: "px-3 py-2 text-center bg-red-50"}, 
                                React.createElement("div", {className: "text-red-700 font-bold"}, nl(e.fora_prazo).toLocaleString("pt-BR")),
                                React.createElement("span", {className: "text-xs text-red-500"}, pctFora.toFixed(1), "%")
                            ), 
                            React.createElement("td", {className: "px-3 py-2 text-center bg-violet-50"}, 
                                React.createElement("div", {className: "text-emerald-700 font-bold"}, nl(e.dentro_prazo_prof || 0).toLocaleString("pt-BR")),
                                React.createElement("span", {className: "px-2 py-0.5 rounded text-xs font-bold " + (pctDentroProf >= 80 ? "bg-violet-100 text-violet-700" : pctDentroProf >= 60 ? "bg-yellow-100 text-yellow-700" : "bg-red-100 text-red-700")}, pctDentroProf.toFixed(1), "%")
                            ), 
                            React.createElement("td", {className: "px-3 py-2 text-center bg-orange-50"}, 
                                React.createElement("div", {className: "text-orange-700 font-bold"}, nl(e.fora_prazo_prof || 0).toLocaleString("pt-BR")),
                                React.createElement("span", {className: "text-xs text-orange-500"}, pctForaProf.toFixed(1), "%")
                            ), 
                            React.createElement("td", {className: "px-3 py-2 text-right text-gray-600"}, parseFloat(e.distancia_total || 0).toLocaleString("pt-BR", {maximumFractionDigits: 1}), " km"), 
                            React.createElement("td", {className: "px-3 py-2 text-right text-orange-600"}, e.retornos || 0), 
                            React.createElement("td", {className: "px-3 py-2 text-right text-purple-600 font-medium"}, sl(e.valor_prof))
                        ),
                        // Linha expandida com tabela de OS
                        expandido && React.createElement("tr", {className: "bg-blue-50"},
                            React.createElement("td", {colSpan: "13", className: "px-4 py-3"},
                                carregandoOS ? 
                                    React.createElement("div", {className: "text-center py-4"},
                                        React.createElement("span", {className: "animate-spin inline-block mr-2"}, "‚è≥"),
                                        "Carregando OS..."
                                    ) :
                                osDoProf.length > 0 ?
                                    React.createElement("div", null,
                                        React.createElement("h4", {className: "font-bold text-blue-800 mb-2"}, "üìã OS Realizadas (", osDoProf.length, ")"),
                                        React.createElement("div", {className: "overflow-x-auto max-h-64 overflow-y-auto"},
                                            React.createElement("table", {className: "w-full text-xs"},
                                                React.createElement("thead", {className: "bg-blue-100 sticky top-0"},
                                                    React.createElement("tr", null,
                                                        React.createElement("th", {className: "px-2 py-1 text-left"}, "OS"),
                                                        React.createElement("th", {className: "px-2 py-1 text-left"}, "Cliente"),
                                                        React.createElement("th", {className: "px-2 py-1 text-left"}, "Centro Custo"),
                                                        React.createElement("th", {className: "px-2 py-1 text-center"}, "Data"),
                                                        React.createElement("th", {className: "px-2 py-1 text-center"}, "T.Aloca√ß√£o"),
                                                        React.createElement("th", {className: "px-2 py-1 text-center"}, "T.Coleta"),
                                                        React.createElement("th", {className: "px-2 py-1 text-center"}, "T.Entrega"),
                                                        React.createElement("th", {className: "px-2 py-1 text-center"}, "Dist."),
                                                        React.createElement("th", {className: "px-2 py-1 text-center"}, "Status"),
                                                        React.createElement("th", {className: "px-2 py-1 text-right"}, "Valor")
                                                    )
                                                ),
                                                React.createElement("tbody", null,
                                                    osDoProf.map(function(os, idx) {
                                                        return React.createElement("tr", {key: os.os + "-" + idx, className: idx % 2 === 0 ? "bg-white" : "bg-blue-50/50"},
                                                            React.createElement("td", {className: "px-2 py-1 font-mono font-bold text-blue-700"}, os.os),
                                                            React.createElement("td", {className: "px-2 py-1"}, os.cod_cliente, " - ", (os.cliente || "").substring(0, 20)),
                                                            React.createElement("td", {className: "px-2 py-1 text-gray-600"}, (os.centro_custo || "-").substring(0, 15)),
                                                            React.createElement("td", {className: "px-2 py-1 text-center"}, os.data_solicitado ? new Date(os.data_solicitado).toLocaleDateString("pt-BR") : "-"),
                                                            React.createElement("td", {className: "px-2 py-1 text-center text-pink-600"}, os.tempo_alocacao ? (Math.floor(os.tempo_alocacao / 60) + ":" + String(Math.round(os.tempo_alocacao) % 60).padStart(2, "0")) : "-"),
                                                            React.createElement("td", {className: "px-2 py-1 text-center text-fuchsia-600"}, os.tempo_coleta ? (Math.floor(os.tempo_coleta / 60) + ":" + String(Math.round(os.tempo_coleta) % 60).padStart(2, "0")) : "-"),
                                                            React.createElement("td", {className: "px-2 py-1 text-center text-rose-600"}, os.tempo_entrega ? (Math.floor(os.tempo_entrega / 60) + ":" + String(Math.round(os.tempo_entrega) % 60).padStart(2, "0")) : "-"),
                                                            React.createElement("td", {className: "px-2 py-1 text-center"}, (os.distancia || 0).toFixed(1), "km"),
                                                            React.createElement("td", {className: "px-2 py-1 text-center"},
                                                                React.createElement("span", {className: "px-1 py-0.5 rounded text-xs font-bold " + (os.dentro_prazo === true ? "bg-green-100 text-green-700" : os.dentro_prazo === false ? "bg-red-100 text-red-700" : "bg-gray-100 text-gray-600")}, os.dentro_prazo === true ? "‚úì" : os.dentro_prazo === false ? "‚úó" : "?")
                                                            ),
                                                            React.createElement("td", {className: "px-2 py-1 text-right text-purple-600"}, "R$", (os.valor_prof || 0).toFixed(2))
                                                        );
                                                    })
                                                )
                                            )
                                        )
                                    ) :
                                    React.createElement("div", {className: "text-center py-4 text-gray-500"}, "Nenhuma OS encontrada para este per√≠odo")
                            )
                        )
                    );
                })
            ), React.createElement("tfoot", {
                className: "bg-purple-200 font-bold"
            }, React.createElement("tr", null, 
                React.createElement("td", {className: "px-3 py-2"}), 
                React.createElement("td", {className: "px-3 py-2"}, "Total (", Vt.filter(e => parseInt(e.total_entregas) > 0).length, " prof.)"), 
                React.createElement("td", {className: "px-3 py-2 text-right"}, Vt.reduce((e, t) => e + nl(t.total_entregas), 0).toLocaleString("pt-BR")), 
                // M√©dia T.Aloca√ß√£o - usar m√©tricas globais (ft) que s√£o calculadas corretamente pelo SQL
                React.createElement("td", {className: "px-3 py-2 text-right text-pink-700"}, cl(ft?.tempo_medio_alocacao)), 
                // M√©dia T.Coleta - usar m√©tricas globais (ft)
                React.createElement("td", {className: "px-3 py-2 text-right text-fuchsia-700"}, cl(ft?.tempo_medio_coleta)), 
                // M√©dia T.Entrega - usar m√©tricas globais (ft)
                React.createElement("td", {className: "px-3 py-2 text-right text-rose-700"}, cl(ft?.tempo_medio)), 
                // No Prazo - qtd + %
                React.createElement("td", {className: "px-3 py-2 text-center bg-green-100"}, (function() {
                    var totalDentro = Vt.reduce((e, t) => e + nl(t.dentro_prazo), 0);
                    var totalFora = Vt.reduce((e, t) => e + nl(t.fora_prazo), 0);
                    var total = totalDentro + totalFora;
                    var pct = total > 0 ? (totalDentro / total * 100).toFixed(1) : "0.0";
                    return React.createElement("div", null,
                        React.createElement("div", {className: "text-green-800"}, totalDentro.toLocaleString("pt-BR")),
                        React.createElement("span", {className: "px-2 py-0.5 rounded text-xs font-bold " + (pct >= 80 ? "bg-green-200 text-green-800" : pct >= 60 ? "bg-yellow-100 text-yellow-700" : "bg-red-100 text-red-700")}, pct + "%")
                    );
                })()), 
                // Fora Prazo - qtd + %
                React.createElement("td", {className: "px-3 py-2 text-center bg-red-100"}, (function() {
                    var totalDentro = Vt.reduce((e, t) => e + nl(t.dentro_prazo), 0);
                    var totalFora = Vt.reduce((e, t) => e + nl(t.fora_prazo), 0);
                    var total = totalDentro + totalFora;
                    var pct = total > 0 ? (totalFora / total * 100).toFixed(1) : "0.0";
                    return React.createElement("div", null,
                        React.createElement("div", {className: "text-red-800"}, totalFora.toLocaleString("pt-BR")),
                        React.createElement("span", {className: "text-xs text-red-600"}, pct + "%")
                    );
                })()), 
                // No Prazo Prof - qtd + %
                React.createElement("td", {className: "px-3 py-2 text-center bg-emerald-100"}, (function() {
                    var totalDentroProf = Vt.reduce((e, t) => e + nl(t.dentro_prazo_prof || 0), 0);
                    var totalForaProf = Vt.reduce((e, t) => e + nl(t.fora_prazo_prof || 0), 0);
                    var total = totalDentroProf + totalForaProf;
                    var pct = total > 0 ? (totalDentroProf / total * 100).toFixed(1) : "0.0";
                    return React.createElement("div", null,
                        React.createElement("div", {className: "text-violet-800"}, totalDentroProf.toLocaleString("pt-BR")),
                        React.createElement("span", {className: "px-2 py-0.5 rounded text-xs font-bold " + (pct >= 80 ? "bg-violet-200 text-violet-800" : pct >= 60 ? "bg-yellow-100 text-yellow-700" : "bg-red-100 text-red-700")}, pct + "%")
                    );
                })()), 
                // Fora Prazo Prof - qtd + %
                React.createElement("td", {className: "px-3 py-2 text-center bg-orange-100"}, (function() {
                    var totalDentroProf = Vt.reduce((e, t) => e + nl(t.dentro_prazo_prof || 0), 0);
                    var totalForaProf = Vt.reduce((e, t) => e + nl(t.fora_prazo_prof || 0), 0);
                    var total = totalDentroProf + totalForaProf;
                    var pct = total > 0 ? (totalForaProf / total * 100).toFixed(1) : "0.0";
                    return React.createElement("div", null,
                        React.createElement("div", {className: "text-orange-800"}, totalForaProf.toLocaleString("pt-BR")),
                        React.createElement("span", {className: "text-xs text-orange-600"}, pct + "%")
                    );
                })()), 
                React.createElement("td", {className: "px-3 py-2 text-right"}, Vt.reduce((e, t) => e + parseFloat(t.distancia_total || 0), 0).toLocaleString("pt-BR", {maximumFractionDigits: 1}), " km"), 
                React.createElement("td", {className: "px-3 py-2 text-right"}, Vt.reduce((e, t) => e + nl(t.retornos || 0), 0)), 
                React.createElement("td", {className: "px-3 py-2 text-right"}, sl(Vt.reduce((e, t) => e + nl(t.valor_prof), 0)))
            )))),
            // Pagina√ß√£o
            Vt.length > 20 && React.createElement("div", {className: "bg-purple-50 px-4 py-3 flex justify-center items-center gap-2"},
                React.createElement("button", {
                    onClick: function() { setProfPaginaAtual(1); },
                    disabled: profPaginaAtual === 1,
                    className: "px-3 py-1 rounded " + (profPaginaAtual === 1 ? "bg-gray-200 text-gray-400" : "bg-purple-600 text-white hover:bg-purple-700")
                }, "¬´"),
                React.createElement("button", {
                    onClick: function() { setProfPaginaAtual(Math.max(1, profPaginaAtual - 1)); },
                    disabled: profPaginaAtual === 1,
                    className: "px-3 py-1 rounded " + (profPaginaAtual === 1 ? "bg-gray-200 text-gray-400" : "bg-purple-600 text-white hover:bg-purple-700")
                }, "‚Äπ"),
                Array.from({length: Math.ceil(Vt.length / 20)}, function(_, i) { return i + 1; })
                    .filter(function(p) { return p === 1 || p === Math.ceil(Vt.length / 20) || Math.abs(p - profPaginaAtual) <= 2; })
                    .map(function(p, idx, arr) {
                        var showEllipsis = idx > 0 && p - arr[idx - 1] > 1;
                        return React.createElement(React.Fragment, {key: p},
                            showEllipsis && React.createElement("span", {className: "px-2 text-gray-500"}, "..."),
                            React.createElement("button", {
                                onClick: function() { setProfPaginaAtual(p); },
                                className: "px-3 py-1 rounded " + (profPaginaAtual === p ? "bg-purple-800 text-white font-bold" : "bg-purple-100 text-purple-700 hover:bg-purple-200")
                            }, p)
                        );
                    }),
                React.createElement("button", {
                    onClick: function() { setProfPaginaAtual(Math.min(Math.ceil(Vt.length / 20), profPaginaAtual + 1)); },
                    disabled: profPaginaAtual === Math.ceil(Vt.length / 20),
                    className: "px-3 py-1 rounded " + (profPaginaAtual === Math.ceil(Vt.length / 20) ? "bg-gray-200 text-gray-400" : "bg-purple-600 text-white hover:bg-purple-700")
                }, "‚Ä∫"),
                React.createElement("button", {
                    onClick: function() { setProfPaginaAtual(Math.ceil(Vt.length / 20)); },
                    disabled: profPaginaAtual === Math.ceil(Vt.length / 20),
                    className: "px-3 py-1 rounded " + (profPaginaAtual === Math.ceil(Vt.length / 20) ? "bg-gray-200 text-gray-400" : "bg-purple-600 text-white hover:bg-purple-700")
                }, "¬ª"),
                React.createElement("span", {className: "ml-4 text-sm text-purple-700"}, "P√°gina ", profPaginaAtual, " de ", Math.ceil(Vt.length / 20))
            )), 
            
            // ==================== ABA GARANTIDO ====================
            "garantido" === Et && React.createElement("div", {className: "space-y-4"},
                // Header
                React.createElement("div", {className: "bg-gradient-to-r from-green-600 to-emerald-800 rounded-xl p-6 text-white"},
                    React.createElement("div", {className: "flex justify-between items-center"},
                        React.createElement("div", null,
                            React.createElement("h2", {className: "text-2xl font-bold mb-2"}, "üí∞ An√°lise M√≠nimo Garantido"),
                            React.createElement("p", {className: "opacity-80"}, "Comparativo entre valor negociado e produ√ß√£o real dos profissionais")
                        ),
                        React.createElement("button", {
                            onClick: carregarGarantido,
                            disabled: garantidoLoading,
                            className: "px-4 py-2 bg-white/20 rounded-lg hover:bg-white/30 disabled:opacity-50"
                        }, garantidoLoading ? "üîÑ Carregando..." : "üîÑ Atualizar")
                    )
                ),
                
                // Filtros
                React.createElement("div", {className: "bg-white rounded-xl shadow-lg p-4"},
                    React.createElement("div", {className: "grid grid-cols-2 md:grid-cols-5 gap-4"},
                        React.createElement("div", null,
                            React.createElement("label", {className: "block text-xs font-semibold text-gray-600 mb-1"}, "Data In√≠cio"),
                            React.createElement("input", {
                                type: "date",
                                value: garantidoFiltros.data_inicio,
                                onChange: (e) => setGarantidoFiltros(f => ({...f, data_inicio: e.target.value})),
                                className: "w-full px-3 py-2 border rounded-lg text-sm"
                            })
                        ),
                        React.createElement("div", null,
                            React.createElement("label", {className: "block text-xs font-semibold text-gray-600 mb-1"}, "Data Fim"),
                            React.createElement("input", {
                                type: "date",
                                value: garantidoFiltros.data_fim,
                                onChange: (e) => setGarantidoFiltros(f => ({...f, data_fim: e.target.value})),
                                className: "w-full px-3 py-2 border rounded-lg text-sm"
                            })
                        ),
                        React.createElement("div", null,
                            React.createElement("label", {className: "block text-xs font-semibold text-gray-600 mb-1"}, "C√≥d. Cliente"),
                            React.createElement("input", {
                                type: "text",
                                placeholder: "Ex: 767",
                                value: garantidoFiltros.cod_cliente,
                                onChange: (e) => setGarantidoFiltros(f => ({...f, cod_cliente: e.target.value})),
                                className: "w-full px-3 py-2 border rounded-lg text-sm"
                            })
                        ),
                        React.createElement("div", null,
                            React.createElement("label", {className: "block text-xs font-semibold text-gray-600 mb-1"}, "C√≥d. Profissional"),
                            React.createElement("input", {
                                type: "text",
                                placeholder: "Ex: 12345",
                                value: garantidoFiltros.cod_prof,
                                onChange: (e) => setGarantidoFiltros(f => ({...f, cod_prof: e.target.value})),
                                className: "w-full px-3 py-2 border rounded-lg text-sm"
                            })
                        ),
                        React.createElement("div", {className: "flex items-end"},
                            React.createElement("button", {
                                onClick: carregarGarantido,
                                className: "w-full px-4 py-2 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700"
                            }, "üîç Filtrar")
                        )
                    ),
                    // Filtros de status
                    React.createElement("div", {className: "flex flex-wrap gap-2 mt-4"},
                        React.createElement("button", {
                            onClick: () => { setGarantidoFiltros(f => ({...f, filtro_status: 'todos'})); setTimeout(carregarGarantido, 100); },
                            className: "px-4 py-2 rounded-lg text-sm font-semibold " + 
                                (garantidoFiltros.filtro_status === 'todos' ? 'bg-gray-800 text-white' : 'bg-gray-100 text-gray-600 hover:bg-gray-200')
                        }, "üìã Todos"),
                        React.createElement("button", {
                            onClick: () => { setGarantidoFiltros(f => ({...f, filtro_status: 'abaixo'})); setTimeout(carregarGarantido, 100); },
                            className: "px-4 py-2 rounded-lg text-sm font-semibold " + 
                                (garantidoFiltros.filtro_status === 'abaixo' ? 'bg-red-600 text-white' : 'bg-red-100 text-red-600 hover:bg-red-200')
                        }, "üî¥ Abaixo Garantido"),
                        React.createElement("button", {
                            onClick: () => { setGarantidoFiltros(f => ({...f, filtro_status: 'acima'})); setTimeout(carregarGarantido, 100); },
                            className: "px-4 py-2 rounded-lg text-sm font-semibold " + 
                                (garantidoFiltros.filtro_status === 'acima' ? 'bg-green-600 text-white' : 'bg-green-100 text-green-600 hover:bg-green-200')
                        }, "üü¢ Acima Garantido"),
                        React.createElement("button", {
                            onClick: () => { setGarantidoFiltros(f => ({...f, filtro_status: 'nao_rodou'})); setTimeout(carregarGarantido, 100); },
                            className: "px-4 py-2 rounded-lg text-sm font-semibold " + 
                                (garantidoFiltros.filtro_status === 'nao_rodou' ? 'bg-gray-600 text-white' : 'bg-gray-200 text-gray-600 hover:bg-gray-300')
                        }, "‚ö´ N√£o Rodou"),
                        React.createElement("button", {
                            onClick: () => { setGarantidoFiltros(f => ({...f, filtro_status: 'rodou'})); setTimeout(carregarGarantido, 100); },
                            className: "px-4 py-2 rounded-lg text-sm font-semibold " + 
                                (garantidoFiltros.filtro_status === 'rodou' ? 'bg-blue-600 text-white' : 'bg-blue-100 text-blue-600 hover:bg-blue-200')
                        }, "üîµ Rodou")
                    )
                ),
                
                // Cards de totais
                garantidoStats && React.createElement("div", {className: "grid grid-cols-2 md:grid-cols-4 gap-4"},
                    React.createElement("div", {className: "bg-white rounded-xl shadow p-4 text-center"},
                        React.createElement("p", {className: "text-2xl font-bold text-blue-600"}, "R$", (garantidoStats.total_negociado || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})),
                        React.createElement("p", {className: "text-xs text-gray-500"}, "Valor Total Negociado")
                    ),
                    React.createElement("div", {className: "bg-white rounded-xl shadow p-4 text-center"},
                        React.createElement("p", {className: "text-2xl font-bold text-purple-600"}, "R$", (garantidoStats.total_produzido || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})),
                        React.createElement("p", {className: "text-xs text-gray-500"}, "Valor Total Produ√ß√£o")
                    ),
                    React.createElement("div", {className: "bg-white rounded-xl shadow p-4 text-center"},
                        React.createElement("p", {className: "text-2xl font-bold text-red-600"}, "R$", (garantidoStats.total_complemento || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})),
                        React.createElement("p", {className: "text-xs text-gray-500"}, "Valor Total Complemento")
                    ),
                    React.createElement("div", {className: "bg-white rounded-xl shadow p-4 text-center"},
                        React.createElement("p", {className: "text-2xl font-bold text-gray-600"}, "R$", (garantidoStats.valor_nao_rodou || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})),
                        React.createElement("p", {className: "text-xs text-gray-500"}, "Valor Prof. N√£o Rodou")
                    )
                ),
                
                // Sub-abas
                React.createElement("div", {className: "bg-white rounded-xl shadow overflow-hidden"},
                    React.createElement("div", {className: "flex border-b"},
                        React.createElement("button", {
                            onClick: () => setGarantidoSubTab('analise'),
                            className: "flex-1 px-4 py-3 text-sm font-semibold " + 
                                (garantidoSubTab === 'analise' ? 'bg-green-50 text-green-700 border-b-2 border-green-600' : 'text-gray-600 hover:bg-gray-50')
                        }, "üìã An√°lise M√≠nimo Garantido"),
                        React.createElement("button", {
                            onClick: () => setGarantidoSubTab('semanal'),
                            className: "flex-1 px-4 py-3 text-sm font-semibold " + 
                                (garantidoSubTab === 'semanal' ? 'bg-green-50 text-green-700 border-b-2 border-green-600' : 'text-gray-600 hover:bg-gray-50')
                        }, "üìÖ An√°lise Semanal"),
                        React.createElement("button", {
                            onClick: () => setGarantidoSubTab('cliente'),
                            className: "flex-1 px-4 py-3 text-sm font-semibold " + 
                                (garantidoSubTab === 'cliente' ? 'bg-green-50 text-green-700 border-b-2 border-green-600' : 'text-gray-600 hover:bg-gray-50')
                        }, "üè¢ Por Cliente")
                    )
                ),
                
                // Loading
                garantidoLoading && React.createElement("div", {className: "bg-white rounded-xl shadow p-12 text-center"},
                    React.createElement("div", {className: "inline-block w-12 h-12 border-4 border-green-500 border-t-transparent rounded-full animate-spin mb-4"}),
                    React.createElement("p", {className: "text-gray-500"}, "Carregando dados do garantido...")
                ),
                
                // Conte√∫do Sub-aba: An√°lise Principal
                !garantidoLoading && garantidoSubTab === 'analise' && React.createElement("div", {className: "bg-white rounded-xl shadow-lg overflow-hidden"},
                    React.createElement("div", {className: "overflow-x-auto"},
                        React.createElement("table", {className: "w-full"},
                            React.createElement("thead", {className: "bg-gradient-to-r from-purple-100 to-purple-200"},
                                React.createElement("tr", null,
                                    React.createElement("th", {className: "px-3 py-3 text-left text-xs font-bold text-purple-800"}, "Data"),
                                    React.createElement("th", {className: "px-3 py-3 text-left text-xs font-bold text-purple-800"}, "C√≥d. Prof."),
                                    React.createElement("th", {className: "px-3 py-3 text-left text-xs font-bold text-purple-800"}, "Profissional"),
                                    React.createElement("th", {className: "px-3 py-3 text-left text-xs font-bold text-purple-800"}, "Onde Rodou?"),
                                    React.createElement("th", {className: "px-3 py-3 text-center text-xs font-bold text-purple-800"}, "Entregas"),
                                    React.createElement("th", {className: "px-3 py-3 text-center text-xs font-bold text-purple-800"}, "Dist√¢ncia"),
                                    React.createElement("th", {className: "px-3 py-3 text-right text-xs font-bold text-purple-800"}, "Negociado"),
                                    React.createElement("th", {className: "px-3 py-3 text-right text-xs font-bold text-purple-800"}, "Produ√ß√£o"),
                                    React.createElement("th", {className: "px-3 py-3 text-right text-xs font-bold text-purple-800"}, "Complemento"),
                                    React.createElement("th", {className: "px-3 py-3 text-center text-xs font-bold text-purple-800"}, "Status Pagamento")
                                )
                            ),
                            React.createElement("tbody", null,
                                garantidoData.length === 0 && React.createElement("tr", null,
                                    React.createElement("td", {colSpan: 10, className: "px-4 py-12 text-center text-gray-500"},
                                        "Nenhum dado encontrado. Ajuste os filtros ou verifique a planilha de garantido."
                                    )
                                ),
                                garantidoData.map((row, idx) => {
                                    const statusKey = `${row.cod_prof}_${row.data}_${row.cod_cliente_garantido}`;
                                    const statusInfo = garantidoStatusMap[statusKey];
                                    const statusAtual = statusInfo?.status || 'analise';
                                    
                                    return React.createElement("tr", {
                                        key: idx,
                                        className: (row.status === 'nao_rodou' ? 'bg-gray-100' : 
                                                   row.status === 'abaixo' ? 'bg-red-50' : 'bg-green-50') + 
                                                  " border-b hover:bg-opacity-80"
                                    },
                                        React.createElement("td", {className: "px-3 py-2 text-sm"}, 
                                            new Date(row.data + 'T12:00:00').toLocaleDateString('pt-BR')
                                        ),
                                        React.createElement("td", {className: "px-3 py-2 text-sm font-mono"}, row.cod_prof),
                                        React.createElement("td", {className: "px-3 py-2 text-sm font-semibold"}, row.profissional),
                                        React.createElement("td", {className: "px-3 py-2 text-sm"}, row.onde_rodou),
                                        React.createElement("td", {className: "px-3 py-2 text-sm text-center"}, row.entregas),
                                        React.createElement("td", {className: "px-3 py-2 text-sm text-center"}, 
                                            row.distancia ? row.distancia.toFixed(2) + ' KM' : '-'
                                        ),
                                        React.createElement("td", {className: "px-3 py-2 text-sm text-right font-semibold"}, 
                                            "R$", row.valor_negociado?.toFixed(2)
                                        ),
                                        React.createElement("td", {className: "px-3 py-2 text-sm text-right font-semibold"}, 
                                            "R$", row.valor_produzido?.toFixed(2)
                                        ),
                                        React.createElement("td", {className: "px-3 py-2 text-right"},
                                            React.createElement("span", {
                                                className: "inline-flex items-center gap-1 px-2 py-1 rounded text-sm font-bold " +
                                                    (row.complemento > 0 ? 'bg-red-200 text-red-800' : 'bg-green-200 text-green-800')
                                            },
                                                row.complemento > 0 ? 'üî¥' : 'üü¢',
                                                " R$", row.complemento?.toFixed(2)
                                            )
                                        ),
                                        // Coluna de Status com dropdown
                                        React.createElement("td", {className: "px-3 py-2 text-center"},
                                            React.createElement("div", {className: "flex flex-col items-center gap-1"},
                                                React.createElement("select", {
                                                    value: statusAtual,
                                                    onChange: (e) => {
                                                        const novoStatus = e.target.value;
                                                        if (novoStatus === 'reprovado') {
                                                            setGarantidoModalStatus(row);
                                                            setGarantidoMotivoReprovado('');
                                                        } else {
                                                            salvarStatusGarantido(row, novoStatus);
                                                        }
                                                    },
                                                    className: "px-2 py-1 text-xs font-semibold rounded border " +
                                                        (statusAtual === 'lancado' ? 'bg-green-100 text-green-800 border-green-300' :
                                                         statusAtual === 'reprovado' ? 'bg-red-100 text-red-800 border-red-300' :
                                                         'bg-yellow-100 text-yellow-800 border-yellow-300')
                                                },
                                                    React.createElement("option", {value: "analise"}, "üîç An√°lise"),
                                                    React.createElement("option", {value: "lancado"}, "‚úÖ Lan√ßado"),
                                                    React.createElement("option", {value: "reprovado"}, "‚ùå Reprovado")
                                                ),
                                                // Mostrar info de quem alterou
                                                statusInfo?.alterado_por && React.createElement("div", {className: "text-xs text-gray-500"},
                                                    statusInfo.alterado_por
                                                ),
                                                statusInfo?.alterado_em && React.createElement("div", {className: "text-xs text-gray-400"},
                                                    new Date(statusInfo.alterado_em).toLocaleString('pt-BR', {
                                                        day: '2-digit', month: '2-digit', year: '2-digit',
                                                        hour: '2-digit', minute: '2-digit'
                                                    })
                                                ),
                                                // Mostrar motivo se reprovado
                                                statusAtual === 'reprovado' && statusInfo?.motivo_reprovado && 
                                                    React.createElement("div", {
                                                        className: "text-xs text-red-600 italic max-w-32 truncate",
                                                        title: statusInfo.motivo_reprovado
                                                    }, "üìù ", statusInfo.motivo_reprovado)
                                            )
                                        )
                                    );
                                }),
                                // Linha de totais
                                garantidoData.length > 0 && React.createElement("tr", {className: "bg-purple-200 font-bold"},
                                    React.createElement("td", {colSpan: 4, className: "px-3 py-3 text-right text-purple-800"}, "Total"),
                                    React.createElement("td", {className: "px-3 py-3 text-center text-purple-800"}, 
                                        garantidoStats?.total_entregas || garantidoData.reduce((s, r) => s + r.entregas, 0)
                                    ),
                                    React.createElement("td", {className: "px-3 py-3 text-center text-purple-800"}, 
                                        (garantidoStats?.total_distancia || garantidoData.reduce((s, r) => s + (r.distancia || 0), 0)).toFixed(2), " KM"
                                    ),
                                    React.createElement("td", {className: "px-3 py-3 text-right text-purple-800"}, 
                                        "R$", (garantidoStats?.total_negociado || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})
                                    ),
                                    React.createElement("td", {className: "px-3 py-3 text-right text-purple-800"}, 
                                        "R$", (garantidoStats?.total_produzido || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})
                                    ),
                                    React.createElement("td", {className: "px-3 py-3 text-right text-red-800"}, 
                                        "R$", (garantidoStats?.total_complemento || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})
                                    ),
                                    React.createElement("td", {className: "px-3 py-3"})
                                )
                            )
                        )
                    ),
                    // Modal para informar motivo de reprova√ß√£o
                    garantidoModalStatus && React.createElement("div", {
                        className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50"
                    },
                        React.createElement("div", {className: "bg-white rounded-xl shadow-2xl p-6 max-w-md w-full mx-4"},
                            React.createElement("h3", {className: "text-lg font-bold text-red-700 mb-4"}, 
                                "‚ùå Reprovar Complemento"
                            ),
                            React.createElement("p", {className: "text-sm text-gray-600 mb-2"},
                                "Profissional: ", React.createElement("strong", null, garantidoModalStatus.profissional)
                            ),
                            React.createElement("p", {className: "text-sm text-gray-600 mb-4"},
                                "Data: ", React.createElement("strong", null, new Date(garantidoModalStatus.data + 'T12:00:00').toLocaleDateString('pt-BR'))
                            ),
                            React.createElement("label", {className: "block text-sm font-semibold text-gray-700 mb-2"}, 
                                "Motivo da Reprova√ß√£o *"
                            ),
                            React.createElement("textarea", {
                                value: garantidoMotivoReprovado,
                                onChange: (e) => setGarantidoMotivoReprovado(e.target.value),
                                placeholder: "Informe o motivo da reprova√ß√£o...",
                                className: "w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500",
                                rows: 3
                            }),
                            React.createElement("div", {className: "flex gap-3 mt-4"},
                                React.createElement("button", {
                                    onClick: () => {
                                        setGarantidoModalStatus(null);
                                        setGarantidoMotivoReprovado('');
                                    },
                                    className: "flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300"
                                }, "Cancelar"),
                                React.createElement("button", {
                                    onClick: () => salvarStatusGarantido(garantidoModalStatus, 'reprovado', garantidoMotivoReprovado),
                                    disabled: !garantidoMotivoReprovado.trim(),
                                    className: "flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed"
                                }, "Confirmar Reprova√ß√£o")
                            )
                        )
                    )
                ),
                
                // Conte√∫do Sub-aba: An√°lise Semanal
                !garantidoLoading && garantidoSubTab === 'semanal' && React.createElement("div", {className: "bg-white rounded-xl shadow-lg overflow-hidden"},
                    React.createElement("div", {className: "overflow-x-auto"},
                        React.createElement("table", {className: "w-full"},
                            React.createElement("thead", {className: "bg-gradient-to-r from-blue-100 to-blue-200"},
                                React.createElement("tr", null,
                                    React.createElement("th", {rowSpan: 2, className: "px-4 py-3 text-left text-xs font-bold text-blue-800 border-r"}, "Onde Rodou?"),
                                    // Colunas din√¢micas por semana
                                    garantidoSemanal.length > 0 && garantidoSemanal[0]?.semanas?.map((sem, i) => 
                                        React.createElement("th", {key: i, colSpan: 3, className: "px-2 py-2 text-center text-xs font-bold text-blue-800 border-l bg-blue-200"},
                                            sem.semana
                                        )
                                    )
                                ),
                                React.createElement("tr", {className: "bg-blue-50"},
                                    // Sub-headers para cada semana
                                    garantidoSemanal.length > 0 && garantidoSemanal[0]?.semanas?.map((_, i) =>
                                        React.createElement(React.Fragment, {key: i},
                                            React.createElement("th", {className: "px-2 py-2 text-xs text-blue-600 border-l text-right"}, "Negociado"),
                                            React.createElement("th", {className: "px-2 py-2 text-xs text-blue-600 text-right"}, "Produzido"),
                                            React.createElement("th", {className: "px-2 py-2 text-xs text-blue-600 text-right"}, "Compl.")
                                        )
                                    )
                                )
                            ),
                            React.createElement("tbody", null,
                                garantidoSemanal.length === 0 && React.createElement("tr", null,
                                    React.createElement("td", {colSpan: 20, className: "px-4 py-12 text-center text-gray-500"},
                                        "Nenhum dado semanal encontrado. Selecione um per√≠odo de datas."
                                    )
                                ),
                                garantidoSemanal.map((local, idx) =>
                                    React.createElement("tr", {key: idx, className: "border-b hover:bg-gray-50"},
                                        React.createElement("td", {className: "px-4 py-2 text-sm font-semibold border-r whitespace-nowrap"}, local.onde_rodou),
                                        local.semanas?.map((sem, i) => {
                                            // Calcular varia√ß√£o em rela√ß√£o √† semana anterior
                                            const semanaAnterior = i > 0 ? local.semanas[i-1] : null;
                                            const complementoAnterior = semanaAnterior?.complemento || 0;
                                            const complementoAtual = sem.complemento || 0;
                                            
                                            // S√≥ mostra seta se houver negociado nas duas semanas
                                            let seta = '';
                                            let setaClass = '';
                                            if (i > 0 && semanaAnterior?.negociado > 0 && sem.negociado > 0) {
                                                if (complementoAtual > complementoAnterior) {
                                                    seta = '‚ñ≤'; // Subiu = ruim = vermelho
                                                    setaClass = 'text-red-500 text-lg animate-pulse';
                                                } else if (complementoAtual < complementoAnterior) {
                                                    seta = '‚ñº'; // Diminuiu = bom = verde
                                                    setaClass = 'text-green-500 text-lg';
                                                }
                                            }
                                            
                                            return React.createElement(React.Fragment, {key: i},
                                                React.createElement("td", {className: "px-2 py-2 text-sm text-right border-l"}, 
                                                    sem.negociado > 0 ? `R$${sem.negociado.toLocaleString('pt-BR', {minimumFractionDigits: 2})}` : ''
                                                ),
                                                React.createElement("td", {className: "px-2 py-2 text-sm text-right"}, 
                                                    sem.produzido > 0 ? `R$${sem.produzido.toLocaleString('pt-BR', {minimumFractionDigits: 2})}` : ''
                                                ),
                                                React.createElement("td", {className: "px-2 py-2 text-sm text-right font-semibold " + 
                                                    (sem.complemento > 0 ? 'text-red-600' : sem.negociado > 0 ? 'text-green-600' : '')
                                                }, 
                                                    sem.negociado > 0 ? React.createElement("div", {className: "flex items-center justify-end gap-1"},
                                                        React.createElement("span", null, `R$${sem.complemento.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`),
                                                        seta && React.createElement("span", {className: setaClass + " font-bold", title: seta === '‚ñ≤' ? 'Aumentou em rela√ß√£o √† semana anterior' : 'Diminuiu em rela√ß√£o √† semana anterior'}, seta)
                                                    ) : ''
                                                )
                                            );
                                        })
                                    )
                                ),
                                // Rodap√© com totais
                                garantidoSemanal.length > 0 && React.createElement("tr", {className: "bg-gradient-to-r from-blue-100 to-blue-200 font-bold border-t-2 border-blue-400"},
                                    React.createElement("td", {className: "px-4 py-3 text-sm font-bold border-r text-blue-800"}, "TOTAL"),
                                    garantidoSemanal[0]?.semanas?.map((_, semIdx) => {
                                        // Calcular totais da coluna
                                        const totalNegociado = garantidoSemanal.reduce((sum, local) => sum + (local.semanas[semIdx]?.negociado || 0), 0);
                                        const totalProduzido = garantidoSemanal.reduce((sum, local) => sum + (local.semanas[semIdx]?.produzido || 0), 0);
                                        const totalComplemento = garantidoSemanal.reduce((sum, local) => sum + (local.semanas[semIdx]?.complemento || 0), 0);
                                        
                                        // Calcular varia√ß√£o do total em rela√ß√£o √† semana anterior
                                        let setaTotal = '';
                                        let setaTotalClass = '';
                                        if (semIdx > 0) {
                                            const totalCompAnterior = garantidoSemanal.reduce((sum, local) => sum + (local.semanas[semIdx-1]?.complemento || 0), 0);
                                            if (totalComplemento > totalCompAnterior) {
                                                setaTotal = '‚ñ≤';
                                                setaTotalClass = 'text-red-600 text-xl animate-pulse';
                                            } else if (totalComplemento < totalCompAnterior) {
                                                setaTotal = '‚ñº';
                                                setaTotalClass = 'text-green-600 text-xl';
                                            }
                                        }
                                        
                                        return React.createElement(React.Fragment, {key: semIdx},
                                            React.createElement("td", {className: "px-2 py-3 text-sm text-right border-l text-blue-800"}, 
                                                `R$${totalNegociado.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`
                                            ),
                                            React.createElement("td", {className: "px-2 py-3 text-sm text-right text-purple-700"}, 
                                                `R$${totalProduzido.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`
                                            ),
                                            React.createElement("td", {className: "px-2 py-3 text-sm text-right text-red-700"}, 
                                                React.createElement("div", {className: "flex items-center justify-end gap-1"},
                                                    React.createElement("span", null, `R$${totalComplemento.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`),
                                                    setaTotal && React.createElement("span", {className: setaTotalClass + " font-bold"}, setaTotal)
                                                )
                                            )
                                        );
                                    })
                                )
                            )
                        )
                    )
                ),
                
                // Conte√∫do Sub-aba: Por Cliente
                !garantidoLoading && garantidoSubTab === 'cliente' && React.createElement("div", {className: "grid md:grid-cols-2 gap-6"},
                    // Tabela por cliente
                    React.createElement("div", {className: "bg-white rounded-xl shadow-lg overflow-hidden"},
                        React.createElement("div", {className: "overflow-x-auto"},
                            React.createElement("table", {className: "w-full"},
                                React.createElement("thead", {className: "bg-gradient-to-r from-emerald-100 to-emerald-200"},
                                    React.createElement("tr", null,
                                        React.createElement("th", {className: "px-4 py-3 text-left text-xs font-bold text-emerald-800"}, "Onde Rodou?"),
                                        React.createElement("th", {className: "px-4 py-3 text-right text-xs font-bold text-emerald-800"}, "Negociado"),
                                        React.createElement("th", {className: "px-4 py-3 text-right text-xs font-bold text-emerald-800"}, "Produzido"),
                                        React.createElement("th", {className: "px-4 py-3 text-right text-xs font-bold text-emerald-800"}, "Complemento")
                                    )
                                ),
                                React.createElement("tbody", null,
                                    garantidoPorCliente.length === 0 && React.createElement("tr", null,
                                        React.createElement("td", {colSpan: 4, className: "px-4 py-12 text-center text-gray-500"},
                                            "Nenhum dado por cliente encontrado."
                                        )
                                    ),
                                    garantidoPorCliente.map((cli, idx) =>
                                        React.createElement("tr", {key: idx, className: "border-b hover:bg-gray-50"},
                                            React.createElement("td", {className: "px-4 py-3 text-sm font-semibold"}, cli.onde_rodou),
                                            React.createElement("td", {className: "px-4 py-3 text-sm text-right"}, 
                                                "R$", (cli.negociado || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})
                                            ),
                                            React.createElement("td", {className: "px-4 py-3 text-sm text-right"}, 
                                                "R$", (cli.produzido || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})
                                            ),
                                            React.createElement("td", {className: "px-4 py-3 text-sm text-right font-bold " + 
                                                (cli.complemento > 0 ? 'text-red-600' : 'text-green-600')
                                            }, 
                                                "R$", (cli.complemento || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})
                                            )
                                        )
                                    ),
                                    // Linha de total
                                    garantidoPorCliente.length > 0 && React.createElement("tr", {className: "bg-emerald-200 font-bold"},
                                        React.createElement("td", {className: "px-4 py-3 text-emerald-800"}, "Total"),
                                        React.createElement("td", {className: "px-4 py-3 text-right text-emerald-800"}, 
                                            "R$", garantidoPorCliente.reduce((s, c) => s + (c.negociado || 0), 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})
                                        ),
                                        React.createElement("td", {className: "px-4 py-3 text-right text-emerald-800"}, 
                                            "R$", garantidoPorCliente.reduce((s, c) => s + (c.produzido || 0), 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})
                                        ),
                                        React.createElement("td", {className: "px-4 py-3 text-right text-red-700"}, 
                                            "R$", garantidoPorCliente.reduce((s, c) => s + (c.complemento || 0), 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})
                                        )
                                    )
                                )
                            )
                        )
                    ),
                    
                    // Gr√°fico de pizza
                    React.createElement("div", {className: "bg-white rounded-xl shadow-lg p-6"},
                        React.createElement("h3", {className: "text-lg font-bold text-gray-800 mb-4"}, "Complemento por Cliente"),
                        garantidoPorCliente.length > 0 ? React.createElement("div", {className: "relative max-h-[500px] overflow-y-auto"},
                            // Gr√°fico com barras horizontais - todos os clientes
                            React.createElement("div", {className: "space-y-3"},
                                garantidoPorCliente.map((cli, idx) => {
                                    const total = garantidoPorCliente.reduce((s, c) => s + (c.complemento || 0), 0);
                                    const percent = total > 0 ? ((cli.complemento || 0) / total * 100) : 0;
                                    const colors = ['bg-purple-500', 'bg-blue-500', 'bg-green-500', 'bg-yellow-500', 'bg-red-500', 'bg-pink-500', 'bg-indigo-500', 'bg-teal-500', 'bg-orange-500', 'bg-cyan-500'];
                                    return React.createElement("div", {key: idx},
                                        React.createElement("div", {className: "flex justify-between text-sm mb-1 gap-2"},
                                            React.createElement("span", {className: "text-xs font-medium text-gray-700", title: cli.onde_rodou}, cli.onde_rodou),
                                            React.createElement("span", {className: "font-semibold whitespace-nowrap"}, 
                                                "R$", (cli.complemento || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2}),
                                                " (", percent.toFixed(1), "%)"
                                            )
                                        ),
                                        React.createElement("div", {className: "w-full h-4 bg-gray-200 rounded-full overflow-hidden"},
                                            React.createElement("div", {
                                                className: `h-full ${colors[idx % colors.length]} rounded-full transition-all`,
                                                style: {width: `${percent}%`}
                                            })
                                        )
                                    );
                                })
                            )
                        ) : React.createElement("p", {className: "text-gray-500 text-center py-8"}, "Sem dados para exibir")
                    )
                )
            ),
            
            "os" === Et && React.createElement("div", {
                className: "space-y-4"
            }, 
            // Header
            React.createElement("div", {
                className: "bg-gradient-to-r from-purple-600 to-purple-800 rounded-xl p-6 text-white"
            }, React.createElement("h2", {
                className: "text-2xl font-bold mb-2"
            }, "üìã An√°lise por OS"), React.createElement("p", {
                className: "opacity-80"
            }, "Detalhamento de todas as ordens de servi√ßo com pontos expand√≠veis")),
            // Tabela principal
            React.createElement("div", {
                className: "bg-white rounded-xl shadow-lg overflow-hidden"
            }, React.createElement("div", {
                className: "overflow-x-auto"
            }, React.createElement("table", {
                className: "w-full text-xs"
            }, React.createElement("thead", {
                className: "bg-purple-100"
            }, React.createElement("tr", null, 
                React.createElement("th", {className: "px-2 py-2 text-center text-purple-900 w-8"}, ""),
                React.createElement("th", {className: "px-2 py-2 text-left text-purple-900"}, "OS"),
                React.createElement("th", {className: "px-2 py-2 text-left text-purple-900"}, "Profissional"),
                React.createElement("th", {className: "px-2 py-2 text-center text-purple-900"}, "Tipo"),
                React.createElement("th", {className: "px-2 py-2 text-left text-purple-900 max-w-xs"}, "Endere√ßo"),
                React.createElement("th", {className: "px-2 py-2 text-center text-purple-900"}, "Data Solic."),
                React.createElement("th", {className: "px-2 py-2 text-center text-purple-900"}, "H. Solicita√ß√£o"),
                React.createElement("th", {className: "px-2 py-2 text-center text-purple-900"}, "H. Aloca√ß√£o"),
                React.createElement("th", {className: "px-2 py-2 text-center text-purple-900"}, "H. Chegada"),
                React.createElement("th", {className: "px-2 py-2 text-center text-purple-900"}, "H. Entregue"),
                React.createElement("th", {className: "px-2 py-2 text-center text-purple-900 bg-green-200"}, "T. Entrega"),
                React.createElement("th", {className: "px-2 py-2 text-center text-purple-900 bg-orange-200"}, "T. Entrega Prof"),
                React.createElement("th", {className: "px-2 py-2 text-right text-purple-900"}, "KM"),
                React.createElement("th", {className: "px-2 py-2 text-center text-purple-900"}, "Prazo"),
                React.createElement("th", {className: "px-2 py-2 text-center text-purple-900 bg-orange-200"}, "Prazo Prof"),
                React.createElement("th", {className: "px-2 py-2 text-center text-purple-900"}, "Finalizado")
            )), React.createElement("tbody", null, (function() {
                // Agrupar dados por OS
                var osAgrupadas = {};
                var dados = Array.isArray(qt) ? qt : [];
                dados.forEach(function(row) {
                    var osNum = row.os;
                    if (!osAgrupadas[osNum]) {
                        osAgrupadas[osNum] = [];
                    }
                    osAgrupadas[osNum].push(row);
                });
                
                // Ordenar cada grupo por ponto
                Object.keys(osAgrupadas).forEach(function(os) {
                    osAgrupadas[os].sort(function(a, b) {
                        var pontoA = parseInt(a.ponto) || 1;
                        var pontoB = parseInt(b.ponto) || 1;
                        return pontoA - pontoB;
                    });
                });
                
                // Converter para array e ordenar por OS desc
                var osArray = Object.keys(osAgrupadas).sort(function(a, b) {
                    return parseInt(b) - parseInt(a);
                });
                
                // Fun√ß√£o para extrair data e hora (para filtro)
                var parseDateTime = function(str) {
                    if (!str) return null;
                    var s = String(str);
                    var match = s.match(/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})/);
                    if (!match) return null;
                    return {
                        ano: parseInt(match[1]),
                        mes: parseInt(match[2]),
                        dia: parseInt(match[3]),
                        hora: parseInt(match[4]),
                        min: parseInt(match[5]),
                        seg: parseInt(match[6]),
                        dataStr: match[1] + '-' + match[2] + '-' + match[3]
                    };
                };
                
                // Fun√ß√£o para calcular tempo com regras (para filtro)
                var calcTempoFiltro = function(dataHoraInicio, dataHoraFim) {
                    var inicio = parseDateTime(dataHoraInicio);
                    var fim = parseDateTime(dataHoraFim);
                    
                    if (!inicio || !fim) return null;
                    
                    var mesmaData = inicio.dataStr === fim.dataStr;
                    var inicioMinutos, fimMinutos;
                    
                    fimMinutos = fim.hora * 60 + fim.min + fim.seg / 60;
                    
                    if (!mesmaData) {
                        inicioMinutos = 8 * 60;
                    } else {
                        inicioMinutos = inicio.hora * 60 + inicio.min + inicio.seg / 60;
                    }
                    
                    var difMinutos = fimMinutos - inicioMinutos;
                    if (difMinutos < 0) return null;
                    return difMinutos;
                };
                
                // Filtrar pelo status_prazo_prof se estiver selecionado
                // Agora usa o campo dentro_prazo_prof calculado pelo backend
                if (ua.status_prazo_prof) {
                    osArray = osArray.filter(function(osNum) {
                        var pontos = osAgrupadas[osNum];
                        var primeiroReg = pontos[0];
                        
                        // Usar campo calculado pelo backend
                        var dentroPrazoProf = primeiroReg.dentro_prazo_prof;
                        
                        if (dentroPrazoProf === null || dentroPrazoProf === undefined) return true;
                        
                        if (ua.status_prazo_prof === "dentro") {
                            return dentroPrazoProf === true;
                        } else if (ua.status_prazo_prof === "fora") {
                            return dentroPrazoProf === false;
                        }
                        return true;
                    });
                }
                
                // Limitar a 200 resultados ap√≥s filtro
                osArray = osArray.slice(0, 200);
                
                // Estado para controlar expans√£o (usando window para persistir)
                if (!window.osExpandidas) window.osExpandidas = {};
                
                return osArray.map(function(osNum, idx) {
                    var pontos = osAgrupadas[osNum];
                    var primeiroReg = pontos[0];
                    var ultimoReg = pontos[pontos.length - 1]; // √öltimo ponto da OS (onde tem o finalizado real)
                    var isExpanded = window.osExpandidas[osNum] || false;
                    var temMaisPontos = pontos.length > 1;
                    
                    // Pegar o finalizado da OS (do √∫ltimo ponto, que √© quando realmente terminou)
                    var finalizadoOS = ultimoReg.finalizado || primeiroReg.finalizado;
                    
                    // Fun√ß√£o para extrair data e hora de uma string datetime
                    // Os dados v√™m como "2025-12-01T18:12:19.000Z" mas s√£o hor√°rios de Bras√≠lia
                    var parseDateTime = function(str) {
                        if (!str) return null;
                        var s = String(str);
                        // Extrair partes: YYYY-MM-DD e HH:MM:SS
                        var match = s.match(/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})/);
                        if (!match) return null;
                        return {
                            ano: parseInt(match[1]),
                            mes: parseInt(match[2]),
                            dia: parseInt(match[3]),
                            hora: parseInt(match[4]),
                            min: parseInt(match[5]),
                            seg: parseInt(match[6]),
                            dataStr: match[1] + '-' + match[2] + '-' + match[3]
                        };
                    };
                    
                    // Fun√ß√£o para calcular tempo com regras de hor√°rio comercial
                    // Regra: se dias diferentes, come√ßa √†s 8h do dia do fim
                    var calcularTempoComRegras = function(dataHoraInicio, dataHoraFim) {
                        var inicio = parseDateTime(dataHoraInicio);
                        var fim = parseDateTime(dataHoraFim);
                        
                        if (!inicio || !fim) return null;
                        
                        var mesmaData = inicio.dataStr === fim.dataStr;
                        
                        var inicioMinutos, fimMinutos;
                        
                        // Fim sempre √© a hora real do fim
                        fimMinutos = fim.hora * 60 + fim.min + fim.seg / 60;
                        
                        if (!mesmaData) {
                            // Dias diferentes - come√ßa √†s 8h do dia do fim
                            inicioMinutos = 8 * 60; // 8:00 = 480 minutos
                        } else {
                            inicioMinutos = inicio.hora * 60 + inicio.min + inicio.seg / 60;
                        }
                        
                        var difMinutos = fimMinutos - inicioMinutos;
                        
                        // Se negativo (fim antes das 8h), algo est√° errado - retorna null
                        if (difMinutos < 0) return null;
                        
                        return difMinutos;
                    };
                    
                    // T. Entrega: Solicitado (data_hora) ‚Üí Finalizado
                    var tempoEntregaOS = calcularTempoComRegras(primeiroReg.data_hora, finalizadoOS);
                    
                    // T. Entrega Prof: usar campo do banco (calculado durante upload/rec√°lculo)
                    var tempoEntregaProfOS = primeiroReg.tempo_entrega_prof_minutos;
                    
                    // Prazo em minutos (vem do banco) - para prazo normal
                    var prazoMinutos = primeiroReg.prazo_minutos || 60;
                    
                    // Prazo Prof em minutos - vem do banco
                    var prazoProfMinutos = primeiroReg.prazo_prof_minutos || 60;
                    
                    // Prazo Prof: usar campo do banco
                    var dentroPrazoProf = primeiroReg.dentro_prazo_prof;
                    
                    var formatTempo = function(mins) {
                        if (mins === null || mins === undefined || isNaN(mins) || mins < 0) return "-";
                        var h = Math.floor(mins / 60);
                        var m = Math.floor(mins % 60);
                        var s = Math.floor((mins % 1) * 60);
                        return String(h).padStart(2, "0") + ":" + String(m).padStart(2, "0") + ":" + String(s).padStart(2, "0");
                    };
                    
                    // Hora que a OS foi finalizada
                    var extrairHoraOS = function(dataHoraStr) {
                        if (!dataHoraStr) return "-";
                        var str = String(dataHoraStr);
                        var match = str.match(/(\d{2}):(\d{2}):(\d{2})/);
                        if (match) {
                            return match[1] + ":" + match[2] + ":" + match[3];
                        }
                        return "-";
                    };
                    var horaEntregueOS = extrairHoraOS(finalizadoOS);
                    
                    // Fun√ß√£o para formatar data corretamente
                    var formatData = function(dataStr) {
                        if (!dataStr) return "-";
                        // Se j√° √© uma data ISO ou string de data
                        var d = new Date(dataStr);
                        if (isNaN(d.getTime())) return "-";
                        // Ajustar para evitar problema de timezone
                        var dia = String(d.getDate()).padStart(2, "0");
                        var mes = String(d.getMonth() + 1).padStart(2, "0");
                        var ano = d.getFullYear();
                        return dia + "/" + mes + "/" + ano;
                    };
                    
                    var renderRow = function(row, isFirst, rowIdx) {
                        // Debug: ver dados da linha (remover depois)
                        if (rowIdx === 0 && isFirst) {
                            console.log("üìã Debug OS row:", JSON.stringify(row, null, 2));
                        }
                        
                        // Ponto vem como n√∫mero do backend
                        var pontoNum = parseInt(row.ponto) || 1;
                        
                        // Verificar se √© retorno (mesma l√≥gica do backend - isRetorno)
                        var isRetorno = false;
                        if (row.ocorrencia) {
                            var oc = row.ocorrencia.toLowerCase();
                            isRetorno = oc.indexOf("cliente fechado") !== -1 ||
                                       oc.indexOf("clienteaus") !== -1 ||
                                       oc.indexOf("cliente ausente") !== -1 ||
                                       oc.indexOf("loja fechada") !== -1 ||
                                       oc.indexOf("produto incorreto") !== -1 ||
                                       oc.indexOf("retorno") !== -1;
                        }
                        
                        // Determinar tipo: Coleta (ponto 1), Entrega (ponto >= 2), ou Retorno
                        var tipo = isRetorno ? "Retorno" : (pontoNum === 1 ? "Coleta" : "Entrega");
                        var tipoClass = isRetorno ? "bg-orange-100 text-orange-700" : 
                                        (pontoNum === 1 ? "bg-blue-100 text-blue-700" : "bg-green-100 text-green-700");
                        
                        // Fun√ß√£o para extrair hora de uma string datetime sem convers√£o de timezone
                        var extrairHora = function(dataHoraStr) {
                            if (!dataHoraStr) return "-";
                            // Se vier como "2025-12-01T16:39:31" ou "2025-12-01 16:39:31"
                            var str = String(dataHoraStr);
                            var match = str.match(/(\d{2}):(\d{2}):(\d{2})/);
                            if (match) {
                                return match[1] + ":" + match[2] + ":" + match[3];
                            }
                            // Fallback: tentar extrair do objeto Date mas sem convers√£o
                            return "-";
                        };
                        
                        var horaAlocado = extrairHora(row.data_hora_alocado);
                        var horaSolicitado = row.hora_solicitado || extrairHora(row.data_hora);
                        
                        // Formatar data solicitado corretamente
                        var dataSolic = "-";
                        if (row.data_solicitado) {
                            // data_solicitado pode vir como "2024-12-01" ou "2024-12-01T00:00:00"
                            var partes = row.data_solicitado.split("T")[0].split("-");
                            if (partes.length === 3) {
                                dataSolic = partes[2] + "/" + partes[1] + "/" + partes[0];
                            }
                        }
                        
                        return React.createElement("tr", {
                            key: osNum + "-" + rowIdx,
                            className: "border-b hover:bg-purple-50 " + (isFirst ? (idx % 2 === 0 ? "bg-white" : "bg-gray-50") : "bg-blue-50")
                        },
                            // Bot√£o expandir (s√≥ na primeira linha)
                            React.createElement("td", {className: "px-2 py-1 text-center"}, 
                                isFirst && temMaisPontos ? React.createElement("button", {
                                    onClick: function() {
                                        window.osExpandidas[osNum] = !window.osExpandidas[osNum];
                                        // For√ßar re-render
                                        Ut([...qt]);
                                    },
                                    className: "w-5 h-5 rounded bg-purple-600 text-white text-xs font-bold hover:bg-purple-700"
                                }, isExpanded ? "‚àí" : "+") : ""
                            ),
                            // OS
                            React.createElement("td", {className: "px-2 py-1 font-medium text-purple-700"}, row.os),
                            // Profissional
                            React.createElement("td", {className: "px-2 py-1 truncate max-w-[120px]", title: row.nome_prof}, row.nome_prof || "-"),
                            // Tipo (Coleta/Entrega/Retorno)
                            React.createElement("td", {className: "px-2 py-1 text-center"}, 
                                React.createElement("span", {
                                    className: "px-2 py-0.5 rounded text-xs font-medium " + tipoClass
                                }, tipo)
                            ),
                            // Endere√ßo
                            React.createElement("td", {className: "px-2 py-1 truncate max-w-[200px]", title: row.endereco}, row.endereco || "-"),
                            // Data Solicitado
                            React.createElement("td", {className: "px-2 py-1 text-center"}, dataSolic),
                            // Hora Solicita√ß√£o
                            React.createElement("td", {className: "px-2 py-1 text-center"}, horaSolicitado),
                            // Hora Aloca√ß√£o
                            React.createElement("td", {className: "px-2 py-1 text-center"}, horaAlocado),
                            // Hora Chegada
                            React.createElement("td", {className: "px-2 py-1 text-center"}, row.hora_chegada || "-"),
                            // Hora Entregue (finalizado da OS)
                            React.createElement("td", {className: "px-2 py-1 text-center"}, horaEntregueOS),
                            // T. Entrega (Solicitado ‚Üí Finalizado da OS)
                            React.createElement("td", {className: "px-2 py-1 text-center font-medium bg-green-50 text-green-700"}, formatTempo(tempoEntregaOS)),
                            // T. Entrega Prof (Alocado ‚Üí Finalizado da OS)
                            React.createElement("td", {className: "px-2 py-1 text-center font-medium bg-orange-50 " + (tempoEntregaProfOS !== null && tempoEntregaProfOS <= prazoProfMinutos ? "text-green-700" : "text-red-600")}, formatTempo(tempoEntregaProfOS)),
                            // KM
                            React.createElement("td", {className: "px-2 py-1 text-right"}, parseFloat(row.distancia || 0).toFixed(2) + " km"),
                            // Prazo
                            React.createElement("td", {className: "px-2 py-1 text-center"}, 
                                row.dentro_prazo === true ? React.createElement("span", {className: "text-green-600 font-bold"}, "‚úÖ") :
                                row.dentro_prazo === false ? React.createElement("span", {className: "text-red-600 font-bold"}, "‚ùå") :
                                React.createElement("span", {className: "text-gray-400"}, "-")
                            ),
                            // Prazo Prof (baseado no T. Entrega Prof vs prazo por km)
                            React.createElement("td", {className: "px-2 py-1 text-center bg-orange-50"}, 
                                dentroPrazoProf === true ? React.createElement("span", {className: "text-green-600 font-bold"}, "‚úÖ") :
                                dentroPrazoProf === false ? React.createElement("span", {className: "text-red-600 font-bold"}, "‚ùå") :
                                React.createElement("span", {className: "text-gray-400"}, "-")
                            ),
                            // Finalizado
                            React.createElement("td", {className: "px-2 py-1 text-center text-xs"}, row.finalizado ? formatData(row.finalizado) : "-")
                        );
                    };
                    
                    // Renderizar linhas
                    var rows = [];
                    rows.push(renderRow(primeiroReg, true, 0));
                    
                    if (isExpanded && temMaisPontos) {
                        for (var i = 1; i < pontos.length; i++) {
                            rows.push(renderRow(pontos[i], false, i));
                        }
                    }
                    
                    return rows;
                }).flat();
            })())))),
            // Contador
            qt.length > 200 && React.createElement("div", {
                className: "bg-yellow-50 border border-yellow-200 rounded-lg px-4 py-3 text-center text-sm text-yellow-700"
            }, "‚ö†Ô∏è Mostrando 200 de ", (function() {
                var osUnicas = {};
                qt.forEach(function(r) { osUnicas[r.os] = true; });
                return Object.keys(osUnicas).length;
            })(), " OS √∫nicas. Use os filtros para refinar a busca.")
            ), "upload" === Et && React.createElement("div", {
                className: "space-y-6"
            }, React.createElement("div", {
                className: "bg-white rounded-xl shadow p-6"
            }, React.createElement("h2", {
                className: "text-xl font-bold text-purple-900 mb-6"
            }, "üì§ Upload de Planilha"), 
            // Upload Manual
            React.createElement("div", {
                className: "border-2 border-dashed border-purple-300 rounded-xl p-10 text-center bg-purple-50"
            }, React.createElement("p", {
                className: "text-5xl mb-4"
            }, "üìÑ"), React.createElement("p", {
                className: "text-purple-700 font-semibold mb-2"
            }, "Arraste ou selecione planilhas Excel"), React.createElement("p", {
                className: "text-purple-600 text-sm mb-4"
            }, "Voc√™ pode selecionar m√∫ltiplos arquivos ‚Ä¢ Apenas OS novas ser√£o inseridas"), Ea ? React.createElement("div", null, React.createElement("div", {
                className: "animate-spin text-4xl mb-2"
            }, "‚è≥"), React.createElement("p", {
                className: "text-purple-600 text-sm"
            }, Ea)) : React.createElement(React.Fragment, null, React.createElement("input", {
                type: "file",
                accept: ".xlsx,.xls",
                multiple: true,
                onChange: async (e) => {
                    const arquivos = Array.from(e.target.files);
                    if (arquivos.length === 0) return;
                    
                    // Pegar usu√°rio logado
                    const usuarioLogado = l;
                    console.log("üë§ Usu√°rio logado:", usuarioLogado);
                    
                    let totalInseridos = 0;
                    let totalIgnorados = 0;
                    let arquivosProcessados = 0;
                    
                    for (const arquivo of arquivos) {
                        try {
                            ha(`Processando ${arquivo.name} (${arquivosProcessados + 1}/${arquivos.length})...`);
                            
                            const t = await arquivo.arrayBuffer();
                            const a = XLSX.read(t, { type: "array" });
                            const sheet = a.Sheets[a.SheetNames[0]];
                            const r = XLSX.utils.sheet_to_json(sheet);
                            
                            const o = r.map(e => ({
                                os: e.OS,
                                num_pedido: e["N¬∫ Pedido"],
                                cod_cliente: e["C√≥d. cliente"],
                                nome_cliente: e["Nome cliente"],
                                empresa: e.Empresa,
                                nome_fantasia: e["Nome fantasia"],
                                centro_custo: e["Centro custo"],
                                cidade_p1: e["Cidade P1"],
                                endereco: e["Endere√ßo"],
                                bairro: e.Bairro,
                                cidade: e.Cidade,
                                estado: e.Estado,
                                cod_prof: e["C√≥d. prof."],
                                nome_prof: e["Nome prof."],
                                data_hora: e["Data/Hora"],
                                data_hora_alocado: e["Data/Hora Alocado"],
                                data_solicitado: e["Data solicitado"],
                                hora_solicitado: e["Hora solicitado"],
                                data_chegada: e["Data Chegada"],
                                hora_chegada: e["Hora Chegada"],
                                data_saida: e["Data Saida"],
                                hora_saida: e["Hora Saida"],
                                latitude: e.Latitude || e.latitude || e.Lat || e.lat,
                                longitude: e.Longitude || e.longitude || e.Long || e.lng,
                                categoria: e.Categoria,
                                valor: e.Valor,
                                distancia: e["Dist√¢ncia"],
                                valor_prof: e["Valor prof."],
                                finalizado: e.Finalizado,
                                execucao_comp: e["Execu√ß√£o Comp."],
                                execucao_espera: e["Execu√ß√£o - Espera"],
                                status: e.Status,
                                motivo: e.Motivo,
                                ocorrencia: e["Ocorr√™ncia"],
                                velocidade_media: e["Velocidade M√©dia"]
                            })).filter(e => e.os);
                            
                            ha(`Enviando ${o.length} entregas de ${arquivo.name}...`);
                            
                            // Extrair nome do usu√°rio de forma robusta
                            const nomeUsuario = usuarioLogado?.fullName || usuarioLogado?.full_name || usuarioLogado?.username || usuarioLogado?.name || "Admin";
                            const idUsuario = usuarioLogado?.codProfissional || usuarioLogado?.cod_profissional || usuarioLogado?.cod || usuarioLogado?.id || "";
                            
                            console.log("üì§ Enviando upload com usuario:", nomeUsuario, "id:", idUsuario);
                            
                            const response = await fetchAuth(`${API_URL}/bi/entregas/upload`, {
                                method: "POST",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify({
                                    entregas: o,
                                    usuario_id: idUsuario,
                                    usuario_nome: nomeUsuario,
                                    nome_arquivo: arquivo.name
                                })
                            });
                            
                            const result = await response.json();
                            if (result.success) {
                                totalInseridos += result.inseridos || 0;
                                totalIgnorados += result.ignorados || 0;
                                arquivosProcessados++;
                            }
                        } catch (err) {
                            console.error(`Erro em ${arquivo.name}:`, err);
                        }
                    }
                    
                    ha(null);
                    e.target.value = "";
                    
                    if (arquivosProcessados > 0) {
                        ja(`‚úÖ ${arquivosProcessados} arquivo(s) processado(s)! ${totalInseridos} inseridos, ${totalIgnorados} ignorados`, "success");
                        el();
                        ll();
                    } else {
                        ja("‚ùå Nenhum arquivo foi processado", "error");
                    }
                },
                className: "hidden",
                id: "bi-upload-file"
            }), React.createElement("label", {
                htmlFor: "bi-upload-file",
                className: "px-6 py-3 bg-purple-600 text-white rounded-lg font-semibold cursor-pointer hover:bg-purple-700 inline-block"
            }, "üì§ Selecionar Arquivo(s)")),
            // Bot√£o para atualizar aloca√ß√£o em registros existentes
            React.createElement("div", {
                className: "mt-4 pt-4 border-t border-purple-200"
            }, React.createElement("p", {
                className: "text-purple-600 text-sm mb-2"
            }, "üîÑ Atualizar apenas Data/Hora Alocado (para registros existentes):"), React.createElement("input", {
                type: "file",
                accept: ".xlsx,.xls",
                multiple: true,
                onChange: async (e) => {
                    const arquivos = Array.from(e.target.files);
                    if (arquivos.length === 0) return;
                    
                    let totalAtualizados = 0;
                    let totalErros = 0;
                    
                    for (const arquivo of arquivos) {
                        try {
                            ha(`Atualizando aloca√ß√£o de ${arquivo.name}...`);
                            
                            const t = await arquivo.arrayBuffer();
                            const a = XLSX.read(t, { type: "array" });
                            const sheet = a.Sheets[a.SheetNames[0]];
                            const r = XLSX.utils.sheet_to_json(sheet);
                            
                            const entregas = r.map(row => ({
                                os: row.OS,
                                ponto: row.Ponto || row['Ponto_Entrega'] || 1,
                                data_hora_alocado: row["Data/Hora Alocado"]
                            })).filter(e => e.os && e.data_hora_alocado);
                            
                            if (entregas.length === 0) {
                                console.log("Nenhum registro com Data/Hora Alocado encontrado");
                                continue;
                            }
                            
                            ha(`Enviando ${entregas.length} registros para atualiza√ß√£o...`);
                            
                            const response = await fetchAuth(`${API_URL}/bi/entregas/atualizar-alocado`, {
                                method: "POST",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify({ entregas })
                            });
                            
                            const result = await response.json();
                            if (result.success) {
                                totalAtualizados += result.atualizados || 0;
                                totalErros += result.erros || 0;
                            }
                        } catch (err) {
                            console.error(`Erro em ${arquivo.name}:`, err);
                            totalErros++;
                        }
                    }
                    
                    ha(null);
                    if (totalAtualizados > 0) {
                        ja(`‚úÖ ${totalAtualizados} registros atualizados com Data/Hora Alocado!`, "success");
                        el(); // Recarregar dashboard
                    } else {
                        ja(`‚ö†Ô∏è Nenhum registro atualizado. Verifique se a planilha tem a coluna "Data/Hora Alocado"`, "warning");
                    }
                    e.target.value = "";
                },
                className: "hidden",
                id: "bi-update-alocado-file"
            }), React.createElement("label", {
                htmlFor: "bi-update-alocado-file",
                className: "px-4 py-2 bg-pink-500 text-white rounded-lg font-semibold cursor-pointer hover:bg-pink-600 inline-block text-sm"
            }, "üïê Atualizar Aloca√ß√£o")), 
            // Bot√£o para inicializar prazos DAX
            React.createElement("div", {
                className: "mt-4 pt-4 border-t border-green-200"
            }, React.createElement("p", {
                className: "text-green-600 text-sm mb-2"
            }, "üìä Inicializar prazos com regras do DAX (cliente 767 = 2h fixo, outros = faixas por km):"), React.createElement("button", {
                onClick: async () => {
                    if (!confirm("Isso vai atualizar todos os prazos com as regras do DAX. Continuar?")) return;
                    ha("Inicializando prazos DAX...");
                    try {
                        const r = await fetchAuth(`${API_URL}/bi/inicializar-prazos-dax`, { method: "POST" });
                        const j = await r.json();
                        if (j.success) {
                            ja(`‚úÖ Prazos inicializados! ${j.registrosAtualizados} registros atualizados`, "success");
                            el();
                        } else {
                            ja(`‚ùå Erro: ${j.error}`, "error");
                        }
                    } catch (err) {
                        ja(`‚ùå Erro: ${err.message}`, "error");
                    }
                    ha(null);
                },
                className: "px-4 py-2 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600 text-sm"
            }, "üìä Inicializar Prazos DAX")))), React.createElement("div", {
                className: "bg-white rounded-xl shadow p-6"
            }, React.createElement("h2", {
                className: "text-xl font-bold text-purple-900 mb-4"
            }, "üìã Hist√≥rico de Uploads"), 0 === Mt.length ? React.createElement("p", {
                className: "text-gray-500 text-center py-8"
            }, "Nenhum upload realizado ainda") : React.createElement("div", {
                className: "space-y-3"
            }, Mt.map((e, t) => React.createElement("div", {
                key: e.id || t,
                className: "flex items-center justify-between p-4 bg-purple-50 rounded-lg border border-purple-200"
            }, React.createElement("div", {className: "flex-1"}, 
                React.createElement("div", {className: "flex items-center gap-3 mb-1"},
                    React.createElement("p", {className: "font-semibold text-purple-900"}, 
                        "üìÑ ", e.nome_arquivo || "Arquivo Excel"
                    ),
                    e.usuario_nome && React.createElement("span", {
                        className: "text-xs bg-purple-200 text-purple-700 px-2 py-0.5 rounded-full"
                    }, "üë§ ", e.usuario_nome)
                ),
                React.createElement("div", {className: "flex items-center gap-4 text-sm text-purple-600"},
                    React.createElement("span", null, "üìÖ ", e.data_upload ? new Date(e.data_upload).toLocaleDateString("pt-BR") + " √†s " + new Date(e.data_upload).toLocaleTimeString("pt-BR", {hour: "2-digit", minute: "2-digit"}) : "-"),
                    e.linhas_inseridas !== undefined ? React.createElement("span", null, "‚úÖ ", e.linhas_inseridas, " inseridas") : React.createElement("span", null, e.total_registros, " registros"),
                    e.linhas_ignoradas > 0 && React.createElement("span", {className: "text-orange-600"}, "‚è≠Ô∏è ", e.linhas_ignoradas, " ignoradas")
                )
            ), React.createElement("button", {
                onClick: () => (async (uploadData) => {
                    const dataStr = uploadData.data_upload ? new Date(uploadData.data_upload).toLocaleDateString("pt-BR") : "este upload";
                    if (confirm(`Excluir upload de ${dataStr}?`)) try {
                        // Se tem ID, usa o novo endpoint
                        const endpoint = uploadData.id 
                            ? `${API_URL}/bi/uploads/historico/${uploadData.id}`
                            : `${API_URL}/bi/uploads/${uploadData.data_upload}`;
                        const t = await fetch(endpoint, { method: "DELETE" }),
                            a = await t.json();
                        ja(`‚úÖ Upload exclu√≠do!`, "success"), ll(), el()
                    } catch (err) {
                        ja("Erro ao excluir", "error")
                    }
                })(e),
                className: "px-4 py-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 font-semibold text-sm"
            }, "üóëÔ∏è Excluir"))))), React.createElement("div", {
                className: "bg-blue-50 border border-blue-200 rounded-xl p-4"
            }, React.createElement("div", {
                className: "flex items-center justify-between"
            }, React.createElement("div", null, React.createElement("h4", {
                className: "font-semibold text-blue-800"
            }, "üîÑ Recalcular Prazos"), React.createElement("p", {
                className: "text-sm text-blue-600"
            }, "Ap√≥s alterar configura√ß√µes de prazo, recalcule para atualizar os dados")), React.createElement("button", {
                onClick: xl,
                disabled: ba,
                className: "px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 disabled:opacity-50"
            }, ba ? "‚è≥ Recalculando..." : "üîÑ Recalcular")))), 
            
            // ========== ABA RELAT√ìRIO IA ==========
            "relatorio-ia" === Et && React.createElement("div", {className: "space-y-6"},
                // Header
                React.createElement("div", {className: "bg-gradient-to-r from-violet-600 to-purple-600 rounded-xl p-6 text-white"},
                    React.createElement("div", {className: "flex items-center gap-4"},
                        React.createElement("img", {
                            src: "https://raw.githubusercontent.com/Leonardodevcloud/tutts-frontend/main/gemini-app-icon-hd.png",
                            alt: "IA",
                            className: "w-16 h-16 rounded-xl shadow-lg"
                        }),
                        React.createElement("div", null,
                            React.createElement("h2", {className: "text-2xl font-bold"}, "Relat√≥rio Inteligente com IA"),
                            React.createElement("p", {className: "text-violet-100 mt-1"}, "An√°lises autom√°ticas dos seus dados usando Intelig√™ncia Artificial")
                        )
                    )
                ),
                
                // Filtros edit√°veis
                React.createElement("div", {className: "bg-white rounded-xl shadow-lg p-6"},
                    React.createElement("h3", {className: "text-lg font-bold text-gray-800 mb-4 flex items-center gap-2"},
                        React.createElement("span", null, "üîç"),
                        "Filtros da An√°lise"
                    ),
                    React.createElement("div", {className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},
                        // Data In√≠cio
                        React.createElement("div", null,
                            React.createElement("label", {className: "block text-sm font-medium text-gray-700 mb-1"}, "üìÖ Data In√≠cio"),
                            React.createElement("input", {
                                type: "date",
                                value: relatorioIAFiltros.data_inicio,
                                onChange: (e) => setRelatorioIAFiltros(prev => ({...prev, data_inicio: e.target.value})),
                                className: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-violet-500 focus:border-violet-500"
                            })
                        ),
                        // Data Fim
                        React.createElement("div", null,
                            React.createElement("label", {className: "block text-sm font-medium text-gray-700 mb-1"}, "üìÖ Data Fim"),
                            React.createElement("input", {
                                type: "date",
                                value: relatorioIAFiltros.data_fim,
                                onChange: (e) => setRelatorioIAFiltros(prev => ({...prev, data_fim: e.target.value})),
                                className: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-violet-500 focus:border-violet-500"
                            })
                        ),
                        // Cliente com busca
                        React.createElement("div", null,
                            React.createElement("label", {className: "block text-sm font-medium text-gray-700 mb-1"}, "üè¢ Cliente"),
                            React.createElement("input", {
                                type: "text",
                                placeholder: "üîç Buscar cliente...",
                                value: buscaClienteRelatorioIA,
                                onChange: (e) => setBuscaClienteRelatorioIA(e.target.value),
                                className: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-violet-500 focus:border-violet-500 mb-1 text-sm"
                            }),
                            React.createElement("select", {
                                value: relatorioIAFiltros.cod_cliente,
                                onChange: (e) => {
                                    const codCliente = e.target.value;
                                    setRelatorioIAFiltros(prev => ({...prev, cod_cliente: codCliente, centro_custo: ''}));
                                    setBuscaClienteRelatorioIA('');
                                    // Carregar centros de custo do cliente
                                    if (codCliente && Tt[codCliente]) {
                                        setRelatorioIACentrosCusto(Tt[codCliente] || []);
                                    } else {
                                        setRelatorioIACentrosCusto([]);
                                    }
                                },
                                className: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-violet-500 focus:border-violet-500"
                            },
                                React.createElement("option", {value: ""}, "Todos os clientes"),
                                jt && jt.filter(function(c) {
                                    if (!buscaClienteRelatorioIA) return true;
                                    var termo = buscaClienteRelatorioIA.toLowerCase();
                                    var codigo = String(c.cod_cliente).toLowerCase();
                                    var mascara = il(c.cod_cliente);
                                    var nome = (mascara || c.nome_cliente || "").toLowerCase();
                                    return codigo.includes(termo) || nome.includes(termo);
                                }).map(function(c) {
                                    // Prioridade: 1) M√°scara configurada, 2) nome_cliente do banco, 3) fallback
                                    var mascara = il(c.cod_cliente);
                                    var nomeExibir = mascara || (c.nome_cliente && c.nome_cliente.trim()) || "Cliente " + c.cod_cliente;
                                    return React.createElement("option", {key: c.cod_cliente, value: c.cod_cliente}, 
                                        c.cod_cliente + " - " + nomeExibir
                                    );
                                })
                            )
                        ),
                        // Centro de Custo
                        React.createElement("div", null,
                            React.createElement("label", {className: "block text-sm font-medium text-gray-700 mb-1"}, "üìÅ Centro de Custo"),
                            React.createElement("select", {
                                value: relatorioIAFiltros.centro_custo,
                                onChange: (e) => setRelatorioIAFiltros(prev => ({...prev, centro_custo: e.target.value})),
                                disabled: !relatorioIAFiltros.cod_cliente,
                                className: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-violet-500 focus:border-violet-500 disabled:bg-gray-100 disabled:cursor-not-allowed"
                            },
                                React.createElement("option", {value: ""}, relatorioIAFiltros.cod_cliente ? "Todos os centros" : "Selecione um cliente primeiro"),
                                relatorioIACentrosCusto && relatorioIACentrosCusto.map(function(cc) {
                                    return React.createElement("option", {key: cc, value: cc}, cc);
                                })
                            )
                        )
                    ),
                    // Resumo dos filtros aplicados
                    React.createElement("div", {className: "mt-4 flex flex-wrap items-center gap-2 text-sm"},
                        React.createElement("span", {className: "text-gray-500"}, "An√°lise:"),
                        relatorioIAFiltros.data_inicio && React.createElement("span", {className: "bg-violet-100 text-violet-800 px-2 py-1 rounded"},
                            "De " + new Date(relatorioIAFiltros.data_inicio + "T12:00:00").toLocaleDateString("pt-BR")
                        ),
                        relatorioIAFiltros.data_fim && React.createElement("span", {className: "bg-violet-100 text-violet-800 px-2 py-1 rounded"},
                            "At√© " + new Date(relatorioIAFiltros.data_fim + "T12:00:00").toLocaleDateString("pt-BR")
                        ),
                        relatorioIAFiltros.cod_cliente && React.createElement("span", {className: "bg-purple-100 text-purple-800 px-2 py-1 rounded"},
                            "üè¢ " + (function() {
                                var mascara = il(relatorioIAFiltros.cod_cliente);
                                if (mascara) return mascara;
                                var cliente = jt.find(c => String(c.cod_cliente) === String(relatorioIAFiltros.cod_cliente));
                                return (cliente?.nome_cliente && cliente.nome_cliente.trim()) || "Cliente " + relatorioIAFiltros.cod_cliente;
                            })()
                        ),
                        relatorioIAFiltros.centro_custo && React.createElement("span", {className: "bg-blue-100 text-blue-800 px-2 py-1 rounded"},
                            "üìÅ " + relatorioIAFiltros.centro_custo
                        ),
                        !relatorioIAFiltros.data_inicio && !relatorioIAFiltros.data_fim && !relatorioIAFiltros.cod_cliente && React.createElement("span", {className: "text-gray-400 italic"},
                            "Nenhum filtro aplicado - analisar√° todos os dados"
                        ),
                        // Bot√£o limpar filtros
                        (relatorioIAFiltros.data_inicio || relatorioIAFiltros.data_fim || relatorioIAFiltros.cod_cliente) && React.createElement("button", {
                            onClick: () => {
                                setRelatorioIAFiltros({ data_inicio: '', data_fim: '', cod_cliente: '', centro_custo: '' });
                                setRelatorioIACentrosCusto([]);
                            },
                            className: "ml-2 text-red-500 hover:text-red-700 text-xs underline"
                        }, "Limpar filtros")
                    )
                ),
                
                // Tipos de relat√≥rio
                React.createElement("div", {className: "bg-white rounded-xl shadow-lg p-6"},
                    React.createElement("div", {className: "flex items-center justify-between mb-4"},
                        React.createElement("h3", {className: "text-lg font-bold text-gray-800"}, "üìä Escolha os Tipos de An√°lise"),
                        React.createElement("span", {className: "text-sm text-gray-500"}, 
                            relatorioIATipos.length > 0 ? relatorioIATipos.length + " selecionado(s)" : "Selecione um ou mais"
                        )
                    ),
                    React.createElement("p", {className: "text-sm text-gray-500 mb-4"}, "Clique nos cards para selecionar m√∫ltiplas an√°lises. A IA gerar√° um relat√≥rio completo combinando todas."),
                    React.createElement("div", {className: "grid grid-cols-2 md:grid-cols-3 gap-4"},
                        // Performance
                        React.createElement("button", {
                            onClick: () => toggleRelatorioIATipo("performance"),
                            className: "p-4 rounded-xl border-2 text-left transition-all relative " + (relatorioIATipos.includes("performance") ? "border-violet-500 bg-violet-50 ring-2 ring-violet-200" : "border-gray-200 hover:border-violet-300")
                        },
                            relatorioIATipos.includes("performance") && React.createElement("div", {className: "absolute top-2 right-2 w-6 h-6 bg-violet-500 rounded-full flex items-center justify-center text-white text-sm"}, "‚úì"),
                            React.createElement("div", {className: "text-3xl mb-2"}, "üìà"),
                            React.createElement("div", {className: "font-semibold text-gray-800"}, "Performance"),
                            React.createElement("div", {className: "text-xs text-gray-500"}, "An√°lise geral de desempenho")
                        ),
                        // Tend√™ncias
                        React.createElement("button", {
                            onClick: () => toggleRelatorioIATipo("tendencias"),
                            className: "p-4 rounded-xl border-2 text-left transition-all relative " + (relatorioIATipos.includes("tendencias") ? "border-violet-500 bg-violet-50 ring-2 ring-violet-200" : "border-gray-200 hover:border-violet-300")
                        },
                            relatorioIATipos.includes("tendencias") && React.createElement("div", {className: "absolute top-2 right-2 w-6 h-6 bg-violet-500 rounded-full flex items-center justify-center text-white text-sm"}, "‚úì"),
                            React.createElement("div", {className: "text-3xl mb-2"}, "üìâ"),
                            React.createElement("div", {className: "font-semibold text-gray-800"}, "Tend√™ncias"),
                            React.createElement("div", {className: "text-xs text-gray-500"}, "Padr√µes e comportamentos")
                        ),
                        // Alertas
                        React.createElement("button", {
                            onClick: () => toggleRelatorioIATipo("alertas"),
                            className: "p-4 rounded-xl border-2 text-left transition-all relative " + (relatorioIATipos.includes("alertas") ? "border-violet-500 bg-violet-50 ring-2 ring-violet-200" : "border-gray-200 hover:border-violet-300")
                        },
                            relatorioIATipos.includes("alertas") && React.createElement("div", {className: "absolute top-2 right-2 w-6 h-6 bg-violet-500 rounded-full flex items-center justify-center text-white text-sm"}, "‚úì"),
                            React.createElement("div", {className: "text-3xl mb-2"}, "‚ö†Ô∏è"),
                            React.createElement("div", {className: "font-semibold text-gray-800"}, "Alertas"),
                            React.createElement("div", {className: "text-xs text-gray-500"}, "Anomalias e problemas")
                        ),
                        // Gest√£o de Profissionais
                        React.createElement("button", {
                            onClick: () => toggleRelatorioIATipo("gestao_profissionais"),
                            className: "p-4 rounded-xl border-2 text-left transition-all relative " + (relatorioIATipos.includes("gestao_profissionais") ? "border-violet-500 bg-violet-50 ring-2 ring-violet-200" : "border-gray-200 hover:border-violet-300")
                        },
                            relatorioIATipos.includes("gestao_profissionais") && React.createElement("div", {className: "absolute top-2 right-2 w-6 h-6 bg-violet-500 rounded-full flex items-center justify-center text-white text-sm"}, "‚úì"),
                            React.createElement("div", {className: "text-3xl mb-2"}, "üë•"),
                            React.createElement("div", {className: "font-semibold text-gray-800"}, "Gest√£o de Profissionais"),
                            React.createElement("div", {className: "text-xs text-gray-500"}, "Produtividade e rotatividade")
                        ),
                        // Personalizado
                        React.createElement("button", {
                            onClick: () => toggleRelatorioIATipo("personalizado"),
                            className: "p-4 rounded-xl border-2 text-left transition-all relative " + (relatorioIATipos.includes("personalizado") ? "border-violet-500 bg-violet-50 ring-2 ring-violet-200" : "border-gray-200 hover:border-violet-300")
                        },
                            relatorioIATipos.includes("personalizado") && React.createElement("div", {className: "absolute top-2 right-2 w-6 h-6 bg-violet-500 rounded-full flex items-center justify-center text-white text-sm"}, "‚úì"),
                            React.createElement("div", {className: "text-3xl mb-2"}, "‚ú®"),
                            React.createElement("div", {className: "font-semibold text-gray-800"}, "Personalizado"),
                            React.createElement("div", {className: "text-xs text-gray-500"}, "Sua pr√≥pria pergunta")
                        )
                    ),
                    
                    // Sele√ß√£o r√°pida
                    React.createElement("div", {className: "mt-4 flex gap-2"},
                        React.createElement("button", {
                            onClick: () => setRelatorioIATipos(["performance", "tendencias", "alertas", "gestao_profissionais"]),
                            className: "px-3 py-1 text-xs bg-violet-100 text-violet-700 rounded-full hover:bg-violet-200"
                        }, "Selecionar todos"),
                        React.createElement("button", {
                            onClick: () => setRelatorioIATipos([]),
                            className: "px-3 py-1 text-xs bg-gray-100 text-gray-600 rounded-full hover:bg-gray-200"
                        }, "Limpar sele√ß√£o")
                    ),
                    
                    // Campo de prompt personalizado
                    relatorioIATipos.includes("personalizado") && React.createElement("div", {className: "mt-4 p-4 bg-purple-50 rounded-lg border border-purple-200"},
                        React.createElement("label", {className: "block text-sm font-medium text-purple-800 mb-2"}, "‚ú® Sua pergunta personalizada:"),
                        React.createElement("textarea", {
                            value: relatorioIAPromptCustom,
                            onChange: (e) => setRelatorioIAPromptCustom(e.target.value),
                            placeholder: "Ex: Quais profissionais est√£o com desempenho abaixo da m√©dia? Existe algum padr√£o nos atrasos de segunda-feira? Compare o desempenho entre os turnos da manh√£ e tarde.",
                            className: "w-full px-4 py-3 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",
                            rows: 3
                        })
                    ),
                    
                    // Resumo da sele√ß√£o
                    relatorioIATipos.length > 0 && React.createElement("div", {className: "mt-4 p-3 bg-violet-50 rounded-lg border border-violet-200"},
                        React.createElement("div", {className: "flex items-center gap-2 text-sm text-violet-800"},
                            React.createElement("span", {className: "font-semibold"}, "An√°lises selecionadas:"),
                            relatorioIATipos.map(function(t) {
                                var labels = {performance: "üìà Performance", tendencias: "üìâ Tend√™ncias", alertas: "‚ö†Ô∏è Alertas", gestao_profissionais: "üë• Gest√£o de Profissionais", personalizado: "‚ú® Personalizado"};
                                return React.createElement("span", {key: t, className: "px-2 py-0.5 bg-violet-200 rounded text-xs"}, labels[t] || t);
                            })
                        )
                    ),
                    
                    // Bot√£o gerar
                    React.createElement("button", {
                        onClick: () => gerarRelatorioIA(),
                        disabled: relatorioIALoading || relatorioIATipos.length === 0 || (relatorioIATipos.includes("personalizado") && relatorioIATipos.length === 1 && !relatorioIAPromptCustom.trim()),
                        className: "mt-6 w-full py-4 bg-gradient-to-r from-violet-600 to-purple-600 text-white rounded-xl font-bold text-lg hover:from-violet-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3 transition-all"
                    },
                        relatorioIALoading ? React.createElement("span", {className: "flex items-center gap-2"},
                            React.createElement("span", {className: "animate-spin"}, "‚è≥"),
                            "Analisando dados..."
                        ) : React.createElement("span", {className: "flex items-center gap-2"},
                            React.createElement("span", null, "üöÄ"),
                            "Gerar Relat√≥rio com IA",
                            relatorioIATipos.length > 0 && React.createElement("span", {className: "bg-white/20 px-2 py-0.5 rounded text-sm"}, relatorioIATipos.length + " an√°lise(s)")
                        )
                    )
                ),
                
                // Erro
                relatorioIAErro && React.createElement("div", {className: "bg-red-50 border border-red-200 rounded-xl p-4 text-red-800"},
                    React.createElement("div", {className: "flex items-center gap-2"},
                        React.createElement("span", {className: "text-xl"}, "‚ùå"),
                        React.createElement("span", {className: "font-semibold"}, "Erro ao gerar relat√≥rio"),
                    ),
                    React.createElement("p", {className: "mt-2 text-sm"}, relatorioIAErro)
                ),
                
                // Resultado
                relatorioIAResultado && React.createElement("div", {className: "bg-white rounded-xl shadow-lg overflow-hidden"},
                    React.createElement("div", {className: "bg-gradient-to-r from-violet-600 to-purple-600 px-6 py-4 text-white"},
                        React.createElement("div", {className: "flex items-center justify-between"},
                            React.createElement("div", {className: "flex items-center gap-3"},
                                React.createElement("span", {className: "text-2xl"}, "üìã"),
                                React.createElement("div", null,
                                    React.createElement("h3", {className: "font-bold"}, "Relat√≥rio Gerado"),
                                    React.createElement("p", {className: "text-sm text-violet-100"}, 
                                        relatorioIAResultado.tipo_analise + " ‚Ä¢ " + new Date().toLocaleString("pt-BR")
                                    )
                                )
                            ),
                            React.createElement("div", {className: "flex gap-2"},
                                React.createElement("button", {
                                    onClick: () => {
                                        navigator.clipboard.writeText(relatorioIAResultado.relatorio);
                                        alert("Relat√≥rio copiado!");
                                    },
                                    className: "px-3 py-1 bg-white/20 rounded-lg text-sm hover:bg-white/30"
                                }, "üìã Copiar"),
                                React.createElement("button", {
                                    onClick: () => gerarPDFRelatorioIA(),
                                    className: "px-3 py-1 bg-white/20 rounded-lg text-sm hover:bg-white/30"
                                }, "üìÑ Word")
                            )
                        )
                    ),
                    React.createElement("div", {className: "p-6"},
                        // M√©tricas resumidas
                        relatorioIAResultado.metricas && React.createElement("div", {className: "grid grid-cols-2 md:grid-cols-4 gap-4 mb-6"},
                            React.createElement("div", {className: "bg-blue-50 rounded-lg p-3 text-center"},
                                React.createElement("div", {className: "text-2xl font-bold text-blue-600"}, relatorioIAResultado.metricas.total_entregas?.toLocaleString() || "0"),
                                React.createElement("div", {className: "text-xs text-blue-800"}, "Entregas")
                            ),
                            React.createElement("div", {className: "bg-green-50 rounded-lg p-3 text-center"},
                                React.createElement("div", {className: "text-2xl font-bold text-green-600"}, (relatorioIAResultado.metricas.taxa_prazo || 0).toFixed(1) + "%"),
                                React.createElement("div", {className: "text-xs text-green-800"}, "No Prazo")
                            ),
                            React.createElement("div", {className: "bg-purple-50 rounded-lg p-3 text-center"},
                                React.createElement("div", {className: "text-2xl font-bold text-purple-600"}, (relatorioIAResultado.metricas.tempo_medio_entrega || 0).toFixed(0) + " min"),
                                React.createElement("div", {className: "text-xs text-purple-800"}, "Tempo M√©dio")
                            ),
                            React.createElement("div", {className: "bg-orange-50 rounded-lg p-3 text-center"},
                                React.createElement("div", {className: "text-2xl font-bold text-orange-600"}, relatorioIAResultado.metricas.media_profissionais_por_dia || "0"),
                                React.createElement("div", {className: "text-xs text-orange-800"}, "Motos/Dia")
                            )
                        ),
                        
                        // Relat√≥rio em texto
                        React.createElement("div", {id: "relatorio-ia-content", className: "prose prose-sm max-w-none"},
                            React.createElement("div", {
                                className: "whitespace-pre-wrap text-gray-700 leading-relaxed",
                                dangerouslySetInnerHTML: { __html: (relatorioIAResultado.relatorio || "").replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br/>') }
                            })
                        )
                    )
                ),
                
                // Hist√≥rico de Relat√≥rios do Banco de Dados
                React.createElement("div", {className: "bg-white rounded-xl shadow-lg p-6"},
                    React.createElement("div", {className: "flex items-center justify-between mb-4"},
                        React.createElement("h3", {className: "text-lg font-bold text-gray-800 flex items-center gap-2"},
                            React.createElement("span", null, "üìú"),
                            "Hist√≥rico de Relat√≥rios"
                        ),
                        React.createElement("span", {className: "text-sm text-gray-500"}, 
                            relatorioIAHistoricoDB.length + " relat√≥rio(s)"
                        )
                    ),
                    relatorioIAHistoricoDB.length === 0 
                        ? React.createElement("div", {className: "text-center py-8 text-gray-400"},
                            React.createElement("div", {className: "text-4xl mb-2"}, "üìã"),
                            "Nenhum relat√≥rio gerado ainda"
                        )
                        : React.createElement("div", {className: "space-y-3 max-h-96 overflow-y-auto"},
                            relatorioIAHistoricoDB.map(function(item) {
                                return React.createElement("div", {
                                    key: item.id, 
                                    className: "p-4 bg-gradient-to-r from-violet-50 to-purple-50 rounded-xl border border-violet-100"
                                },
                                    React.createElement("div", {className: "flex items-start justify-between gap-4"},
                                        React.createElement("div", {className: "flex-1 min-w-0"},
                                            // T√≠tulo com cliente
                                            React.createElement("div", {className: "flex items-center gap-2 flex-wrap"},
                                                React.createElement("span", {className: "font-bold text-violet-800"}, 
                                                    item.cod_cliente ? item.cod_cliente + " - " + (item.nome_cliente || "Cliente") : "Todos os Clientes"
                                                ),
                                                item.centro_custo && React.createElement("span", {className: "text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full"},
                                                    "üìÅ " + item.centro_custo
                                                )
                                            ),
                                            // Tipo de an√°lise
                                            React.createElement("div", {className: "text-sm text-gray-600 mt-1"},
                                                "üìä " + (item.tipo_analise || "An√°lise Geral")
                                            ),
                                            // Per√≠odo
                                            React.createElement("div", {className: "text-xs text-gray-500 mt-1"},
                                                "üìÖ Per√≠odo: " + (item.data_inicio ? new Date(item.data_inicio).toLocaleDateString("pt-BR") : "-") + 
                                                " a " + (item.data_fim ? new Date(item.data_fim).toLocaleDateString("pt-BR") : "-")
                                            ),
                                            // Usu√°rio e data de cria√ß√£o
                                            React.createElement("div", {className: "flex items-center gap-3 mt-2 text-xs text-gray-400"},
                                                React.createElement("span", null, "üë§ " + (item.usuario_nome || "Usu√°rio")),
                                                React.createElement("span", null, "üïê " + new Date(item.created_at).toLocaleString("pt-BR"))
                                            )
                                        ),
                                        // Bot√µes de a√ß√£o
                                        React.createElement("div", {className: "flex flex-col gap-2"},
                                            React.createElement("button", {
                                                onClick: () => gerarWordHistorico(item),
                                                className: "px-3 py-1.5 bg-violet-600 text-white text-xs rounded-lg hover:bg-violet-700 flex items-center gap-1 whitespace-nowrap"
                                            }, "üìÑ Word"),
                                            React.createElement("button", {
                                                onClick: () => deletarRelatorioHistorico(item.id),
                                                className: "px-3 py-1.5 bg-red-100 text-red-600 text-xs rounded-lg hover:bg-red-200 flex items-center gap-1"
                                            }, "üóëÔ∏è")
                                        )
                                    )
                                );
                            })
                        )
                )
            ),
            
            "config" === Et && React.createElement("div", {
                className: "space-y-4"
            }, 
            // ========== SE√á√ÉO 1: REGI√ïES (Dropdown) ==========
            React.createElement("div", {className: "bg-white rounded-xl shadow overflow-hidden"},
                // Header clic√°vel do dropdown
                React.createElement("button", {
                    onClick: function() { setConfigSecaoAberta(configSecaoAberta === "regioes" ? "" : "regioes"); },
                    className: "w-full px-6 py-4 flex items-center justify-between bg-gradient-to-r from-purple-50 to-white hover:from-purple-100 transition-all"
                },
                    React.createElement("div", {className: "flex items-center gap-3"},
                        React.createElement("span", {className: "text-2xl"}, "üó∫Ô∏è"),
                        React.createElement("div", {className: "text-left"},
                            React.createElement("h2", {className: "text-lg font-bold text-purple-900"}, "Configura√ß√£o de Regi√µes"),
                            React.createElement("p", {className: "text-sm text-gray-500"}, aa.length + " regi√£o(√µes) configurada(s)")
                        )
                    ),
                    React.createElement("span", {className: "text-2xl text-purple-600 transition-transform " + (configSecaoAberta === "regioes" ? "rotate-180" : "")}, "‚ñº")
                ),
                // Conte√∫do expans√≠vel da se√ß√£o Regi√µes
                configSecaoAberta === "regioes" && React.createElement("div", {className: "p-6 border-t"},
            React.createElement("p", {
                className: "text-sm text-gray-500 mb-4"
            }, "Agrupe clientes e centros de custo em regi√µes para facilitar a filtragem no dashboard."), React.createElement("div", {
                className: "border rounded-lg p-4 mb-4 bg-gray-50"
            },
            // T√≠tulo do formul√°rio com modo edi√ß√£o
            React.createElement("div", {className: "flex items-center justify-between mb-4"},
                React.createElement("h3", {className: "font-semibold text-purple-800"}, 
                    regiaoEditando ? "‚úèÔ∏è Editando Regi√£o" : "‚ûï Nova Regi√£o"
                ),
                regiaoEditando && React.createElement("button", {
                    onClick: function() {
                        setRegiaoEditando(null);
                        setRegiaoNome("");
                        setRegiaoClienteSelecionado([]);
                        setRegiaoCentrosCusto({});
                        setRegiaoItensAdicionados([]);
                    },
                    className: "text-sm text-gray-500 hover:text-red-600"
                }, "‚úï Cancelar edi√ß√£o")
            ), 
            // Nome da regi√£o
            React.createElement("div", {className: "mb-4"}, 
                React.createElement("label", {className: "text-sm font-semibold text-gray-700"}, "Nome da Regi√£o"),
                React.createElement("input", {
                    type: "text",
                    value: regiaoNome,
                    onChange: function(e) { setRegiaoNome(e.target.value); },
                    placeholder: "Ex: Grande Recife, Interior, Zona Sul...",
                    className: "w-full px-3 py-2 border rounded-lg mt-1"
                })
            ),
            // Sele√ß√£o de Clientes (m√∫ltiplos) + Centros de Custo
            React.createElement("div", {className: "grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},
                // Coluna 1: Lista de Clientes com checkboxes
                React.createElement("div", null,
                    React.createElement("label", {className: "text-sm font-semibold text-gray-700"}, "üè¢ Clientes"),
                    React.createElement("div", {className: "border rounded-lg mt-1 bg-white max-h-64 overflow-y-auto"},
                        // Campo de busca
                        React.createElement("div", {className: "sticky top-0 bg-white p-2 border-b"},
                            React.createElement("input", {
                                type: "text",
                                id: "regiao-busca-cliente",
                                placeholder: "üîç Buscar cliente...",
                                className: "w-full px-2 py-1 text-sm border rounded",
                                onChange: function(e) {
                                    var termo = e.target.value.toLowerCase();
                                    var items = document.querySelectorAll('.regiao-cliente-item');
                                    items.forEach(function(item) {
                                        var texto = item.textContent.toLowerCase();
                                        item.style.display = texto.includes(termo) ? 'flex' : 'none';
                                    });
                                }
                            })
                        ),
                        // Lista de clientes
                        React.createElement("div", {className: "p-1"},
                            jt.map(function(c) {
                                var isSelected = regiaoClienteSelecionado && regiaoClienteSelecionado.includes(String(c.cod_cliente));
                                return React.createElement("label", {
                                    key: c.cod_cliente,
                                    className: "regiao-cliente-item flex items-center gap-2 p-2 hover:bg-purple-50 rounded cursor-pointer " + (isSelected ? "bg-purple-100" : "")
                                },
                                    React.createElement("input", {
                                        type: "checkbox",
                                        checked: isSelected,
                                        onChange: async function(e) {
                                            var codStr = String(c.cod_cliente);
                                            if (e.target.checked) {
                                                // Adicionar cliente √† sele√ß√£o
                                                setRegiaoClienteSelecionado(function(prev) {
                                                    return prev ? [...prev, codStr] : [codStr];
                                                });
                                                // Buscar centros de custo
                                                try {
                                                    var resp = await fetch(API_URL + "/bi/centros-custo/" + c.cod_cliente);
                                                    var data = await resp.json();
                                                    setRegiaoCentrosCusto(function(prev) {
                                                        var novo = {...prev};
                                                        novo[codStr] = data || [];
                                                        return novo;
                                                    });
                                                } catch(err) {
                                                    console.error("Erro ao buscar centros:", err);
                                                }
                                            } else {
                                                // Remover cliente da sele√ß√£o
                                                setRegiaoClienteSelecionado(function(prev) {
                                                    return prev ? prev.filter(function(x) { return x !== codStr; }) : [];
                                                });
                                                // Remover centros de custo
                                                setRegiaoCentrosCusto(function(prev) {
                                                    var novo = {...prev};
                                                    delete novo[codStr];
                                                    return novo;
                                                });
                                                // Remover itens adicionados desse cliente
                                                setRegiaoItensAdicionados(function(prev) {
                                                    return prev.filter(function(i) { return String(i.cod_cliente) !== codStr; });
                                                });
                                            }
                                        },
                                        className: "w-4 h-4 accent-purple-600"
                                    }),
                                    React.createElement("span", {className: "text-sm flex-1"}, 
                                        c.cod_cliente + " - " + (il(c.cod_cliente) || c.nome_cliente)
                                    )
                                );
                            })
                        )
                    ),
                    React.createElement("p", {className: "text-xs text-gray-400 mt-1"}, 
                        (regiaoClienteSelecionado?.length || 0) + " cliente(s) selecionado(s)"
                    )
                ),
                // Coluna 2: Centros de Custo dos Clientes Selecionados
                React.createElement("div", null,
                    React.createElement("label", {className: "text-sm font-semibold text-gray-700"}, "üìÅ Centros de Custo"),
                    (regiaoClienteSelecionado && regiaoClienteSelecionado.length > 0) ? 
                    React.createElement("div", {className: "border rounded-lg mt-1 bg-white max-h-64 overflow-y-auto p-2"},
                        regiaoClienteSelecionado.map(function(codCliente) {
                            var cliente = jt.find(function(c) { return String(c.cod_cliente) === codCliente; });
                            var nomeCliente = il(codCliente) || cliente?.nome_cliente || "Cliente " + codCliente;
                            var centros = regiaoCentrosCusto[codCliente] || [];
                            
                            return React.createElement("div", {key: codCliente, className: "mb-3 pb-3 border-b last:border-b-0"},
                                React.createElement("div", {className: "font-medium text-purple-700 text-sm mb-2"}, 
                                    "üè¢ " + codCliente + " - " + nomeCliente
                                ),
                                // Op√ß√£o "Todos os centros"
                                React.createElement("label", {className: "flex items-center gap-2 p-1 hover:bg-gray-50 rounded cursor-pointer ml-2"},
                                    React.createElement("input", {
                                        type: "checkbox",
                                        onChange: function() {
                                            var novoItem = {
                                                cod_cliente: parseInt(codCliente),
                                                nome_cliente: nomeCliente,
                                                centro_custo: null
                                            };
                                            var existe = regiaoItensAdicionados.some(function(i) { 
                                                return i.cod_cliente === novoItem.cod_cliente && i.centro_custo === null; 
                                            });
                                            if (!existe) {
                                                setRegiaoItensAdicionados(function(prev) { return [...prev, novoItem]; });
                                                ja("‚úÖ " + codCliente + " - Todos CC adicionado", "success");
                                            }
                                        },
                                        className: "w-3 h-3"
                                    }),
                                    React.createElement("span", {className: "text-xs font-medium text-green-700"}, "üìå TODOS os centros")
                                ),
                                // Lista de centros
                                centros.length > 0 ? centros.map(function(cc) {
                                    return React.createElement("label", {
                                        key: cc.centro_custo,
                                        className: "flex items-center gap-2 p-1 hover:bg-gray-50 rounded cursor-pointer ml-2"
                                    },
                                        React.createElement("input", {
                                            type: "checkbox",
                                            onChange: function() {
                                                var novoItem = {
                                                    cod_cliente: parseInt(codCliente),
                                                    nome_cliente: nomeCliente,
                                                    centro_custo: cc.centro_custo
                                                };
                                                var existe = regiaoItensAdicionados.some(function(i) { 
                                                    return i.cod_cliente === novoItem.cod_cliente && i.centro_custo === novoItem.centro_custo; 
                                                });
                                                if (!existe) {
                                                    setRegiaoItensAdicionados(function(prev) { return [...prev, novoItem]; });
                                                    ja("‚úÖ " + cc.centro_custo + " adicionado", "success");
                                                }
                                            },
                                            className: "w-3 h-3"
                                        }),
                                        React.createElement("span", {className: "text-xs"}, cc.centro_custo),
                                        React.createElement("span", {className: "text-xs text-gray-400 ml-auto"}, cc.total_entregas)
                                    );
                                }) : React.createElement("p", {className: "text-xs text-gray-400 ml-4"}, "Sem centros de custo")
                            );
                        })
                    ) :
                    React.createElement("div", {className: "border rounded-lg mt-1 p-4 bg-white text-center text-gray-400 text-sm"},
                        "Selecione clientes √† esquerda para ver os centros de custo"
                    )
                )
            ),
            // Lista de itens adicionados
            regiaoItensAdicionados.length > 0 && React.createElement("div", {className: "mb-4"},
                React.createElement("label", {className: "text-sm font-semibold text-gray-700 mb-2 block"}, 
                    "‚úÖ Itens na Regi√£o (" + regiaoItensAdicionados.length + ")"
                ),
                React.createElement("div", {className: "flex flex-wrap gap-2"},
                    regiaoItensAdicionados.map(function(item, idx) {
                        return React.createElement("span", {
                            key: idx,
                            className: "inline-flex items-center gap-1 px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm"
                        },
                            React.createElement("span", null, 
                                item.cod_cliente + " - " + (item.centro_custo || "Todos CC")
                            ),
                            React.createElement("button", {
                                onClick: function() {
                                    setRegiaoItensAdicionados(function(prev) {
                                        return prev.filter(function(_, i) { return i !== idx; });
                                    });
                                },
                                className: "ml-1 text-purple-600 hover:text-red-600 font-bold"
                            }, "√ó")
                        );
                    })
                )
            ),
            // Bot√£o criar regi√£o
            React.createElement("button", {
                onClick: async function() {
                    if (!regiaoNome.trim()) {
                        return ja("Digite o nome da regi√£o", "error");
                    }
                    if (regiaoItensAdicionados.length === 0) {
                        return ja("Adicione pelo menos um cliente/centro de custo", "error");
                    }
                    try {
                        var url = regiaoEditando 
                            ? API_URL + "/bi/regioes/" + regiaoEditando 
                            : API_URL + "/bi/regioes";
                        var method = regiaoEditando ? "PUT" : "POST";
                        var resp = await fetch(url, {
                            method: method,
                            headers: {"Content-Type": "application/json"},
                            body: JSON.stringify({
                                nome: regiaoNome.trim(),
                                itens: regiaoItensAdicionados.map(function(i) {
                                    return { cod_cliente: i.cod_cliente, centro_custo: i.centro_custo };
                                })
                            })
                        });
                        var data = await resp.json();
                        if (data.success) {
                            ja(regiaoEditando ? "‚úÖ Regi√£o atualizada!" : "‚úÖ Regi√£o criada!", "success");
                            setRegiaoNome("");
                            setRegiaoClienteSelecionado([]);
                            setRegiaoCentrosCusto({});
                            setRegiaoItensAdicionados([]);
                            setRegiaoEditando(null);
                            pl(); // Recarregar regi√µes
                        } else {
                            ja("‚ùå Erro: " + data.error, "error");
                        }
                    } catch(err) {
                        ja("Erro ao salvar regi√£o", "error");
                    }
                },
                className: "px-4 py-2 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700"
            }, regiaoEditando ? "üíæ Atualizar Regi√£o" : "‚ûï Criar Regi√£o")), 0 === aa.length ? React.createElement("p", {
                className: "text-gray-500 text-center py-4 bg-gray-50 rounded-lg"
            }, "Nenhuma regi√£o configurada") : React.createElement("div", {
                className: "space-y-3"
            }, aa.map(e => {
                // Suporta formato antigo (array de n√∫meros) e novo (array de objetos)
                var itens = (e.clientes || []).map(function(item) {
                    if (typeof item === 'number') {
                        // Formato antigo
                        return { cod_cliente: item, centro_custo: null };
                    }
                    return item;
                });
                var totalItens = itens.length;
                var clientesUnicos = [...new Set(itens.map(function(i) { return i.cod_cliente; }))];
                
                return React.createElement("div", {
                    key: e.id,
                    className: "border border-blue-200 rounded-lg p-4 bg-blue-50"
                }, React.createElement("div", {
                    className: "flex justify-between items-start mb-2"
                }, React.createElement("div", null, React.createElement("h3", {
                    className: "font-bold text-blue-900"
                }, e.nome), React.createElement("p", {
                    className: "text-sm text-blue-600"
                }, clientesUnicos.length, " cliente(s), ", totalItens, " item(ns)")), 
                // Bot√µes editar e excluir
                React.createElement("div", {className: "flex gap-2"},
                    // Bot√£o editar
                    React.createElement("button", {
                        onClick: async function() {
                            setRegiaoEditando(e.id);
                            setRegiaoNome(e.nome);
                            var itensParaEditar = itens.map(function(i) {
                                var cliente = jt.find(function(c) { return c.cod_cliente === i.cod_cliente; });
                                return {
                                    cod_cliente: i.cod_cliente,
                                    nome_cliente: il(i.cod_cliente) || cliente?.nome_cliente || "Cliente " + i.cod_cliente,
                                    centro_custo: i.centro_custo
                                };
                            });
                            setRegiaoItensAdicionados(itensParaEditar);
                            var clientesCods = [...new Set(itens.map(function(i) { return String(i.cod_cliente); }))];
                            setRegiaoClienteSelecionado(clientesCods);
                            var novosCC = {};
                            for (var cod of clientesCods) {
                                try {
                                    var resp = await fetch(API_URL + "/bi/centros-custo/" + cod);
                                    var data = await resp.json();
                                    novosCC[cod] = data || [];
                                } catch(err) {
                                    novosCC[cod] = [];
                                }
                            }
                            setRegiaoCentrosCusto(novosCC);
                            ja("üìù Editando regi√£o: " + e.nome, "success");
                        },
                        className: "text-blue-500 hover:text-blue-700 p-1",
                        title: "Editar regi√£o"
                    }, "‚úèÔ∏è"),
                    // Bot√£o excluir
                    React.createElement("button", {
                        onClick: async function() {
                            if (confirm("Excluir a regi√£o '" + e.nome + "'?")) {
                                try {
                                    var resp = await fetch(API_URL + "/bi/regioes/" + e.id, {method: "DELETE"});
                                    if (resp.ok) {
                                        ja("‚úÖ Regi√£o exclu√≠da!", "success");
                                        pl();
                                    }
                                } catch (err) {
                                    ja("Erro ao excluir", "error");
                                }
                            }
                        },
                        className: "text-red-500 hover:text-red-700 p-1",
                        title: "Excluir regi√£o"
                    }, "üóëÔ∏è")
                )), React.createElement("div", {
                    className: "flex flex-wrap gap-1"
                }, itens.map(function(item, idx) {
                    var cliente = jt.find(function(c) { return c.cod_cliente === item.cod_cliente; });
                    var nomeCliente = il(item.cod_cliente) || cliente?.nome_cliente || "";
                    return React.createElement("span", {
                        key: idx,
                        className: "text-xs bg-white border border-blue-300 px-2 py-0.5 rounded"
                    }, item.cod_cliente, " - ", item.centro_custo || nomeCliente || "Todos CC");
                })));
            })))),
            
            // ========== SE√á√ÉO 2: M√ÅSCARAS (Dropdown) ==========
            React.createElement("div", {className: "bg-white rounded-xl shadow overflow-hidden"},
                React.createElement("button", {
                    onClick: function() { setConfigSecaoAberta(configSecaoAberta === "mascaras" ? "" : "mascaras"); },
                    className: "w-full px-6 py-4 flex items-center justify-between bg-gradient-to-r from-purple-50 to-white hover:from-purple-100 transition-all"
                },
                    React.createElement("div", {className: "flex items-center gap-3"},
                        React.createElement("span", {className: "text-2xl"}, "üè∑Ô∏è"),
                        React.createElement("div", {className: "text-left"},
                            React.createElement("h2", {className: "text-lg font-bold text-purple-900"}, "M√°scaras de Clientes"),
                            React.createElement("p", {className: "text-sm text-gray-500"}, ea.length + " m√°scara(s) configurada(s)")
                        )
                    ),
                    React.createElement("span", {className: "text-2xl text-purple-600 transition-transform " + (configSecaoAberta === "mascaras" ? "rotate-180" : "")}, "‚ñº")
                ),
                configSecaoAberta === "mascaras" && React.createElement("div", {className: "p-6 border-t"},
            React.createElement("p", {
                className: "text-sm text-gray-500 mb-4"
            }, "Defina apelidos para os c√≥digos de clientes. Esses apelidos aparecer√£o nos filtros e visualiza√ß√µes."), React.createElement("div", {
                className: "flex gap-3 mb-4 flex-wrap"
            }, React.createElement("select", {
                id: "bi-mascara-cliente",
                className: "flex-1 min-w-48 px-3 py-2 border rounded-lg"
            }, React.createElement("option", {
                value: ""
            }, "-- Selecione um Cliente --"), jt.map(e => React.createElement("option", {
                key: e.cod_cliente,
                value: `${e.cod_cliente}:${e.nome_cliente}`
            }, e.cod_cliente, " - ", e.nome_cliente))), React.createElement("input", {
                type: "text",
                id: "bi-mascara-nome",
                placeholder: "Digite a m√°scara (apelido)",
                className: "flex-1 min-w-48 px-3 py-2 border rounded-lg"
            }), React.createElement("button", {
                onClick: () => {
                    const e = document.getElementById("bi-mascara-cliente").value,
                        t = document.getElementById("bi-mascara-nome").value.trim();
                    if (!e || !t) return ja("Selecione um cliente e digite a m√°scara", "error");
                    const [a] = e.split(":");
                    (async (e, t) => {
                        try {
                            const a = await fetchAuth(`${API_URL}/bi/mascaras`, {
                                    method: "POST",
                                    headers: {
                                        "Content-Type": "application/json"
                                    },
                                    body: JSON.stringify({
                                        cod_cliente: e,
                                        mascara: t
                                    })
                                }),
                                l = await a.json();
                            l.success ? (ja("‚úÖ M√°scara salva!", "success"), dl()) : ja("‚ùå Erro: " + l.error, "error")
                        } catch (e) {
                            ja("Erro ao salvar m√°scara", "error")
                        }
                    })(a, t), document.getElementById("bi-mascara-cliente").value = "", document.getElementById("bi-mascara-nome").value = ""
                },
                className: "px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 whitespace-nowrap"
            }, "üíæ Salvar M√°scara")), 0 === ea.length ? React.createElement("p", {
                className: "text-gray-500 text-center py-4 bg-gray-50 rounded-lg"
            }, "Nenhuma m√°scara configurada") : React.createElement("div", {
                className: "space-y-2"
            }, ea.map(e => React.createElement("div", {
                key: e.id,
                className: "flex items-center justify-between p-3 bg-purple-50 rounded-lg border border-purple-200"
            }, React.createElement("div", null, React.createElement("span", {
                className: "font-mono bg-purple-200 px-2 py-0.5 rounded text-purple-900"
            }, e.cod_cliente), React.createElement("span", {
                className: "mx-2"
            }, "‚Üí"), React.createElement("span", {
                className: "font-semibold text-purple-900"
            }, e.mascara)), React.createElement("button", {
                onClick: () => (async e => {
                    if (confirm("Excluir esta m√°scara?")) try {
                        (await fetchAuth(`${API_URL}/bi/mascaras/${e}`, {
                            method: "DELETE"
                        })).ok && (ja("‚úÖ M√°scara exclu√≠da!", "success"), dl())
                    } catch (e) {
                        ja("Erro ao excluir", "error")
                    }
                })(e.id),
                className: "text-red-500 hover:text-red-700 p-1"
            }, "üóëÔ∏è")))))),
            
            // ========== SE√á√ÉO 3: PRAZOS (Dropdown) ==========
            React.createElement("div", {className: "bg-white rounded-xl shadow overflow-hidden"},
                React.createElement("button", {
                    onClick: function() { setConfigSecaoAberta(configSecaoAberta === "prazos" ? "" : "prazos"); },
                    className: "w-full px-6 py-4 flex items-center justify-between bg-gradient-to-r from-purple-50 to-white hover:from-purple-100 transition-all"
                },
                    React.createElement("div", {className: "flex items-center gap-3"},
                        React.createElement("span", {className: "text-2xl"}, "‚è±Ô∏è"),
                        React.createElement("div", {className: "text-left"},
                            React.createElement("h2", {className: "text-lg font-bold text-purple-900"}, "Configura√ß√£o de Prazos"),
                            React.createElement("p", {className: "text-sm text-gray-500"}, yt.length + " prazo(s) espec√≠fico(s)")
                        )
                    ),
                    React.createElement("span", {className: "text-2xl text-purple-600 transition-transform " + (configSecaoAberta === "prazos" ? "rotate-180" : "")}, "‚ñº")
                ),
                configSecaoAberta === "prazos" && React.createElement("div", {className: "p-6 border-t"},
            React.createElement("h3", {
                className: "font-bold text-purple-800 mb-2"
            }, "‚öôÔ∏è Prazo Padr√£o"), React.createElement("p", {
                className: "text-sm text-gray-500 mb-4"
            }, "Usado para clientes/centros sem configura√ß√£o espec√≠fica"), React.createElement("div", {
                className: "space-y-3 mb-4"
            }, fa.map((e, t) => React.createElement("div", {
                key: t,
                className: "flex items-center gap-2 p-3 bg-purple-50 rounded-lg flex-wrap"
            }, React.createElement("span", {
                className: "text-sm font-medium"
            }, "De"), React.createElement("input", {
                type: "number",
                value: e.km_min,
                onChange: e => {
                    const a = [...fa];
                    a[t].km_min = Number(e.target.value), Na(a)
                },
                className: "w-20 px-2 py-1 border rounded text-center",
                min: "0"
            }), React.createElement("span", {
                className: "text-sm font-medium"
            }, "at√©"), React.createElement("input", {
                type: "number",
                value: e.km_max || "",
                onChange: e => {
                    const a = [...fa];
                    a[t].km_max = e.target.value ? Number(e.target.value) : null, Na(a)
                },
                placeholder: "‚àû",
                className: "w-20 px-2 py-1 border rounded text-center",
                min: "0"
            }), React.createElement("span", {
                className: "text-sm font-medium"
            }, "km ‚Üí"), React.createElement("input", {
                type: "number",
                value: e.prazo_minutos,
                onChange: e => {
                    const a = [...fa];
                    a[t].prazo_minutos = Number(e.target.value), Na(a)
                },
                className: "w-20 px-2 py-1 border rounded text-center",
                min: "1"
            }), React.createElement("span", {
                className: "text-sm font-medium"
            }, "minutos"), fa.length > 1 && React.createElement("button", {
                onClick: () => Na(fa.filter((e, a) => a !== t)),
                className: "text-red-500 hover:text-red-700 ml-2"
            }, "üóëÔ∏è")))), React.createElement("div", {
                className: "flex gap-3"
            }, React.createElement("button", {
                onClick: () => {
                    const e = fa[fa.length - 1];
                    Na([...fa, {
                        km_min: e.km_max || 0,
                        km_max: null,
                        prazo_minutos: 60
                    }])
                },
                className: "px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300"
            }, "‚ûï Adicionar Faixa"), React.createElement("button", {
                onClick: () => (async e => {
                    try {
                        const t = await fetchAuth(`${API_URL}/bi/prazo-padrao`, {
                                method: "POST",
                                headers: {
                                    "Content-Type": "application/json"
                                },
                                body: JSON.stringify({
                                    faixas: e
                                })
                            }),
                            a = await t.json();
                        a.success ? (ja("‚úÖ Prazo padr√£o salvo!", "success"), al(), xl()) : ja("‚ùå Erro: " + a.error, "error")
                    } catch (e) {
                        ja("Erro ao salvar", "error")
                    }
                })(fa),
                className: "px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700"
            }, "üíæ Salvar Prazo Padr√£o"))), React.createElement("div", {
                className: "bg-white rounded-xl shadow p-6"
            }, React.createElement("h2", {
                className: "text-xl font-bold text-purple-900 mb-2"
            }, "‚ûï Prazo por Cliente ou Centro de Custo"), React.createElement("p", {
                className: "text-sm text-gray-500 mb-4"
            }, "Configure prazos espec√≠ficos que sobrescrevem o padr√£o"), React.createElement("div", {
                className: "mb-4"
            }, React.createElement("label", {
                className: "text-sm text-gray-600 font-medium"
            }, "Selecionar Cliente ou Centro de Custo"), React.createElement("select", {
                id: "bi-novo-codigo",
                className: "w-full px-3 py-2 border rounded-lg mt-1"
            }, React.createElement("option", {
                value: ""
            }, "-- Selecione --"), React.createElement("optgroup", {
                label: "üë§ Clientes"
            }, jt.map(e => React.createElement("option", {
                key: `cli-${e.cod_cliente}`,
                value: `cliente:${e.cod_cliente}:${il(e.cod_cliente)||e.nome_cliente}`
            }, il(e.cod_cliente) || e.nome_cliente, " (C√≥d: ", e.cod_cliente, ")"))), React.createElement("optgroup", {
                label: "üè¢ Centros de Custo"
            }, At.map(e => React.createElement("option", {
                key: `cc-${e.centro_custo}`,
                value: `centro_custo:${e.centro_custo}:${e.centro_custo}`
            }, e.centro_custo))))), React.createElement("div", {
                className: "space-y-3 mb-4"
            }, ya.map((e, t) => React.createElement("div", {
                key: t,
                className: "flex items-center gap-2 p-3 bg-gray-50 rounded-lg flex-wrap"
            }, React.createElement("span", {
                className: "text-sm font-medium"
            }, "De"), React.createElement("input", {
                type: "number",
                value: e.km_min,
                onChange: e => {
                    const a = [...ya];
                    a[t].km_min = Number(e.target.value), va(a)
                },
                className: "w-20 px-2 py-1 border rounded text-center",
                min: "0"
            }), React.createElement("span", {
                className: "text-sm font-medium"
            }, "at√©"), React.createElement("input", {
                type: "number",
                value: e.km_max || "",
                onChange: e => {
                    const a = [...ya];
                    a[t].km_max = e.target.value ? Number(e.target.value) : null, va(a)
                },
                placeholder: "‚àû",
                className: "w-20 px-2 py-1 border rounded text-center",
                min: "0"
            }), React.createElement("span", {
                className: "text-sm font-medium"
            }, "km ‚Üí"), React.createElement("input", {
                type: "number",
                value: e.prazo_minutos,
                onChange: e => {
                    const a = [...ya];
                    a[t].prazo_minutos = Number(e.target.value), va(a)
                },
                className: "w-20 px-2 py-1 border rounded text-center",
                min: "1"
            }), React.createElement("span", {
                className: "text-sm font-medium"
            }, "minutos"), ya.length > 1 && React.createElement("button", {
                onClick: () => va(ya.filter((e, a) => a !== t)),
                className: "text-red-500 hover:text-red-700 ml-2"
            }, "üóëÔ∏è")))), React.createElement("div", {
                className: "flex gap-3"
            }, React.createElement("button", {
                onClick: () => {
                    const e = ya[ya.length - 1];
                    va([...ya, {
                        km_min: e.km_max || 0,
                        km_max: null,
                        prazo_minutos: 60
                    }])
                },
                className: "px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300"
            }, "‚ûï Adicionar Faixa"), React.createElement("button", {
                onClick: () => {
                    const e = document.getElementById("bi-novo-codigo").value;
                    if (!e) return ja("Selecione um cliente ou centro", "error");
                    const [t, a, l] = e.split(":");
                    (async (e, t, a, l) => {
                        try {
                            const r = await fetchAuth(`${API_URL}/bi/prazos`, {
                                    method: "POST",
                                    headers: {
                                        "Content-Type": "application/json"
                                    },
                                    body: JSON.stringify({
                                        tipo: e,
                                        codigo: t,
                                        nome: a,
                                        faixas: l
                                    })
                                }),
                                o = await r.json();
                            o.success ? (ja("‚úÖ Prazo salvo!", "success"), tl(), xl()) : ja("‚ùå Erro: " + o.error, "error")
                        } catch (e) {
                            ja("Erro ao salvar", "error")
                        }
                    })(t, a, l, ya), va([{
                        km_min: 0,
                        km_max: 15,
                        prazo_minutos: 45
                    }]), document.getElementById("bi-novo-codigo").value = ""
                },
                className: "px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700"
            }, "üíæ Salvar Configura√ß√£o"))), React.createElement("div", {
                className: "bg-white rounded-xl shadow p-6"
            }, React.createElement("h2", {
                className: "text-xl font-bold text-purple-900 mb-4"
            }, "üìã Prazos Configurados (", yt.length, ")"), 0 === yt.length ? React.createElement("p", {
                className: "text-gray-500 text-center py-8"
            }, "Nenhum prazo espec√≠fico configurado") : React.createElement("div", {
                className: "space-y-3"
            }, yt.map(e => React.createElement("div", {
                key: e.id,
                className: "border border-purple-200 rounded-lg p-4 bg-purple-50"
            }, React.createElement("div", {
                className: "flex justify-between items-start mb-3"
            }, React.createElement("div", null, React.createElement("span", {
                className: "text-xs px-2 py-0.5 rounded " + ("cliente" === e.tipo ? "bg-blue-100 text-blue-700" : "bg-green-100 text-green-700")
            }, "cliente" === e.tipo ? "üë§ Cliente" : "üè¢ Centro de Custo"), React.createElement("p", {
                className: "font-semibold mt-1 text-purple-900"
            }, e.nome || e.codigo)), React.createElement("button", {
                onClick: () => (async e => {
                    if (confirm("Remover esta configura√ß√£o de prazo?")) try {
                        await fetchAuth(`${API_URL}/bi/prazos/${e}`, {
                            method: "DELETE"
                        }), ja("‚úÖ Removido!", "success"), tl()
                    } catch (e) {
                        ja("Erro ao remover", "error")
                    }
                })(e.id),
                className: "text-red-500 hover:text-red-700 p-1"
            }, "üóëÔ∏è")), React.createElement("div", {
                className: "flex flex-wrap gap-2"
            }, e.faixas && e.faixas.map((e, t) => React.createElement("span", {
                key: t,
                className: "bg-white border border-purple-300 px-3 py-1 rounded text-sm"
            }, e.km_min, " - ", e.km_max || "‚àû", " km ‚Üí ", React.createElement("strong", null, e.prazo_minutos, " min")))))))))),
            
            // ========== SE√á√ÉO 4: PRAZOS PROFISSIONAIS (Dropdown) - APENAS NA ABA CONFIG ==========
            "config" === Et && React.createElement("div", {className: "bg-white rounded-xl shadow overflow-hidden"},
                React.createElement("button", {
                    onClick: function() { setConfigSecaoAberta(configSecaoAberta === "prazos_prof" ? "" : "prazos_prof"); },
                    className: "w-full px-6 py-4 flex items-center justify-between bg-gradient-to-r from-orange-50 to-white hover:from-orange-100 transition-all"
                },
                    React.createElement("div", {className: "flex items-center gap-3"},
                        React.createElement("span", {className: "text-2xl"}, "üë®‚Äçüîß"),
                        React.createElement("div", {className: "text-left"},
                            React.createElement("h2", {className: "text-lg font-bold text-orange-900"}, "Prazo Profissional"),
                            React.createElement("p", {className: "text-sm text-gray-500"}, prazosProfissionais.length + " prazo(s) espec√≠fico(s)")
                        )
                    ),
                    React.createElement("span", {className: "text-2xl text-orange-600 transition-transform " + (configSecaoAberta === "prazos_prof" ? "rotate-180" : "")}, "‚ñº")
                ),
                configSecaoAberta === "prazos_prof" && React.createElement("div", {className: "p-6 border-t"},
                    // Prazo Padr√£o Profissional
                    React.createElement("h3", {
                        className: "font-bold text-orange-800 mb-2"
                    }, "‚öôÔ∏è Prazo Padr√£o Profissional"),
                    React.createElement("p", {
                        className: "text-sm text-gray-500 mb-4"
                    }, "Prazo que o profissional tem para concluir a entrega ap√≥s coletar"),
                    React.createElement("div", {
                        className: "space-y-3 mb-4"
                    }, prazoProfPadrao.map((e, t) => React.createElement("div", {
                        key: t,
                        className: "flex items-center gap-2 p-3 bg-orange-50 rounded-lg flex-wrap"
                    },
                        React.createElement("span", {className: "text-sm font-medium"}, "De"),
                        React.createElement("input", {
                            type: "number",
                            value: e.km_min,
                            onChange: e => {
                                const a = [...prazoProfPadrao];
                                a[t].km_min = Number(e.target.value);
                                setPrazoProfPadrao(a);
                            },
                            className: "w-20 px-2 py-1 border rounded text-center",
                            min: "0"
                        }),
                        React.createElement("span", {className: "text-sm font-medium"}, "at√©"),
                        React.createElement("input", {
                            type: "number",
                            value: e.km_max || "",
                            onChange: e => {
                                const a = [...prazoProfPadrao];
                                a[t].km_max = e.target.value ? Number(e.target.value) : null;
                                setPrazoProfPadrao(a);
                            },
                            placeholder: "‚àû",
                            className: "w-20 px-2 py-1 border rounded text-center",
                            min: "0"
                        }),
                        React.createElement("span", {className: "text-sm font-medium"}, "km ‚Üí"),
                        React.createElement("input", {
                            type: "number",
                            value: e.prazo_minutos,
                            onChange: e => {
                                const a = [...prazoProfPadrao];
                                a[t].prazo_minutos = Number(e.target.value);
                                setPrazoProfPadrao(a);
                            },
                            className: "w-20 px-2 py-1 border rounded text-center",
                            min: "1"
                        }),
                        React.createElement("span", {className: "text-sm font-medium"}, "minutos"),
                        prazoProfPadrao.length > 1 && React.createElement("button", {
                            onClick: () => setPrazoProfPadrao(prazoProfPadrao.filter((e, a) => a !== t)),
                            className: "text-red-500 hover:text-red-700 ml-2"
                        }, "üóëÔ∏è")
                    ))),
                    React.createElement("div", {className: "flex gap-3 mb-6"},
                        React.createElement("button", {
                            onClick: () => {
                                const e = prazoProfPadrao[prazoProfPadrao.length - 1];
                                setPrazoProfPadrao([...prazoProfPadrao, {
                                    km_min: e.km_max || 0,
                                    km_max: null,
                                    prazo_minutos: 60
                                }]);
                            },
                            className: "px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300"
                        }, "‚ûï Adicionar Faixa"),
                        React.createElement("button", {
                            onClick: async () => {
                                try {
                                    const resp = await fetchAuth(`${API_URL}/bi/prazo-prof-padrao`, {
                                        method: "POST",
                                        headers: {"Content-Type": "application/json"},
                                        body: JSON.stringify({faixas: prazoProfPadrao})
                                    });
                                    const data = await resp.json();
                                    if (data.success) {
                                        ja("‚úÖ Prazo profissional padr√£o salvo!", "success");
                                    } else {
                                        ja("‚ùå Erro: " + data.error, "error");
                                    }
                                } catch (err) {
                                    ja("Erro ao salvar", "error");
                                }
                            },
                            className: "px-4 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700"
                        }, "üíæ Salvar Prazo Padr√£o")
                    ),
                    
                    // Prazo por Cliente/Centro
                    React.createElement("div", {className: "bg-white rounded-xl shadow p-6 border border-orange-200"},
                        React.createElement("h2", {className: "text-xl font-bold text-orange-900 mb-2"}, "‚ûï Prazo Prof. por Cliente ou Centro de Custo"),
                        React.createElement("p", {className: "text-sm text-gray-500 mb-4"}, "Configure prazos profissionais espec√≠ficos que sobrescrevem o padr√£o"),
                        React.createElement("div", {className: "mb-4"},
                            React.createElement("label", {className: "text-sm text-gray-600 font-medium"}, "Selecionar Cliente ou Centro de Custo"),
                            React.createElement("select", {
                                id: "bi-prazo-prof-codigo",
                                className: "w-full px-3 py-2 border rounded-lg mt-1"
                            },
                                React.createElement("option", {value: ""}, "-- Selecione --"),
                                React.createElement("optgroup", {label: "üë§ Clientes"},
                                    jt.map(e => React.createElement("option", {
                                        key: `cli-prof-${e.cod_cliente}`,
                                        value: `cliente:${e.cod_cliente}:${il(e.cod_cliente)||e.nome_cliente}`
                                    }, il(e.cod_cliente) || e.nome_cliente, " (C√≥d: ", e.cod_cliente, ")"))
                                ),
                                React.createElement("optgroup", {label: "üè¢ Centros de Custo"},
                                    At.map(e => React.createElement("option", {
                                        key: `cc-prof-${e.centro_custo}`,
                                        value: `centro_custo:${e.centro_custo}:${e.centro_custo}`
                                    }, e.centro_custo))
                                )
                            )
                        ),
                        React.createElement("div", {className: "space-y-3 mb-4"},
                            prazoProfNovo.map((e, t) => React.createElement("div", {
                                key: t,
                                className: "flex items-center gap-2 p-3 bg-gray-50 rounded-lg flex-wrap"
                            },
                                React.createElement("span", {className: "text-sm font-medium"}, "De"),
                                React.createElement("input", {
                                    type: "number",
                                    value: e.km_min,
                                    onChange: e => {
                                        const a = [...prazoProfNovo];
                                        a[t].km_min = Number(e.target.value);
                                        setPrazoProfNovo(a);
                                    },
                                    className: "w-20 px-2 py-1 border rounded text-center",
                                    min: "0"
                                }),
                                React.createElement("span", {className: "text-sm font-medium"}, "at√©"),
                                React.createElement("input", {
                                    type: "number",
                                    value: e.km_max || "",
                                    onChange: e => {
                                        const a = [...prazoProfNovo];
                                        a[t].km_max = e.target.value ? Number(e.target.value) : null;
                                        setPrazoProfNovo(a);
                                    },
                                    placeholder: "‚àû",
                                    className: "w-20 px-2 py-1 border rounded text-center",
                                    min: "0"
                                }),
                                React.createElement("span", {className: "text-sm font-medium"}, "km ‚Üí"),
                                React.createElement("input", {
                                    type: "number",
                                    value: e.prazo_minutos,
                                    onChange: e => {
                                        const a = [...prazoProfNovo];
                                        a[t].prazo_minutos = Number(e.target.value);
                                        setPrazoProfNovo(a);
                                    },
                                    className: "w-20 px-2 py-1 border rounded text-center",
                                    min: "1"
                                }),
                                React.createElement("span", {className: "text-sm font-medium"}, "minutos"),
                                prazoProfNovo.length > 1 && React.createElement("button", {
                                    onClick: () => setPrazoProfNovo(prazoProfNovo.filter((e, a) => a !== t)),
                                    className: "text-red-500 hover:text-red-700 ml-2"
                                }, "üóëÔ∏è")
                            ))
                        ),
                        React.createElement("div", {className: "flex gap-3"},
                            React.createElement("button", {
                                onClick: () => {
                                    const e = prazoProfNovo[prazoProfNovo.length - 1];
                                    setPrazoProfNovo([...prazoProfNovo, {
                                        km_min: e.km_max || 0,
                                        km_max: null,
                                        prazo_minutos: 60
                                    }]);
                                },
                                className: "px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300"
                            }, "‚ûï Adicionar Faixa"),
                            React.createElement("button", {
                                onClick: async () => {
                                    const sel = document.getElementById("bi-prazo-prof-codigo").value;
                                    if (!sel) return ja("Selecione um cliente ou centro", "error");
                                    const [tipo, codigo, nome] = sel.split(":");
                                    try {
                                        const resp = await fetchAuth(`${API_URL}/bi/prazos-prof`, {
                                            method: "POST",
                                            headers: {"Content-Type": "application/json"},
                                            body: JSON.stringify({
                                                tipo: tipo,
                                                codigo: codigo,
                                                nome: nome,
                                                faixas: prazoProfNovo
                                            })
                                        });
                                        const data = await resp.json();
                                        if (data.success) {
                                            ja("‚úÖ Prazo profissional salvo!", "success");
                                            // Recarregar lista de prazos profissionais
                                            const reloadResp = await fetchAuth(`${API_URL}/bi/prazos-prof`);
                                            const reloadData = await reloadResp.json();
                                            if (reloadData.success) setPrazosProfissionais(reloadData.prazos || []);
                                        } else {
                                            ja("‚ùå Erro: " + data.error, "error");
                                        }
                                    } catch (err) {
                                        ja("Erro ao salvar", "error");
                                    }
                                    setPrazoProfNovo([{km_min: 0, km_max: 15, prazo_minutos: 60}]);
                                    document.getElementById("bi-prazo-prof-codigo").value = "";
                                },
                                className: "px-4 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700"
                            }, "üíæ Salvar Configura√ß√£o")
                        )
                    ),
                    
                    // Lista de Prazos Profissionais Configurados
                    React.createElement("div", {className: "bg-white rounded-xl shadow p-6 mt-4 border border-orange-200"},
                        React.createElement("h2", {className: "text-xl font-bold text-orange-900 mb-4"}, "üìã Prazos Prof. Configurados (", prazosProfissionais.length, ")"),
                        prazosProfissionais.length === 0 
                            ? React.createElement("p", {className: "text-gray-500 text-center py-8"}, "Nenhum prazo profissional espec√≠fico configurado")
                            : React.createElement("div", {className: "space-y-3"},
                                prazosProfissionais.map(e => React.createElement("div", {
                                    key: e.id,
                                    className: "border border-orange-200 rounded-lg p-4 bg-orange-50"
                                },
                                    React.createElement("div", {className: "flex justify-between items-start mb-3"},
                                        React.createElement("div", null,
                                            React.createElement("span", {
                                                className: "text-xs px-2 py-0.5 rounded " + (e.tipo === "cliente" ? "bg-blue-100 text-blue-700" : "bg-green-100 text-green-700")
                                            }, e.tipo === "cliente" ? "üë§ Cliente" : "üè¢ Centro de Custo"),
                                            React.createElement("p", {className: "font-semibold mt-1 text-orange-900"}, e.nome || e.codigo)
                                        ),
                                        React.createElement("button", {
                                            onClick: async () => {
                                                if (confirm("Remover esta configura√ß√£o de prazo profissional?")) {
                                                    try {
                                                        await fetchAuth(`${API_URL}/bi/prazos-prof/${e.id}`, {method: "DELETE"});
                                                        ja("‚úÖ Removido!", "success");
                                                        // Recarregar lista
                                                        const resp = await fetchAuth(`${API_URL}/bi/prazos-prof`);
                                                        const data = await resp.json();
                                                        if (data.success) setPrazosProfissionais(data.prazos || []);
                                                    } catch (err) {
                                                        ja("Erro ao remover", "error");
                                                    }
                                                }
                                            },
                                            className: "text-red-500 hover:text-red-700 p-1"
                                        }, "üóëÔ∏è")
                                    ),
                                    React.createElement("div", {className: "flex flex-wrap gap-2"},
                                        e.faixas && e.faixas.map((f, idx) => React.createElement("span", {
                                            key: idx,
                                            className: "bg-white border border-orange-300 px-3 py-1 rounded text-sm"
                                        }, f.km_min, " - ", f.km_max || "‚àû", " km ‚Üí ", React.createElement("strong", null, f.prazo_minutos, " min")))
                                    )
                                ))
                            )
                    ),
                    
                    // Bot√£o para recalcular prazos profissionais
                    React.createElement("div", {className: "bg-gradient-to-r from-orange-100 to-yellow-100 rounded-xl p-6 mt-4 border-2 border-orange-300"},
                        React.createElement("h3", {className: "font-bold text-orange-800 mb-2 flex items-center gap-2"}, "üîÑ Recalcular Prazos Profissionais"),
                        React.createElement("p", {className: "text-sm text-gray-600 mb-4"}, "Atualiza o status de prazo profissional para todas as entregas existentes com base nas configura√ß√µes atuais."),
                        React.createElement("button", {
                            onClick: async () => {
                                if (!confirm("Isso ir√° recalcular o prazo profissional de TODAS as entregas.\n\nDeseja continuar?")) return;
                                s(true);
                                setLoadingMessage("Recalculando prazos profissionais...");
                                try {
                                    const resp = await fetchAuth(`${API_URL}/bi/entregas/recalcular-prazo-prof`, {
                                        method: "POST",
                                        headers: {"Content-Type": "application/json"}
                                    });
                                    const data = await resp.json();
                                    if (data.success) {
                                        ja(`‚úÖ Recalculado! ${data.atualizados} entregas (‚úÖ ${data.dentroPrazo} no prazo | ‚ùå ${data.foraPrazo} fora | ‚ö†Ô∏è ${data.semDados} sem dados)`, "success");
                                        // Recarregar dados do dashboard
                                        xl();
                                    } else {
                                        ja("‚ùå Erro: " + data.error, "error");
                                    }
                                } catch (err) {
                                    ja("‚ùå Erro ao recalcular: " + err.message, "error");
                                }
                                s(false);
                            },
                            className: "px-6 py-3 bg-orange-600 text-white rounded-lg font-bold hover:bg-orange-700 shadow-lg hover:shadow-xl transition-all flex items-center gap-2"
                        }, "üîÑ Recalcular Agora")
                    )
                )
            ),
            
            !ft && "dashboard" === Et && React.createElement("div", {
                className: "bg-white rounded-xl shadow p-10 text-center"
            }, React.createElement("p", {
                className: "text-5xl mb-4"
            }, "üìä"), React.createElement("p", {
                className: "text-gray-500"
            }, "Nenhum dado encontrado"), React.createElement("p", {
                className: "text-sm text-gray-400 mt-2"
            }, 'Fa√ßa upload de uma planilha na aba "Upload"')))))
        }
        
        // ========== P√ÅGINA HOME - BEM-VINDO ==========
        if ("home" === Ee && ("admin" === l.role || "admin_master" === l.role || "admin_financeiro" === l.role)) {
            const primeiroNome = (socialProfile?.display_name || l.fullName || "").split(" ")[0];
            
            return React.createElement("div", {
                className: "min-h-screen bg-gradient-to-br from-purple-50 via-white to-indigo-50"
            }, i && React.createElement(Toast, i), n && React.createElement(LoadingOverlay, null),
            
            // Modal de notifica√ß√£o de tarefas pendentes
            todoNotifModal && todoPendentesNotif.length > 0 && React.createElement("div", {
                className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
            }, React.createElement("div", {
                className: "bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden"
            }, React.createElement("div", {
                className: "bg-gradient-to-r from-orange-500 to-red-500 p-4 text-white"
            }, React.createElement("h2", {className: "text-xl font-bold flex items-center gap-2"}, "‚ö†Ô∏è Aten√ß√£o!"),
                React.createElement("p", {className: "text-orange-100 text-sm"}, "Voc√™ possui tarefas pendentes")
            ), React.createElement("div", {className: "p-4 max-h-60 overflow-y-auto"},
                React.createElement("p", {className: "text-gray-600 mb-3"}, "üìã ", todoPendentesNotif.length, " tarefa(s) precisam da sua aten√ß√£o:"),
                React.createElement("div", {className: "space-y-2"},
                    todoPendentesNotif.slice(0, 5).map(t => React.createElement("div", {
                        key: t.id,
                        className: "bg-orange-50 border-l-4 border-orange-500 p-3 rounded"
                    }, React.createElement("p", {className: "font-semibold text-gray-800"}, t.titulo),
                        t.data_prazo && React.createElement("p", {className: "text-xs text-orange-600"}, "üìÖ Vence: ", new Date(t.data_prazo).toLocaleDateString("pt-BR"))
                    ))
                ),
                todoPendentesNotif.length > 5 && React.createElement("p", {className: "text-sm text-gray-500 mt-2"}, "... e mais ", todoPendentesNotif.length - 5, " tarefa(s)")
            ), React.createElement("div", {className: "flex gap-3 p-4 border-t"},
                React.createElement("button", {
                    onClick: () => setTodoNotifModal(false),
                    className: "flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300"
                }, "Fechar"),
                React.createElement("button", {
                    onClick: () => { setTodoNotifModal(false); he("todo"); },
                    className: "flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700"
                }, "üìã Ir para Tarefas")
            ))),
            
            // Header
            React.createElement("nav", {
                className: "bg-gradient-to-r from-purple-700 to-indigo-700 shadow-lg"
            }, React.createElement("div", {
                className: "max-w-7xl mx-auto px-4 py-4 flex justify-between items-center"
            }, React.createElement("div", {className: "flex items-center gap-3"},
                socialProfile?.profile_photo ? React.createElement("img", {
                    src: socialProfile.profile_photo,
                    className: "w-12 h-12 rounded-full object-cover border-2 border-white/50"
                }) : React.createElement("div", {
                    className: "w-12 h-12 rounded-full bg-purple-500 flex items-center justify-center text-white font-bold text-xl border-2 border-white/50"
                }, primeiroNome?.charAt(0)?.toUpperCase() || "?"),
                React.createElement("div", null,
                    React.createElement("h1", {className: "text-xl font-bold text-white"}, "Central Tutts"),
                    React.createElement("p", {className: "text-purple-200 text-sm"}, socialProfile?.display_name || l.fullName)
                )
            ), React.createElement("div", {className: "flex items-center gap-2"},
                React.createElement("button", {
                    onClick: () => o(null),
                    className: "px-4 py-2 text-white/80 hover:text-white hover:bg-white/10 rounded-lg transition-all"
                }, "Sair")
            ))),
            
            // Conte√∫do Principal
            React.createElement("div", {className: "max-w-4xl mx-auto px-4 py-12"},
                // Sauda√ß√£o
                React.createElement("div", {className: "text-center mb-12"},
                    React.createElement("h1", {
                        className: "text-4xl md:text-5xl font-bold text-gray-800 mb-4"
                    }, getSaudacao(), ", ", React.createElement("span", {className: "text-purple-600"}, primeiroNome), "!"),
                    React.createElement("p", {className: "text-xl text-gray-600 mb-2"}, "Seja bem-vindo(a) √† Central Tutts"),
                    React.createElement("div", {className: "mt-8 p-6 bg-white rounded-2xl shadow-lg border-l-4 border-purple-500"},
                        React.createElement("p", {className: "text-lg text-gray-700 italic"}, "\"", mensagemGentileza, "\""),
                        React.createElement("p", {className: "text-purple-500 mt-2"}, "üíú")
                    )
                ),
                
                // Bot√µes de Acesso R√°pido
                React.createElement("div", {className: "grid grid-cols-2 md:grid-cols-3 gap-6"},
                    // Solicita√ß√µes
                    hasModuleAccess(l, "solicitacoes") &&
                    React.createElement("div", {
                        onClick: () => { he("solicitacoes"); x(e => ({...e, adminTab: "dashboard"})); },
                        className: "bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 cursor-pointer group overflow-hidden border border-gray-100 hover:border-purple-300"
                    },
                        React.createElement("div", {className: "h-2 bg-gradient-to-r from-purple-500 to-violet-600"}),
                        React.createElement("div", {className: "p-6"},
                            React.createElement("div", {className: "w-14 h-14 bg-purple-100 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"},
                                React.createElement("span", {className: "text-3xl"}, "üìã")
                            ),
                            React.createElement("h3", {className: "text-lg font-bold text-gray-800 mb-2"}, "Solicita√ß√µes"),
                            React.createElement("p", {className: "text-sm text-gray-500"}, "Gerencie pedidos e ajustes")
                        )
                    ),
                    
                    // Financeiro
                    hasModuleAccess(l, "financeiro") &&
                    React.createElement("div", {
                        onClick: () => { he("financeiro"); x(e => ({...e, finTab: getFirstAllowedTab(l, "financeiro", "home-fin")})); },
                        className: "bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 cursor-pointer group overflow-hidden border border-gray-100 hover:border-green-300"
                    },
                        React.createElement("div", {className: "h-2 bg-gradient-to-r from-green-500 to-emerald-600"}),
                        React.createElement("div", {className: "p-6"},
                            React.createElement("div", {className: "w-14 h-14 bg-green-100 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"},
                                React.createElement("span", {className: "text-3xl"}, "üí∞")
                            ),
                            React.createElement("h3", {className: "text-lg font-bold text-gray-800 mb-2"}, "Financeiro"),
                            React.createElement("p", {className: "text-sm text-gray-500"}, "Saques e valores")
                        )
                    ),
                    
                    // Disponibilidade
                    hasModuleAccess(l, "disponibilidade") && 
                    React.createElement("div", {
                        onClick: () => { he("disponibilidade"); },
                        className: "bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 cursor-pointer group overflow-hidden border border-gray-100 hover:border-blue-300"
                    },
                        React.createElement("div", {className: "h-2 bg-gradient-to-r from-blue-500 to-cyan-600"}),
                        React.createElement("div", {className: "p-6"},
                            React.createElement("div", {className: "w-14 h-14 bg-blue-100 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"},
                                React.createElement("span", {className: "text-3xl"}, "üìÖ")
                            ),
                            React.createElement("h3", {className: "text-lg font-bold text-gray-800 mb-2"}, "Disponibilidade"),
                            React.createElement("p", {className: "text-sm text-gray-500"}, "Escalas e hor√°rios")
                        )
                    ),
                    
                    // TO-DO
                    hasModuleAccess(l, "todo") &&
                    React.createElement("div", {
                        onClick: () => he("todo"),
                        className: "bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 cursor-pointer group overflow-hidden border border-gray-100 hover:border-indigo-300"
                    },
                        React.createElement("div", {className: "h-2 bg-gradient-to-r from-indigo-500 to-purple-600"}),
                        React.createElement("div", {className: "p-6"},
                            React.createElement("div", {className: "w-14 h-14 bg-indigo-100 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform relative"},
                                React.createElement("span", {className: "text-3xl"}, "üìù"),
                                todoMeuDia.length > 0 && React.createElement("span", {className: "absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center"}, todoMeuDia.length > 9 ? "9+" : todoMeuDia.length)
                            ),
                            React.createElement("h3", {className: "text-lg font-bold text-gray-800 mb-2"}, "TO-DO"),
                            React.createElement("p", {className: "text-sm text-gray-500"}, "Suas tarefas")
                        )
                    ),
                    
                    // Filas
                    hasModuleAccess(l, "filas") &&
                    React.createElement("div", {
                        onClick: () => he("filas"),
                        className: "bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 cursor-pointer group overflow-hidden border border-gray-100 hover:border-cyan-300"
                    },
                        React.createElement("div", {className: "h-2 bg-gradient-to-r from-cyan-500 to-teal-600"}),
                        React.createElement("div", {className: "p-6"},
                            React.createElement("div", {className: "w-14 h-14 bg-cyan-100 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"},
                                React.createElement("span", {className: "text-3xl"}, "üë•")
                            ),
                            React.createElement("h3", {className: "text-lg font-bold text-gray-800 mb-2"}, "Filas"),
                            React.createElement("p", {className: "text-sm text-gray-500"}, "Gest√£o de filas")
                        )
                    ),
                    
                    // BI
                    hasModuleAccess(l, "bi") && 
                    React.createElement("div", {
                        onClick: () => he("bi"),
                        className: "bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 cursor-pointer group overflow-hidden border border-gray-100 hover:border-orange-300"
                    },
                        React.createElement("div", {className: "h-2 bg-gradient-to-r from-orange-500 to-amber-600"}),
                        React.createElement("div", {className: "p-6"},
                            React.createElement("div", {className: "w-14 h-14 bg-orange-100 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"},
                                React.createElement("span", {className: "text-3xl"}, "üìä")
                            ),
                            React.createElement("h3", {className: "text-lg font-bold text-gray-800 mb-2"}, "BI"),
                            React.createElement("p", {className: "text-sm text-gray-500"}, "An√°lises e dados")
                        )
                    ),
                    
                    // Social
                    React.createElement("div", {
                        onClick: () => he("social"),
                        className: "bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 cursor-pointer group overflow-hidden border border-gray-100 hover:border-pink-300"
                    },
                        React.createElement("div", {className: "h-2 bg-gradient-to-r from-pink-500 to-rose-600"}),
                        React.createElement("div", {className: "p-6"},
                            React.createElement("div", {className: "w-14 h-14 bg-pink-100 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform relative"},
                                React.createElement("span", {className: "text-3xl"}, "üíú"),
                                socialUnread > 0 && React.createElement("span", {className: "absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center"}, socialUnread > 9 ? "9+" : socialUnread)
                            ),
                            React.createElement("h3", {className: "text-lg font-bold text-gray-800 mb-2"}, "Social"),
                            React.createElement("p", {className: "text-sm text-gray-500"}, "Comunidade")
                        )
                    ),
                    
                    // Operacional
                    hasModuleAccess(l, "operacional") &&
                    React.createElement("div", {
                        onClick: () => he("operacional"),
                        className: "bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 cursor-pointer group overflow-hidden border border-gray-100 hover:border-teal-300"
                    },
                        React.createElement("div", {className: "h-2 bg-gradient-to-r from-teal-500 to-cyan-600"}),
                        React.createElement("div", {className: "p-6"},
                            React.createElement("div", {className: "w-14 h-14 bg-teal-100 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"},
                                React.createElement("span", {className: "text-3xl"}, "üîß")
                            ),
                            React.createElement("h3", {className: "text-lg font-bold text-gray-800 mb-2"}, "Operacional"),
                            React.createElement("p", {className: "text-sm text-gray-500"}, "Gest√£o operacional")
                        )
                    ),
                    
                    // Config (admins com permiss√£o)
                    hasModuleAccess(l, "config") && 
                    React.createElement("div", {
                        onClick: () => { he("config"); x(e => ({...e, configTab: getFirstAllowedTab(l, "config", "usuarios")})); },
                        className: "bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 cursor-pointer group overflow-hidden border border-gray-100 hover:border-gray-400"
                    },
                        React.createElement("div", {className: "h-2 bg-gradient-to-r from-gray-500 to-slate-600"}),
                        React.createElement("div", {className: "p-6"},
                            React.createElement("div", {className: "w-14 h-14 bg-gray-100 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"},
                                React.createElement("span", {className: "text-3xl"}, "‚öôÔ∏è")
                            ),
                            React.createElement("h3", {className: "text-lg font-bold text-gray-800 mb-2"}, "Config"),
                            React.createElement("p", {className: "text-sm text-gray-500"}, "Configura√ß√µes")
                        )
                    )
                )
            ),
            
            // Footer
            React.createElement("div", {className: "text-center py-8 text-gray-400 text-sm"},
                "Central Tutts ¬© ", new Date().getFullYear()
            )
            )
        }
        
        const rr = "admin_master" === l.role && ("solicitacoes" === Ee || "disponibilidade" === Ee),
            or = "admin" === l.role;
        
        // Se √© m√≥dulo DISPONIBILIDADE, setar adminTab para usar o c√≥digo original
        if ("disponibilidade" === Ee && p.adminTab !== "disponibilidade") {
            x(prev => ({...prev, adminTab: "disponibilidade"}));
        }
        
        // M√≥dulo SOLICITA√á√ïES ou DISPONIBILIDADE
        if ("solicitacoes" !== Ee && "disponibilidade" !== Ee) return null;
        return React.createElement("div", {
            className: "min-h-screen bg-gray-50"
        }, i && React.createElement(Toast, i), n && React.createElement(LoadingOverlay, null), u && React.createElement(ImageModal, {
            imageUrl: u,
            onClose: () => g(null)
        }), 
        // Modal de notifica√ß√£o de tarefas pendentes
        todoNotifModal && todoPendentesNotif.length > 0 && React.createElement("div", {
            className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
        }, React.createElement("div", {
            className: "bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden"
        }, React.createElement("div", {
            className: "bg-gradient-to-r from-orange-500 to-red-500 p-4 text-white"
        }, React.createElement("h2", {className: "text-xl font-bold flex items-center gap-2"}, "‚ö†Ô∏è Aten√ß√£o!"),
            React.createElement("p", {className: "text-orange-100 text-sm"}, "Voc√™ possui tarefas pendentes")
        ), React.createElement("div", {className: "p-4 max-h-60 overflow-y-auto"},
            React.createElement("p", {className: "text-gray-600 mb-3"}, "üìã ", todoPendentesNotif.length, " tarefa(s) precisam da sua aten√ß√£o:"),
            React.createElement("div", {className: "space-y-2"},
                todoPendentesNotif.slice(0, 5).map(t => React.createElement("div", {
                    key: t.id,
                    className: "bg-orange-50 border-l-4 border-orange-500 p-3 rounded"
                }, React.createElement("p", {className: "font-semibold text-gray-800"}, t.titulo),
                    t.data_prazo && React.createElement("p", {className: "text-xs text-orange-600"}, "üìÖ Vence: ", new Date(t.data_prazo).toLocaleDateString("pt-BR"))
                ))
            ),
            todoPendentesNotif.length > 5 && React.createElement("p", {className: "text-sm text-gray-500 mt-2"}, "... e mais ", todoPendentesNotif.length - 5, " tarefa(s)")
        ), React.createElement("div", {className: "flex gap-3 p-4 border-t"},
            React.createElement("button", {
                onClick: () => setTodoNotifModal(false),
                className: "flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300"
            }, "Fechar"),
            React.createElement("button", {
                onClick: () => { setTodoNotifModal(false); he("todo"); },
                className: "flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700"
            }, "üìã Ir para Tarefas")
        ))),
        // ========== HEADER COM NAVEGA√á√ÉO ==========
        React.createElement(HeaderCompacto, {
            usuario: l,
            moduloAtivo: Ee,
            abaAtiva: Ee === "disponibilidade" ? null : (p.adminTab || "dashboard"),
            socialProfile: socialProfile,
            isLoading: f,
            lastUpdate: E,
            onRefresh: ul,
            onLogout: () => o(null),
            onGoHome: () => he("home"),
            onNavigate: navegarSidebar,
            onChangeTab: Ee === "disponibilidade" ? null : (abaId) => x({...p, adminTab: abaId})
        }),
        // Conte√∫do principal (sub-abas removidas - navega√ß√£o via sidebar)
        React.createElement("div", {
            className: "max-w-7xl mx-auto p-6"
        }, (!p.adminTab || "dashboard" === p.adminTab) && React.createElement(React.Fragment, null, (() => {
            const e = e => {
                    const t = new Date(e),
                        a = t.getDay(),
                        l = t.getHours() + t.getMinutes() / 60;
                    return 0 !== a && (6 === a ? l >= 8 && l < 12 : l >= 9 && l < 18)
                },
                t = new Date;
            t.setHours(0, 0, 0, 0);
            const a = j.filter(e => new Date(e.created_at) >= t),
                l = a.filter(e => "pendente" !== e.status),
                r = j.filter(t => "pendente" !== t.status && t.updated_at && t.created_at && e(t.created_at)).map(e => (new Date(e.updated_at) - new Date(e.created_at)) / 36e5),
                o = r.length > 0 ? r.reduce((e, t) => e + t, 0) / r.length : 0,
                c = j.filter(t => "pendente" === t.status && e(t.created_at) && Date.now() - new Date(t.created_at).getTime() >= 864e5),
                s = 0 === c.length ? 100 : Math.max(0, 100 - 15 * c.length),
                n = o <= 6 ? 100 : o <= 12 ? 80 : o <= 24 ? 60 : 40,
                m = Math.round((s + n) / 2);
            return React.createElement(React.Fragment, null, React.createElement("div", {
                className: "grid grid-cols-2 md:grid-cols-5 gap-4 mb-6"
            }, React.createElement("div", {
                className: "bg-white p-4 rounded-xl shadow"
            }, React.createElement("p", {
                className: "text-sm text-gray-600"
            }, "Total"), React.createElement("p", {
                className: "text-2xl font-bold text-purple-900"
            }, j.length)), React.createElement("div", {
                className: "bg-white p-4 rounded-xl shadow"
            }, React.createElement("p", {
                className: "text-sm text-gray-600"
            }, "Pendentes"), React.createElement("p", {
                className: "text-2xl font-bold text-yellow-600"
            }, j.filter(e => "pendente" === e.status).length)), React.createElement("div", {
                className: "bg-white p-4 rounded-xl shadow"
            }, React.createElement("p", {
                className: "text-sm text-gray-600"
            }, "Aprovadas"), React.createElement("p", {
                className: "text-2xl font-bold text-green-600"
            }, j.filter(e => "aprovado" === e.status).length)), React.createElement("div", {
                className: "bg-white p-4 rounded-xl shadow"
            }, React.createElement("p", {
                className: "text-sm text-gray-600"
            }, "Rejeitados"), React.createElement("p", {
                className: "text-2xl font-bold text-red-600"
            }, j.filter(e => "rejeitado" === e.status).length)), React.createElement("div", {
                className: "bg-white p-4 rounded-xl shadow"
            }, React.createElement("p", {
                className: "text-sm text-gray-600"
            }, "üö® Atrasadas (+24h)"), React.createElement("p", {
                className: "text-2xl font-bold " + (c.length > 0 ? "text-red-600 animate-pulse" : "text-gray-400")
            }, c.length))), c.length > 0 && React.createElement("div", {
                className: "bg-red-50 border-2 border-red-400 rounded-xl p-4 mb-6 animate-pulse"
            }, React.createElement("div", {
                className: "flex items-center gap-3"
            }, React.createElement("span", {
                className: "text-3xl"
            }, "üö®"), React.createElement("div", {
                className: "flex-1"
            }, React.createElement("p", {
                className: "text-red-800 font-bold text-lg"
            }, "ATEN√á√ÉO: ", c.length, " solicita√ß√£o(√µes) aguardando h√° mais de 24 horas!"), React.createElement("p", {
                className: "text-red-600 text-sm mt-1"
            }, "OS: ", c.slice(0, 5).map(e => e.ordemServico).join(", "), c.length > 5 ? "..." : "")))), React.createElement("div", {
                className: "bg-gradient-to-r from-purple-600 to-indigo-600 rounded-xl shadow-lg p-6 mb-6 text-white"
            }, React.createElement("div", {
                className: "flex flex-col md:flex-row items-center gap-6"
            }, React.createElement("div", {
                className: "relative w-28 h-28"
            }, React.createElement("svg", {
                className: "w-28 h-28 transform -rotate-90"
            }, React.createElement("circle", {
                cx: "56",
                cy: "56",
                r: "48",
                stroke: "rgba(255,255,255,0.2)",
                strokeWidth: "10",
                fill: "none"
            }), React.createElement("circle", {
                cx: "56",
                cy: "56",
                r: "48",
                stroke: m >= 80 ? "#10b981" : m >= 50 ? "#f59e0b" : "#ef4444",
                strokeWidth: "10",
                fill: "none",
                strokeDasharray: 3.02 * m + " 302",
                strokeLinecap: "round"
            })), React.createElement("div", {
                className: "absolute inset-0 flex flex-col items-center justify-center"
            }, React.createElement("span", {
                className: "text-2xl font-bold"
            }, m), React.createElement("span", {
                className: "text-xs opacity-70"
            }, "SCORE"))), React.createElement("div", {
                className: "flex-1 grid grid-cols-2 md:grid-cols-4 gap-4"
            }, React.createElement("div", {
                className: "bg-white/10 rounded-lg p-3 text-center"
            }, React.createElement("p", {
                className: "text-white/70 text-xs"
            }, "Hoje"), React.createElement("p", {
                className: "text-xl font-bold"
            }, a.length), React.createElement("p", {
                className: "text-xs text-white/60"
            }, l.length, " processadas")), React.createElement("div", {
                className: "bg-white/10 rounded-lg p-3 text-center"
            }, React.createElement("p", {
                className: "text-white/70 text-xs"
            }, "Tempo M√©dio"), React.createElement("p", {
                className: "text-xl font-bold"
            }, o < 1 ? `${Math.round(60*o)}min` : `${o.toFixed(1)}h`), React.createElement("p", {
                className: "text-xs " + (o <= 12 ? "text-green-300" : o <= 24 ? "text-yellow-300" : "text-red-300")
            }, o <= 6 ? "‚úÖ Excelente" : o <= 12 ? "‚úÖ Bom" : o <= 24 ? "‚ö†Ô∏è Regular" : "üö® Lento")), React.createElement("div", {
                className: "bg-white/10 rounded-lg p-3 text-center"
            }, React.createElement("p", {
                className: "text-white/70 text-xs"
            }, "Pendentes"), React.createElement("p", {
                className: "text-xl font-bold"
            }, j.filter(e => "pendente" === e.status).length), React.createElement("p", {
                className: "text-xs text-white/60"
            }, "aguardando")), React.createElement("div", {
                className: "bg-white/10 rounded-lg p-3 text-center"
            }, React.createElement("p", {
                className: "text-white/70 text-xs"
            }, "Prazo (24h)"), React.createElement("p", {
                className: "text-xl font-bold " + (0 === c.length ? "text-green-300" : "text-red-300")
            }, 0 === c.length ? "‚úÖ" : `${c.length} üö®`), React.createElement("p", {
                className: "text-xs text-white/60"
            }, 0 === c.length ? "Nenhum atraso" : "A√ß√£o necess√°ria!"))))))
        })(), React.createElement("div", {
            className: "grid md:grid-cols-2 gap-6 mb-6"
        }, React.createElement(MotivosPieChart, {
            submissions: j
        }), React.createElement(PieChart, {
            data: [{
                label: "‚úì Aprovados",
                value: j.filter(e => "aprovado" === e.status).length,
                color: "#22c55e"
            }, {
                label: "‚úó Rejeitados",
                value: j.filter(e => "rejeitado" === e.status).length,
                color: "#ef4444"
            }, {
                label: "‚è≥ Pendentes",
                value: j.filter(e => "pendente" === e.status).length,
                color: "#fbbf24"
            }],
            title: "üìà Status das Solicita√ß√µes"
        })), React.createElement("div", {
            className: "bg-white rounded-xl shadow p-6"
        }, React.createElement("h2", {
            className: "text-lg font-semibold mb-4"
        }, "Aguardando Valida√ß√£o"), React.createElement("div", {
            className: "mb-4 flex flex-wrap gap-2"
        }, ["all", "atrasados", "retorno", "ponto1", "pedagio", "simoesfilho"].map(e => React.createElement("button", {
            key: e,
            onClick: () => x({
                ...p,
                pendingFilter: e
            }),
            className: "px-4 py-2 rounded-lg font-semibold " + ((p.pendingFilter || "all") === e ? "atrasados" === e ? "bg-red-600 text-white" : "bg-purple-600 text-white" : "bg-gray-100")
        }, "all" === e && `üìã Todos (${j.filter(e=>"pendente"===e.status).length})`, "atrasados" === e && `üö® Atrasados (${j.filter(e=>"pendente"===e.status&&Date.now()-new Date(e.created_at).getTime()>=864e5).length})`, "retorno" === e && `üîÑ Retorno (${j.filter(e=>"pendente"===e.status&&"Ajuste de Retorno"===e.motivo).length})`, "ponto1" === e && `üìç Ponto 1 (${j.filter(e=>"pendente"===e.status&&e.motivo?.includes("Ponto 1")).length})`, "pedagio" === e && `üõ£Ô∏è Ped√°gio (${j.filter(e=>"pendente"===e.status&&e.motivo?.includes("Ped√°gio")).length})`, "simoesfilho" === e && `üè≠ Sim√µes Filho (${j.filter(e=>"pendente"===e.status&&e.motivo?.includes("Sim√µes Filho")).length})`))), React.createElement("div", {
            className: "grid md:grid-cols-2 lg:grid-cols-3 gap-3"
        }, j.filter(e => "pendente" === e.status && (!p.pendingFilter || "all" === p.pendingFilter || ("atrasados" === p.pendingFilter ? Date.now() - new Date(e.created_at).getTime() >= 864e5 : "retorno" === p.pendingFilter ? "Ajuste de Retorno" === e.motivo : "ponto1" === p.pendingFilter ? e.motivo?.includes("Ponto 1") : "simoesfilho" === p.pendingFilter ? e.motivo?.includes("Sim√µes Filho") : "pedagio" !== p.pendingFilter || e.motivo?.includes("Ped√°gio")))).map(e => {
            const t = Date.now() - new Date(e.created_at).getTime(),
                a = Math.floor(t / 36e5),
                l = Math.floor(t % 36e5 / 6e4),
                r = t >= 864e5,
                o = t >= 36e6 && !r,
                rtnW = (() => {
                    if ("Ajuste de Retorno" !== e.motivo) return 0;
                    const t = new Date,
                        a = t.getDay(),
                        l = new Date(t);
                    l.setDate(t.getDate() - a), l.setHours(0, 0, 0, 0);
                    return j.filter(t => "Ajuste de Retorno" === t.motivo && t.codProfissional === e.codProfissional && new Date(t.created_at) >= l).length
                })(),
                rtnM = (() => {
                    if ("Ajuste de Retorno" !== e.motivo) return 0;
                    const t = new Date,
                        a = new Date(t.getFullYear(), t.getMonth(), 1);
                    return j.filter(t => "Ajuste de Retorno" === t.motivo && t.codProfissional === e.codProfissional && new Date(t.created_at) >= a).length
                })(),
                hasAlert = rtnW > 3 || rtnM > 5;
            return React.createElement("div", {
                key: e.id,
                className: "border-2 rounded-lg p-3 text-sm " + (hasAlert ? "border-yellow-500 bg-yellow-50 ring-2 ring-yellow-400" : r ? "border-red-400 bg-red-50" : o ? "border-orange-300 bg-orange-50" : "border-gray-200")
            }, hasAlert && React.createElement("div", {
                className: "mb-2 p-2 bg-yellow-200 rounded-lg text-xs font-bold text-yellow-900 flex items-center gap-2"
            }, React.createElement("span", {
                className: "text-lg"
            }, "‚ö†Ô∏è"), React.createElement("span", null, "ATEN√á√ÉO: ", rtnW > 3 ? `${rtnW} retornos na semana (m√°x 3)` : "", " ", rtnM > 5 ? `| ${rtnM} retornos no m√™s (m√°x 5)` : "")), React.createElement("div", {
                className: "flex justify-between items-start mb-2"
            }, React.createElement("p", {
                className: "font-mono text-lg font-bold"
            }, "OS: ", e.ordemServico), React.createElement("span", {
                className: "px-2 py-0.5 rounded text-xs font-bold " + (r ? "bg-red-500 text-white animate-pulse" : o ? "bg-orange-400 text-white" : "bg-gray-100 text-gray-600")
            }, r ? "üö®" : o ? "‚ö†Ô∏è" : "‚è±Ô∏è", a > 0 ? `${a}h ${l}m` : `${l}min`)), React.createElement("p", {
                className: "text-xs text-gray-700"
            }, e.fullName), React.createElement("p", {
                className: "text-xs text-gray-500 font-mono"
            }, "COD: ", e.codProfissional), React.createElement("p", {
                className: "text-xs text-purple-900 font-semibold"
            }, e.motivo), React.createElement("p", {
                className: "text-[10px] text-gray-500 mt-1"
            }, "üìÖ ", new Date(e.created_at).toLocaleDateString("pt-BR"), " √†s ", new Date(e.created_at).toLocaleTimeString("pt-BR", {
                hour: "2-digit",
                minute: "2-digit"
            })), e.coordenadas && React.createElement("div", {
                className: "mt-2 bg-green-50 border border-green-200 rounded p-2"
            }, React.createElement("p", {
                className: "text-xs font-mono text-green-900"
            }, e.coordenadas), React.createElement("div", {
                className: "flex gap-2 mt-1"
            }, React.createElement("button", {
                onClick: () => {
                    navigator.clipboard.writeText(e.coordenadas), ja("Copiado!", "success")
                },
                className: "text-xs text-green-600"
            }, "üìã Copiar"), React.createElement("a", {
                href: `https://www.google.com/maps?q=${e.coordenadas}`,
                target: "_blank",
                className: "text-xs text-green-600"
            }, "üó∫Ô∏è Maps"))), e.temImagem && React.createElement("div", {
                className: "mt-2"
            }, e.imagemComprovante ? React.createElement(React.Fragment, null, React.createElement("div", {
                className: "flex gap-2 flex-wrap"
            }, e.imagemComprovante.split("|||").map((e, t) => React.createElement("img", {
                key: t,
                src: e,
                className: "h-20 rounded cursor-pointer",
                onClick: () => g(e)
            }))), React.createElement("button", {
                onClick: () => C(t => t.map(t => t.id === e.id ? {
                    ...t,
                    imagemComprovante: null
                } : t)),
                className: "text-xs text-gray-500"
            }, "‚ñ≤ Ocultar")) : React.createElement("button", {
                onClick: () => {
                    ja("üîÑ Carregando...", "success"), Fa(e.id)
                },
                className: "px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs font-semibold"
            }, "üì∑ Ver foto(s)")), React.createElement("textarea", {
                placeholder: "Obs (opcional)",
                value: p[`obs_${e.id}`] || "",
                onChange: t => x({
                    ...p,
                    [`obs_${e.id}`]: t.target.value
                }),
                className: "w-full px-2 py-1 border rounded mt-2 text-xs",
                rows: "1"
            }), React.createElement("div", {
                className: "flex gap-2 mt-2"
            }, React.createElement("button", {
                onClick: () => Kl(e.id, !0),
                className: "flex-1 bg-green-600 text-white py-1 rounded text-xs font-semibold"
            }, "‚úì Aprovar"), React.createElement("button", {
                onClick: () => Kl(e.id, !1),
                className: "flex-1 bg-red-600 text-white py-1 rounded text-xs font-semibold"
            }, "‚úó Rejeitar")))
        })))), "search" === p.adminTab && React.createElement("div", {
            className: "bg-white rounded-xl shadow p-6"
        }, React.createElement("div", {
            className: "flex flex-wrap gap-4 mb-6"
        }, React.createElement("input", {
            type: "text",
            placeholder: "üîç Buscar por OS ou c√≥digo...",
            value: p.searchOS || "",
            onChange: e => x({
                ...p,
                searchOS: e.target.value
            }),
            className: "flex-1 px-4 py-2 border rounded-lg"
        }), React.createElement("select", {
            value: p.statusFilter || "",
            onChange: e => x({
                ...p,
                statusFilter: e.target.value
            }),
            className: "px-4 py-2 border rounded-lg"
        }, React.createElement("option", {
            value: ""
        }, "Todos status"), React.createElement("option", {
            value: "pendente"
        }, "Pendente"), React.createElement("option", {
            value: "aprovado"
        }, "Aprovado"), React.createElement("option", {
            value: "rejeitado"
        }, "Rejeitado")), React.createElement("select", {
            value: p.dateFilter || "",
            onChange: e => x({
                ...p,
                dateFilter: e.target.value
            }),
            className: "px-4 py-2 border rounded-lg"
        }, React.createElement("option", {
            value: ""
        }, "Todo per√≠odo"), React.createElement("option", {
            value: "today"
        }, "Hoje"), React.createElement("option", {
            value: "week"
        }, "Esta semana"), React.createElement("option", {
            value: "month"
        }, "Este m√™s"))), React.createElement("div", {
            className: "grid md:grid-cols-2 lg:grid-cols-3 gap-3"
        }, j.filter(e => {
            if (p.searchOS && !e.ordemServico?.toLowerCase().includes(p.searchOS.toLowerCase()) && !e.codProfissional?.toLowerCase().includes(p.searchOS.toLowerCase())) return !1;
            if (p.statusFilter && e.status !== p.statusFilter) return !1;
            if (p.dateFilter) {
                const t = new Date;
                t.setHours(0, 0, 0, 0);
                const a = new Date(e.created_at);
                if ("today" === p.dateFilter) {
                    const e = new Date(t);
                    if (e.setDate(e.getDate() + 1), a < t || a >= e) return !1
                } else if ("week" === p.dateFilter) {
                    const e = new Date(t);
                    if (e.setDate(e.getDate() - 7), a < e) return !1
                } else if ("month" === p.dateFilter) {
                    const e = new Date(t);
                    if (e.setMonth(e.getMonth() - 1), a < e) return !1
                }
            }
            return !0
        }).map(e => React.createElement("div", {
            key: e.id,
            className: "border rounded-lg p-3 text-sm " + ("aprovado" === e.status ? "bg-green-50" : "rejeitado" === e.status ? "bg-red-50" : "bg-yellow-50")
        }, React.createElement("div", {
            className: "flex justify-between items-start mb-1"
        }, React.createElement("div", null, React.createElement("p", {
            className: "font-mono font-bold"
        }, "OS: ", e.ordemServico), React.createElement("p", {
            className: "text-xs text-gray-700"
        }, e.fullName)), React.createElement("div", {
            className: "flex items-center gap-1"
        }, React.createElement("span", {
            className: "px-2 py-0.5 rounded-full text-xs font-bold " + ("aprovado" === e.status ? "bg-green-600 text-white" : "rejeitado" === e.status ? "bg-red-600 text-white" : "bg-yellow-600 text-white")
        }, e.status?.toUpperCase()), React.createElement("button", {
            onClick: async () => {
                confirm(`Excluir OS ${e.ordemServico}?`) && (await fetchAuth(`${API_URL}/submissions/${e.id}`, {
                    method: "DELETE"
                }), ja("üóëÔ∏è Exclu√≠da!", "success"), La())
            },
            className: "px-1.5 py-0.5 bg-red-600 text-white rounded text-xs"
        }, "üóëÔ∏è"))), React.createElement("p", {
            className: "text-xs text-gray-600"
        }, e.motivo), e.coordenadas && React.createElement("div", {
            className: "mt-1 bg-green-50 border border-green-200 rounded p-1.5 flex items-center justify-between"
        }, React.createElement("p", {
            className: "text-xs font-mono text-green-900"
        }, e.coordenadas), React.createElement("button", {
            onClick: () => {
                navigator.clipboard.writeText(e.coordenadas), ja("üìã Copiado!", "success")
            },
            className: "px-1.5 py-0.5 bg-green-600 text-white text-xs rounded"
        }, "üìã")), e.temImagem && React.createElement("div", {
            className: "mt-1"
        }, e.imagemComprovante ? React.createElement(React.Fragment, null, React.createElement("div", {
            className: "flex gap-1 flex-wrap"
        }, e.imagemComprovante.split("|||").map((e, t) => React.createElement("img", {
            key: t,
            src: e,
            className: "h-20 rounded cursor-pointer",
            onClick: () => g(e)
        }))), React.createElement("button", {
            onClick: () => C(t => t.map(t => t.id === e.id ? {
                ...t,
                imagemComprovante: null
            } : t)),
            className: "text-xs text-gray-500"
        }, "‚ñ≤ Ocultar")) : React.createElement("button", {
            onClick: () => {
                ja("üîÑ Carregando...", "success"), Fa(e.id)
            },
            className: "px-2 py-0.5 bg-blue-100 text-blue-800 rounded text-xs font-semibold"
        }, "üì∑ Ver foto(s)")), e.observacao && React.createElement("div", {
            className: "mt-1 bg-white p-1 rounded border"
        }, React.createElement("p", {
            className: "text-xs text-gray-600"
        }, "Obs: ", e.observacao)), React.createElement("div", {
            className: "flex justify-between items-center mt-1"
        }, React.createElement("p", {
            className: "text-xs text-gray-400"
        }, e.timestamp), e.validated_by_name && "pendente" !== e.status && React.createElement("p", {
            className: "text-xs text-purple-600 font-semibold"
        }, "üë§ ", e.validated_by_name)))))), "ranking" === p.adminTab && React.createElement("div", {
            className: "bg-white rounded-xl shadow p-6"
        }, React.createElement("h2", {
            className: "text-lg font-semibold mb-4"
        }, "üèÜ Ranking de Retorno - Aprova√ß√µes"), React.createElement("div", {
            className: "mb-6"
        }, React.createElement("select", {
            value: p.rankingPeriod || "all",
            onChange: e => x({
                ...p,
                rankingPeriod: e.target.value
            }),
            className: "px-4 py-2 border rounded-lg"
        }, React.createElement("option", {
            value: "all"
        }, "üìÖ Todos os Tempos"), React.createElement("option", {
            value: "today"
        }, "üìÖ Hoje"), React.createElement("option", {
            value: "week"
        }, "üìÖ Esta Semana"), React.createElement("option", {
            value: "month"
        }, "üìÖ Este M√™s"))), React.createElement("div", {
            className: "space-y-3"
        }, (() => {
            const e = new Date;
            e.setHours(0, 0, 0, 0);
            const t = j.filter(t => {
                    if ("aprovado" !== t.status || "Ajuste de Retorno" !== t.motivo) return !1;
                    if (!p.rankingPeriod || "all" === p.rankingPeriod) return !0;
                    const a = new Date(t.created_at);
                    if ("today" === p.rankingPeriod) {
                        const t = new Date(e);
                        return t.setDate(t.getDate() + 1), a >= e && a < t
                    }
                    if ("week" === p.rankingPeriod) {
                        const t = new Date(e);
                        return t.setDate(t.getDate() - 7), a >= t
                    }
                    if ("month" === p.rankingPeriod) {
                        const t = new Date(e);
                        return t.setMonth(t.getMonth() - 1), a >= t
                    }
                    return !0
                }),
                a = {};
            t.forEach(e => {
                const t = e.codProfissional || "SEM_COD";
                a[t] || (a[t] = {
                    nome: e.fullName || "Desconhecido",
                    cod: e.codProfissional || "-",
                    total: 0,
                    solicitacoes: []
                });
                a[t].total += 1;
                a[t].solicitacoes.push(e)
            });
            const l = Object.entries(a).sort((e, t) => t[1].total - e[1].total);
            return 0 === l.length ? React.createElement("p", {
                className: "text-gray-500 text-center py-8"
            }, "Sem dados no per√≠odo") : l.map(([k, v], i) => React.createElement("div", {
                key: i,
                className: "bg-gray-50 rounded-lg hover:bg-gray-100"
            }, React.createElement("div", {
                className: "flex items-center gap-4 p-4 cursor-pointer",
                onClick: () => x({
                    ...p,
                    [`rankingExp_${k}`]: !p[`rankingExp_${k}`]
                })
            }, React.createElement("div", {
                className: "text-3xl font-bold w-12 " + (0 === i ? "text-yellow-500" : 1 === i ? "text-gray-400" : 2 === i ? "text-orange-600" : "text-gray-400")
            }, 0 === i ? "ü•á" : 1 === i ? "ü•à" : 2 === i ? "ü•â" : `${i+1}¬∫`), React.createElement("div", {
                className: "flex-1"
            }, React.createElement("p", {
                className: "font-semibold text-lg text-gray-800"
            }, v.nome), React.createElement("p", {
                className: "text-sm text-gray-500 font-mono"
            }, "COD: ", v.cod)), React.createElement("div", {
                className: "text-right flex items-center gap-3"
            }, React.createElement("div", null, React.createElement("p", {
                className: "text-3xl font-bold text-purple-600"
            }, v.total), React.createElement("p", {
                className: "text-xs text-gray-500"
            }, "aprova√ß√µes")), React.createElement("button", {
                className: "w-8 h-8 rounded-full bg-purple-600 text-white font-bold text-lg flex items-center justify-center hover:bg-purple-700 transition-all " + (p[`rankingExp_${k}`] ? "rotate-45" : "")
            }, "+"))), p[`rankingExp_${k}`] && React.createElement("div", {
                className: "px-4 pb-4"
            }, React.createElement("div", {
                className: "bg-white rounded-lg border border-gray-200 divide-y divide-gray-100 max-h-64 overflow-y-auto"
            }, v.solicitacoes.map((s, idx) => React.createElement("div", {
                key: idx,
                className: "p-3 hover:bg-gray-50"
            }, React.createElement("div", {
                className: "flex justify-between items-center"
            }, React.createElement("div", null, React.createElement("p", {
                className: "font-mono font-semibold text-sm"
            }, "OS: ", s.ordemServico), React.createElement("p", {
                className: "text-xs text-gray-500"
            }, new Date(s.created_at).toLocaleDateString("pt-BR"), " √†s ", new Date(s.created_at).toLocaleTimeString("pt-BR", {
                hour: "2-digit",
                minute: "2-digit"
            }))), React.createElement("div", {
                className: "flex items-center gap-2"
            }, s.temImagem && React.createElement("button", {
                onClick: e => {
                    e.stopPropagation();
                    if (s.imagemComprovante) {
                        g(s.imagemComprovante.split("|||")[0])
                    } else {
                        ja("üîÑ Carregando...", "success");
                        Fa(s.id)
                    }
                },
                className: "px-2 py-1 bg-blue-100 text-blue-700 text-xs font-semibold rounded hover:bg-blue-200 flex items-center gap-1"
            }, "üì∑ Ver Foto"), React.createElement("span", {
                className: "px-2 py-1 bg-green-100 text-green-700 text-xs font-semibold rounded"
            }, "‚úì Aprovada"))), s.imagemComprovante && React.createElement("div", {
                className: "mt-2 flex gap-2 flex-wrap"
            }, s.imagemComprovante.split("|||").map((img, imgIdx) => React.createElement("img", {
                key: imgIdx,
                src: img,
                className: "h-16 rounded cursor-pointer border border-gray-200 hover:border-purple-400",
                onClick: e => {
                    e.stopPropagation();
                    g(img)
                }
            })))))))))
        })())), "disponibilidade" === p.adminTab && (
            typeof window.ModuloDisponibilidadeContent !== 'undefined' 
                ? React.createElement(window.ModuloDisponibilidadeContent, {
                    p, x, ja, API_URL, pe, Ta, A, l
                })
                : React.createElement("div", {className: "flex items-center justify-center py-12"},
                    React.createElement("div", {className: "text-center"},
                        React.createElement("div", {className: "animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto"}),
                        React.createElement("p", {className: "mt-4 text-gray-600"}, "Carregando m√≥dulo...")
                    )
                )
        ), "relatorios" === p.adminTab && (() => {
            const e = void 0 !== p.relMes ? parseInt(p.relMes) : (new Date).getMonth(),
                t = void 0 !== p.relAno ? parseInt(p.relAno) : (new Date).getFullYear(),
                a = j.filter(a => {
                    const l = new Date(a.created_at);
                    return l.getMonth() === e && l.getFullYear() === t
                }),
                l = a.filter(e => "aprovado" === e.status),
                r = a.filter(e => "rejeitado" === e.status),
                o = a.filter(e => "pendente" === e.status),
                c = a.length > 0 ? (l.length / a.length * 100).toFixed(1) : 0,
                s = a.length > 0 ? (r.length / a.length * 100).toFixed(1) : 0,
                n = {};
            a.forEach(e => {
                const t = e.motivo || "Outros";
                n[t] || (n[t] = {
                    total: 0,
                    aprovadas: 0,
                    rejeitadas: 0,
                    pendentes: 0
                }), n[t].total++, "aprovado" === e.status && n[t].aprovadas++, "rejeitado" === e.status && n[t].rejeitadas++, "pendente" === e.status && n[t].pendentes++
            });
            const m = {};
            a.forEach(e => {
                const t = e.user_name || e.cod_profissional || "Desconhecido";
                m[t] || (m[t] = {
                    total: 0,
                    aprovadas: 0,
                    rejeitadas: 0,
                    cod: e.cod_profissional
                }), m[t].total++, "aprovado" === e.status && m[t].aprovadas++, "rejeitado" === e.status && m[t].rejeitadas++
            });
            const i = Object.entries(m).map(([e, t]) => ({
                    nome: e,
                    ...t,
                    taxa: t.total > 0 ? (t.aprovadas / t.total * 100).toFixed(0) : 0
                })).sort((e, t) => t.total - e.total).slice(0, 10),
                d = [{
                    label: "Semana 1",
                    dias: [1, 7],
                    total: 0,
                    aprovadas: 0
                }, {
                    label: "Semana 2",
                    dias: [8, 14],
                    total: 0,
                    aprovadas: 0
                }, {
                    label: "Semana 3",
                    dias: [15, 21],
                    total: 0,
                    aprovadas: 0
                }, {
                    label: "Semana 4",
                    dias: [22, 31],
                    total: 0,
                    aprovadas: 0
                }];
            a.forEach(e => {
                const t = new Date(e.created_at).getDate(),
                    a = d.find(e => t >= e.dias[0] && t <= e.dias[1]);
                a && (a.total++, "aprovado" === e.status && a.aprovadas++)
            });
            const u = Math.max(...d.map(e => e.total), 1),
                g = [];
            for (let a = 5; a >= 0; a--) {
                const l = new Date(t, e - a, 1),
                    r = l.getMonth(),
                    o = l.getFullYear(),
                    c = j.filter(e => {
                        const t = new Date(e.created_at);
                        return t.getMonth() === r && t.getFullYear() === o
                    });
                g.push({
                    label: l.toLocaleDateString("pt-BR", {
                        month: "short"
                    }),
                    total: c.length,
                    aprovadas: c.filter(e => "aprovado" === e.status).length
                })
            }
            const b = Math.max(...g.map(e => e.total), 1),
                R = new Date(t, e - 1, 1),
                E = j.filter(e => {
                    const t = new Date(e.created_at);
                    return t.getMonth() === R.getMonth() && t.getFullYear() === R.getFullYear()
                }),
                h = E.length > 0 ? ((a.length - E.length) / E.length * 100).toFixed(1) : 0,
                f = ["Janeiro", "Fevereiro", "Mar√ßo", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
            return React.createElement(React.Fragment, null, React.createElement("div", {
                className: "bg-white rounded-xl shadow p-4 mb-6 flex flex-wrap items-center gap-4"
            }, React.createElement("div", {
                className: "flex items-center gap-2"
            }, React.createElement("label", {
                className: "font-semibold"
            }, "üìÖ Per√≠odo:"), React.createElement("select", {
                value: e,
                onChange: e => x({
                    ...p,
                    relMes: e.target.value
                }),
                className: "px-3 py-2 border rounded-lg"
            }, f.map((e, t) => React.createElement("option", {
                key: t,
                value: t
            }, e))), React.createElement("select", {
                value: t,
                onChange: e => x({
                    ...p,
                    relAno: e.target.value
                }),
                className: "px-3 py-2 border rounded-lg"
            }, [2024, 2025, 2026].map(e => React.createElement("option", {
                key: e,
                value: e
            }, e)))), React.createElement("button", {
                onClick: () => {
                    const m = `\n                  <html>\n                  <head>\n                    <title>Relat√≥rio Tutts - ${f[e]}/${t}</title>\n                    <style>\n                      body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }\n                      h1 { color: #581c87; border-bottom: 2px solid #581c87; padding-bottom: 10px; }\n                      h2 { color: #7c3aed; margin-top: 30px; }\n                      .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }\n                      .cards { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin: 20px 0; }\n                      .card { background: #f3f4f6; padding: 15px; border-radius: 8px; text-align: center; }\n                      .card-value { font-size: 28px; font-weight: bold; }\n                      .green { color: #16a34a; }\n                      .red { color: #dc2626; }\n                      .yellow { color: #ca8a04; }\n                      .purple { color: #7c3aed; }\n                      table { width: 100%; border-collapse: collapse; margin: 15px 0; }\n                      th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }\n                      th { background: #f3f4f6; }\n                      .footer { margin-top: 40px; text-align: center; color: #666; font-size: 12px; border-top: 1px solid #ddd; padding-top: 20px; }\n                      .comparativo { background: ${parseFloat(h)>=0?"#dcfce7":"#fee2e2"}; padding: 15px; border-radius: 8px; margin: 20px 0; }\n                    </style>\n                  </head>\n                  <body>\n                    <div class="header">\n                      <h1>üìä Relat√≥rio Tutts</h1>\n                      <div>\n                        <strong>${f[e]} / ${t}</strong><br>\n                        <small>Gerado em: ${(new Date).toLocaleString("pt-BR")}</small>\n                      </div>\n                    </div>\n                    \n                    <h2>üìã Resumo Geral</h2>\n                    <div class="cards">\n                      <div class="card"><div class="card-value purple">${a.length}</div><div>Total</div></div>\n                      <div class="card"><div class="card-value green">${l.length}</div><div>Aprovadas</div></div>\n                      <div class="card"><div class="card-value red">${r.length}</div><div>Rejeitadas</div></div>\n                      <div class="card"><div class="card-value yellow">${o.length}</div><div>Pendentes</div></div>\n                    </div>\n                    \n                    <div class="cards">\n                      <div class="card"><div class="card-value green">${c}%</div><div>Taxa Aprova√ß√£o</div></div>\n                      <div class="card"><div class="card-value red">${s}%</div><div>Taxa Rejei√ß√£o</div></div>\n                      <div class="card"><div class="card-value purple">${A.length}</div><div>Profissionais</div></div>\n                      <div class="card"><div class="card-value purple">${A.length>0?(a.length/A.length).toFixed(1):0}</div><div>M√©dia/Profissional</div></div>\n                    </div>\n                    \n                    <div class="comparativo">\n                      <strong>üìä Comparativo com M√™s Anterior:</strong> \n                      ${parseFloat(h)>=0?"üìà":"üìâ"} ${parseFloat(h)>=0?"+":""}${h}% \n                      (${E.length} ‚Üí ${a.length} solicita√ß√µes)\n                    </div>\n                    \n                    <h2>üìÅ Por Motivo</h2>\n                    <table>\n                      <thead><tr><th>Motivo</th><th>Total</th><th>Aprovadas</th><th>Rejeitadas</th><th>Pendentes</th><th>Taxa</th></tr></thead>\n                      <tbody>\n                        ${Object.entries(n).map(([e,t])=>`\n                          <tr>\n                            <td>${e}</td>\n                            <td>${t.total}</td>\n                            <td class="green">${t.aprovadas}</td>\n                            <td class="red">${t.rejeitadas}</td>\n                            <td class="yellow">${t.pendentes}</td>\n                            <td>${t.total>0?(t.aprovadas/t.total*100).toFixed(0):0}%</td>\n                          </tr>\n                        `).join("")}\n                      </tbody>\n                    </table>\n                    \n                    <h2>üë∑ Top 10 Profissionais</h2>\n                    <table>\n                      <thead><tr><th>#</th><th>Profissional</th><th>C√≥digo</th><th>Total</th><th>Aprovadas</th><th>Rejeitadas</th><th>Taxa</th></tr></thead>\n                      <tbody>\n                        ${i.map((e,t)=>`\n                          <tr>\n                            <td>${t+1}</td>\n                            <td>${e.nome}</td>\n                            <td>${e.cod||"-"}</td>\n                            <td>${e.total}</td>\n                            <td class="green">${e.aprovadas}</td>\n                            <td class="red">${e.rejeitadas}</td>\n                            <td>${e.taxa}%</td>\n                          </tr>\n                        `).join("")}\n                      </tbody>\n                    </table>\n                    \n                    <h2>üìÖ Por Semana</h2>\n                    <table>\n                      <thead><tr><th>Semana</th><th>Total</th><th>Aprovadas</th><th>Taxa</th></tr></thead>\n                      <tbody>\n                        ${d.map(e=>`\n                          <tr>\n                            <td>${e.label} (dias ${e.dias[0]}-${e.dias[1]})</td>\n                            <td>${e.total}</td>\n                            <td class="green">${e.aprovadas}</td>\n                            <td>${e.total>0?(e.aprovadas/e.total*100).toFixed(0):0}%</td>\n                          </tr>\n                        `).join("")}\n                      </tbody>\n                    </table>\n                    \n                    <div class="footer">\n                      <strong>Central do Entregador Tutts</strong> - Relat√≥rio Gerado Automaticamente<br>\n                      ${(new Date).toLocaleString("pt-BR")}\n                    </div>\n                  </body>\n                  </html>\n                `,
                        p = window.open("", "_blank");
                    p.document.write(m), p.document.close(), p.print()
                },
                className: "ml-auto px-4 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 flex items-center gap-2"
            }, "üìÑ Gerar PDF")), React.createElement("div", {
                className: "grid grid-cols-2 md:grid-cols-4 gap-4 mb-6"
            }, React.createElement("div", {
                className: "bg-white rounded-xl shadow p-4 border-l-4 border-purple-500"
            }, React.createElement("p", {
                className: "text-xs text-gray-500"
            }, "üìã Total Solicita√ß√µes"), React.createElement("p", {
                className: "text-3xl font-bold text-purple-600"
            }, a.length)), React.createElement("div", {
                className: "bg-white rounded-xl shadow p-4 border-l-4 border-green-500"
            }, React.createElement("p", {
                className: "text-xs text-gray-500"
            }, "‚úÖ Aprovadas"), React.createElement("p", {
                className: "text-3xl font-bold text-green-600"
            }, l.length)), React.createElement("div", {
                className: "bg-white rounded-xl shadow p-4 border-l-4 border-red-500"
            }, React.createElement("p", {
                className: "text-xs text-gray-500"
            }, "‚ùå Rejeitadas"), React.createElement("p", {
                className: "text-3xl font-bold text-red-600"
            }, r.length)), React.createElement("div", {
                className: "bg-white rounded-xl shadow p-4 border-l-4 border-yellow-500"
            }, React.createElement("p", {
                className: "text-xs text-gray-500"
            }, "‚è≥ Pendentes"), React.createElement("p", {
                className: "text-3xl font-bold text-yellow-600"
            }, o.length))), React.createElement("div", {
                className: "grid grid-cols-2 md:grid-cols-4 gap-4 mb-6"
            }, React.createElement("div", {
                className: "bg-green-50 rounded-xl p-4 text-center border border-green-200"
            }, React.createElement("p", {
                className: "text-3xl font-bold text-green-600"
            }, c, "%"), React.createElement("p", {
                className: "text-xs text-green-700"
            }, "Taxa de Aprova√ß√£o")), React.createElement("div", {
                className: "bg-red-50 rounded-xl p-4 text-center border border-red-200"
            }, React.createElement("p", {
                className: "text-3xl font-bold text-red-600"
            }, s, "%"), React.createElement("p", {
                className: "text-xs text-red-700"
            }, "Taxa de Rejei√ß√£o")), React.createElement("div", {
                className: "bg-purple-50 rounded-xl p-4 text-center border border-purple-200"
            }, React.createElement("p", {
                className: "text-3xl font-bold text-purple-600"
            }, A.length), React.createElement("p", {
                className: "text-xs text-purple-700"
            }, "Total Profissionais")), React.createElement("div", {
                className: "bg-blue-50 rounded-xl p-4 text-center border border-blue-200"
            }, React.createElement("p", {
                className: "text-3xl font-bold text-blue-600"
            }, A.length > 0 ? (a.length / A.length).toFixed(1) : 0), React.createElement("p", {
                className: "text-xs text-blue-700"
            }, "M√©dia por Profissional"))), React.createElement("div", {
                className: "rounded-xl p-4 mb-6 " + (parseFloat(h) >= 0 ? "bg-green-50 border border-green-200" : "bg-red-50 border border-red-200")
            }, React.createElement("h3", {
                className: "font-semibold mb-2"
            }, "üìä Comparativo com M√™s Anterior"), React.createElement("div", {
                className: "flex items-center gap-6"
            }, React.createElement("div", null, React.createElement("p", {
                className: "text-sm text-gray-600"
            }, "M√™s anterior: ", React.createElement("strong", null, E.length), " solicita√ß√µes"), React.createElement("p", {
                className: "text-sm text-gray-600"
            }, "M√™s atual: ", React.createElement("strong", null, a.length), " solicita√ß√µes")), React.createElement("div", {
                className: "text-3xl font-bold " + (parseFloat(h) >= 0 ? "text-green-600" : "text-red-600")
            }, parseFloat(h) >= 0 ? "üìà" : "üìâ", " ", parseFloat(h) >= 0 ? "+" : "", h, "%"))), React.createElement("div", {
                className: "grid md:grid-cols-2 gap-6 mb-6"
            }, React.createElement("div", {
                className: "bg-white rounded-xl shadow p-6"
            }, React.createElement("h3", {
                className: "font-semibold mb-4"
            }, "üìà Evolu√ß√£o (√öltimos 6 meses)"), React.createElement("div", {
                className: "flex items-end justify-between h-40 gap-2"
            }, g.map((e, t) => React.createElement("div", {
                key: t,
                className: "flex-1 flex flex-col items-center"
            }, React.createElement("div", {
                className: "w-full bg-gray-100 rounded-t relative",
                style: {
                    height: e.total / b * 100 + "%",
                    minHeight: "20px"
                }
            }, React.createElement("div", {
                className: "absolute inset-0 bg-gradient-to-t from-purple-600 to-purple-400 rounded-t"
            })), React.createElement("p", {
                className: "text-xs font-bold mt-1"
            }, e.total), React.createElement("p", {
                className: "text-xs text-gray-500"
            }, e.label))))), React.createElement("div", {
                className: "bg-white rounded-xl shadow p-6"
            }, React.createElement("h3", {
                className: "font-semibold mb-4"
            }, "üìÖ Por Semana (", f[e], ")"), React.createElement("div", {
                className: "flex items-end justify-between h-40 gap-2"
            }, d.map((e, t) => React.createElement("div", {
                key: t,
                className: "flex-1 flex flex-col items-center"
            }, React.createElement("div", {
                className: "w-full bg-gray-100 rounded-t relative",
                style: {
                    height: e.total / u * 100 + "%",
                    minHeight: "20px"
                }
            }, React.createElement("div", {
                className: "absolute inset-0 bg-gradient-to-t from-blue-600 to-blue-400 rounded-t"
            })), React.createElement("p", {
                className: "text-xs font-bold mt-1"
            }, e.total), React.createElement("p", {
                className: "text-xs text-gray-500"
            }, "Sem ", t + 1)))))), React.createElement("div", {
                className: "bg-white rounded-xl shadow p-6 mb-6"
            }, React.createElement("h3", {
                className: "font-semibold mb-4"
            }, "üìÅ Por Motivo"), React.createElement("div", {
                className: "overflow-x-auto"
            }, React.createElement("table", {
                className: "w-full text-sm"
            }, React.createElement("thead", {
                className: "bg-gray-50"
            }, React.createElement("tr", null, React.createElement("th", {
                className: "px-4 py-3 text-left"
            }, "Motivo"), React.createElement("th", {
                className: "px-4 py-3 text-center"
            }, "Total"), React.createElement("th", {
                className: "px-4 py-3 text-center"
            }, "‚úÖ Aprovadas"), React.createElement("th", {
                className: "px-4 py-3 text-center"
            }, "‚ùå Rejeitadas"), React.createElement("th", {
                className: "px-4 py-3 text-center"
            }, "‚è≥ Pendentes"), React.createElement("th", {
                className: "px-4 py-3 text-center"
            }, "Taxa"))), React.createElement("tbody", null, Object.entries(n).sort((e, t) => t[1].total - e[1].total).map(([e, t]) => React.createElement("tr", {
                key: e,
                className: "border-t hover:bg-gray-50"
            }, React.createElement("td", {
                className: "px-4 py-3 font-semibold"
            }, e), React.createElement("td", {
                className: "px-4 py-3 text-center font-bold"
            }, t.total), React.createElement("td", {
                className: "px-4 py-3 text-center text-green-600 font-semibold"
            }, t.aprovadas), React.createElement("td", {
                className: "px-4 py-3 text-center text-red-600 font-semibold"
            }, t.rejeitadas), React.createElement("td", {
                className: "px-4 py-3 text-center text-yellow-600 font-semibold"
            }, t.pendentes), React.createElement("td", {
                className: "px-4 py-3 text-center"
            }, React.createElement("span", {
                className: "px-2 py-1 rounded text-xs font-bold " + (t.total > 0 && t.aprovadas / t.total >= .7 ? "bg-green-100 text-green-700" : t.total > 0 && t.aprovadas / t.total >= .4 ? "bg-yellow-100 text-yellow-700" : "bg-red-100 text-red-700")
            }, t.total > 0 ? (t.aprovadas / t.total * 100).toFixed(0) : 0, "%")))))))), React.createElement("div", {
                className: "bg-white rounded-xl shadow p-6"
            }, React.createElement("h3", {
                className: "font-semibold mb-4"
            }, "üë∑ Top 10 Profissionais do M√™s"), React.createElement("div", {
                className: "overflow-x-auto"
            }, React.createElement("table", {
                className: "w-full text-sm"
            }, React.createElement("thead", {
                className: "bg-gray-50"
            }, React.createElement("tr", null, React.createElement("th", {
                className: "px-4 py-3 text-center"
            }, "#"), React.createElement("th", {
                className: "px-4 py-3 text-left"
            }, "Profissional"), React.createElement("th", {
                className: "px-4 py-3 text-left"
            }, "C√≥digo"), React.createElement("th", {
                className: "px-4 py-3 text-center"
            }, "Total"), React.createElement("th", {
                className: "px-4 py-3 text-center"
            }, "‚úÖ"), React.createElement("th", {
                className: "px-4 py-3 text-center"
            }, "‚ùå"), React.createElement("th", {
                className: "px-4 py-3 text-center"
            }, "Taxa"))), React.createElement("tbody", null, i.map((e, t) => React.createElement("tr", {
                key: t,
                className: "border-t hover:bg-gray-50 " + (t < 3 ? "bg-yellow-50" : "")
            }, React.createElement("td", {
                className: "px-4 py-3 text-center"
            }, 0 === t ? "ü•á" : 1 === t ? "ü•à" : 2 === t ? "ü•â" : t + 1), React.createElement("td", {
                className: "px-4 py-3 font-semibold"
            }, e.nome), React.createElement("td", {
                className: "px-4 py-3 font-mono text-gray-600"
            }, e.cod || "-"), React.createElement("td", {
                className: "px-4 py-3 text-center font-bold"
            }, e.total), React.createElement("td", {
                className: "px-4 py-3 text-center text-green-600 font-semibold"
            }, e.aprovadas), React.createElement("td", {
                className: "px-4 py-3 text-center text-red-600 font-semibold"
            }, e.rejeitadas), React.createElement("td", {
                className: "px-4 py-3 text-center"
            }, React.createElement("span", {
                className: "px-2 py-1 rounded text-xs font-bold " + (parseInt(e.taxa) >= 70 ? "bg-green-100 text-green-700" : parseInt(e.taxa) >= 40 ? "bg-yellow-100 text-yellow-700" : "bg-red-100 text-red-700")
            }, e.taxa, "%")))))))))
        })(), "users" === p.adminTab && React.createElement("div", {
            className: "bg-white rounded-xl shadow p-6"
        }, React.createElement("h2", {
            className: "text-lg font-semibold mb-4"
        }, "üë• Gerenciar Usu√°rios"), React.createElement("div", {
            className: "bg-purple-50 border border-purple-200 rounded-lg p-4 mb-6"
        }, React.createElement("h3", {
            className: "font-semibold mb-3"
        }, "‚ûï Criar Usu√°rio"), React.createElement("div", {
            className: "space-y-4"
        }, React.createElement("div", {
            className: "grid md:grid-cols-2 gap-4"
        }, React.createElement("div", null, React.createElement("label", {
            className: "block text-sm font-semibold mb-1"
        }, "Nome"), React.createElement("input", {
            type: "text",
            value: p.newName || "",
            onChange: e => x({
                ...p,
                newName: e.target.value
            }),
            className: "w-full px-3 py-2 border rounded"
        })), React.createElement("div", null, React.createElement("label", {
            className: "block text-sm font-semibold mb-1"
        }, "C√≥digo"), React.createElement("input", {
            type: "text",
            value: p.newCod || "",
            onChange: e => x({
                ...p,
                newCod: e.target.value
            }),
            className: "w-full px-3 py-2 border rounded"
        }))), React.createElement("div", {
            className: "grid md:grid-cols-2 gap-4"
        }, React.createElement("div", null, React.createElement("label", {
            className: "block text-sm font-semibold mb-1"
        }, "Senha"), React.createElement("input", {
            type: "password",
            value: p.newPass || "",
            onChange: e => x({
                ...p,
                newPass: e.target.value
            }),
            className: "w-full px-3 py-2 border rounded"
        })), React.createElement("div", null, React.createElement("label", {
            className: "block text-sm font-semibold mb-1"
        }, "Tipo"), React.createElement("select", {
            value: p.newRole || "user",
            onChange: e => x({
                ...p,
                newRole: e.target.value
            }),
            className: "w-full px-3 py-2 border rounded bg-white"
        }, React.createElement("option", {
            value: "user"
        }, "üë§ Usu√°rio"), React.createElement("option", {
            value: "admin"
        }, "üëë Admin"), React.createElement("option", {
            value: "admin_financeiro"
        }, "üí∞ Admin Financeiro")))), React.createElement("button", {
            onClick: async () => {
                if (p.newName && p.newCod && p.newPass) {
                    s(!0);
                    try {
                        await fetchAuth(`${API_URL}/users/register`, {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify({
                                fullName: p.newName,
                                codProfissional: p.newCod,
                                password: p.newPass,
                                role: p.newRole || "user"
                            })
                        }), ja("‚úÖ Criado!", "success"), x({
                            ...p,
                            newName: "",
                            newCod: "",
                            newPass: "",
                            newRole: "user"
                        }), Ia()
                    } catch {
                        ja("Erro", "error")
                    }
                    s(!1)
                } else ja("Preencha todos", "error")
            },
            className: "w-full px-6 py-2 bg-purple-600 text-white rounded font-semibold"
        }, "‚ûï Criar Usu√°rio"))), React.createElement("h3", {
            className: "font-semibold mb-3"
        }, "üìã Usu√°rios Cadastrados (", A.length, ")"), React.createElement("div", {
            className: "space-y-2"
        }, A.map(e => React.createElement("div", {
            key: e.codProfissional,
            className: "border rounded-lg p-4 flex items-center justify-between hover:bg-gray-50"
        }, React.createElement("div", {
            className: "flex-1"
        }, React.createElement("p", {
            className: "font-semibold"
        }, e.fullName), React.createElement("p", {
            className: "text-sm text-gray-600"
        }, "COD: ", e.codProfissional, " ‚Ä¢ ", e.role), React.createElement("p", {
            className: "text-xs text-gray-400"
        }, e.createdAt)), React.createElement("div", {
            className: "flex gap-2 items-center"
        }, React.createElement("input", {
            type: "password",
            placeholder: "Nova senha",
            value: p[`newpass_${e.codProfissional}`] || "",
            onChange: t => x({
                ...p,
                [`newpass_${e.codProfissional}`]: t.target.value
            }),
            className: "px-3 py-2 border rounded text-sm w-32"
        }), React.createElement("button", {
            onClick: async () => {
                const t = p[`newpass_${e.codProfissional}`];
                !t || t.length < 6 ? ja("Senha muito curta (m√≠n. 6)", "error") : (await fetchAuth(`${API_URL}/users/reset-password`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        codProfissional: e.codProfissional,
                        newPassword: t
                    })
                }), ja("‚úÖ Senha alterada!", "success"), x({
                    ...p,
                    [`newpass_${e.codProfissional}`]: ""
                }))
            },
            className: "px-4 py-2 bg-purple-600 text-white rounded text-sm font-semibold"
        }, "üîë Resetar"), React.createElement("button", {
            onClick: async () => {
                const t = `‚ö†Ô∏è ATEN√á√ÉO!\n\nExcluir ${e.fullName} (${e.codProfissional})?\n\nTODOS os dados associados ser√£o exclu√≠dos:\n‚Ä¢ Solicita√ß√µes de saque\n‚Ä¢ Hist√≥rico de saques\n‚Ä¢ Gratuidades\n‚Ä¢ Indica√ß√µes\n‚Ä¢ Inscri√ß√µes em promo√ß√µes\n‚Ä¢ Respostas do quiz\n\nEsta a√ß√£o N√ÉO pode ser desfeita!`;
                if (confirm(t)) {
                    try {
                        const t = await fetchAuth(`${API_URL}/users/${e.codProfissional}`, {
                                method: "DELETE"
                            }),
                            a = await t.json();
                        if (!t.ok) throw new Error(a.error);
                        {
                            const e = a.deleted;
                            ja(`üóëÔ∏è Exclu√≠do! (${e.submissions} solicita√ß√µes, ${e.withdrawals} saques, ${e.gratuities} gratuidades, ${e.indicacoes} indica√ß√µes)`, "success")
                        }
                    } catch (e) {
                        ja("‚ùå Erro ao excluir: " + e.message, "error")
                    }
                    Ia()
                }
            },
            className: "px-4 py-2 bg-red-600 text-white rounded text-sm font-semibold"
        }, "üóëÔ∏è"))))))))
    };

// =====================================================
// COMPONENTE: ScoreEntregador
// Visualiza√ß√£o completa do score para o profissional
// =====================================================
function ScoreEntregador({ user, apiUrl, showToast }) {
  const [loading, setLoading] = React.useState(true);
  const [dados, setDados] = React.useState(null);
  const [filtroData, setFiltroData] = React.useState({ inicio: '', fim: '' });
  const [abaAtiva, setAbaAtiva] = React.useState('clube');

  const carregarDados = React.useCallback(async () => {
    try {
      setLoading(true);
      let url = `${apiUrl}/score/profissional/${user.codProfissional || user.cod_profissional}`;
      const params = new URLSearchParams();
      if (filtroData.inicio) params.append('data_inicio', filtroData.inicio);
      if (filtroData.fim) params.append('data_fim', filtroData.fim);
      if (params.toString()) url += `?${params.toString()}`;
      const response = await fetch(url);
      const data = await response.json();
      setDados(data);
    } catch (error) {
      console.error('Erro ao carregar score:', error);
      showToast && showToast('Erro ao carregar seus pontos', 'error');
    } finally {
      setLoading(false);
    }
  }, [user, apiUrl, filtroData, showToast]);

  React.useEffect(() => { carregarDados(); }, [carregarDados]);

  const formatarData = (data) => {
    if (!data) return '-';
    // Evitar problema de fuso hor√°rio: pegar apenas a parte da data (YYYY-MM-DD)
    const dataStr = typeof data === 'string' ? data.split('T')[0] : data;
    const [ano, mes, dia] = dataStr.split('-');
    return `${dia}/${mes}/${ano}`;
  };
  const formatarHora = (hora) => hora ? (typeof hora === 'string' ? hora.substring(0, 5) : hora) : '-';

  if (loading && !dados) {
    return React.createElement('div', { className: 'flex items-center justify-center min-h-[400px]' },
      React.createElement('div', { className: 'text-center' },
        React.createElement('div', { className: 'w-12 h-12 border-4 border-purple-200 border-t-purple-600 rounded-full animate-spin mx-auto mb-4' }),
        React.createElement('p', { className: 'text-gray-600' }, 'Carregando seus pontos...')
      )
    );
  }

  if (!dados) {
    return React.createElement('div', { className: 'text-center py-12' },
      React.createElement('p', { className: 'text-gray-500' }, 'N√£o foi poss√≠vel carregar seus dados de pontua√ß√£o.'),
      React.createElement('button', { onClick: carregarDados, className: 'mt-4 px-4 py-2 bg-purple-600 text-white rounded-lg' }, 'üîÑ Tentar novamente')
    );
  }

  const { profissional, score, extrato, milestones, proximo_milestone } = dados;

  return React.createElement('div', { className: 'space-y-6 pb-20' },
    // Header com Score Total
    React.createElement('div', { className: 'bg-gradient-to-br from-purple-600 via-purple-700 to-indigo-800 rounded-2xl p-6 text-white shadow-xl' },
      React.createElement('div', { className: 'flex items-center justify-between mb-4' },
        React.createElement('div', null,
          React.createElement('h2', { className: 'text-lg opacity-90' }, 'Meu Score'),
          React.createElement('p', { className: 'text-sm opacity-70' }, profissional?.nome || 'Entregador')
        ),
        React.createElement('div', { className: 'text-5xl' }, '‚≠ê')
      ),
      React.createElement('div', { className: 'text-center py-4' },
        React.createElement('div', { className: 'text-6xl font-bold mb-2' }, 
          (score?.total || 0).toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })
        ),
        React.createElement('p', { className: 'text-purple-200' }, 'pontos acumulados')
      ),
      React.createElement('div', { className: 'grid grid-cols-3 gap-4 mt-4 pt-4 border-t border-purple-500/30' },
        React.createElement('div', { className: 'text-center' },
          React.createElement('div', { className: 'text-2xl font-bold' }, score?.total_os || 0),
          React.createElement('div', { className: 'text-xs opacity-70' }, 'Entregas')
        ),
        React.createElement('div', { className: 'text-center' },
          React.createElement('div', { className: 'text-2xl font-bold text-green-300' }, `${score?.taxa_no_prazo || 0}%`),
          React.createElement('div', { className: 'text-xs opacity-70' }, 'No Prazo')
        ),
        React.createElement('div', { className: 'text-center' },
          React.createElement('div', { className: 'text-2xl font-bold text-yellow-300' }, `+${(score?.bonus_janela_total || 0).toFixed(1)}`),
          React.createElement('div', { className: 'text-xs opacity-70' }, 'B√¥nus Pico')
        )
      )
    ),
    // Pr√≥ximo Milestone
    proximo_milestone && React.createElement('div', { className: 'bg-white rounded-xl p-4 shadow-lg border-l-4 border-purple-500' },
      React.createElement('div', { className: 'flex items-center gap-3 mb-3' },
        React.createElement('span', { className: 'text-3xl' }, proximo_milestone.milestone?.icone || 'üèÜ'),
        React.createElement('div', { className: 'flex-1' },
          React.createElement('h3', { className: 'font-bold text-gray-800' }, `Pr√≥ximo: ${proximo_milestone.milestone?.nome || 'Meta'}`),
          React.createElement('p', { className: 'text-sm text-gray-500' }, `Faltam ${(proximo_milestone.pontos_faltam || 0).toFixed(1)} pontos`)
        )
      ),
      React.createElement('div', { className: 'w-full bg-gray-200 rounded-full h-3 overflow-hidden' },
        React.createElement('div', { 
          className: 'h-full rounded-full transition-all duration-500',
          style: { width: `${proximo_milestone.progresso_percentual || 0}%`, background: `linear-gradient(90deg, ${proximo_milestone.milestone?.cor || '#7c3aed'}, #7c3aed)` }
        })
      ),
      React.createElement('p', { className: 'text-xs text-gray-500 mt-2 text-center' }, `${(proximo_milestone.progresso_percentual || 0).toFixed(0)}% conclu√≠do`)
    ),
    // Abas
    React.createElement('div', { className: 'flex bg-gray-100 rounded-xl p-1' },
      ['resumo', 'extrato', 'clube'].map(aba => 
        React.createElement('button', {
          key: aba,
          onClick: () => setAbaAtiva(aba),
          className: `flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-all ${abaAtiva === aba ? 'bg-white text-purple-700 shadow' : 'text-gray-500 hover:text-gray-700'}`
        }, aba === 'resumo' ? 'üìä Resumo' : aba === 'extrato' ? 'üìã Extrato' : 'üéÅ Clube')
      )
    ),
    // Aba Resumo
    abaAtiva === 'resumo' && React.createElement('div', { className: 'space-y-4' },
      React.createElement('div', { className: 'grid grid-cols-2 gap-4' },
        React.createElement('div', { className: 'bg-green-50 rounded-xl p-4 border border-green-200' },
          React.createElement('div', { className: 'flex items-center gap-2 mb-2' },
            React.createElement('span', { className: 'text-green-500 text-xl' }, '‚úì'),
            React.createElement('span', { className: 'text-green-700 font-medium' }, 'No Prazo')
          ),
          React.createElement('div', { className: 'text-2xl font-bold text-green-700' }, score?.os_no_prazo || 0),
          React.createElement('div', { className: 'text-xs text-green-600' }, `+${((score?.os_no_prazo || 0) * 0.75).toFixed(2)} pts`)
        ),
        React.createElement('div', { className: 'bg-red-50 rounded-xl p-4 border border-red-200' },
          React.createElement('div', { className: 'flex items-center gap-2 mb-2' },
            React.createElement('span', { className: 'text-red-500 text-xl' }, '‚úó'),
            React.createElement('span', { className: 'text-red-700 font-medium' }, 'Fora do Prazo')
          ),
          React.createElement('div', { className: 'text-2xl font-bold text-red-700' }, score?.os_fora_prazo || 0),
          React.createElement('div', { className: 'text-xs text-red-600' }, `${((score?.os_fora_prazo || 0) * -1).toFixed(2)} pts`)
        )
      ),
      React.createElement('div', { className: 'bg-blue-50 rounded-xl p-4 border border-blue-200' },
        React.createElement('h4', { className: 'font-bold text-blue-800 mb-3 flex items-center gap-2' },
          React.createElement('span', null, 'üí°'), 'Como ganhar mais pontos?'
        ),
        React.createElement('div', { className: 'space-y-2 text-sm text-blue-700' },
          React.createElement('div', { className: 'flex items-center gap-2' }, React.createElement('span', { className: 'text-green-500' }, '‚úì'), 'Entrega no prazo: +0,75 pts'),
          React.createElement('div', { className: 'flex items-center gap-2' }, React.createElement('span', { className: 'text-yellow-500' }, '‚è∞'), 'B√¥nus 10h-12h: +0,50 pts extra'),
          React.createElement('div', { className: 'flex items-center gap-2' }, React.createElement('span', { className: 'text-orange-500' }, 'üî•'), 'B√¥nus 16h-18h: +0,75 pts extra'),
          React.createElement('div', { className: 'flex items-center gap-2 text-red-600' }, React.createElement('span', null, '‚ö†Ô∏è'), 'Fora do prazo: -1,00 pt')
        )
      ),
      // Tabela de Prazos por KM
      React.createElement('div', { className: 'bg-gray-50 rounded-xl p-4 border border-gray-200' },
        React.createElement('h4', { className: 'font-bold text-gray-800 mb-3 flex items-center gap-2' },
          React.createElement('span', null, 'üìè'), 'Prazo por Dist√¢ncia'
        ),
        React.createElement('div', { className: 'grid grid-cols-2 gap-2 text-sm' },
          [
            { km: '0 - 10', tempo: '50 min' },
            { km: '10 - 15', tempo: '60 min' },
            { km: '15 - 20', tempo: '70 min' },
            { km: '20 - 25', tempo: '80 min' },
            { km: '25 - 30', tempo: '90 min' },
            { km: '30 - 35', tempo: '100 min' },
            { km: '35 - 40', tempo: '110 min' },
            { km: '40 - 45', tempo: '120 min' },
            { km: '45 - 50', tempo: '130 min' },
            { km: '50 - 55', tempo: '140 min' },
            { km: '55 - 60', tempo: '150 min' },
            { km: '60 - 65', tempo: '160 min' },
            { km: '65 - 70', tempo: '170 min' },
            { km: '70 - 75', tempo: '180 min' },
            { km: '75 - 80', tempo: '190 min' },
            { km: '80 - 85', tempo: '200 min' }
          ].map((faixa, idx) => 
            React.createElement('div', { key: idx, className: 'flex justify-between items-center bg-white rounded-lg px-3 py-2 border border-gray-100' },
              React.createElement('span', { className: 'text-gray-600' }, `${faixa.km} km`),
              React.createElement('span', { className: 'font-medium text-purple-600' }, faixa.tempo)
            )
          )
        )
      )
    ),
    // Aba Extrato
    abaAtiva === 'extrato' && React.createElement('div', { className: 'space-y-4' },
      React.createElement('div', { className: 'flex gap-2' },
        React.createElement('input', { type: 'date', value: filtroData.inicio, onChange: (e) => setFiltroData(prev => ({ ...prev, inicio: e.target.value })), className: 'flex-1 px-3 py-2 border rounded-lg text-sm' }),
        React.createElement('input', { type: 'date', value: filtroData.fim, onChange: (e) => setFiltroData(prev => ({ ...prev, fim: e.target.value })), className: 'flex-1 px-3 py-2 border rounded-lg text-sm' }),
        React.createElement('button', { onClick: carregarDados, className: 'px-4 py-2 bg-purple-600 text-white rounded-lg text-sm font-medium' }, 'üîç')
      ),
      React.createElement('div', { className: 'space-y-2' },
        extrato && extrato.length > 0 
          ? extrato.map((item, idx) => {
              const pontoTotal = parseFloat(item.ponto_total) || 0;
              const pontoPrazo = parseFloat(item.ponto_prazo) || 0;
              const pontoBonus = parseFloat(item.ponto_bonus_janela) || 0;
              const tempoEntrega = parseFloat(item.tempo_entrega_minutos) || 0;
              const prazoMinutos = parseFloat(item.prazo_minutos) || 0;
              const distanciaKm = parseFloat(item.distancia_km) || 0;
              return React.createElement('div', { key: idx, className: `bg-white rounded-xl p-4 shadow border-l-4 ${item.dentro_prazo ? 'border-green-500' : 'border-red-500'}` },
                // Linha 1: OS, Data e Pontua√ß√£o Total
                React.createElement('div', { className: 'flex justify-between items-start mb-2' },
                  React.createElement('div', null,
                    React.createElement('span', { className: 'font-bold text-gray-800' }, `OS ${item.os}`),
                    React.createElement('span', { className: 'text-gray-400 text-sm ml-2' }, formatarData(item.data_os))
                  ),
                  React.createElement('span', { className: `text-lg font-bold ${pontoTotal >= 0 ? 'text-green-600' : 'text-red-600'}` }, 
                    `${pontoTotal >= 0 ? '+' : ''}${pontoTotal.toFixed(2)}`
                  )
                ),
                // Linha 2: Hor√°rio, KM e Tempo
                React.createElement('div', { className: 'flex flex-wrap gap-3 text-sm text-gray-600 mb-2' },
                  React.createElement('span', { className: 'flex items-center gap-1' }, 
                    React.createElement('span', { className: 'text-purple-500' }, '‚è∞'),
                    `${formatarHora(item.hora_solicitacao)}`
                  ),
                  React.createElement('span', { className: 'flex items-center gap-1' },
                    React.createElement('span', { className: 'text-blue-500' }, 'üìç'),
                    `${distanciaKm.toFixed(1)} km`
                  ),
                  React.createElement('span', { className: 'flex items-center gap-1' },
                    React.createElement('span', { className: item.dentro_prazo ? 'text-green-500' : 'text-red-500' }, 'üöÄ'),
                    `${tempoEntrega.toFixed(0)}/${prazoMinutos.toFixed(0)} min`
                  )
                ),
                // Linha 3: Detalhamento dos pontos
                React.createElement('div', { className: 'flex flex-wrap gap-2 text-xs' },
                  React.createElement('span', { className: `px-2 py-1 rounded-full ${item.dentro_prazo ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}` },
                    item.dentro_prazo ? `‚úì No prazo (+${pontoPrazo.toFixed(2)})` : `‚úó Fora do prazo (${pontoPrazo.toFixed(2)})`
                  ),
                  pontoBonus > 0 && React.createElement('span', { className: 'px-2 py-1 bg-yellow-100 text-yellow-700 rounded-full' },
                    `üéØ B√¥nus ${item.janela_bonus} (+${pontoBonus.toFixed(2)})`
                  )
                )
              );
            })
          : React.createElement('div', { className: 'text-center py-8 text-gray-500' },
              React.createElement('span', { className: 'text-4xl block mb-2' }, 'üì≠'), 'Nenhuma entrega registrada no per√≠odo'
            )
      )
    ),
    // Aba Clube
    abaAtiva === 'clube' && React.createElement('div', { className: 'space-y-4' },
      React.createElement('div', { className: 'text-center mb-4' },
        React.createElement('h3', { className: 'text-xl font-bold text-gray-800' }, 'üéÅ Clube de Benef√≠cios'),
        React.createElement('p', { className: 'text-gray-500 text-sm' }, 'Alcance marcos e desbloqueie pr√™mios!')
      ),
      milestones && milestones.map((milestone, idx) => {
        const isPremioFisico = milestone.pontos_necessarios === 250 || milestone.pontos_necessarios === 300;
        const premioRecebido = milestone.premio_recebido || milestone.premio_status === 'entregue';
        
        return React.createElement('div', { key: idx, className: `rounded-xl p-4 border-2 transition-all ${milestone.conquistado ? 'bg-gradient-to-r from-purple-50 to-indigo-50 border-purple-300 shadow-lg' : 'bg-gray-50 border-gray-200 opacity-70'}` },
          React.createElement('div', { className: 'flex items-center gap-4' },
            React.createElement('span', { className: `text-4xl ${milestone.conquistado ? '' : 'grayscale opacity-50'}` }, milestone.icone),
            React.createElement('div', { className: 'flex-1' },
              React.createElement('div', { className: 'flex items-center gap-2 flex-wrap' },
                React.createElement('h4', { className: `font-bold ${milestone.conquistado ? 'text-purple-800' : 'text-gray-500'}` }, milestone.nome),
                milestone.conquistado && !isPremioFisico && React.createElement('span', { className: 'text-xs px-2 py-0.5 bg-green-500 text-white rounded-full' }, '‚úì Conquistado!'),
                milestone.conquistado && isPremioFisico && premioRecebido && React.createElement('span', { className: 'text-xs px-2 py-0.5 bg-green-500 text-white rounded-full' }, '‚úì Pr√™mio Recebido'),
                milestone.conquistado && isPremioFisico && !premioRecebido && React.createElement('span', { className: 'text-xs px-2 py-0.5 bg-yellow-500 text-white rounded-full animate-pulse' }, 'üéÅ Dispon√≠vel para retirada!')
              ),
              React.createElement('p', { className: 'text-sm text-gray-600' }, milestone.descricao),
              React.createElement('p', { className: `text-xs mt-1 ${milestone.conquistado ? 'text-purple-600' : 'text-gray-400'}` }, `${milestone.pontos_necessarios} pontos necess√°rios`)
            )
          ),
          milestone.beneficio && React.createElement('div', { className: 'mt-3 pt-3 border-t border-gray-200 text-sm' },
            React.createElement('span', { className: 'text-gray-500' }, 'üéÅ Benef√≠cio: '),
            React.createElement('span', { className: milestone.conquistado ? 'text-purple-700 font-medium' : 'text-gray-400' }, milestone.beneficio),
            isPremioFisico && milestone.conquistado && !premioRecebido && React.createElement('p', { className: 'text-xs text-yellow-600 mt-1' }, '‚ö†Ô∏è Procure o escrit√≥rio para retirar seu pr√™mio!')
          )
        );
      })
    )
  );
}

// =====================================================
// COMPONENTE: ScoreAdmin
// Dashboard administrativo para gestores
// =====================================================
function ScoreAdmin({ apiUrl, showToast }) {
  const [loading, setLoading] = React.useState(true);
  const [estatisticas, setEstatisticas] = React.useState(null);
  const [ranking, setRanking] = React.useState([]);
  const [milestones, setMilestones] = React.useState([]);
  const [filtros, setFiltros] = React.useState({ data_inicio: '', data_fim: '', limite: 10000 });
  const [buscaProfissional, setBuscaProfissional] = React.useState('');
  const [profissionalSelecionado, setProfissionalSelecionado] = React.useState(null);
  const [recalculando, setRecalculando] = React.useState(false);
  const [abaAtiva, setAbaAtiva] = React.useState('ranking');
  const [dadosCarregados, setDadosCarregados] = React.useState(false);
  const [premiosPendentes, setPremiosPendentes] = React.useState([]);

  const carregarDados = async () => {
    try {
      setLoading(true);
      let rankingUrl = `${apiUrl}/score/ranking?limite=${filtros.limite}`;
      if (filtros.data_inicio) rankingUrl += `&data_inicio=${filtros.data_inicio}`;
      if (filtros.data_fim) rankingUrl += `&data_fim=${filtros.data_fim}`;
      
      const [rankingRes, estatRes, milestonesRes] = await Promise.all([
        fetch(rankingUrl).then(r => r.json()),
        fetch(`${apiUrl}/score/estatisticas${filtros.data_inicio ? `?data_inicio=${filtros.data_inicio}&data_fim=${filtros.data_fim}` : ''}`).then(r => r.json()),
        fetch(`${apiUrl}/score/milestones`).then(r => r.json())
      ]);
      
      setRanking(rankingRes.ranking || []);
      setEstatisticas(estatRes);
      setMilestones(milestonesRes);
      setDadosCarregados(true);
    } catch (error) {
      console.error('Erro ao carregar dados:', error);
      showToast && showToast('Erro ao carregar dados', 'error');
    } finally {
      setLoading(false);
    }
  };

  const carregarPremios = async () => {
    try {
      const res = await fetch(`${apiUrl}/score/premios-pendentes`);
      const data = await res.json();
      setPremiosPendentes(data || []);
    } catch (error) {
      console.error('Erro ao carregar pr√™mios:', error);
    }
  };

  React.useEffect(() => { 
    if (!dadosCarregados) carregarDados(); 
  }, []);

  const recalcularScores = async () => {
    if (!window.confirm('Recalcular todos os scores? Isso pode levar alguns minutos.')) return;
    try {
      setRecalculando(true);
      const response = await fetch(`${apiUrl}/score/recalcular`, {
        method: 'POST', headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ data_inicio: filtros.data_inicio || null, data_fim: filtros.data_fim || null })
      });
      const result = await response.json();
      if (result.success) {
        showToast && showToast(`Score recalculado: ${result.processadas} OS processadas`, 'success');
        carregarDados();
      }
    } catch (error) {
      showToast && showToast('Erro ao recalcular scores', 'error');
    } finally {
      setRecalculando(false);
    }
  };

  const buscarProfissional = async () => {
    if (!buscaProfissional) return;
    try {
      const response = await fetch(`${apiUrl}/score/profissional/${buscaProfissional}`);
      const data = await response.json();
      setProfissionalSelecionado(data);
    } catch (error) {
      showToast && showToast('Profissional n√£o encontrado', 'error');
    }
  };

  if (loading && !estatisticas) {
    return React.createElement('div', { className: 'flex items-center justify-center min-h-[400px]' },
      React.createElement('div', { className: 'w-12 h-12 border-4 border-purple-200 border-t-purple-600 rounded-full animate-spin' })
    );
  }

  return React.createElement('div', { className: 'space-y-6' },
    React.createElement('div', { className: 'flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4' },
      React.createElement('div', null,
        React.createElement('h2', { className: 'text-2xl font-bold text-gray-800' }, '‚≠ê Score Prof'),
        React.createElement('p', { className: 'text-gray-500' }, 'Gest√£o de pontua√ß√£o dos profissionais')
      ),
      React.createElement('button', {
        onClick: recalcularScores, disabled: recalculando,
        className: `px-4 py-2 rounded-lg font-medium flex items-center gap-2 ${recalculando ? 'bg-gray-300 text-gray-500' : 'bg-teal-600 text-white hover:bg-teal-700'}`
      }, recalculando ? '‚è≥ Processando...' : 'üîÑ Recalcular Scores')
    ),
    React.createElement('div', { className: 'bg-white rounded-xl p-4 shadow flex flex-wrap gap-4 items-end' },
      React.createElement('div', { className: 'flex-1 min-w-[150px]' },
        React.createElement('label', { className: 'block text-sm text-gray-600 mb-1' }, 'Data In√≠cio'),
        React.createElement('input', { type: 'date', value: filtros.data_inicio, onChange: (e) => setFiltros(prev => ({ ...prev, data_inicio: e.target.value })), className: 'w-full px-3 py-2 border rounded-lg' })
      ),
      React.createElement('div', { className: 'flex-1 min-w-[150px]' },
        React.createElement('label', { className: 'block text-sm text-gray-600 mb-1' }, 'Data Fim'),
        React.createElement('input', { type: 'date', value: filtros.data_fim, onChange: (e) => setFiltros(prev => ({ ...prev, data_fim: e.target.value })), className: 'w-full px-3 py-2 border rounded-lg' })
      ),
      React.createElement('div', { className: 'flex-1 min-w-[200px]' },
        React.createElement('label', { className: 'block text-sm text-gray-600 mb-1' }, 'Buscar Profissional'),
        React.createElement('div', { className: 'flex gap-2' },
          React.createElement('input', { type: 'text', value: buscaProfissional, onChange: (e) => setBuscaProfissional(e.target.value), placeholder: 'C√≥digo', className: 'flex-1 px-3 py-2 border rounded-lg' }),
          React.createElement('button', { onClick: buscarProfissional, className: 'px-4 py-2 bg-gray-600 text-white rounded-lg' }, 'üîç')
        )
      ),
      React.createElement('button', { onClick: carregarDados, className: 'px-4 py-2 bg-purple-600 text-white rounded-lg font-medium' }, 'Filtrar')
    ),
    estatisticas?.resumo && React.createElement('div', { className: 'grid grid-cols-2 md:grid-cols-4 gap-4' },
      React.createElement('div', { className: 'bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-4 text-white' },
        React.createElement('div', { className: 'text-3xl mb-1' }, 'üë•'),
        React.createElement('div', { className: 'text-2xl font-bold' }, estatisticas.resumo.total_profissionais),
        React.createElement('div', { className: 'text-sm opacity-80' }, 'Profissionais')
      ),
      React.createElement('div', { className: 'bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-4 text-white' },
        React.createElement('div', { className: 'text-3xl mb-1' }, 'üì¶'),
        React.createElement('div', { className: 'text-2xl font-bold' }, estatisticas.resumo.total_os),
        React.createElement('div', { className: 'text-sm opacity-80' }, 'Entregas')
      ),
      React.createElement('div', { className: 'bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 text-white' },
        React.createElement('div', { className: 'text-3xl mb-1' }, '‚≠ê'),
        React.createElement('div', { className: 'text-2xl font-bold' }, (estatisticas.resumo.pontos_distribuidos || 0).toLocaleString('pt-BR', { maximumFractionDigits: 0 })),
        React.createElement('div', { className: 'text-sm opacity-80' }, 'Pontos Distribu√≠dos')
      ),
      React.createElement('div', { className: 'bg-gradient-to-br from-yellow-500 to-orange-500 rounded-xl p-4 text-white' },
        React.createElement('div', { className: 'text-3xl mb-1' }, 'üéØ'),
        React.createElement('div', { className: 'text-2xl font-bold' }, `${estatisticas.resumo.taxa_prazo}%`),
        React.createElement('div', { className: 'text-sm opacity-80' }, 'Taxa No Prazo')
      )
    ),
    profissionalSelecionado && React.createElement('div', { className: 'fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4', onClick: () => setProfissionalSelecionado(null) },
      React.createElement('div', { className: 'bg-white rounded-2xl max-w-lg w-full max-h-[80vh] overflow-y-auto p-6', onClick: (e) => e.stopPropagation() },
        React.createElement('div', { className: 'flex justify-between items-center mb-4' },
          React.createElement('h3', { className: 'text-xl font-bold' }, profissionalSelecionado.profissional?.nome),
          React.createElement('button', { onClick: () => setProfissionalSelecionado(null), className: 'text-gray-400 hover:text-gray-600 text-2xl' }, '√ó')
        ),
        React.createElement('div', { className: 'bg-purple-50 rounded-xl p-4 text-center mb-4' },
          React.createElement('div', { className: 'text-4xl font-bold text-purple-700' }, (profissionalSelecionado.score?.total || 0).toFixed(2)),
          React.createElement('div', { className: 'text-purple-600' }, 'pontos totais')
        ),
        React.createElement('div', { className: 'grid grid-cols-2 gap-4' },
          React.createElement('div', { className: 'text-center p-3 bg-green-50 rounded-lg' },
            React.createElement('div', { className: 'text-2xl font-bold text-green-700' }, profissionalSelecionado.score?.os_no_prazo || 0),
            React.createElement('div', { className: 'text-sm text-green-600' }, 'No Prazo')
          ),
          React.createElement('div', { className: 'text-center p-3 bg-red-50 rounded-lg' },
            React.createElement('div', { className: 'text-2xl font-bold text-red-700' }, profissionalSelecionado.score?.os_fora_prazo || 0),
            React.createElement('div', { className: 'text-sm text-red-600' }, 'Fora Prazo')
          )
        )
      )
    ),
    React.createElement('div', { className: 'flex bg-gray-100 rounded-xl p-1' },
      [{ id: 'ranking', label: 'üèÖ Ranking' }, { id: 'premios', label: 'üéÅ Pr√™mios' }, { id: 'estatisticas', label: 'üìä Estat√≠sticas' }].map(aba => 
        React.createElement('button', { key: aba.id, onClick: () => { setAbaAtiva(aba.id); if (aba.id === 'premios') carregarPremios(); },
          className: `flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-all ${abaAtiva === aba.id ? 'bg-white text-teal-700 shadow' : 'text-gray-500 hover:text-gray-700'}`
        }, aba.label)
      )
    ),
    abaAtiva === 'ranking' && React.createElement('div', { className: 'bg-white rounded-xl shadow overflow-hidden' },
      React.createElement('div', { className: 'overflow-x-auto' },
        React.createElement('table', { className: 'w-full' },
          React.createElement('thead', { className: 'bg-gray-50' },
            React.createElement('tr', null,
              React.createElement('th', { className: 'px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase' }, '#'),
              React.createElement('th', { className: 'px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase' }, 'Profissional'),
              React.createElement('th', { className: 'px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase' }, 'Score'),
              React.createElement('th', { className: 'px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase' }, 'Entregas'),
              React.createElement('th', { className: 'px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase' }, 'Taxa Prazo'),
              React.createElement('th', { className: 'px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase' }, 'N√≠vel')
            )
          ),
          React.createElement('tbody', { className: 'divide-y divide-gray-200' },
            ranking.map((prof, idx) => {
              const score = parseFloat(prof.score_total) || 0;
              let nivel = { icone: '‚ö™', nome: 'Sem n√≠vel', cor: 'bg-gray-100 text-gray-600' };
              if (score >= 500) nivel = { icone: 'üëë', nome: 'Diamante', cor: 'bg-cyan-100 text-cyan-700' };
              else if (score >= 300) nivel = { icone: 'üíé', nome: 'Platina', cor: 'bg-purple-100 text-purple-700' };
              else if (score >= 250) nivel = { icone: 'ü•á', nome: 'Ouro', cor: 'bg-yellow-100 text-yellow-700' };
              else if (score >= 100) nivel = { icone: 'ü•à', nome: 'Prata', cor: 'bg-gray-200 text-gray-700' };
              else if (score >= 80) nivel = { icone: 'ü•â', nome: 'Bronze', cor: 'bg-orange-100 text-orange-700' };
              
              return React.createElement('tr', { key: idx, className: 'hover:bg-gray-50 cursor-pointer',
                onClick: async () => { const res = await fetch(`${apiUrl}/score/profissional/${prof.cod_prof}`); setProfissionalSelecionado(await res.json()); }
              },
                React.createElement('td', { className: 'px-4 py-3' },
                  React.createElement('span', { className: `inline-flex items-center justify-center w-8 h-8 rounded-full text-sm font-bold ${prof.posicao === 1 ? 'bg-yellow-100 text-yellow-700' : prof.posicao === 2 ? 'bg-gray-200 text-gray-700' : prof.posicao === 3 ? 'bg-orange-100 text-orange-700' : 'bg-gray-100 text-gray-600'}` }, 
                    prof.posicao <= 3 ? ['ü•á', 'ü•à', 'ü•â'][prof.posicao - 1] : prof.posicao)
                ),
                React.createElement('td', { className: 'px-4 py-3' },
                  React.createElement('div', { className: 'font-medium text-gray-800' }, prof.nome),
                  React.createElement('div', { className: 'text-xs text-gray-400' }, `#${prof.cod_prof}`)
                ),
                React.createElement('td', { className: 'px-4 py-3 text-right font-bold text-purple-600' }, prof.score_total.toFixed(2)),
                React.createElement('td', { className: 'px-4 py-3 text-right text-gray-600' }, prof.total_os),
                React.createElement('td', { className: 'px-4 py-3 text-right' },
                  React.createElement('span', { className: `px-2 py-1 rounded-full text-xs font-medium ${prof.taxa_prazo >= 90 ? 'bg-green-100 text-green-700' : prof.taxa_prazo >= 70 ? 'bg-yellow-100 text-yellow-700' : 'bg-red-100 text-red-700'}` }, `${prof.taxa_prazo}%`)
                ),
                React.createElement('td', { className: 'px-4 py-3 text-center' },
                  React.createElement('span', { className: `px-2 py-1 rounded-full text-xs font-medium ${nivel.cor}` }, `${nivel.icone} ${nivel.nome}`)
                )
              );
            })
          )
        )
      )
    ),
    abaAtiva === 'premios' && React.createElement('div', { className: 'space-y-6' },
      React.createElement('div', { className: 'bg-white rounded-xl p-6 shadow' },
        React.createElement('div', { className: 'flex justify-between items-center mb-4' },
          React.createElement('h3', { className: 'font-bold text-lg' }, 'üéÅ Pr√™mios F√≠sicos Pendentes'),
          React.createElement('button', { onClick: carregarPremios, className: 'px-3 py-1 bg-teal-100 text-teal-700 rounded-lg text-sm font-medium hover:bg-teal-200' }, 'üîÑ Atualizar')
        ),
        premiosPendentes.length === 0 
          ? React.createElement('div', { className: 'text-center py-8 text-gray-500' },
              React.createElement('span', { className: 'text-4xl block mb-2' }, 'üéØ'),
              React.createElement('p', null, 'Nenhum profissional atingiu n√≠vel Ouro (250pts) ou Platina (300pts) ainda')
            )
          : React.createElement('div', { className: 'space-y-4' },
              premiosPendentes.map((prof, idx) =>
                React.createElement('div', { key: idx, className: 'border rounded-xl p-4 bg-gray-50' },
                  React.createElement('div', { className: 'flex justify-between items-start mb-3' },
                    React.createElement('div', null,
                      React.createElement('div', { className: 'font-bold text-gray-800' }, prof.nome_prof),
                      React.createElement('div', { className: 'text-sm text-gray-500' }, `#${prof.cod_prof} ‚Ä¢ ${prof.score_total.toFixed(2)} pontos`)
                    )
                  ),
                  React.createElement('div', { className: 'space-y-2' },
                    prof.premios.map((premio, pIdx) =>
                      React.createElement('div', { key: pIdx, className: `flex items-center justify-between p-3 rounded-lg ${premio.status === 'entregue' ? 'bg-green-50 border border-green-200' : 'bg-white border border-gray-200'}` },
                        React.createElement('div', { className: 'flex items-center gap-3' },
                          React.createElement('span', { className: 'text-2xl' }, premio.icone),
                          React.createElement('div', null,
                            React.createElement('div', { className: 'font-medium' }, premio.milestone_nome),
                            React.createElement('div', { className: 'text-sm text-gray-500' }, premio.beneficio)
                          )
                        ),
                        premio.status === 'entregue'
                          ? React.createElement('span', { className: 'px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium' }, '‚úÖ Entregue')
                          : React.createElement('button', { 
                              onClick: async () => {
                                if (!window.confirm(`Confirmar entrega de "${premio.beneficio}" para ${prof.nome_prof}?`)) return;
                                try {
                                  const res = await fetch(`${apiUrl}/score/premios-fisicos/confirmar`, {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify({ cod_prof: prof.cod_prof, milestone_id: premio.milestone_id, confirmado_por: 'Admin' })
                                  });
                                  const data = await res.json();
                                  if (data.success) {
                                    showToast && showToast('Pr√™mio confirmado!', 'success');
                                    carregarPremios();
                                  }
                                } catch (err) {
                                  showToast && showToast('Erro ao confirmar', 'error');
                                }
                              },
                              className: 'px-4 py-2 bg-teal-600 text-white rounded-lg text-sm font-medium hover:bg-teal-700'
                            }, '‚úì Confirmar Entrega')
                      )
                    )
                  )
                )
              )
            )
      ),
      // Progresso geral dos milestones
      React.createElement('div', { className: 'bg-white rounded-xl p-6 shadow' },
        React.createElement('h3', { className: 'font-bold text-lg mb-4' }, 'üìä Progresso dos Milestones'),
        React.createElement('div', { className: 'space-y-4' },
          milestones.map((m, idx) => {
            const total = ranking.length;
            const alcancaram = ranking.filter(p => parseFloat(p.score_total) >= m.pontos_necessarios).length;
            const percentual = total > 0 ? (alcancaram / total * 100).toFixed(1) : 0;
            return React.createElement('div', { key: idx, className: 'border rounded-lg p-4' },
              React.createElement('div', { className: 'flex justify-between items-center mb-2' },
                React.createElement('div', { className: 'flex items-center gap-2' },
                  React.createElement('span', { className: 'text-2xl' }, m.icone),
                  React.createElement('div', null,
                    React.createElement('div', { className: 'font-medium' }, m.nome),
                    React.createElement('div', { className: 'text-sm text-gray-500' }, `${m.pontos_necessarios} pts - ${m.beneficio}`)
                  )
                ),
                React.createElement('div', { className: 'text-right' },
                  React.createElement('div', { className: 'font-bold text-teal-600' }, `${alcancaram}/${total}`),
                  React.createElement('div', { className: 'text-xs text-gray-500' }, `${percentual}%`)
                )
              ),
              React.createElement('div', { className: 'w-full bg-gray-200 rounded-full h-2' },
                React.createElement('div', { className: 'bg-teal-500 h-2 rounded-full transition-all', style: { width: `${percentual}%` } })
              )
            );
          })
        )
      )
    ),
    abaAtiva === 'estatisticas' && estatisticas && React.createElement('div', { className: 'space-y-6' },
      React.createElement('div', { className: 'bg-white rounded-xl p-6 shadow' },
        React.createElement('h3', { className: 'font-bold text-lg mb-4' }, 'üèÜ Top 10 do Per√≠odo'),
        React.createElement('div', { className: 'space-y-3' },
          estatisticas.top_10?.map((prof, idx) => 
            React.createElement('div', { key: idx, className: 'flex items-center gap-4 p-3 bg-gray-50 rounded-lg' },
              React.createElement('span', { className: 'text-2xl' }, idx < 3 ? ['ü•á', 'ü•à', 'ü•â'][idx] : `${idx + 1}¬∫`),
              React.createElement('div', { className: 'flex-1' },
                React.createElement('div', { className: 'font-medium' }, prof.nome),
                React.createElement('div', { className: 'text-sm text-gray-500' }, `${prof.total_os} entregas`)
              ),
              React.createElement('div', { className: 'text-xl font-bold text-purple-600' }, prof.score_total.toFixed(1))
            )
          )
        )
      )
    )
  );
}

// =====================================================
// COMPONENTE: AuditLogs
// Visualiza√ß√£o de logs de auditoria para administradores
// =====================================================
function AuditLogs({ apiUrl, showToast }) {
  const [logs, setLogs] = React.useState([]);
  const [stats, setStats] = React.useState(null);
  const [loading, setLoading] = React.useState(true);
  const [filtros, setFiltros] = React.useState({
    page: 1,
    limit: 30,
    category: '',
    action: '',
    user_cod: '',
    data_inicio: '',
    data_fim: '',
    search: ''
  });
  const [abaAtiva, setAbaAtiva] = React.useState('logs');

  const carregarLogs = async () => {
    try {
      setLoading(true);
      const params = new URLSearchParams();
      Object.entries(filtros).forEach(([key, value]) => {
        if (value) params.append(key, value);
      });
      
      const response = await fetchAuth(`${apiUrl}/audit/logs?${params}`);
      if (response.ok) {
        const data = await response.json();
        setLogs(data.logs || []);
        setFiltros(prev => ({ ...prev, totalPages: data.pagination?.totalPages || 1, total: data.pagination?.total || 0 }));
      }
    } catch (error) {
      console.error('Erro ao carregar logs:', error);
    } finally {
      setLoading(false);
    }
  };

  const carregarStats = async () => {
    try {
      const response = await fetchAuth(`${apiUrl}/audit/stats?dias=7`);
      if (response.ok) {
        const data = await response.json();
        setStats(data);
      }
    } catch (error) {
      console.error('Erro ao carregar stats:', error);
    }
  };

  const exportarCSV = async () => {
    try {
      const params = new URLSearchParams();
      if (filtros.data_inicio) params.append('data_inicio', filtros.data_inicio);
      if (filtros.data_fim) params.append('data_fim', filtros.data_fim);
      if (filtros.category) params.append('category', filtros.category);
      
      const response = await fetchAuth(`${apiUrl}/audit/export?${params}`);
      if (response.ok) {
        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `audit_logs_${new Date().toISOString().split('T')[0]}.csv`;
        a.click();
        showToast && showToast('Exporta√ß√£o conclu√≠da!', 'success');
      }
    } catch (error) {
      showToast && showToast('Erro ao exportar', 'error');
    }
  };

  React.useEffect(() => {
    carregarLogs();
    carregarStats();
  }, []);

  React.useEffect(() => {
    carregarLogs();
  }, [filtros.page, filtros.category]);

  const getCategoryColor = (cat) => {
    const colors = {
      auth: 'bg-blue-100 text-blue-700',
      user: 'bg-purple-100 text-purple-700',
      financial: 'bg-green-100 text-green-700',
      data: 'bg-yellow-100 text-yellow-700',
      config: 'bg-gray-100 text-gray-700',
      score: 'bg-orange-100 text-orange-700',
      admin: 'bg-red-100 text-red-700'
    };
    return colors[cat] || 'bg-gray-100 text-gray-700';
  };

  const getActionIcon = (action) => {
    if (action.includes('LOGIN')) return 'üîê';
    if (action.includes('DELETE')) return 'üóëÔ∏è';
    if (action.includes('CREATE')) return '‚ûï';
    if (action.includes('WITHDRAWAL')) return 'üí∞';
    if (action.includes('EXPORT')) return 'üì§';
    return 'üìã';
  };

  const formatDate = (dateStr) => {
    if (!dateStr) return '-';
    const date = new Date(dateStr);
    return date.toLocaleString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' });
  };

  return React.createElement('div', { className: 'space-y-6' },
    // Header
    React.createElement('div', { className: 'flex justify-between items-center' },
      React.createElement('div', null,
        React.createElement('h2', { className: 'text-2xl font-bold text-gray-800' }, 'üìã Logs de Auditoria'),
        React.createElement('p', { className: 'text-gray-500' }, 'Registro de todas as a√ß√µes do sistema')
      ),
      React.createElement('button', {
        onClick: exportarCSV,
        className: 'px-4 py-2 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 flex items-center gap-2'
      }, 'üì• Exportar CSV')
    ),

    // Abas
    React.createElement('div', { className: 'flex bg-gray-100 rounded-xl p-1' },
      [{ id: 'logs', label: 'üìã Logs' }, { id: 'stats', label: 'üìä Estat√≠sticas' }].map(aba =>
        React.createElement('button', {
          key: aba.id,
          onClick: () => setAbaAtiva(aba.id),
          className: `flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-all ${abaAtiva === aba.id ? 'bg-white text-gray-700 shadow' : 'text-gray-500 hover:text-gray-700'}`
        }, aba.label)
      )
    ),

    // Aba Estat√≠sticas
    abaAtiva === 'stats' && stats && React.createElement('div', { className: 'space-y-6' },
      // Cards de resumo
      React.createElement('div', { className: 'grid grid-cols-2 md:grid-cols-4 gap-4' },
        React.createElement('div', { className: 'bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-4 text-white' },
          React.createElement('div', { className: 'text-3xl mb-1' }, 'üìä'),
          React.createElement('div', { className: 'text-2xl font-bold' }, stats.total_acoes),
          React.createElement('div', { className: 'text-sm opacity-80' }, `A√ß√µes (${stats.periodo_dias} dias)`)
        ),
        React.createElement('div', { className: 'bg-gradient-to-br from-red-500 to-red-600 rounded-xl p-4 text-white' },
          React.createElement('div', { className: 'text-3xl mb-1' }, '‚ö†Ô∏è'),
          React.createElement('div', { className: 'text-2xl font-bold' }, stats.falhas_login),
          React.createElement('div', { className: 'text-sm opacity-80' }, 'Falhas de Login')
        ),
        React.createElement('div', { className: 'bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-4 text-white' },
          React.createElement('div', { className: 'text-3xl mb-1' }, 'üë•'),
          React.createElement('div', { className: 'text-2xl font-bold' }, stats.usuarios_ativos?.length || 0),
          React.createElement('div', { className: 'text-sm opacity-80' }, 'Usu√°rios Ativos')
        ),
        React.createElement('div', { className: 'bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 text-white' },
          React.createElement('div', { className: 'text-3xl mb-1' }, '‚úÖ'),
          React.createElement('div', { className: 'text-2xl font-bold' }, stats.por_categoria?.length || 0),
          React.createElement('div', { className: 'text-sm opacity-80' }, 'Categorias')
        )
      ),

      // Top a√ß√µes e usu√°rios
      React.createElement('div', { className: 'grid md:grid-cols-2 gap-6' },
        React.createElement('div', { className: 'bg-white rounded-xl p-6 shadow' },
          React.createElement('h3', { className: 'font-bold text-lg mb-4' }, 'üî• Top A√ß√µes'),
          React.createElement('div', { className: 'space-y-2' },
            stats.top_acoes?.map((item, idx) =>
              React.createElement('div', { key: idx, className: 'flex justify-between items-center p-2 bg-gray-50 rounded-lg' },
                React.createElement('span', { className: 'text-sm' }, item.action),
                React.createElement('span', { className: 'font-bold text-purple-600' }, item.total)
              )
            )
          )
        ),
        React.createElement('div', { className: 'bg-white rounded-xl p-6 shadow' },
          React.createElement('h3', { className: 'font-bold text-lg mb-4' }, 'üë• Usu√°rios Mais Ativos'),
          React.createElement('div', { className: 'space-y-2' },
            stats.usuarios_ativos?.map((item, idx) =>
              React.createElement('div', { key: idx, className: 'flex justify-between items-center p-2 bg-gray-50 rounded-lg' },
                React.createElement('div', null,
                  React.createElement('span', { className: 'text-sm font-medium' }, item.user_name),
                  React.createElement('span', { className: 'text-xs text-gray-500 ml-2' }, `#${item.user_cod}`)
                ),
                React.createElement('span', { className: 'font-bold text-purple-600' }, item.total)
              )
            )
          )
        )
      )
    ),

    // Aba Logs
    abaAtiva === 'logs' && React.createElement('div', { className: 'space-y-4' },
      // Filtros
      React.createElement('div', { className: 'bg-white rounded-xl p-4 shadow flex flex-wrap gap-4 items-end' },
        React.createElement('div', { className: 'flex-1 min-w-[150px]' },
          React.createElement('label', { className: 'block text-sm text-gray-600 mb-1' }, 'Categoria'),
          React.createElement('select', {
            value: filtros.category,
            onChange: (e) => setFiltros(prev => ({ ...prev, category: e.target.value, page: 1 })),
            className: 'w-full px-3 py-2 border rounded-lg'
          },
            React.createElement('option', { value: '' }, 'Todas'),
            React.createElement('option', { value: 'auth' }, 'üîê Autentica√ß√£o'),
            React.createElement('option', { value: 'user' }, 'üë• Usu√°rios'),
            React.createElement('option', { value: 'financial' }, 'üí∞ Financeiro'),
            React.createElement('option', { value: 'data' }, 'üìä Dados'),
            React.createElement('option', { value: 'admin' }, '‚öôÔ∏è Admin')
          )
        ),
        React.createElement('div', { className: 'flex-1 min-w-[150px]' },
          React.createElement('label', { className: 'block text-sm text-gray-600 mb-1' }, 'Data In√≠cio'),
          React.createElement('input', { type: 'date', value: filtros.data_inicio, onChange: (e) => setFiltros(prev => ({ ...prev, data_inicio: e.target.value })), className: 'w-full px-3 py-2 border rounded-lg' })
        ),
        React.createElement('div', { className: 'flex-1 min-w-[150px]' },
          React.createElement('label', { className: 'block text-sm text-gray-600 mb-1' }, 'Data Fim'),
          React.createElement('input', { type: 'date', value: filtros.data_fim, onChange: (e) => setFiltros(prev => ({ ...prev, data_fim: e.target.value })), className: 'w-full px-3 py-2 border rounded-lg' })
        ),
        React.createElement('div', { className: 'flex-1 min-w-[200px]' },
          React.createElement('label', { className: 'block text-sm text-gray-600 mb-1' }, 'Buscar'),
          React.createElement('input', {
            type: 'text',
            value: filtros.search,
            onChange: (e) => setFiltros(prev => ({ ...prev, search: e.target.value })),
            placeholder: 'Usu√°rio, a√ß√£o...',
            className: 'w-full px-3 py-2 border rounded-lg'
          })
        ),
        React.createElement('button', {
          onClick: () => { setFiltros(prev => ({ ...prev, page: 1 })); carregarLogs(); },
          className: 'px-4 py-2 bg-purple-600 text-white rounded-lg font-medium'
        }, 'üîç Filtrar')
      ),

      // Tabela de logs
      loading
        ? React.createElement('div', { className: 'flex items-center justify-center py-12' },
            React.createElement('div', { className: 'w-12 h-12 border-4 border-purple-200 border-t-purple-600 rounded-full animate-spin' })
          )
        : React.createElement('div', { className: 'bg-white rounded-xl shadow overflow-hidden' },
            React.createElement('div', { className: 'overflow-x-auto' },
              React.createElement('table', { className: 'w-full' },
                React.createElement('thead', { className: 'bg-gray-50' },
                  React.createElement('tr', null,
                    React.createElement('th', { className: 'px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase' }, 'Data/Hora'),
                    React.createElement('th', { className: 'px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase' }, 'Usu√°rio'),
                    React.createElement('th', { className: 'px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase' }, 'A√ß√£o'),
                    React.createElement('th', { className: 'px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase' }, 'Categoria'),
                    React.createElement('th', { className: 'px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase' }, 'Recurso'),
                    React.createElement('th', { className: 'px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase' }, 'Status')
                  )
                ),
                React.createElement('tbody', { className: 'divide-y divide-gray-200' },
                  logs.length === 0
                    ? React.createElement('tr', null,
                        React.createElement('td', { colSpan: 6, className: 'px-4 py-8 text-center text-gray-500' }, 'Nenhum log encontrado')
                      )
                    : logs.map((log, idx) =>
                        React.createElement('tr', { key: idx, className: 'hover:bg-gray-50' },
                          React.createElement('td', { className: 'px-4 py-3 text-sm text-gray-600' }, formatDate(log.created_at)),
                          React.createElement('td', { className: 'px-4 py-3' },
                            React.createElement('div', { className: 'font-medium text-gray-800 text-sm' }, log.user_name || 'An√¥nimo'),
                            React.createElement('div', { className: 'text-xs text-gray-400' }, log.user_cod || '-')
                          ),
                          React.createElement('td', { className: 'px-4 py-3 text-sm' },
                            React.createElement('span', { className: 'flex items-center gap-1' },
                              React.createElement('span', null, getActionIcon(log.action)),
                              log.action
                            )
                          ),
                          React.createElement('td', { className: 'px-4 py-3' },
                            React.createElement('span', { className: `px-2 py-1 rounded-full text-xs font-medium ${getCategoryColor(log.category)}` }, log.category)
                          ),
                          React.createElement('td', { className: 'px-4 py-3 text-sm text-gray-600' }, log.resource || '-'),
                          React.createElement('td', { className: 'px-4 py-3' },
                            React.createElement('span', { className: `px-2 py-1 rounded-full text-xs font-medium ${log.status === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}` },
                              log.status === 'success' ? '‚úì OK' : '‚úó Falha'
                            )
                          )
                        )
                      )
                )
              )
            ),
            // Pagina√ß√£o
            React.createElement('div', { className: 'px-4 py-3 bg-gray-50 flex justify-between items-center' },
              React.createElement('span', { className: 'text-sm text-gray-500' }, `${filtros.total || 0} registros`),
              React.createElement('div', { className: 'flex gap-2' },
                React.createElement('button', {
                  onClick: () => setFiltros(prev => ({ ...prev, page: Math.max(1, prev.page - 1) })),
                  disabled: filtros.page <= 1,
                  className: 'px-3 py-1 border rounded text-sm disabled:opacity-50'
                }, '‚Üê Anterior'),
                React.createElement('span', { className: 'px-3 py-1 text-sm' }, `P√°gina ${filtros.page} de ${filtros.totalPages || 1}`),
                React.createElement('button', {
                  onClick: () => setFiltros(prev => ({ ...prev, page: prev.page + 1 })),
                  disabled: filtros.page >= (filtros.totalPages || 1),
                  className: 'px-3 py-1 border rounded text-sm disabled:opacity-50'
                }, 'Pr√≥xima ‚Üí')
              )
            )
          )
    )
    // Modal do Roteirizador √© renderizado via useEffect/portal
  );
}

ReactDOM.render(React.createElement(App, null), document.getElementById("root"), hideLoadingScreen);
